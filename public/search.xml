<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Android-MVVMä¹‹LiveDataå’ŒViewModel</title>
      <link href="/2019/08/01/Android-LiveData%20and%20ViewModel/"/>
      <url>/2019/08/01/Android-LiveData%20and%20ViewModel/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰å½’çº³äº†databindingï¼Œè¯´åˆ°åº•databindingä¹Ÿåªæ˜¯æ‰¿è½½å®ä½“æ•°æ®å’ŒUIè¿›è¡Œå…³è”ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´äº’é€šï¼Œè½¬æ¢ã€‚ä½†æ˜¯å‘¢ä»¬å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦æœ‰ä¸­é—´äººæ¥æ§åˆ¶é€»è¾‘ï¼Œè¿æ¥åå°æ•°æ®åˆ°ç»‘å®šæ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ViewModelåŠ ä¸ŠDataBindingä»¥åŠLiveDataå°±å¯ä»¥å¾ˆå¥½çš„ç»„æˆä¸€ç§æ¶æ„æ¨¡å¼ã€‚æˆ‘ä»¬è¿˜æ˜¯åœ¨äº†è§£LiveDataå’ŒViewModelä¹‹åï¼Œå†ç»“åˆä¹‹å‰çš„DataBindingæ¥è¯´MVVMå§ã€‚</p><h2 id="LiveData"><a href="#LiveData" class="headerlink" title="LiveData"></a>LiveData</h2><p>è€è§„çŸ©ï¼Œé¦–å…ˆé™„ä¸Šå®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://developer.android.google.cn/topic/libraries/architecture/livedata" target="_blank" rel="noopener">LiveData</a></p><p>çœ‹çœ‹å®˜æ–¹æ€ä¹ˆå®šä¹‰LiveDataçš„ï¼š</p><blockquote><p>LiveDataæ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡æŒæœ‰ç±»ï¼Œä¸åŒäºå¹³å¸¸çš„å¯è§‚å¯Ÿå¯¹è±¡ï¼ŒLiveDataæ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ï¼Œæ„å‘³ç€å®ƒä¼šå…³å¿ƒappç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚Activityï¼Œfragmentï¼Œserviceã€‚è¿™ç§æ„ŸçŸ¥ç‰¹æ€§ä¿è¯LiveDataåªä¼šåœ¨ç”Ÿå‘½å‘¨æœŸæ´»è·ƒçš„æ—¶å€™è¿›è¡Œè§‚å¯Ÿæ›´æ–°ã€‚</p></blockquote><p>LiveDataè€ƒè™‘å°†è§‚å¯Ÿè€…ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸä¸º<code>started</code>å’Œ<code>resumed</code>ä¸‹ä¿æŒæ´»è·ƒã€‚LiveDataä»…ä»…ä¼šé€šçŸ¥æ´»è·ƒçš„è§‚å¯Ÿè€…è¿›è¡Œæ›´æ–°ï¼Œä¸æ´»è·ƒçš„è§‚å¯Ÿè€…ä¸ä¼šæ”¶åˆ°ä»»ä½•é€šçŸ¥ã€‚</p><p>ä½ å¯ä»¥æ³¨å†Œè§‚å¯Ÿè€…å¹¶ä¸”ç»™ä»–é…å¯¹å®ç°äº†<a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner.html" target="_blank" rel="noopener"><code>LifecycleOwner</code></a> çš„æ¥å£çš„å¯¹è±¡ã€‚åœ¨è¿™å±‚å…³ç³»ä¸‹ï¼Œè§‚å¯Ÿè€…ä¼šåœ¨<code>Lifecycle</code>å¯¹è±¡è¿›å…¥<code>destory</code>æ—¶è¢«ç§»é™¤ï¼Œè¿™ä¸ªå¯¹äº<code>fragment</code>å’Œ<code>activity</code>éå¸¸æœ‰ç”¨ï¼Œå®ƒå¯ä»¥å¾ˆå®‰å…¨çš„è§‚å¯Ÿlivedataå¯¹è±¡ï¼Œåœ¨<code>fragment</code>å’Œ<code>activity</code>ç”Ÿå‘½å‘¨æœŸé”€æ¯æ—¶ï¼Œå®ƒä»¬ä¼šç«‹å³è§£é™¤è®¢é˜…ï¼Œä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚</p><a id="more"></a><h3 id="LiveDataä¼˜ç‚¹"><a href="#LiveDataä¼˜ç‚¹" class="headerlink" title="LiveDataä¼˜ç‚¹"></a>LiveDataä¼˜ç‚¹</h3><ul><li><p>ç¡®ä¿UIå’Œæ•°æ®çŠ¶æ€åŒ¹é…</p><p>é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼ï¼Œlivedataä¼šåœ¨ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿæ”¹å˜é€šçŸ¥è§‚å¯Ÿè€…ï¼Œé€šè¿‡ä¹¦å†™å›ºå®šæ›´æ–°UIä»£ç ï¼Œåœ¨æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨åœ¨æ•°æ®æ”¹å˜æ—¶æ”¹å˜UIã€‚</p></li><li><p>æ²¡æœ‰å†…å­˜æ³„æ¼</p><p>è§‚å¯Ÿè€…ä¼šè¢«ç»‘å®šåˆ°<code>Lifecycle</code>å¯¹è±¡ï¼Œåœ¨å…³è”çš„ç”Ÿå‘½å‘¨æœŸè¢«é”€æ¯æ—¶ï¼Œè§‚å¯Ÿè€…ä¼šè¢«æ¸…ç†ã€‚</p></li><li><p>activityåœæ­¢ä¸ä¼šå´©æºƒ</p><p>å¦‚æœè§‚å¯Ÿè€…å¤„äºä¸æ´»è·ƒçŠ¶æ€ï¼Œæ¯”å¦‚activityåœ¨åå°è¿è¡Œï¼Œè§‚å¯Ÿè€…ä¸ä¼šæ”¶åˆ°livedataçš„äº‹ä»¶</p></li><li><p>ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</p><p>UIç»„ä»¶åªä¼šè§‚å¯Ÿæ•°æ®ï¼Œä¸ä¼šåœæ­¢å’Œæ¢å¤è§‚å¯Ÿï¼Œè¿™äº›éƒ½æ˜¯äº¤ç”±livedataè‡ªåŠ¨ç®¡ç†ã€‚å› ä¸ºlivedataå¯ä»¥æ„ŸçŸ¥</p></li><li><p>ä¿æŒæ•°æ®æœ€æ–°</p><p>å¦‚æœç”Ÿå‘½å‘¨æœŸæ˜¯ä¸æ´»è·ƒçš„ï¼Œå®ƒå°†åœ¨å˜ä¸ºæ´»è·ƒæ˜¯è·å–æœ€æ–°çš„æ•°æ®ã€‚ä¾‹å¦‚activityä»åå°æ¥åˆ°å‰å°å°†ä¼šæ”¶å–æœ€æ–°çš„æ•°æ®ã€‚</p></li><li><p>é€‚é…é…ç½®æ›´æ”¹</p><p>activityå’Œfragmentå› ä¸ºé…ç½®æ›´æ”¹è€Œé‡å»ºï¼Œå®ƒä»¬ä¼šæ”¶åˆ°æœ€æ–°çš„æ•°æ®</p></li><li><p>å…±äº«èµ„æº</p><p>ä½¿ç”¨å•ä¾‹æ¨¡å¼ç»§æ‰¿LiveDataï¼Œå¹¶ä¸”åŒ…è£¹ç³»ç»ŸæœåŠ¡ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨åœ¨å…¨å±€ä½¿ç”¨ï¼Œä¸€æ—¦è¿æ¥åˆ°ç³»ç»ŸæœåŠ¡ï¼Œä»»ä½•è§‚å¯Ÿè€…éƒ½å¯ä»¥æŸ¥çœ‹livedataã€‚</p></li></ul><h3 id="ä½¿ç”¨LiveData"><a href="#ä½¿ç”¨LiveData" class="headerlink" title="ä½¿ç”¨LiveData"></a>ä½¿ç”¨LiveData</h3><p>ä¸€èˆ¬æ¥è®²æ˜¯è¦å£°æ˜ä¾èµ–</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="keyword">def</span> lifecycle_version = <span class="string">"2.0.0"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ViewModel and LiveData</span></span><br><span class="line">    implementation <span class="string">"androidx.lifecycle:lifecycle-extensions:$lifecycle_version"</span></span><br><span class="line">    <span class="comment">// alternatively - just ViewModel</span></span><br><span class="line">    implementation <span class="string">"androidx.lifecycle:lifecycle-viewmodel:$lifecycle_version"</span> <span class="comment">// For Kotlin use lifecycle-viewmodel-ktx</span></span><br><span class="line">    <span class="comment">// alternatively - just LiveData</span></span><br><span class="line">    implementation <span class="string">"androidx.lifecycle:lifecycle-livedata:$lifecycle_version"</span></span><br><span class="line">    <span class="comment">// alternatively - Lifecycles only (no ViewModel or LiveData). Some UI</span></span><br><span class="line">    <span class="comment">//     AndroidX libraries use this lightweight import for Lifecycle</span></span><br><span class="line">    implementation <span class="string">"androidx.lifecycle:lifecycle-runtime:$lifecycle_version"</span></span><br><span class="line"></span><br><span class="line">    annotationProcessor <span class="string">"androidx.lifecycle:lifecycle-compiler:$lifecycle_version"</span> <span class="comment">// For Kotlin use kapt instead of annotationProcessor</span></span><br><span class="line">    <span class="comment">// alternately - if using Java8, use the following instead of lifecycle-compiler</span></span><br><span class="line">    implementation <span class="string">"androidx.lifecycle:lifecycle-common-java8:$lifecycle_version"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// optional - ReactiveStreams support for LiveData</span></span><br><span class="line">    implementation <span class="string">"androidx.lifecycle:lifecycle-reactivestreams:$lifecycle_version"</span> <span class="comment">// For Kotlin use lifecycle-reactivestreams-ktx</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// optional - Test helpers for LiveData</span></span><br><span class="line">    testImplementation <span class="string">"androidx.arch.core:core-testing:$lifecycle_version"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘¢ï¼Œæˆ‘åœ¨AS3.4çš„åŸºç¡€ä¸Šæ‰“å¼€Databingåï¼Œè¿™äº›LiveDataå’ŒViewModeléƒ½æœ‰äº†ã€‚ã€‚è¿™äº›ç»„ä»¶ä¹Ÿæ˜¯å‡ å¹´å‰å°±æœ‰äº†å°±ï¼Œä¼°è®¡å› ä¸ºç°åœ¨æ˜¯9012å¹´çš„åŸå› ï¼Œç›´æ¥éƒ½ç»™ä½ é›†æˆå¥½äº†ã€‚</p><p>ä¸€èˆ¬æ¥è¯´æ˜¯è¿™æ ·çš„æ­¥éª¤ï¼š</p><ul><li>åœ¨ViewModelä¸­å£°æ˜åˆ›é”®LiveDataå¯¹è±¡</li><li>åœ¨UIæ§åˆ¶å™¨ä¸­ï¼Œæ¯”å¦‚activityï¼Œfragmentä¸­åˆ›é”®è§‚å¯Ÿè€…<code>Observer</code>å¯¹è±¡ï¼Œå®ç°<code>onChange</code>é€»è¾‘</li><li>é€šè¿‡åœ¨LiveDataä¸Šè°ƒç”¨<code>oberve</code>å…³è”<code>Observer</code>å’Œ<code>LiveData</code>ï¼Œéœ€è¦ä¼ å…¥<code>lifecycleOwner</code>ï¼Œä¸€èˆ¬æ˜¯åœ¨UIæ§åˆ¶ä¸­æ‰§è¡Œ</li></ul><blockquote><p>å¦‚æœoberverå’Œlivedataä¹‹é—´æ²¡æœ‰å…³è”lifecycleOwnerï¼Œåˆ™é»˜è®¤è€ƒè™‘è¿™ä¸ªobserveræ€»æ˜¯å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå³æ€»æ˜¯æ¥å—é€šçŸ¥å‘ç”Ÿè°ƒç”¨ã€‚ä½ å¯ä»¥é€šè¿‡<code>removeOberver()</code>ç§»é™¤å®ƒ</p></blockquote><p>å½“livedataæ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè§¦å‘é™„ç€åœ¨ç”Ÿå‘½å‘¨æœŸä¸Šæ´»è·ƒçš„oberver</p><p>livedataå…è®¸åœ¨æ§åˆ¶å™¨ä¸­è®¢é˜…å®ƒï¼Œå¹¶ä¸”è§¦å‘è¿›è¡ŒUIå˜åŒ–</p><h4 id="åˆ›é”®LiveDataå¯¹è±¡"><a href="#åˆ›é”®LiveDataå¯¹è±¡" class="headerlink" title="åˆ›é”®LiveDataå¯¹è±¡"></a>åˆ›é”®LiveDataå¯¹è±¡</h4><p>LiveDataä¸€ä¸ªå¯ä»¥åŒ…è£…å¯¹è±¡ï¼ŒåŒ…æ‹¬äº†é›†åˆï¼Œä¸€ä¸ªLiveDataé€šå¸¸æ˜¯åœ¨ViewModelä¸­å£°æ˜çš„ï¼ŒåŒæ—¶æä¾›getteræ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Create a LiveData with a String</span></span><br><span class="line">    <span class="keyword">private</span> MutableLiveData&lt;String&gt; currentName;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MutableLiveData&lt;String&gt; <span class="title">getCurrentName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentName == <span class="keyword">null</span>) &#123;</span><br><span class="line">            currentName = <span class="keyword">new</span> MutableLiveData&lt;String&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> currentName;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Rest of the ViewModel...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¡®ä¿åœ¨ViewModelä¸­å­˜å‚¨UIçš„LiveDataå¯¹è±¡ï¼Œç¬¬ä¸€ï¼Œé¿å…activityå’Œfragmentè¿‡åº¦è†¨èƒ€ï¼Œå®ƒä»¬çš„èŒè´£åº”è¯¥æ˜¯è´Ÿè´£UIæ˜¾ç¤ºè€Œä¸æ˜¯ä¿å­˜æ•°æ®çŠ¶æ€ï¼Œç¬¬äºŒã€å°†LiveDataå®ä¾‹å’Œactivityï¼Œfragmentè¿›è¡Œè§£è€¦ï¼Œå¹¶ä¸”å…è®¸åœ¨é…ç½®å‘ç”Ÿæ”¹å˜æ—¶ä¾ç„¶å­˜æ´»</p></blockquote><h4 id="è§‚å¯ŸLiveDataå¯¹è±¡"><a href="#è§‚å¯ŸLiveDataå¯¹è±¡" class="headerlink" title="è§‚å¯ŸLiveDataå¯¹è±¡"></a>è§‚å¯ŸLiveDataå¯¹è±¡</h4><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨appç»„ä»¶çš„<code>onCreate</code>æ–¹æ³•ä¸­å¼€å¯<code>LiveData</code>è§‚å¯Ÿæ˜¯éå¸¸é€‚åˆçš„ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ul><li>onResumeè°ƒç”¨æ—¶ä¸ä¼šäº§ç”Ÿå†—ä½™è°ƒç”¨åœ¨</li><li>ç¡®ä¿activityï¼Œfragmentæ‹¥æœ‰æ•°æ®ï¼Œåœ¨å¤„äºæ´»è·ƒçŠ¶æ€ç«‹å³å±•ç¤ºå®ƒï¼Œä¸€æ—¦è¿›å…¥<code>started</code>çŠ¶æ€ï¼Œç«‹å³æ”¶å–æœ€è¿‘çš„æ•°æ®</li></ul><p>è§¦å‘æ´»è·ƒçŠ¶æ€ä¸‹çš„oberverï¼Œä¾‹å¤–ï¼Œä»éæ´»è·ƒè½¬ä¸ºæ´»è·ƒä¹Ÿä¼šè§¦å‘ï¼Œå¦‚æœç¬¬äºŒæ¬¡ä»éæ´»è·ƒåˆ°æ´»è·ƒï¼Œåªæœ‰ä¸Šæ¬¡æƒ…å†µä¸‹çš„å€¼å‘ç”Ÿæ”¹å˜äº†æ‰ä¼šè§¦å‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> NameViewModel model;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">// Other code to setup the activity...</span></span><br><span class="line">        <span class="comment">// Get the ViewModel.</span></span><br><span class="line">        model = ViewModelProviders.of(<span class="keyword">this</span>).get(NameViewModel.class);</span><br><span class="line">        <span class="comment">// Create the observer which updates the UI.</span></span><br><span class="line">        <span class="keyword">final</span> Observer&lt;String&gt; nameObserver = <span class="keyword">new</span> Observer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(@Nullable <span class="keyword">final</span> String newName)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// Update the UI, in this case, a TextView.</span></span><br><span class="line">                nameTextView.setText(newName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// Observe the LiveData, passing in this activity as the LifecycleOwner and the observer.</span></span><br><span class="line">        model.getCurrentName().observe(<span class="keyword">this</span>, nameObserver);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°æ®æ”¹å˜ï¼Œè§¦å‘ç›‘å¬</p><h4 id="æ›´æ–°LiveDataå¯¹è±¡"><a href="#æ›´æ–°LiveDataå¯¹è±¡" class="headerlink" title="æ›´æ–°LiveDataå¯¹è±¡"></a>æ›´æ–°LiveDataå¯¹è±¡</h4><p>é€šè¿‡<code>setValue(T)</code>å’Œ<code>postValue</code>æ¥æ›´æ–°æ•°æ®ï¼Œè§¦å‘ç›‘å¬ï¼Œæ›´æ–°UI</p><p><code>setValue</code>åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°æ•°æ®</p><p><code>postValue</code>å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­ï¼Œå­çº¿ç¨‹ä¸­ç”¨å®ƒå°±å¯¹äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">button.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        String anotherName = <span class="string">"John Doe"</span>;</span><br><span class="line">        model.getCurrentName().setValue(anotherName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="Roomä¸­ä½¿ç”¨LiveData"><a href="#Roomä¸­ä½¿ç”¨LiveData" class="headerlink" title="Roomä¸­ä½¿ç”¨LiveData"></a>Roomä¸­ä½¿ç”¨LiveData</h4><p>Roomæ”¯æŒå¯è§‚å¯Ÿçš„æŸ¥è¯¢ï¼Œè¿”å›LiveDataå¯¹è±¡ï¼Œé€šè¿‡LiveDataï¼Œä»¥åŠè®¾ç½®è§‚å¯Ÿè€…ï¼Œä¿æŒUIæ•°æ®å’Œæ•°æ®åº“åŒæ­¥ï¼Œå…·ä½“ä»¥åçœ‹Roomçš„å­¦ä¹ å§</p><h4 id="LiveDataä½¿ç”¨åç¨‹"><a href="#LiveDataä½¿ç”¨åç¨‹" class="headerlink" title="LiveDataä½¿ç”¨åç¨‹"></a>LiveDataä½¿ç”¨åç¨‹</h4><p>æ”¯æŒkotlinçš„åç¨‹ï¼ˆå‘ƒå‘ƒï¼Œè¿™ä¸ªæˆ‘è¿˜ä¸æ˜¯å¾ˆä¼šğŸ˜­ï¼‰</p><h3 id="æ‰©å±•LiveData"><a href="#æ‰©å±•LiveData" class="headerlink" title="æ‰©å±•LiveData"></a>æ‰©å±•LiveData</h3><p>LiveDataä¼šæ ¹æ®oberverç”Ÿå‘½å‘¨æœŸå®¿ä¸»æ˜¯å¦æ˜¯<code>STARTED</code>å’Œ<code>RESUME</code>æ¥è®¤å®šoberveræ˜¯å¦å¤„äºæ´»è·ƒå’Œéæ´»è·ƒçŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StockLiveData</span> <span class="keyword">extends</span> <span class="title">LiveData</span>&lt;<span class="title">BigDecimal</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> StockManager stockManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SimplePriceListener listener = <span class="keyword">new</span> SimplePriceListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPriceChanged</span><span class="params">(BigDecimal price)</span> </span>&#123;</span><br><span class="line">            setValue(price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StockLiveData</span><span class="params">(String symbol)</span> </span>&#123;</span><br><span class="line">        stockManager = <span class="keyword">new</span> StockManager(symbol);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stockManager.requestPriceUpdates(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onInactive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stockManager.removeUpdates(listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>onActive å½“LiveDataæ‹¥æœ‰æ´»è·ƒçš„oberverï¼Œå¯ä»¥å¼€å§‹ç›‘å¬æ•°æ®ï¼Œè°ƒç”¨</li><li>onInActive LiveDataæ²¡æœ‰æ´»è·ƒçš„oberverï¼Œä¸ä¼šè§¦å‘ç›‘å¬ï¼Œè°ƒç”¨</li></ul><p>é€šè¿‡æ‰©å±•ï¼Œå¯ä»¥åŠ å…¥è‡ªå·±çš„ç›‘å¬å™¨</p><p>è¿™äº›obseverä¼šéšç€ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œæ¯”å¦‚æ´»è·ƒçŠ¶æ€ï¼Œæ¶ˆäº¡çŠ¶æ€</p><p>é€šè¿‡å•ä¾‹è¿›è¡Œåˆ†äº«</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StockLiveData</span> <span class="keyword">extends</span> <span class="title">LiveData</span>&lt;<span class="title">BigDecimal</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> StockLiveData sInstance;</span><br><span class="line">    <span class="keyword">private</span> StockManager stockManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SimplePriceListener listener = <span class="keyword">new</span> SimplePriceListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPriceChanged</span><span class="params">(BigDecimal price)</span> </span>&#123;</span><br><span class="line">            setValue(price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StockLiveData <span class="title">get</span><span class="params">(String symbol)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            sInstance = <span class="keyword">new</span> StockLiveData(symbol);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">StockLiveData</span><span class="params">(String symbol)</span> </span>&#123;</span><br><span class="line">        stockManager = <span class="keyword">new</span> StockManager(symbol);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stockManager.requestPriceUpdates(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onInactive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stockManager.removeUpdates(listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½ å¯ä»¥åœ¨fragmentä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        StockLiveData.get(symbol).observe(<span class="keyword">this</span>, price -&gt; &#123;</span><br><span class="line">            <span class="comment">// Update the UI.</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å˜æ¢LiveData"><a href="#å˜æ¢LiveData" class="headerlink" title="å˜æ¢LiveData"></a>å˜æ¢LiveData</h3><p>å½“ä½ æƒ³è¦åœ¨å‘é€é€šçŸ¥å‰æ”¹å˜<code>LiveData</code>çš„å€¼ï¼Œæˆ–è€…ä½ éœ€è¦åŸºäºåŸæ¥çš„<code>LiveData</code>è¿”å›ä¸€ä¸ªå¦ä¸€<code>LiveData</code>ï¼Œ<code>LifeCycle</code>åŒ…é‡Œé¢æä¾›äº†è¿™æ ·çš„å·¥å…·ç±»<code>Transformations</code></p><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LiveData&lt;User&gt; userLiveData = ...;</span><br><span class="line">LiveData&lt;String&gt; userName = Transformations.map(userLiveData, user -&gt; &#123;</span><br><span class="line">    user.name + <span class="string">" "</span> + user.lastName</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="switchMap"><a href="#switchMap" class="headerlink" title="switchMap"></a>switchMap</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> LiveData&lt;User&gt; <span class="title">getUser</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">  ...;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LiveData&lt;String&gt; userId = ...;</span><br><span class="line">LiveData&lt;User&gt; user = Transformations.switchMap(userId, id -&gt; getUser(id) );</span><br></pre></td></tr></table></figure><p>å˜æ¢æ˜¯æƒ°æ€§çš„ï¼Œåªæœ‰åœ¨åœ¨æ­£å¤„äºè§‚å¯Ÿå’Œè¿”å›æ•°æ®æ—¶è¿›è¡Œè®¡ç®—ã€‚</p><h3 id="åˆå¹¶å¤šä¸ªLiveDataæº"><a href="#åˆå¹¶å¤šä¸ªLiveDataæº" class="headerlink" title="åˆå¹¶å¤šä¸ªLiveDataæº"></a>åˆå¹¶å¤šä¸ªLiveDataæº</h3><p>ä½¿ç”¨<code>MediatorLiveData</code>æ¥åˆå¹¶å¤šä¸ª<code>LiveData</code>ï¼Œä¸€æ—¦å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªæ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œ<code>MediatorLiveData</code>çš„<code>Ovserver</code>ä¼šè§¦å‘å˜åŒ–ï¼Œä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¥è‡ªæ•°æ®åº“çš„LiveDataï¼Œä¸€ä¸ªæ¥è‡ªç½‘ç»œçš„LiveDataï¼Œä»¥åŠèšåˆäº†äºŒè€…çš„ä¸UIç›¸å…³çš„<code>MediatorLiveData</code>ï¼Œæ— è®ºåœ¨æ˜¯æ•°æ®åº“è¿˜æ˜¯ç½‘ç»œå‘ç”Ÿå˜åŒ–ï¼Œéƒ½ä¼šè§¦å‘UIçš„<code>MediatorLiveData</code>çš„observerã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€»çš„æ¥è®²LiveDataå¯¹è±¡ï¼Œå°±æ˜¯ä¸€ä¸ªå…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ï¼ŒæŒæœ‰å¯è§‚å¯Ÿæ•°æ®ï¼Œä¸ä»…ä»…å±€é™äºUIã€‚ä½¿ç”¨å®ƒå¯ä»¥åœ¨MVVMçš„ç»“æ„ä¸­ä½¿å¾—ViewModelä¸ä¾èµ–Viewè¿™ä¸€å±‚ä»è€Œå®ŒæˆViewçš„å˜åŒ–ã€‚</p><p>View-&gt;ViewModel-&gt;Model</p><h2 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h2><p>å®šä¹‰ï¼šåœ¨ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œç”¨äºå­˜å‚¨ç®¡ç†UIå…³è”çš„æ•°æ®ã€‚ViewModelå…è®¸åœ¨é…ç½®å‘ç”Ÿæ”¹å˜æ—¶å­˜æ´»</p><p>ç¼˜ç”±ï¼š</p><p>Android frameworkç®¡ç†è€…activityï¼Œfragmentçš„ç”Ÿå‘½å‘¨æœŸï¼ŒAndroid framework ä¹Ÿè®¸ä¼šå› ä¸ºæŸäº›å¤±æ§çš„äº‹ä»¶å’Œæ“ä½œæ¥è¿›è¡Œé”€æ¯ï¼Œé‡å»ºactivityï¼Œfragmentã€‚åœ¨å‘ç”Ÿè¿™ç§æƒ…å†µä¸‹æ—¶å€™ï¼Œç¬æ—¶çš„UIæ•°æ®å°±ä¼šä¸¢å¤±ï¼Œåœ¨ä¹‹å‰çš„æƒ…å†µä¸‹æˆ‘ä»¬ä¼šé€šè¿‡<code>onSaveInstanceState</code>å»ä¿å­˜æŸäº›æ•°æ®ï¼Œä»¥ä¾¿ä¸‹æ¬¡é‡å»ºæ—¶<code>onCreate</code>è¿›è¡Œæ•°æ®æ¢å¤ï¼Œä½†æ˜¯è¿™ä¸ªè§£å†³æ–¹å¼åªé€‚ç”¨äºä¸€äº›è½»é‡çš„åºåˆ—åŒ–æ•°æ®ï¼Œåƒé‚£äº›<code>Bitmap</code>å°±ä¸é€‚ç”¨äº†ã€‚</p><p>å†è€…ï¼ŒUIæ§åˆ¶å™¨ä¼šç»å¸¸æ€§å»åšä¸€äº›å¼‚æ­¥è°ƒç”¨ï¼Œå¹¶ä¸”æœ‰å¯èƒ½è¿”å›æ•°æ®ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ï¼ŒUIæ§åˆ¶å™¨éœ€è¦ç®¡ç†è¿™äº›è°ƒç”¨ï¼Œåœ¨UIæ§åˆ¶å™¨é”€æ¯æ—¶å»æ¸…ç†ã€‚è¿™ç§æ–¹å¼éœ€è¦å¤§é‡çš„ç»´æŠ¤ï¼Œå¹¶ä¸”åœ¨é…ç½®å‘ç”Ÿæ”¹å˜ï¼ŒæŸäº›éœ€è¦é‡å»ºçš„èµ„æºå¯¹è±¡åœ¨é‡å»ºæ—¶ä¼šæ¶ˆè€—å¤§é‡èµ„æºã€‚</p><p>å¯¹äºUIæ§åˆ¶å™¨æ¥è¯´ï¼Œå®ƒçš„è´£ä»»åº”è¯¥æ˜¯UIå±•ç¤ºï¼ŒUIäº¤äº’ï¼Œå¤„ç†å’Œç³»ç»Ÿçš„äº¤æµæ¯”å¦‚æƒé™è¯·æ±‚ã€‚å°†è¿‡å¤šçš„è´£ä»»åˆ†é…ç»™UIæ§åˆ¶å™¨ä¼šå¯¼è‡´ä»£ç è‡ƒè‚¿ã€‚å°è¯•å°†ä¸€äº›è´£ä»»åˆ†é…å‡ºå»ï¼Œä¹Ÿä¼šä¾¿äºæµ‹è¯•ã€‚</p><h3 id="å®ç°ViewModel"><a href="#å®ç°ViewModel" class="headerlink" title="å®ç°ViewModel"></a>å®ç°ViewModel</h3><p>æ¶æ„ç»„ä»¶æä¾›ViewModelæ¥å¸®åŠ©UIæ§åˆ¶å™¨æ‰¿æ‹…UIæ•°æ®è´®å¤‡çš„èŒè´£ï¼Œå¹¶ä¸”å®ƒä¼šåœ¨é…ç½®æ”¹å˜æ—¶è‡ªåŠ¨ä¿å­˜ï¼Œä¸‹æ¬¡æ¢å¤æ—¶ç«‹é©¬å¯ç”¨ã€‚</p><p>è¿™ä¸ªä¾‹å­æ˜¯ç”¨äºåŠ è½½ç”¨æˆ·åˆ—è¡¨æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MutableLiveData&lt;List&lt;User&gt;&gt; users;</span><br><span class="line">    <span class="keyword">public</span> LiveData&lt;List&lt;User&gt;&gt; getUsers() &#123;</span><br><span class="line">        <span class="keyword">if</span> (users == <span class="keyword">null</span>) &#123;</span><br><span class="line">            users = <span class="keyword">new</span> MutableLiveData&lt;List&lt;User&gt;&gt;();</span><br><span class="line">            loadUsers();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Do an asynchronous operation to fetch users.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨UIæ§åˆ¶å™¨ä¸­ç›‘å¬æ•°æ®å˜åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Create a ViewModel the first time the system calls an activity's onCreate() method.</span></span><br><span class="line">        <span class="comment">// Re-created activities receive the same MyViewModel instance created by the first activity.</span></span><br><span class="line"></span><br><span class="line">        MyViewModel model = ViewModelProviders.of(<span class="keyword">this</span>).get(MyViewModel.class);</span><br><span class="line">        model.getUsers().observe(<span class="keyword">this</span>, users -&gt; &#123;</span><br><span class="line">            <span class="comment">// update UI</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ViewModelä¸å…è®¸æŒæœ‰Viewå¼•ç”¨ã€Lifecycleä»¥åŠä»»ä½•æŒæœ‰äº†activity contextçš„å¯¹è±¡çš„å¼•ç”¨</strong>ï¼Œ<strong>å³UIæ— å…³</strong></p><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>ViewModelçš„ä½œç”¨åŸŸæ˜¯é€šè¿‡<code>Lifecycle</code>é€šè¿‡<code>ViewModelProvider</code>ä¼ é€’çš„ï¼Œ<code>ViewModel</code>ä¼šä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°<code>Lifecycle</code>çš„ä½œç”¨åŸŸæ¶ˆå¤±ï¼Œæ¯”å¦‚ï¼Œactivityçš„finishï¼Œfragmentçš„detachï¼Œå¯ä»¥è§ä¸‹å›¾</p><p><img src="https://developer.android.google.cn/images/topic/libraries/architecture/viewmodel-lifecycle.png" alt="ViewModelç”Ÿå‘½å‘¨æœŸ"></p><p>é€šå¸¸æ¥è®²å®åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚<code>onCreate</code>åˆ›é”®<code>ViewModel</code>ï¼Œè¿‡ç¨‹ä¸­å¯èƒ½å¤šæ¬¡<code>onCreate</code>ï¼Œä½†æ˜¯åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚<code>ViewModel</code>ç›´åˆ°activity finished and destroyed ä¹‹é—´éƒ½æ˜¯å­˜åœ¨çš„ã€‚</p><h3 id="åœ¨Fragmenté—´å…±äº«æ•°æ®ï¼Œé€šä¿¡"><a href="#åœ¨Fragmenté—´å…±äº«æ•°æ®ï¼Œé€šä¿¡" class="headerlink" title="åœ¨Fragmenté—´å…±äº«æ•°æ®ï¼Œé€šä¿¡"></a>åœ¨Fragmenté—´å…±äº«æ•°æ®ï¼Œé€šä¿¡</h3><p>é€šå¸¸ä¸€ä¸ªactivityä¼šåŒ…å«å¤šä¸ªfragmentï¼Œç„¶è€Œå¤šä¸ªfragmentä¹‹é—´ä¼šæ¶‰åŠç›¸å…³è”çš„æ•°æ®ä»¥åŠæ“ä½œï¼Œfragmentä¹‹é—´éœ€è¦é€šä¿¡ï¼Œç®€å•çš„è§£å†³æ–¹æ³•æ˜¯é€šè¿‡å®šä¹‰æ¥å£è¿›è¡Œå›è°ƒï¼Œä½†æ˜¯å¾ˆç¹çï¼Œæ¯ä¸ªéƒ½å†™é‚£ä¸å¾—çƒ¦æ­»ï¼Œè¿˜å¾—ç»‘å®šï¼Œè§£ç»‘ï¼Œç”Ÿå‘½å‘¨æœŸå¯è§æ€§ï¼Œå„ç§è€ƒè™‘ã€‚é€šè¿‡å…±äº«å¾—ViewModelå¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SharedViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MutableLiveData&lt;Item&gt; selected = <span class="keyword">new</span> MutableLiveData&lt;Item&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">(Item item)</span> </span>&#123;</span><br><span class="line">        selected.setValue(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LiveData&lt;Item&gt; <span class="title">getSelected</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> selected;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MasterFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SharedViewModel model;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        model = ViewModelProviders.of(getActivity()).get(SharedViewModel.class);</span><br><span class="line">        itemSelector.setOnClickListener(item -&gt; &#123;</span><br><span class="line">            model.select(item);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        SharedViewModel model = ViewModelProviders.of(getActivity()).get(SharedViewModel.class);</span><br><span class="line">        model.getSelected().observe(<span class="keyword">this</span>, &#123; item -&gt;</span><br><span class="line">           <span class="comment">// Update the UI.</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªfragmentå…±åŒå¤„äºä¸€ä¸ªactivityï¼Œå½“ç„¶viewmodelä¹Ÿæ˜¯åŒä¸€ä¸ªã€‚</p><p>ä¼˜ç‚¹</p><ul><li>activityä¸éœ€è¦äº†è§£ä»»ä½•äº‹æƒ…ï¼Œç”šè‡³é€šä¿¡å†…å®¹</li><li>fragmentåªéœ€è¦äº†è§£å’ŒViewmodelä¹‹é—´çš„å¥‘çº¦ï¼Œå…¶å®ƒçš„ä¸éœ€è¦äº†è§£ï¼Œå…¶ä¸­ä¹‹ä¸€çš„fragmentæ¶ˆå¤±äº†ï¼Œå¦ä¸€ä¸ªè¿˜æ˜¯ä¼šæ­£å¸¸å·¥ä½œ</li><li>æ¯ä¸ªfragmentéƒ½æœ‰å„è‡ªçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä»¬ä¹‹é—´äº’ä¸å½±å“ï¼Œå¦‚æœä¸€ä¸ªfragmentè¢«æ›¿æ¢äº†ï¼ŒUIè¿˜æ˜¯ä¼šæ­£å¸¸å·¥ä½œã€‚</li></ul><h3 id="ä½¿ç”¨ViewModelæ›¿æ¢loaderè¿›è¡ŒåŠ è½½"><a href="#ä½¿ç”¨ViewModelæ›¿æ¢loaderè¿›è¡ŒåŠ è½½" class="headerlink" title="ä½¿ç”¨ViewModelæ›¿æ¢loaderè¿›è¡ŒåŠ è½½"></a>ä½¿ç”¨ViewModelæ›¿æ¢loaderè¿›è¡ŒåŠ è½½</h3><p>ä»¥å‰ä½¿ç”¨loaderæ¥åŒæ­¥UIå’Œæ•°æ®åº“çš„æ•°æ®</p><p><img src="https://developer.android.google.cn/images/topic/libraries/architecture/viewmodel-loader.png" alt></p><p>ç°åœ¨è¿™æ ·ç”¨</p><p><img src="https://developer.android.google.cn/images/topic/libraries/architecture/viewmodel-replace-loader.png" alt></p><h3 id="ViewModelä¸­ä½¿ç”¨åç¨‹"><a href="#ViewModelä¸­ä½¿ç”¨åç¨‹" class="headerlink" title="ViewModelä¸­ä½¿ç”¨åç¨‹"></a>ViewModelä¸­ä½¿ç”¨åç¨‹</h3><p>å¾…å­¦ä¹ </p><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p> éšç€æ•°æ®å˜å¾—å¤æ‚ï¼Œè€ƒè™‘å°†æ•°æ®åŠ è½½åˆ†ç¦»å‡ºå»ï¼Œå½“å½“å½“ï¼Œè¿™ä¸€æ­¥èµ°å®Œä¸å°±æ˜¯MVVMäº†å—ï¼Ÿå“ˆå“ˆ</p><h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p>å…¶å®ä»DataBindåˆ°LiveDataï¼Œå†åˆ°ViewModelå°±å·®ä¸å¤šæ˜¯MVVMçš„é›å½¢äº†</p><p>Mï¼šModelå±‚ï¼Œç”¨äºå®é™…çš„æ•°æ®åŠ è½½ï¼Œåªè´Ÿè´£åŠ è½½æ•°æ®</p><p>Vï¼šViewå±‚ï¼Œè´Ÿè´£UIå±•ç¤ºï¼Œäº¤äº’</p><p>VMï¼šViewMdoelå±‚ï¼Œè´Ÿè´£Viewçš„æ•°æ®ï¼Œè¿é€šViewå’ŒModelï¼Œè´Ÿè´£è·å–Modelçš„æ•°æ®ï¼Œè½¬åŒ–ä¸ºUIçš„æ•°æ®ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬äº†é€»è¾‘å¤„ç†</p><p>å¦‚æœæ„Ÿè§‰VMå±‚å¤ªç¹é‡ï¼Œå¯ä»¥ç»§ç»­åˆ†ç¦»ä¸€å±‚Presenteræ¥å¤„ç†é€»è¾‘ï¼Œäº¦æˆ–è€…åˆ†ç¦»ä¸€å±‚Mediatoræ¥å¤„ç†éªŒè¯</p><p>View -&gt; ViewModel -&gt; Model ç°åœ¨çš„ä¾èµ–å•å‘ï¼Œé€šè¿‡LiveDataå’ŒåŒå‘ç»‘å®šï¼ŒViewModelä¸éœ€è¦ä¾èµ–Viewäº†ã€‚</p><p>ç°åœ¨çš„æ¶æ„å˜æˆè¿™æ ·äº†ï¼Œç®€æ´æ˜äº†</p><p><img src="https://developer.android.google.cn/topic/libraries/architecture/images/final-architecture.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mvvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android-MVVMä¹‹DataBinding</title>
      <link href="/2019/07/30/Android-DataBinding/"/>
      <url>/2019/07/30/Android-DataBinding/</url>
      
        <content type="html"><![CDATA[<blockquote><p>MVVMä¸€ç§androidæ¶æ„æ¨¡å¼ï¼Œè°·æ­Œå®˜æ–¹æ¶æ„ä¸­å®ç°äº†ï¼ŒåŒ…æ‹¬databindingï¼Œviewmodelï¼Œlivedataï¼Œroomï¼Œlifecycleï¼Œç­‰ä¸€å¥—ç”¨äºmvvmæ¶æ„çš„æ¶æ„ç»„ä»¶ã€‚</p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ•´ä½“å­¦ä¹ MVVMä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¥å•ç‹¬çœ‹çœ‹DataBindingæ˜¯å¹²å˜›çš„</p><p>é¦–å…ˆé™„ä¸Šå®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://developer.android.google.cn/topic/libraries/data-binding" target="_blank" rel="noopener">Data Binding Library</a> ï¼Œä»¥åŠ<a href="https://github.com/googlesamples/android-databinding" target="_blank" rel="noopener">å®˜æ–¹demo</a></p><p>å®˜æ–¹æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p><blockquote><p>æ•°æ®ç»‘å®šåº“æ˜¯ä¸€ç§æ”¯æŒåº“ï¼Œå€ŸåŠ©è¯¥åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å£°æ˜æ€§æ ¼å¼ï¼ˆè€Œéç¨‹åºåŒ–åœ°ï¼‰å°†å¸ƒå±€ä¸­çš„ç•Œé¢ç»„ä»¶ç»‘å®šåˆ°åº”ç”¨ä¸­çš„æ•°æ®æºã€‚</p></blockquote><p>å°±åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:text</span>=<span class="string">"@&#123;viewmodel.userName&#125;"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>è¯¶ï¼Œå¥½åƒä¼¼æ›¾ç›¸è¯†ï¼Œå¯¹äº†ï¼Œå’Œé‚£ä¸ªjspçš„elè¡¨è¾¾å¼ï¼Œä»¥åŠspringä¸­è¡¨è¾¾å¼æœ‰ç‚¹åƒå•Šã€‚è¿™æ ·å°±å¥½ç†è§£äº†ï¼Œxml UIé€šè¿‡æŸç§æ•°æ®ç»‘å®šï¼Œå¯ä»¥é€šè¿‡è¿™ç§å£°æ˜å¼å°†æ•°æ®ä¼ åˆ°UIä¸­ã€‚ä¸å¾—ä¸è¯´æœ‰ç‚¹äº²åˆ‡ï¼Œå“ˆå“ˆã€‚æˆ‘ä¸‹é¢çš„å†™ä¸œè¥¿ä¹ŸåŸºæœ¬ä¸Šæ˜¯æ€»ç»“(ç¿»è¯‘233)å®˜æ–¹æ–‡æ¡£ï¼Œæ‰€ä»¥ç»“æ„ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p><a id="more"></a><h2 id="åˆæ­¥"><a href="#åˆæ­¥" class="headerlink" title="åˆæ­¥"></a>åˆæ­¥</h2><blockquote><p>APIè¦æ±‚14ä»¥ä¸Šï¼Œgradle1.5ä»¥ä¸Š</p></blockquote><h3 id="æ„å»ºç¯å¢ƒ"><a href="#æ„å»ºç¯å¢ƒ" class="headerlink" title="æ„å»ºç¯å¢ƒ"></a>æ„å»ºç¯å¢ƒ</h3><p>å¼€å¯DataBinding</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    dataBinding &#123;</span><br><span class="line">        enabled = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ASå¯¹databindingçš„æ”¯æŒ"><a href="#ASå¯¹databindingçš„æ”¯æŒ" class="headerlink" title="ASå¯¹databindingçš„æ”¯æŒ"></a>ASå¯¹databindingçš„æ”¯æŒ</h3><ul><li>è¯­æ³•é«˜äº®</li><li>è¯­æ³•é”™è¯¯æ ‡è®°</li><li>xmlä»£ç å®Œæˆ</li><li>å¼•ç”¨å®šä½è‡³å¯¼èˆªå’Œæ–‡æ¡£</li></ul><h2 id="å¸ƒå±€å’Œç»‘å®šè¡¨è¾¾å¼"><a href="#å¸ƒå±€å’Œç»‘å®šè¡¨è¾¾å¼" class="headerlink" title="å¸ƒå±€å’Œç»‘å®šè¡¨è¾¾å¼"></a>å¸ƒå±€å’Œç»‘å®šè¡¨è¾¾å¼</h2><p>è¿™é‡Œå¼€å§‹å•¦å•Š</p><h3 id="åŒ…å«DataBindingçš„layout"><a href="#åŒ…å«DataBindingçš„layout" class="headerlink" title="åŒ…å«DataBindingçš„layout"></a>åŒ…å«DataBindingçš„layout</h3><p>åœ¨åŸæœ¬åŸºç¡€ä¸Šå¤–å±‚å¥—ä¸Šä»¥<code>layout</code>æ ‡ç­¾ï¼Œä»¥åŠå†…éƒ¨ç´§è·Ÿç€å£°æ˜<code>data</code>æ ‡ç­¾ï¼Œåœ¨dataæ ‡ç­¾ä½¿ç”¨<code>variable</code>é‡Œé¢å°±å¯å£°æ˜ç»‘å®šå˜é‡äº†ã€‚åœ¨xmlä¸­ä½¿ç”¨ç»‘å®šæ•°æ®é€šè¿‡<code>@{user.firstName}</code>çš„å½¢å¼ä½¿ç”¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.example.User"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:text</span>=<span class="string">"@&#123;user.firstName&#125;"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:text</span>=<span class="string">"@&#123;user.lastName&#125;"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å£°æ˜æ•°æ®å¯¹è±¡"><a href="#å£°æ˜æ•°æ®å¯¹è±¡" class="headerlink" title="å£°æ˜æ•°æ®å¯¹è±¡"></a>å£°æ˜æ•°æ®å¯¹è±¡</h3><p>ä½¿ç”¨pojoç®€å•å¯¹è±¡ï¼Œæˆ–è€…è€å¥—è·¯ï¼Œget/setå‡†å¤‡ï¼Œç„¶å<code>@{user.firstName}</code>ä¼šå»è°ƒç”¨<code>getFirstName()</code>æˆ–è€…<code>firstName()</code>ï¼Œæˆ–è€…ç›´æ¥è®¿é—®å‰ææ˜¯publicçš„<code>firstName</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> String firstName;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> String lastName;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String firstName, String lastName)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">      <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»‘å®šæ•°æ®"><a href="#ç»‘å®šæ•°æ®" class="headerlink" title="ç»‘å®šæ•°æ®"></a>ç»‘å®šæ•°æ®</h3><p>é€šè¿‡ä¸Šè¿°å£°æ˜layoutæ–‡ä»¶ï¼Œå¼€å§‹æ„å»ºï¼Œä¼šç”Ÿæˆä»¥xmlæ–‡ä»¶å¼€å¤´ï¼Œå°¾ç¼€ä¸ºBindingçš„ç±»ï¼Œæ¯”å¦‚<code>ActivityMainBinding.java</code>ï¼Œä¸‹é¢çœ‹ä¸‹å¦‚ä½•å°†å¯¹è±¡ç»‘å®šåˆ°layoutæ–‡ä»¶ä¸­çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">   ActivityMainBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_main);</span><br><span class="line">   User user = <span class="keyword">new</span> User(<span class="string">"Test"</span>, <span class="string">"User"</span>);</span><br><span class="line">   binding.setUser(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥æ•°æ®å°±å’Œlayoutç»‘å®šå¥½äº†ï¼Œlayoutå°±èƒ½é€šè¿‡è¡¨è¾¾æ˜¯æ˜¾ç¤ºç»‘å®šæ•°æ®</p><p>ä½¿ç”¨<code>LayoutInflater</code>è·å–binding</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ActivityMainBinding binding = ActivityMainBinding.inflate(getLayoutInflater());</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨<code>Fragment</code>ï¼Œ<code>ListView</code>ï¼Œ<code>RecyclerView adapter</code>ä¸­ä½¿ç”¨databindingï¼Œå¯ä»¥è¿™æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ListItemBinding binding = ListItemBinding.inflate(layoutInflater, viewGroup, <span class="keyword">false</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">ListItemBinding binding = DataBindingUtil.inflate(layoutInflater, R.layout.list_item, viewGroup, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure><h3 id="è¡¨è¾¾å¼è¯­è¨€"><a href="#è¡¨è¾¾å¼è¯­è¨€" class="headerlink" title="è¡¨è¾¾å¼è¯­è¨€"></a>è¡¨è¾¾å¼è¯­è¨€</h3><h4 id="é€šç”¨è¡¨è¾¾"><a href="#é€šç”¨è¡¨è¾¾" class="headerlink" title="é€šç”¨è¡¨è¾¾"></a>é€šç”¨è¡¨è¾¾</h4><p>è¡¨è¾¾å¼è¯­è¨€å’Œä»£ç å¾ˆç›¸ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æ“ä½œç¬¦å’Œå…³é”®å­—</p><ul><li>ç®—æœ¯ç¬¦ï¼š<code>+ - / * %</code></li><li>å­—ç¬¦ä¸²è¿æ¥ç¬¦ï¼š<code>+</code></li><li>é€»è¾‘ç¬¦<code>&amp;&amp; ||</code></li><li>ä½æ“ä½œç¬¦ï¼š<code>&amp; | ^</code></li><li>ä¸€å…ƒè¿ç®—ç¬¦ï¼š<code>+ - ! ~</code></li><li>ç§»ä½ç¬¦ï¼š<code>&gt;&gt; &gt;&gt;&gt; &lt;&lt;</code></li><li>æ¯”è¾ƒç¬¦ï¼š== &gt; &lt; &gt;= &lt;=<code>(Note that</code>&lt;<code>needs to be escaped as</code>&lt;`)</li><li><code>instanceof</code></li><li>æ‹¬å·<code>()</code></li><li>å­—é¢é‡ï¼š character, String, numeric, <code>null</code></li><li>ç±»å‹è½¬æ¢</li><li>æ–¹æ³•è°ƒç”¨</li><li>å±æ€§è®¿é—®</li><li>æ•°ç»„è®¿é—® <code>[]</code></li><li>ä¸‰å…ƒç¬¦ <code>?:</code></li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android:text=<span class="string">"@&#123;String.valueOf(index + 1)&#125;"</span></span><br><span class="line">android:visibility=<span class="string">"@&#123;age &gt; 13 ? View.GONE : View.VISIBLE&#125;"</span></span><br><span class="line">android:transitionName=<span class="string">'@&#123;"image_" + id&#125;'</span></span><br></pre></td></tr></table></figure><h4 id="ä¸å¯ä»¥ç”¨çš„æ“ä½œç¬¦"><a href="#ä¸å¯ä»¥ç”¨çš„æ“ä½œç¬¦" class="headerlink" title="ä¸å¯ä»¥ç”¨çš„æ“ä½œç¬¦"></a>ä¸å¯ä»¥ç”¨çš„æ“ä½œç¬¦</h4><ul><li><code>this</code></li><li><code>super</code></li><li><code>new</code></li><li>Explicit generic invocation ï¼ˆæˆ‘ç†è§£ä½æ³›å‹è°ƒç”¨è¡Œå—ï¼Ÿï¼‰</li></ul><h4 id="ç©ºåˆå¹¶è¿ç®—ç¬¦"><a href="#ç©ºåˆå¹¶è¿ç®—ç¬¦" class="headerlink" title="ç©ºåˆå¹¶è¿ç®—ç¬¦"></a>ç©ºåˆå¹¶è¿ç®—ç¬¦</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:text=<span class="string">"@&#123;user.displayName ?? user.lastName&#125;"</span></span><br></pre></td></tr></table></figure><p>ç­‰ä»·äº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:text=<span class="string">"@&#123;user.displayName != null ? user.displayName : user.lastName&#125;"</span></span><br></pre></td></tr></table></figure><h4 id="å±æ€§è®¿é—®"><a href="#å±æ€§è®¿é—®" class="headerlink" title="å±æ€§è®¿é—®"></a>å±æ€§è®¿é—®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:text=<span class="string">"@&#123;user.lastName&#125;"</span></span><br></pre></td></tr></table></figure><h4 id="é˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸"><a href="#é˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸" class="headerlink" title="é˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸"></a>é˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸</h4><p>ç”Ÿæˆçš„ç»‘å®šä»£ç è‡ªåŠ¨æ£€æŸ¥<code>null</code>ä»¥åŠé˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ¯”å¦‚<code>@{user.name}</code>ä¸­å¦‚æœuserä¸ºç©ºï¼Œé‚£ä¹ˆnameä¼šè¢«åˆ†é…ä¸ºnullï¼Œå¦‚æœæ˜¯<code>@{user.age}</code>ï¼Œåˆ™ageåˆ†é…ä¸º0</p><h4 id="è¿ç”¨é›†åˆ"><a href="#è¿ç”¨é›†åˆ" class="headerlink" title="è¿ç”¨é›†åˆ"></a>è¿ç”¨é›†åˆ</h4><p>è‡ªç„¶æ˜¯å°‘ä¸ä¸äº†é›†åˆäº†çš„ä½¿ç”¨äº†ï¼Œæ•°ç»„ï¼Œlistï¼Œsparse list ï¼Œmapå¯ä»¥é€šè¿‡<code>[]</code>å½¢å¼è®¿é—®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;data&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> type=<span class="string">"android.util.SparseArray"</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> type=<span class="string">"java.util.Map"</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> type=<span class="string">"java.util.List"</span>/&gt;</span><br><span class="line">    &lt;variable name=<span class="string">"list"</span> type=<span class="string">"List&amp;lt;String&gt;"</span>/&gt;</span><br><span class="line">    &lt;variable name=<span class="string">"sparse"</span> type=<span class="string">"SparseArray&amp;lt;String&gt;"</span>/&gt;</span><br><span class="line">    &lt;variable name=<span class="string">"map"</span> type=<span class="string">"Map&amp;lt;String, String&gt;"</span>/&gt;</span><br><span class="line">    &lt;variable name=<span class="string">"index"</span> type=<span class="string">"int"</span>/&gt;</span><br><span class="line">    &lt;variable name=<span class="string">"key"</span> type=<span class="string">"String"</span>/&gt;</span><br><span class="line">&lt;/data&gt;</span><br><span class="line">â€¦</span><br><span class="line">android:text=<span class="string">"@&#123;list[index]&#125;"</span></span><br><span class="line">â€¦</span><br><span class="line">android:text=<span class="string">"@&#123;sparse[index]&#125;"</span></span><br><span class="line">â€¦</span><br><span class="line">android:text=<span class="string">"@&#123;map[key]&#125;"</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šåƒ<code>List&lt;String&gt;</code>è¿™ç§å¸¦æ³›å‹éœ€è¦å†™æˆ<code>List&amp;lt;String&gt;</code>ï¼Œå…¶å®ƒçš„ä¾æ¬¡ç±»æ¨</p><h4 id="å­—ç¬¦ä¸²å­—é¢é‡key"><a href="#å­—ç¬¦ä¸²å­—é¢é‡key" class="headerlink" title="å­—ç¬¦ä¸²å­—é¢é‡key"></a>å­—ç¬¦ä¸²å­—é¢é‡key</h4><p>ä¸‹é¢çš„ä¸¤ç§å½¢å¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé€šè¿‡å­—é¢é‡è®¿é—®å€¼ï¼ŒåŒå¼•å·ï¼Œåå¼•å·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android:text=<span class="string">'@&#123;map["firstName"]&#125;'</span></span><br><span class="line">android:text=<span class="string">"@&#123;map[`firstName`]&#125;"</span></span><br></pre></td></tr></table></figure><h4 id="è®¿é—®èµ„æº"><a href="#è®¿é—®èµ„æº" class="headerlink" title="è®¿é—®èµ„æº"></a>è®¿é—®èµ„æº</h4><p>ç»“åˆè¡¨è¾¾å¼æ¥è®¿é—®èµ„æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:padding=<span class="string">"@&#123;large? @dimen/largePadding : @dimen/smallPadding&#125;"</span></span><br></pre></td></tr></table></figure><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android:text=<span class="string">"@&#123;@string/nameFormat(firstName, lastName)&#125;"</span></span><br><span class="line">android:text=<span class="string">"@&#123;@plurals/banana(bananaCount)&#125;"</span></span><br></pre></td></tr></table></figure><h4 id="é»˜è®¤å€¼"><a href="#é»˜è®¤å€¼" class="headerlink" title="é»˜è®¤å€¼"></a>é»˜è®¤å€¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:text=<span class="string">"@&#123;user.firstName, default=my_default&#125;"</span>/&gt;</span><br></pre></td></tr></table></figure><h3 id="äº‹ä»¶å¤„ç†"><a href="#äº‹ä»¶å¤„ç†" class="headerlink" title="äº‹ä»¶å¤„ç†"></a>äº‹ä»¶å¤„ç†</h3><p>Data Bindingå…è®¸é€šè¿‡è¡¨è¾¾å¼æ¥å¤„ç†åˆ†å‘çš„viewäº‹ä»¶ï¼Œä¾‹å¦‚ç‚¹å‡»äº‹ä»¶ï¼Œéœ€è¦åœ¨onclickå±æ€§ä¸Šå†™è¡¨è¾¾å¼ã€‚æœ‰ä¸‰ç§éœ€è¦ç‰¹æ®Šå¤„ç†</p><table><thead><tr><th>Class</th><th>Listener setter</th><th>Attribute</th></tr></thead><tbody><tr><td><code>SearchView</code></td><td><code>setOnSearchClickListener(View.OnClickListener)</code></td><td><code>android:onSearchClick</code></td></tr><tr><td><code>ZoomControls</code></td><td><code>setOnZoomInClickListener(View.OnClickListener)</code></td><td><code>android:onZoomIn</code></td></tr><tr><td><code>ZoomControls</code></td><td><code>setOnZoomOutClickListener(View.OnClickListener)</code></td><td><code>android:onZoomOut</code></td></tr></tbody></table><p>æœ‰ä¸¤ç§æ–¹å¼æ¥å¤„ç†äº‹ä»¶ï¼š</p><ul><li>æ–¹æ³•å¼•ç”¨ï¼šé€šè¿‡è°ƒç”¨å…·æœ‰ç›¸åŒç­¾åçš„æ–¹æ³•</li><li>ç›‘å¬å™¨ç»‘å®š: é€šè¿‡lambdaæ–¹å¼ä¹¦å†™å¯¹è±¡</li></ul><h4 id="æ–¹æ³•å¼•ç”¨"><a href="#æ–¹æ³•å¼•ç”¨" class="headerlink" title="æ–¹æ³•å¼•ç”¨"></a>æ–¹æ³•å¼•ç”¨</h4><p>ç±»ä¼¼äºä¹¦å†™onClickå±æ€§å…³è”åˆ°activityçš„åŒç­¾åæ–¹æ³•ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•å¼•ç”¨ä¼šåœ¨ç¼–è¯‘æ—¶å¤„ç†ï¼Œå³å¦‚æœå‡ºç°ç­¾åä¸ä¸€è‡´ç­‰é”™è¯¯ï¼Œä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™ã€‚<strong>ç­¾åå¿…é¡»ä¸è§¦å‘äº‹ä»¶ä¸€è‡´</strong></p><p>å£°æ˜å¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandlers</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClickFriend</span><span class="params">(View view)</span> </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ï¼Œ<code>::</code> <code>.</code>ä¸¤ç§éƒ½è¡Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"handlers"</span> <span class="attr">type</span>=<span class="string">"com.example.MyHandlers"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.example.User"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:text</span>=<span class="string">"@&#123;user.firstName&#125;"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:onClick</span>=<span class="string">"@&#123;handlers::onClickFriend&#125;"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç›‘å¬å™¨ç»‘å®š"><a href="#ç›‘å¬å™¨ç»‘å®š" class="headerlink" title="ç›‘å¬å™¨ç»‘å®š"></a>ç›‘å¬å™¨ç»‘å®š</h4><p>å®é™…å¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Presenter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSaveClick</span><span class="params">(Task task)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>@{() -&gt; presenter.onSaveClick(task)}</code>ç±»ä¼¼lambdaè¡¨ç¤ºå¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"task"</span> <span class="attr">type</span>=<span class="string">"com.android.example.Task"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"presenter"</span> <span class="attr">type</span>=<span class="string">"com.android.example.Presenter"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span> <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span> <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"@&#123;() -&gt; presenter.onSaveClick(task)&#125;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç›‘å¬å™¨çš„å®ç°æ˜¯æ•°æ®ç»‘å®šæ—¶è¢«åˆ›é”®çš„ï¼Œå’Œæ–¹æ³•å¼•ç”¨ç±»ä¼¼ï¼Œ<strong>ä½†æ˜¯ç›‘å¬å™¨ç»‘å®šçš„å¤„ç†æ–¹æ³•ä¸è¦æ±‚ç­¾åå®Œå…¨ä¸€è‡´ï¼Œåªéœ€è¦ä¿è¯è¿”å›å€¼ä¸€è‡´å°±è¡Œäº†</strong></p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨viewå‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:onClick=<span class="string">"@&#123;(view) -&gt; presenter.onSaveClick(task)&#125;"</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç»§ç»­ä¼ å…¥åˆ°å¤„ç†æ–¹æ³•ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Presenter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSaveClick</span><span class="params">(View view, Task task)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">android:onClick=<span class="string">"@&#123;(theView) -&gt; presenter.onSaveClick(theView, task)&#125;"</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶æŸäº›äº‹ä»¶ä¸æ­¢ä¸€ä¸ªå‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public class Presenter &#123;</span><br><span class="line">    public void onCompletedChanged(Task task, boolean completed)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;CheckBox android:layout_width=<span class="string">"wrap_content"</span> android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">      android:onCheckedChanged=<span class="string">"@&#123;(cb, isChecked) -&gt; presenter.completeChanged(task, isChecked)&#125;"</span> /&gt;</span><br></pre></td></tr></table></figure><p>ç»“åˆä¸‰å…ƒè¡¨è¾¾å¼ä½¿ç”¨é»˜è®¤è¿”å›å€¼ï¼Œ<code>null</code>ï¼Œ<code>0</code>ç­‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:onClick=<span class="string">"@&#123;(v) -&gt; v.isVisible() ? doSomething() : void&#125;"</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿‡ç¨‹è¦ä¿è¯ç›‘å¬å™¨ç®€æ´ï¼Œä¸å®œè¿‡åº¦å¤æ‚ã€‚</p><h3 id="import-å’Œ-variableï¼Œincludes"><a href="#import-å’Œ-variableï¼Œincludes" class="headerlink" title="import å’Œ variableï¼Œincludes"></a>import å’Œ variableï¼Œincludes</h3><h4 id="import"><a href="#import" class="headerlink" title="import"></a>import</h4><p>å’Œjavaæ–‡ä»¶ä¸­çš„å¯¼åŒ…ä¸€æ ·ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"android.view.View"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:text</span>=<span class="string">"@&#123;user.lastName&#125;"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:visibility</span>=<span class="string">"@&#123;user.isAdult ? View.VISIBLE : View.GONE&#125;"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åˆ«åï¼Œç±»åå†²çªæ—¶ä½¿ç”¨åˆ«å</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"android.view.View"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"com.example.real.estate.View"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">alias</span>=<span class="string">"Vista"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>åæ­£å’Œjavaä¸­æ€ä¹ˆå¯¼å…¥æ€ä¹ˆç”¨åŸºæœ¬ä¸€æ ·ï¼ŒåŒ…æ‹¬äº†é™æ€æ–¹æ³•ï¼Œå—¯ï¼ŒçœŸé¦™</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"com.example.MyStringUtils"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.example.User"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">â€¦</span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:text</span>=<span class="string">"@&#123;MyStringUtils.capitalize(user.lastName)&#125;"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="variable"><a href="#variable" class="headerlink" title="variable"></a>variable</h4><p>å£°æ˜å˜é‡ï¼Œè¿™äº›å˜é‡éƒ½æ˜¯ä¼šåœ¨ç¼–è¯‘æ—¶è¿›è¡Œç±»å‹æ£€æŸ¥çš„ã€‚bindingä¼šä¸ºæ¯ä¸ªå˜é‡åˆ†é…é»˜è®¤å€¼ï¼Œå‚è€ƒjavaç±»å±æ€§é»˜è®¤å€¼ã€‚</p><p>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡<code>context</code>ï¼Œå³<code>view.getContext</code></p><h4 id="include"><a href="#include" class="headerlink" title="include"></a>include</h4><p>ä¼ é€’å˜é‡åˆ°å…¶å®ƒå¸ƒå±€</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:bind</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.example.User"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/name"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">bind:user</span>=<span class="string">"@&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/contact"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">bind:user</span>=<span class="string">"@&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸æ”¯æŒç›´æ¥çš„mergeå­èŠ‚ç‚¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:bind</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.example.User"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">merge</span>&gt;</span><span class="comment">&lt;!-- Doesn't work --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/name"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">bind:user</span>=<span class="string">"@&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/contact"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">bind:user</span>=<span class="string">"@&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">merge</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡"><a href="#ä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡" class="headerlink" title="ä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡"></a>ä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡</h2><p>databindingåº“å…è®¸æ•°æ®æ˜¯å¯è§‚å¯Ÿçš„ã€‚åœ¨å¯è§‚å¯Ÿæ€§ä¸‹ï¼Œæ•°æ®å‘ç”Ÿæ”¹å˜ä¼šè‡ªåŠ¨æ›´æ–°ä¸ä¹‹ç»‘å®šçš„UIæ•°æ®ã€‚å½“ç„¶åç»­ä¼šä½¿ç”¨è‡ªå¸¦<strong>ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„</strong><code>LiveDta</code>æ¥æ›¿æ¢Obervableå¢å¼ºåŠŸèƒ½</p><h3 id="Observable-fields"><a href="#Observable-fields" class="headerlink" title="Observable fields"></a>Observable fields</h3><p>å½“ä½ ä¸éœ€è¦è§‚å¯Ÿæ•´ä½“æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨å¯è§‚å¯Ÿå­—æ®µï¼Œæœ‰ä»¥ä¸‹çš„é€‰é¡¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ObservableBoolean</span><br><span class="line">ObservableByte</span><br><span class="line">ObservableChar</span><br><span class="line">ObservableShort</span><br><span class="line">ObservableInt</span><br><span class="line">ObservableLong</span><br><span class="line">ObservableFloat</span><br><span class="line">ObservableDouble</span><br><span class="line">ObservableParcelable</span><br><span class="line">ObservableField&lt;T&gt;</span><br><span class="line">ObservableArrayMap</span><br><span class="line">ObservableArrayList</span><br></pre></td></tr></table></figure><p>å£°æ˜ä¸ºfinal</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> ObservableField&lt;String&gt; firstName = <span class="keyword">new</span> ObservableField&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> ObservableField&lt;String&gt; lastName = <span class="keyword">new</span> ObservableField&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> ObservableInt age = <span class="keyword">new</span> ObservableInt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡getï¼Œsetè®¿é—®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.firstName.set(<span class="string">"Google"</span>);</span><br><span class="line"><span class="keyword">int</span> age = user.age.get();</span><br></pre></td></tr></table></figure><h3 id="Observable-objects"><a href="#Observable-objects" class="headerlink" title="Observable objects"></a>Observable objects</h3><p>æ•´ä½“å£°æ˜ä¸ºå¯è§‚å¯Ÿå¯¹è±¡ï¼Œé€šè¿‡ç»§æ‰¿<code>BaseObservable</code>ï¼Œé€šè¿‡åœ¨setæ–¹æ³•ä¸­è°ƒç”¨<code>notifyPropertyChanged();</code>æ¥é€šçŸ¥UIå˜åŒ–ï¼Œå¯¹äº†getæ–¹æ³•éœ€è¦ä½¿ç”¨<code>@Bindle</code>æ¥æ³¨è§£ï¼Œä¸ç„¶æ— æ³•ä»<code>BR</code>æ‰¾åˆ°å­—æ®µèµ„æºIDï¼Œè¿™ä¸ªIDæ˜¯å’ŒUIå…³è”çš„ï¼Œé€šè¿‡IDå®šä½åˆ°UIæ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">BaseObservable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="meta">@Bindable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.firstName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bindable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.lastName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">(String firstName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">        notifyPropertyChanged(BR.firstName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">        notifyPropertyChanged(BR.lastName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆç»‘å®šç±»"><a href="#ç”Ÿæˆç»‘å®šç±»" class="headerlink" title="ç”Ÿæˆç»‘å®šç±»"></a>ç”Ÿæˆç»‘å®šç±»</h2><p>å¯ä»¥å®šåˆ¶åŒ–çš„ç”Ÿæˆbandingç±»</p><h3 id="åˆ›é”®bandingç±»"><a href="#åˆ›é”®bandingç±»" class="headerlink" title="åˆ›é”®bandingç±»"></a>åˆ›é”®bandingç±»</h3><h4 id="é€šè¿‡inflateæ³¨å…¥"><a href="#é€šè¿‡inflateæ³¨å…¥" class="headerlink" title="é€šè¿‡inflateæ³¨å…¥"></a>é€šè¿‡<code>inflate</code>æ³¨å…¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    MyLayoutBinding binding = MyLayoutBinding.inflate(getLayoutInflater());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ åˆ°çˆ¶viewgroup"><a href="#æ·»åŠ åˆ°çˆ¶viewgroup" class="headerlink" title="æ·»åŠ åˆ°çˆ¶viewgroup"></a>æ·»åŠ åˆ°çˆ¶viewgroup</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyLayoutBinding binding = MyLayoutBinding.inflate(getLayoutInflater(), viewGroup, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure><h4 id="ç»‘å®šview"><a href="#ç»‘å®šview" class="headerlink" title="ç»‘å®šview"></a>ç»‘å®šview</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyLayoutBinding binding = MyLayoutBinding.bind(viewRoot);</span><br></pre></td></tr></table></figure><h4 id="ä¸çŸ¥ç±»å‹çš„æƒ…å†µä¸‹ç»‘å®šview"><a href="#ä¸çŸ¥ç±»å‹çš„æƒ…å†µä¸‹ç»‘å®šview" class="headerlink" title="ä¸çŸ¥ç±»å‹çš„æƒ…å†µä¸‹ç»‘å®šview"></a>ä¸çŸ¥ç±»å‹çš„æƒ…å†µä¸‹ç»‘å®šview</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">View viewRoot = LayoutInflater.from(<span class="keyword">this</span>).inflate(layoutId, parent, attachToParent);</span><br><span class="line">ViewDataBinding binding = DataBindingUtil.bind(viewRoot);</span><br></pre></td></tr></table></figure><h4 id="åœ¨fragmentï¼Œlistviewï¼Œrecyclerview-adpterï¼Œä¼˜å…ˆä½¿ç”¨inflate"><a href="#åœ¨fragmentï¼Œlistviewï¼Œrecyclerview-adpterï¼Œä¼˜å…ˆä½¿ç”¨inflate" class="headerlink" title="åœ¨fragmentï¼Œlistviewï¼Œrecyclerview adpterï¼Œä¼˜å…ˆä½¿ç”¨inflate"></a>åœ¨fragmentï¼Œlistviewï¼Œrecyclerview adpterï¼Œä¼˜å…ˆä½¿ç”¨inflate</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ListItemBinding binding = ListItemBinding.inflate(layoutInflater, viewGroup, <span class="keyword">false</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">ListItemBinding binding = DataBindingUtil.inflate(layoutInflater, R.layout.list_item, viewGroup, <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure><h4 id="setContentView"><a href="#setContentView" class="headerlink" title="setContentView"></a>setContentView</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ActivityMainBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_main);</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡idå®šä½view"><a href="#é€šè¿‡idå®šä½view" class="headerlink" title="é€šè¿‡idå®šä½view"></a>é€šè¿‡idå®šä½view</h3><p>ä»¥å‰æ²¡æœ‰databindingæ—¶æ€»æ˜¯éœ€è¦æ‰‹åŠ¨<code>findViewById</code>ï¼Œæˆ–è€…é€šè¿‡<code>ButterKnife</code>æ¥è¾…åŠ©ï¼Œç°åœ¨æœ‰äº†DataBindingåå¯ä»¥ç›´æ¥é€šè¿‡<code>xxxBinding.id</code>çš„å½¢å¼æ¥è·å¾—viewå¯¹è±¡(ä¸è¿‡ç”¨kotlinæ¥å†™è¯çš„å¤©ç„¶ç›´æ¥é€šè¿‡idå¼•ç”¨å¯¹è±¡233)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"to viewmodel activity"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/btn_to_viewmodel_activity"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>ä¼šå°†ä¸‹åˆ’çº¿å¼çš„å‘½åè§„åˆ™è½¬å˜ä¸ºå°é©¼å³°å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binding.btnToViewmodelActivity.setOnclcikListener();</span><br></pre></td></tr></table></figure><h3 id="ç«‹å³æ‰§è¡Œç»‘å®š"><a href="#ç«‹å³æ‰§è¡Œç»‘å®š" class="headerlink" title="ç«‹å³æ‰§è¡Œç»‘å®š"></a>ç«‹å³æ‰§è¡Œç»‘å®š</h3><p>åŸæœ¬åœ¨å¯è§‚å¯Ÿæ•°æ®å˜åŒ–æ—¶ï¼Œä¼šåœ¨ä¸‹ä¸€å¸§è¿›è¡Œuiå˜åŒ–ï¼Œå¦‚æœä½ æƒ³å¼ºåˆ¶ç«‹å³æ‰§è¡Œè°ƒç”¨ <a href="https://developer.android.google.cn/reference/androidx/databinding/ViewDataBinding.html#executePendingBindings()" target="_blank" rel="noopener"><code>executePendingBindings()</code></a></p><h3 id="åŠ¨æ€å˜é‡"><a href="#åŠ¨æ€å˜é‡" class="headerlink" title="åŠ¨æ€å˜é‡"></a>åŠ¨æ€å˜é‡</h3><p>ä¾‹å¦‚åœ¨RecyclerView.Adapterä¸­ä½ å¯èƒ½ä¸çŸ¥é“Bandingæ˜¯é‚£ä¸ªã€‚é€šè¿‡ä»¥ä¸‹æ–¹å¼é€šçŸ¥ä¿®æ”¹æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(BindingHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> T item = items.get(position);</span><br><span class="line">    holder.getBinding().setVariable(BR.item, item);</span><br><span class="line">    holder.getBinding().executePendingBindings();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤šçº¿ç¨‹é—®é¢˜"><a href="#å¤šçº¿ç¨‹é—®é¢˜" class="headerlink" title="å¤šçº¿ç¨‹é—®é¢˜"></a>å¤šçº¿ç¨‹é—®é¢˜</h3><p>åœ¨databindingä¸­ï¼Œä¿®æ”¹æ•°æ®å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹ï¼Œæ•°æ®åœ¨UIçš„ä¸Šçš„æ”¹å˜ä¼šè‡ªåŠ¨åœ¨æœ¬åœ°åŒ–çš„UIçº¿ç¨‹è¿›è¡Œæ›´æ–°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½åœ¨åå°çº¿ç¨‹æ“çºµé›†åˆæ•°æ®</p><h3 id="è‡ªå®šä¹‰bindingç±»çš„åå­—"><a href="#è‡ªå®šä¹‰bindingç±»çš„åå­—" class="headerlink" title="è‡ªå®šä¹‰bindingç±»çš„åå­—"></a>è‡ªå®šä¹‰bindingç±»çš„åå­—</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span> <span class="attr">class</span>=<span class="string">"ContactItem"</span>&gt;</span></span><br><span class="line">    â€¦</span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç»‘å®šé€‚é…å™¨"><a href="#ç»‘å®šé€‚é…å™¨" class="headerlink" title="ç»‘å®šé€‚é…å™¨"></a>ç»‘å®šé€‚é…å™¨</h2><p>ç»‘å®šé€‚é…è´Ÿè´£é€šè¿‡é€‚å½“çš„æ–¹å¼æ¥è°ƒç”¨å¹¶ä¸”è®¾ç½®å€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è®¾ç½®å±æ€§çš„æ—¶å€™å®é™…æ˜¯é€šè¿‡setTextæ¥å®Œæˆçš„ï¼Œè®¾ç½®ç›‘å¬å™¨æ˜¯é€šè¿‡setOnclickListeneræ¥å®Œæˆçš„ã€‚databingåº“å…è®¸æˆ‘ä»¬æŒ‡å®šæ–¹æ³•è°ƒç”¨æ¥è®¾ç½®å€¼ï¼Œæä¾›ç»‘å®šé€»è¾‘ï¼ŒæŒ‡å®šè¿”å›ç±»å‹ã€‚</p><h3 id="è®¾ç½®å±æ€§å€¼"><a href="#è®¾ç½®å±æ€§å€¼" class="headerlink" title="è®¾ç½®å±æ€§å€¼"></a>è®¾ç½®å±æ€§å€¼</h3><h4 id="è‡ªåŠ¨é€‰æ‹©æ–¹æ³•"><a href="#è‡ªåŠ¨é€‰æ‹©æ–¹æ³•" class="headerlink" title="è‡ªåŠ¨é€‰æ‹©æ–¹æ³•"></a>è‡ªåŠ¨é€‰æ‹©æ–¹æ³•</h4><p>é€šè¿‡åç§°å’Œè¿”å›å€¼ç±»å‹æ¥åŒ¹é…å¯¹åº”çš„æ–¹æ³•è°ƒç”¨ã€‚æ¯”å¦‚<code>app:scrimColor=@{@color/scrim}</code>ä¼šè°ƒç”¨<code>setScrimColor(int)</code>è¯¸å¦‚æ­¤ç±»ï¼Œè‡ªåŠ¨é€‰æ‹©æ–¹æ³•è°ƒç”¨</p><h4 id="æŒ‡å®šå±æ€§è§¦å‘æ–¹æ³•"><a href="#æŒ‡å®šå±æ€§è§¦å‘æ–¹æ³•" class="headerlink" title="æŒ‡å®šå±æ€§è§¦å‘æ–¹æ³•"></a>æŒ‡å®šå±æ€§è§¦å‘æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingMethods</span>(&#123;</span><br><span class="line">       <span class="meta">@BindingMethod</span>(type = <span class="string">"android.widget.ImageView"</span>,</span><br><span class="line">                      attribute = <span class="string">"android:tint"</span>,</span><br><span class="line">                      method = <span class="string">"setImageTintList"</span>),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyBindingMethods</span></span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingMethods</span>(</span><br><span class="line">        <span class="meta">@BindingMethod</span>(type = ImageView::<span class="class"><span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">                <span class="title">attribute</span> </span>= <span class="string">"app:srcCompat"</span>,</span><br><span class="line">                method = <span class="string">"setImageResource"</span>))</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyBindingMethods</span></span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ ·çš„å£°æ˜ä¸‹ï¼Œé€šè¿‡ç»™app:srcCompatè®¾ç½®å±æ€§å€¼ï¼Œä¼šè§¦å‘è°ƒç”¨setImageResourceæ–¹æ³•</p><h4 id="è‡ªå®šä¹‰è§¦å‘æ–¹æ³•é€»è¾‘"><a href="#è‡ªå®šä¹‰è§¦å‘æ–¹æ³•é€»è¾‘" class="headerlink" title="è‡ªå®šä¹‰è§¦å‘æ–¹æ³•é€»è¾‘"></a>è‡ªå®šä¹‰è§¦å‘æ–¹æ³•é€»è¾‘</h4><p>è®¾ç½®<code>android:paddingLeft</code>å°±ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„<code>setPaddingLeft</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter</span>(<span class="string">"android:paddingLeft"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setPaddingLeft</span><span class="params">(View view, <span class="keyword">int</span> padding)</span> </span>&#123;</span><br><span class="line">  view.setPadding(padding,</span><br><span class="line">                  view.getPaddingTop(),</span><br><span class="line">                  view.getPaddingRight(),</span><br><span class="line">                  view.getPaddingBottom());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æ”¯æŒè‡ªå®šä¹‰å±æ€§ï¼Œå’Œå¤šå±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@BindingAdapter(&#123;&quot;imageUrl&quot;, &quot;error&quot;&#125;)</span><br><span class="line">public static void loadImage(ImageView view, String url, Drawable error) &#123;</span><br><span class="line">  Picasso.get().load(url).error(error).into(view);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">app:imageUrl</span>=<span class="string">"@&#123;venue.imageUrl&#125;"</span> <span class="attr">app:error</span>=<span class="string">"@&#123;@drawable/venueError&#125;"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>databing åº“ä¼šå¿½ç•¥è‡ªå®šä¹‰å±æ€§çš„å‘½åç©ºé—´ï¼Œæ‰€ä»¥ä¸å†™ä¹Ÿæ²¡äº‹</p><p>å¯ä»¥è®¾ç½®ä¸è¦æ±‚æ‰€æœ‰å±æ€§æœ‰å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter</span>(value=&#123;<span class="string">"imageUrl"</span>, <span class="string">"placeholder"</span>&#125;, requireAll=<span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setImageUrl</span><span class="params">(ImageView imageView, String url, Drawable placeHolder)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (url == <span class="keyword">null</span>) &#123;</span><br><span class="line">    imageView.setImageDrawable(placeholder);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    MyImageLoader.loadInto(imageView, url, placeholder);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æä¾›æ–°å€¼ï¼Œæ—§å€¼å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter</span>(<span class="string">"android:paddingLeft"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setPaddingLeft</span><span class="params">(View view, <span class="keyword">int</span> oldPadding, <span class="keyword">int</span> newPadding)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (oldPadding != newPadding) &#123;</span><br><span class="line">      view.setPadding(newPadding,</span><br><span class="line">                      view.getPaddingTop(),</span><br><span class="line">                      view.getPaddingRight(),</span><br><span class="line">                      view.getPaddingBottom());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”šè‡³æ–°æ—§ç›‘å¬å™¨å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter</span>(<span class="string">"android:onLayoutChange"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setOnLayoutChangeListener</span><span class="params">(View view, View.OnLayoutChangeListener oldValue,</span></span></span><br><span class="line"><span class="function"><span class="params">       View.OnLayoutChangeListener newValue)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) &#123;</span><br><span class="line">    <span class="keyword">if</span> (oldValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">      view.removeOnLayoutChangeListener(oldValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">      view.addOnLayoutChangeListener(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ç›‘å¬å™¨ç»‘å®š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">View</span> <span class="attr">android:onLayoutChange</span>=<span class="string">"@&#123;() -&gt; handler.layoutChanged()&#125;"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹äºä¸€ä¸ªç›‘å¬å™¨ä¸­æœ‰å¤šä¸ªç›‘å¬æ–¹æ³•çš„éœ€è¦æ‹†åˆ†å‡ºæ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TargetApi</span>(VERSION_CODES.HONEYCOMB_MR1)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnViewDetachedFromWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">onViewDetachedFromWindow</span><span class="params">(View v)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TargetApi</span>(VERSION_CODES.HONEYCOMB_MR1)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnViewAttachedToWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">onViewAttachedToWindow</span><span class="params">(View v)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@BindingAdapter</span>(&#123;<span class="string">"android:onViewDetachedFromWindow"</span>, <span class="string">"android:onViewAttachedToWindow"</span>&#125;, requireAll=<span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">(View view, OnViewDetachedFromWindow detach, OnViewAttachedToWindow attach)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.HONEYCOMB_MR1) &#123;</span><br><span class="line">        OnAttachStateChangeListener newListener;</span><br><span class="line">        <span class="keyword">if</span> (detach == <span class="keyword">null</span> &amp;&amp; attach == <span class="keyword">null</span>) &#123;</span><br><span class="line">            newListener = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newListener = <span class="keyword">new</span> OnAttachStateChangeListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewAttachedToWindow</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (attach != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        attach.onViewAttachedToWindow(v);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewDetachedFromWindow</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (detach != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        detach.onViewDetachedFromWindow(v);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        OnAttachStateChangeListener oldListener = ListenerUtil.trackListener(view, newListener,</span><br><span class="line">                R.id.onAttachStateChangeListener);</span><br><span class="line">        <span class="keyword">if</span> (oldListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">            view.removeOnAttachStateChangeListener(oldListener);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (newListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">            view.addOnAttachStateChangeListener(newListener);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯¹è±¡è½¬æ¢"><a href="#å¯¹è±¡è½¬æ¢" class="headerlink" title="å¯¹è±¡è½¬æ¢"></a>å¯¹è±¡è½¬æ¢</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ä¼šæœ‰è‡ªåŠ¨è½¬æ¢ï¼Œæ¯”å¦‚<code>android:text=&quot;@{String}&quot;</code>ï¼Œstringå°±ä¼šè½¬æ¢ä¸º<code>CharSequence</code>ä»¥ä¾›setTextä½¿ç”¨</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å¯¹è±¡è½¬æ¢æ¯”å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:background</span>=<span class="string">"@&#123;isError ? @color/red : @color/white&#125;"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„å‚æ•°å€¼æ˜¯ä¸€ä¸ª<code>int</code>ï¼Œä½†æ˜¯æœ€åèµ·ä½œç”¨çš„æ˜¯<code>Drawable</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†<code>int</code>è½¬æ¢ä¸º<code>ColorDrawable</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingConversion</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ColorDrawable <span class="title">convertColorToDrawable</span><span class="params">(<span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ColorDrawable(color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šæ‰§è¡Œè½¬æ¢</p><h2 id="ç»“åˆæ¶æ„ç»„ä»¶"><a href="#ç»“åˆæ¶æ„ç»„ä»¶" class="headerlink" title="ç»“åˆæ¶æ„ç»„ä»¶"></a>ç»“åˆæ¶æ„ç»„ä»¶</h2><h3 id="ä½¿ç”¨LiveData"><a href="#ä½¿ç”¨LiveData" class="headerlink" title="ä½¿ç”¨LiveData"></a>ä½¿ç”¨LiveData</h3><p>å’ŒObservableFieldç›¸ä¼¼ï¼ŒLiveDataæ•°æ®ä¹Ÿæ˜¯å¯è§‚å¯Ÿçš„ï¼Œä½†æ˜¯LiveDataæ›´åŠ ä¼˜ç§€çš„æ˜¯<strong>æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸ</strong>ï¼Œå³åœ¨æŸäº›ä¸åº”è¯¥è§¦å‘é€šçŸ¥çš„ç”Ÿå‘½å‘¨æœŸä¸­æ˜¯ä¸ä¼šè§¦å‘é€šçŸ¥çš„ã€‚è¦æ±‚ASç‰ˆæœ¬3.1ä»¥ä¸Šï¼Œè¯¦æƒ…è§ä¹‹åçš„LiveDataä»‹ç»</p><p>ä½¿ç”¨LiveDataéœ€è¦è®¾å®šç”Ÿå‘½å‘¨æœŸçš„æ‰¿è½½è€…æ¥ä¿æŒLiveDataä½œç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewModelActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate view and obtain an instance of the binding class.</span></span><br><span class="line">        UserBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.user);</span><br><span class="line">        <span class="comment">// æŒ‡å®šç”Ÿå‘½å‘¨æœŸæ‰¿è½½è€…æ˜¯æ­¤activity</span></span><br><span class="line">        binding.setLifecycleOwner(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†æ•°æ®ç±»ä¸­ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScheduleViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    LiveData username;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScheduleViewModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String result = Repository.userName;</span><br><span class="line">        userName = Transformations.map(result, result -&gt; result.value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ViewModelç®¡ç†UIå…³è”æ•°æ®"><a href="#ä½¿ç”¨ViewModelç®¡ç†UIå…³è”æ•°æ®" class="headerlink" title="ä½¿ç”¨ViewModelç®¡ç†UIå…³è”æ•°æ®"></a>ä½¿ç”¨ViewModelç®¡ç†UIå…³è”æ•°æ®</h3><p>viewModelç”¨äºç®¡æ§UIè¡Œä¸ºï¼Œä»¥åŠå­˜å‚¨ç»‘å®šæ•°æ®ï¼Œåœ¨æŸäº›å±å¹•æ—‹è½¬æƒ…å†µä¸‹ï¼Œactivityä¼šé‡å»ºï¼Œè€Œviewmodelå¯ä»¥ä¸€ç›´å­˜åœ¨ï¼Œä¿å­˜äºUIçš„å…³è”çš„é‡é‡çº§æ•°æ®ï¼ŒåŒæ—¶ä½œä¸ºé€»è¾‘æ²Ÿé€šçš„æ¡¥æ¢ï¼Œè¿æ¥UIï¼Œè¿æ¥Modelã€‚å…·ä½“è§åç»­çš„ViewModel</p><h3 id="ViewModelå®ç°Obervable"><a href="#ViewModelå®ç°Obervable" class="headerlink" title="ViewModelå®ç°Obervable"></a>ViewModelå®ç°Obervable</h3><p>åœ¨æŸç§ä¸éœ€è¦ä½¿ç”¨LiveDataè¿›è¡Œç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è¿›è¡Œå®ç°Observableï¼Œä½¿å¾—ViewModelå…·æœ‰è¢«è§‚å¯Ÿçš„ç‰¹æ€§ã€‚</p><p>é¦–å…ˆç»§æ‰¿ViewModelï¼Œå®ç°Observableï¼Œæ·»åŠ å±æ€§ç›‘å¬ã€‚</p><p>é‡å†™<code>addOnPropertyChangedCallback</code> <code>removeOnPropertyChangedCallback</code>ï¼Œå¯ä»¥å‚çœ‹BaseObservableçš„åŸºæœ¬å®ç°èŒƒä¾‹</p><p>è¿™æ ·ä¸€ä¸ªViewModelå°±å…·æœ‰è§‚å¯Ÿç‰¹æ€§äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A ViewModel that is also an Observable,</span></span><br><span class="line"><span class="comment"> * to be used with the Data Binding Library.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObservableViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span> <span class="keyword">implements</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> PropertyChangeRegistry callbacks = <span class="keyword">new</span> PropertyChangeRegistry();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addOnPropertyChangedCallback</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            Observable.OnPropertyChangedCallback callback)</span> </span>&#123;</span><br><span class="line">        callbacks.add(callback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">removeOnPropertyChangedCallback</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            Observable.OnPropertyChangedCallback callback)</span> </span>&#123;</span><br><span class="line">        callbacks.remove(callback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies observers that all properties of this instance have changed.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notifyChange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        callbacks.notifyCallbacks(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies observers that a specific property has changed. The getter for the</span></span><br><span class="line"><span class="comment">     * property that changes should be marked with the <span class="doctag">@Bindable</span> annotation to</span></span><br><span class="line"><span class="comment">     * generate a field in the BR class to be used as the fieldId parameter.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fieldId The generated BR id for the Bindable field.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notifyPropertyChanged</span><span class="params">(<span class="keyword">int</span> fieldId)</span> </span>&#123;</span><br><span class="line">        callbacks.notifyCallbacks(<span class="keyword">this</span>, fieldId, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒå‘ç»‘å®š"><a href="#åŒå‘ç»‘å®š" class="headerlink" title="åŒå‘ç»‘å®š"></a>åŒå‘ç»‘å®š</h2><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><p>ç»ˆäºæ¥åˆ°å¤§åé¼é¼çš„åŒå‘ç»‘å®šäº†ã€‚ä¹‹å‰æˆ‘ä»¬çš„æ™®é€šæ“ä½œéƒ½æ˜¯ä¿®æ”¹ç»‘å®šæ•°æ®ï¼Œè§¦å‘UIå˜åŒ–ã€‚</p><p>å•å‘ç»‘å®šè¿‡ç¨‹ï¼š<code>data set</code>-&gt; <code>data notify</code> -&gt; <code>UI get</code>-&gt;<code>UI change</code></p><p>åŒå‘ç»‘å®šè¿‡ç¨‹ï¼š<code>UI set</code> -&gt; <code>data set</code> -&gt; <code>data notify</code> -&gt; <code>UI get</code> -&gt; <code>UI change</code></p><p>ç®€å•æ¥è®²å°±æ˜¯ä»¥å‰æ˜¯é€šè¿‡ç›´æ¥ä¿®æ”¹ç»‘å®šæ•°æ®æ¥å½±å“UIå€¼ï¼Œç°åœ¨åŒå‘ç»‘å®šä¿®æ”¹UIå€¼æ¥è§¦å‘ç»‘å®šæ•°æ®æ”¹å˜ã€‚</p><p>å•å‘ç»‘å®š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">CheckBox</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/rememberMeCheckBox"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:checked</span>=<span class="string">"@&#123;viewmodel.rememberMe&#125;"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:onCheckedChanged</span>=<span class="string">"@&#123;viewmodel.rememberMeChanged&#125;"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡reemberMeChangedæ¥è§¦å‘æ”¹å˜äº‹ä»¶ï¼Œç»§è€Œè‡ªè¡Œä¹¦å†™ä¿®æ”¹ç»‘å®šæ•°æ®é€»è¾‘</p><p>ç°åœ¨åŒå‘ç»‘å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;CheckBox</span><br><span class="line">    android:id=<span class="string">"@+id/rememberMeCheckBox"</span></span><br><span class="line">    android:checked=<span class="string">"@=&#123;viewmodel.rememberMe&#125;"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>@={viewmodel.rememberMe}</code>æ¥è¡¨ç¤ºåŒå‘ç»‘å®šï¼Œæ„æ€æ˜¯åœ¨checkbox UIå±æ€§å˜åŒ–æ—¶ä¼šå»è°ƒç”¨<code>setRememberMe</code>æ–¹æ³•ï¼ŒUIæ•°æ®å’Œç»‘å®šæ•°æ®äº’ç›¸å¯ä»¥å½±å“ï¼Œä½†æ˜¯éœ€è¦é€šè¿‡ä¸€äº›åˆ¤æ–­æ¥é˜²æ­¢è¿›å…¥æ— é™çš„å¾ªç¯è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginViewModel</span> <span class="keyword">extends</span> <span class="title">BaseObservable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private Model data = ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bindable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getRememberMe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.rememberMe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRememberMe</span><span class="params">(Boolean value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Avoids infinite loops.</span></span><br><span class="line">        <span class="keyword">if</span> (data.rememberMe != value) &#123;</span><br><span class="line">            data.rememberMe = value;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// React to the change.</span></span><br><span class="line">            saveData();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Notify observers of a new value.</span></span><br><span class="line">            notifyPropertyChanged(BR.remember_me);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”¨äºè‡ªå®šä¹‰å±æ€§"><a href="#ç”¨äºè‡ªå®šä¹‰å±æ€§" class="headerlink" title="ç”¨äºè‡ªå®šä¹‰å±æ€§"></a>ç”¨äºè‡ªå®šä¹‰å±æ€§</h3><p>è‡ªå®šä¹‰å±æ€§ä¹Ÿå¯ä»¥è¿›è¡ŒåŒå‘ç»‘å®š</p><p>ä½¿ç”¨<code>@BindingAdapter</code>ç»‘å®šsetæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter</span>(<span class="string">"time"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setTime</span><span class="params">(MyView view, Time newValue)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Important to break potential infinite loops.</span></span><br><span class="line">    <span class="keyword">if</span> (view.time != newValue) &#123;</span><br><span class="line">        view.time = newValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>@InverseBindingAdapter</code>ç»‘å®šgetæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@InverseBindingAdapter</span>(<span class="string">"time"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Time <span class="title">getTime</span><span class="params">(MyView view)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view.getTime();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®åŒç”¨çš„ç›‘å¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter</span>(<span class="string">"app:timeAttrChanged"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setListeners</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        MyView view, <span class="keyword">final</span> InverseBindingListener attrChange)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Set a listener for click, focus, touch, etc.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h3><p>åœ¨åŒå‘ç»‘å®šä¸­çš„è½¬æ¢å°±ä¼šæ¶‰åŠåˆ°åå‘è½¬æ¢ï¼Œæ¯”å¦‚åŸæ¥æˆ‘ä»¬æ˜¯date to stringï¼Œç°åœ¨åå‘è½¬æ¢å°±æ˜¯string to dateäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Converter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@InverseMethod</span>(<span class="string">"stringToDate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">dateToString</span><span class="params">(EditText view, <span class="keyword">long</span> oldValue,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">long</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Converts long to String.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">stringToDate</span><span class="params">(EditText view, String oldValue,</span></span></span><br><span class="line"><span class="function"><span class="params">            String value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Converts String to long.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xmlä¸­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/birth_date"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">"@=&#123;Converter.dateToString(viewmodel.birthDate)&#125;"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é¿å…æ— é™å¾ªç¯"><a href="#é¿å…æ— é™å¾ªç¯" class="headerlink" title="é¿å…æ— é™å¾ªç¯"></a>é¿å…æ— é™å¾ªç¯</h3><p>åœ¨åŒå‘ç»‘å®šä¸­å› ä¸ºæ¶‰åŠä¸¤ä¸ªå€¼å¾ªç¯å˜åŒ–ï¼Œéœ€è¦é€šè¿‡æ¯”è¾ƒå€¼æ¥ï¼Œé¿å…æ— é™å¾ªç¯çš„è°ƒç”¨</p><h3 id="databing-æä¾›çš„åŒå‘ç»‘å®šå±æ€§"><a href="#databing-æä¾›çš„åŒå‘ç»‘å®šå±æ€§" class="headerlink" title="databing æä¾›çš„åŒå‘ç»‘å®šå±æ€§"></a>databing æä¾›çš„åŒå‘ç»‘å®šå±æ€§</h3><p>è¿™ä¸ªå°±æ˜¯è¯´å®ƒå†…éƒ¨å®ç°ä¸€äº›åŒå‘ç»‘å®šçš„Adapterï¼Œå°±æ˜¯ä¸ç”¨æˆ‘ä»¬è‡ªå·±å†™ï¼Œå½“ç„¶è‡ªå®šä¹‰çš„å±æ€§åŒå‘ç»‘å®šè¿˜æ˜¯å¾—è‡ªå·±å†™å’¯</p><p>æˆ‘å°±ç›´æ¥ä»å®˜ç½‘æ‹·å•¦</p><table><thead><tr><th>Class</th><th>Attribute(s)</th><th>Binding adapter</th></tr></thead><tbody><tr><td><a href="https://developer.android.google.cn/reference/android/widget/AdapterView" target="_blank" rel="noopener"><code>AdapterView</code></a></td><td><code>android:selectedItemPosition</code> <code>android:selection</code></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/AdapterViewBindingAdapter.java" target="_blank" rel="noopener"><code>AdapterViewBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/CalendarView" target="_blank" rel="noopener"><code>CalendarView</code></a></td><td><code>android:date</code></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/CalendarViewBindingAdapter.java" target="_blank" rel="noopener"><code>CalendarViewBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/CompoundButton" target="_blank" rel="noopener"><code>CompoundButton</code></a></td><td><a href="https://developer.android.google.cn/reference/android/R.attr#checked" target="_blank" rel="noopener"><code>android:checked</code></a></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/CompoundButtonBindingAdapter.java" target="_blank" rel="noopener"><code>CompoundButtonBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/DatePicker" target="_blank" rel="noopener"><code>DatePicker</code></a></td><td><code>android:year</code> <code>android:month</code> <code>android:day</code></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/DatePickerBindingAdapter.java" target="_blank" rel="noopener"><code>DatePickerBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/NumberPicker" target="_blank" rel="noopener"><code>NumberPicker</code></a></td><td><a href="https://developer.android.google.cn/reference/android/R.attr#value" target="_blank" rel="noopener"><code>android:value</code></a></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/NumberPickerBindingAdapter.java" target="_blank" rel="noopener"><code>NumberPickerBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/RadioButton" target="_blank" rel="noopener"><code>RadioButton</code></a></td><td><a href="https://developer.android.google.cn/reference/android/R.attr#checkedButton" target="_blank" rel="noopener"><code>android:checkedButton</code></a></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/RadioGroupBindingAdapter.java" target="_blank" rel="noopener"><code>RadioGroupBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/RatingBar" target="_blank" rel="noopener"><code>RatingBar</code></a></td><td><a href="https://developer.android.google.cn/reference/android/R.attr#rating" target="_blank" rel="noopener"><code>android:rating</code></a></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/RatingBarBindingAdapter.java" target="_blank" rel="noopener"><code>RatingBarBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/SeekBar" target="_blank" rel="noopener"><code>SeekBar</code></a></td><td><a href="https://developer.android.google.cn/reference/android/R.attr#progress" target="_blank" rel="noopener"><code>android:progress</code></a></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/SeekBarBindingAdapter.java" target="_blank" rel="noopener"><code>SeekBarBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/TabHost" target="_blank" rel="noopener"><code>TabHost</code></a></td><td><code>android:currentTab</code></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/TabHostBindingAdapter.java" target="_blank" rel="noopener"><code>TabHostBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/TextView" target="_blank" rel="noopener"><code>TextView</code></a></td><td><a href="https://developer.android.google.cn/reference/android/R.attr#text" target="_blank" rel="noopener"><code>android:text</code></a></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/TextViewBindingAdapter.java" target="_blank" rel="noopener"><code>TextViewBindingAdapter</code></a></td></tr><tr><td><a href="https://developer.android.google.cn/reference/android/widget/TimePicker" target="_blank" rel="noopener"><code>TimePicker</code></a></td><td><code>android:hour</code> <code>android:minute</code></td><td><a href="https://android.googlesource.com/platform/frameworks/data-binding/+/refs/heads/studio-master-dev/extensions/baseAdapters/src/main/java/androidx/databinding/adapters/TimePickerBindingAdapter.java" target="_blank" rel="noopener"><code>TimePickerBindingAdapter</code></a></td></tr></tbody></table><p>è¿™äº›éƒ½æ˜¯å·²ç»å¸®ä½ å†™å¥½å¾—åŒå‘ç»‘å®šå±æ€§</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼Œå¯ä»¥å°†æ•°æ®ç»‘å®šåˆ°UIé¡µé¢çš„æ“ä½œã€‚æ–¹ä¾¿äº†ä¹¦å†™ï¼Œä¸ç”¨å†™è¿‡å¤šçš„æ ·ç‰ˆä»£ç ï¼ŒåŒæ—¶ä¹Ÿè§£è€¦äº†ï¼Œè€¦åˆæ€§é«˜çš„éƒ½è¢«APTè‡ªåŠ¨ç”Ÿæˆäº†ï¼Œä¸ç”¨æˆ‘ä»¬ç®¡ã€‚åæ­£å†™çš„æ—¶å€™æˆ‘è¿˜æ˜¯é‡è§äº†å„ç§é—®é¢˜ï¼Œå°¤å…¶æ˜¯ç”¨Kotlinå†™çš„æ—¶å€™ï¼Œä¸€æ ·çš„ä»£ç éƒ½è·‘ä¸é€šï¼Œkotlinè¿˜æ˜¯å¾—å¥½å¥½ç¢ç£¨ç¢ç£¨å•Šã€‚è¿™ä¸ªæ–‡ç« åŸºæœ¬ç®—æ˜¯ç®€å•å¾—ç¿»è¯‘äº†å®˜æ–¹æ–‡æ¡£å§ï¼Œæœ‰æ—¶é—´è¿˜æ˜¯å†™ä¸ªdemoå¥½äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mvvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼å½’çº³</title>
      <link href="/2019/07/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%BD%92%E7%BA%B3/"/>
      <url>/2019/07/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%BD%92%E7%BA%B3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ ¹æ®ã€ŠAndroidæºç è®¾è®¡æ¨¡å¼è§£æä¸å®æˆ˜ã€‹æ€»ç»“å½’çº³å­¦ä¹ </p></blockquote><h2 id="é¢å‘å¯¹è±¡çš„çš„å…­å¤§åŸåˆ™"><a href="#é¢å‘å¯¹è±¡çš„çš„å…­å¤§åŸåˆ™" class="headerlink" title="é¢å‘å¯¹è±¡çš„çš„å…­å¤§åŸåˆ™"></a>é¢å‘å¯¹è±¡çš„çš„å…­å¤§åŸåˆ™</h2><h3 id="å•ä¸€èŒè´£"><a href="#å•ä¸€èŒè´£" class="headerlink" title="å•ä¸€èŒè´£"></a>å•ä¸€èŒè´£</h3><p>ä¸€ä¸ªç±»åº”è¯¥æ˜¯ä¸€äº›ç›¸å…³æ€§å¾ˆé«˜çš„å‡½æ•°å’Œæ•°æ®çš„é›†åˆã€‚ä¾‹å¦‚æ ¹æ®åŠŸèƒ½è¿›è¡Œå…·ä½“åˆ’åˆ†ï¼Œæ¯ä¸ªä¸ªä½“å®Œæˆè‡ªå·±ç›¸åº”çš„äº‹ã€‚</p><h3 id="å¼€é—­åŸåˆ™"><a href="#å¼€é—­åŸåˆ™" class="headerlink" title="å¼€é—­åŸåˆ™"></a>å¼€é—­åŸåˆ™</h3><p>å¼€æ”¾æ‰©å±•ï¼Œå…³é—­ä¿®æ”¹ã€‚åœ¨è½¯ä»¶ç”Ÿå‘½å‘¨æœŸè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå¯¹åŸæœ‰ä»£ç è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¾ˆæœ‰å¯èƒ½å¼•å…¥æ–°çš„é”™è¯¯ï¼Œå¯¼è‡´æ•´ä¸ªé¡¹ç›®éœ€è¦é‡æ„ï¼Œå¹¶ä¸”éœ€è¦é‡æ–°æµ‹è¯•å•¥çš„ã€‚æ‰€æœ‰è¦é€šè¿‡æ‰©å±•çš„å½¢å¼æ¥ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ã€‚</p><h3 id="é‡Œæ°ä»£æ¢"><a href="#é‡Œæ°ä»£æ¢" class="headerlink" title="é‡Œæ°ä»£æ¢"></a>é‡Œæ°ä»£æ¢</h3><p>å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜åŸæœ‰çˆ¶ç±»çš„åŠŸèƒ½</p><h3 id="ä¾èµ–å€’ç½®"><a href="#ä¾èµ–å€’ç½®" class="headerlink" title="ä¾èµ–å€’ç½®"></a>ä¾èµ–å€’ç½®</h3><p>é«˜å±‚æ¨¡å—ä¸ä¾èµ–åº•å±‚æ¨¡å—ç»†èŠ‚ï¼Œåº”è¯¥ä¾èµ–æŠ½è±¡ã€‚è¿™ä¸ªä¹Ÿå°±æ˜¯ç”³æ˜ä½¿ç”¨æŠ½è±¡ï¼Œå®ç°ä½¿ç”¨ç»†èŠ‚ã€‚</p><h3 id="æ¥å£éš”ç¦»"><a href="#æ¥å£éš”ç¦»" class="headerlink" title="æ¥å£éš”ç¦»"></a>æ¥å£éš”ç¦»</h3><p>å®¢æˆ·ç«¯ä¸åº”å½“ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼Œç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šï¼Œä¸è¦å°†è¿‡å¤šçš„åŠŸèƒ½åŠ åœ¨ä¸€ä¸ªæ¥å£ä¸Šã€‚æ¥å£çš„è®¾è®¡ç²’åº¦è¶Šå°ï¼Œç³»ç»Ÿè¶Šçµæ´»ï¼Œç»´æŠ¤é™ä½</p><h3 id="è¿ªç±³ç‰¹åŸåˆ™"><a href="#è¿ªç±³ç‰¹åŸåˆ™" class="headerlink" title="è¿ªç±³ç‰¹åŸåˆ™"></a>è¿ªç±³ç‰¹åŸåˆ™</h3><p>ä¸€ä¸ªç±»åº”è¯¥åªå’Œè‡ªå·±å…³å¿ƒçš„ç±»è¿›è¡Œé€šä¿¡ã€‚æœ€å°‘çŸ¥é“åŸåˆ™ï¼Œé™ä½ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆã€‚</p><a id="more"></a><h2 id="åˆ›å»ºå‹"><a href="#åˆ›å»ºå‹" class="headerlink" title="åˆ›å»ºå‹"></a>åˆ›å»ºå‹</h2><p>åˆ›å»ºå¯¹è±¡å®ä¾‹åŒ–ï¼Œè¿™ç±»æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯ä¸è®©ç”¨æˆ·ä¾èµ–å¯¹è±¡çš„åˆ›é”®ã€‚</p><h3 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h3><p>ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå•ä¾‹ï¼Œè€Œä¸”è‡ªåŠ¨å®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›ã€‚</p><p>ç‰¹ç‚¹ï¼šæ„é€ å™¨ç§æœ‰ï¼Œå®ä¾‹é™æ€ç§æœ‰ï¼Œæä¾›getå®ä¾‹çš„é™æ€æ–¹æ³•</p><h4 id="é¥¿æ±‰å•ä¾‹"><a href="#é¥¿æ±‰å•ä¾‹" class="headerlink" title="é¥¿æ±‰å•ä¾‹"></a>é¥¿æ±‰å•ä¾‹</h4><p>çº¿ç¨‹å®‰å…¨ï¼Œç±»åŠ è½½æ—¶è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ²¡æœ‰å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯ç©ºé—´æ¢å–æ—¶é—´ï¼Œä¸å¿…è¦æå‰è£…è½½çš„å®ä¾‹ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‡’æ±‰å•ä¾‹"><a href="#æ‡’æ±‰å•ä¾‹" class="headerlink" title="æ‡’æ±‰å•ä¾‹"></a>æ‡’æ±‰å•ä¾‹</h4><p>çº¿ç¨‹ä¸å®‰å…¨ï¼Œé™„å¸¦å»¶è¿ŸåŠ è½½å’Œç¼“å­˜æ€æƒ³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(INSTANCE == <span class="keyword">null</span>)</span><br><span class="line">            INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„æ‡’æ±‰å•ä¾‹å¯èƒ½å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜</p><h4 id="æ‡’æ±‰å•ä¾‹-åŒæ­¥æ–¹æ³•"><a href="#æ‡’æ±‰å•ä¾‹-åŒæ­¥æ–¹æ³•" class="headerlink" title="æ‡’æ±‰å•ä¾‹+åŒæ­¥æ–¹æ³•"></a>æ‡’æ±‰å•ä¾‹+åŒæ­¥æ–¹æ³•</h4><p>çº¿ç¨‹å®‰å…¨ï¼Œé”ä½æ•´ä¸ªæ–¹æ³•å¯¼è‡´ï¼Œè®¿é—®é€Ÿåº¦ä¸‹é™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(INSTANCE == <span class="keyword">null</span>)</span><br><span class="line">            INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŒé‡æ ¡éªŒé”å•ä¾‹"><a href="#åŒé‡æ ¡éªŒé”å•ä¾‹" class="headerlink" title="åŒé‡æ ¡éªŒé”å•ä¾‹"></a>åŒé‡æ ¡éªŒé”å•ä¾‹</h4><p>åªæ˜¯åœ¨å®ä¾‹ä¸ºç©ºçš„æƒ…å†µæ‰åŠ é”ï¼Œå†…éƒ¨åˆ›é”®å®ä¾‹åŠ é”ï¼Œæ—¢ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿæå‡çš„è®¿é—®é€Ÿåº¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(INSTANCE == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span>(INSTANCE == <span class="keyword">null</span>) &#123;</span><br><span class="line">                INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é™æ€å•ä¾‹"><a href="#é™æ€å•ä¾‹" class="headerlink" title="é™æ€å•ä¾‹"></a>é™æ€å•ä¾‹</h4><p>çº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½ï¼Œæ¨è</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æšä¸¾å•ä¾‹"><a href="#æšä¸¾å•ä¾‹" class="headerlink" title="æšä¸¾å•ä¾‹"></a>æšä¸¾å•ä¾‹</h4><p>çº¿ç¨‹å®‰å…¨ï¼Œç®€å•ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯ä¸€ä¸ªå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SingletonEnum &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®¹å™¨å•ä¾‹"><a href="#å®¹å™¨å•ä¾‹" class="headerlink" title="å®¹å™¨å•ä¾‹"></a>å®¹å™¨å•ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,Object&gt; objMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonManager</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerService</span><span class="params">(String key, Object instance)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!objMap.containKey(key))</span><br><span class="line">            objMap.put(key,instance);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getService</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> objMap.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åºåˆ—åŒ–ç ´åå•ä¾‹"><a href="#åºåˆ—åŒ–ç ´åå•ä¾‹" class="headerlink" title="åºåˆ—åŒ–ç ´åå•ä¾‹"></a>åºåˆ—åŒ–ç ´åå•ä¾‹</h4><p>ä»¥ä¸Šå•ä¾‹åœ¨é™¤äº†æšä¸¾å•ä¾‹ï¼Œåœ¨ååºåˆ—åŒ–çš„æƒ…å†µä¸‹æ˜¯ä¼šç”Ÿæˆæ–°çš„å®ä¾‹çš„ï¼Œå¦‚ä½•æœç»ï¼Œé‡å†™ä»¥ä¸‹æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> throw ObjectStreamException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœ¨androidæºç ä¸­ä½“ç°"><a href="#åœ¨androidæºç ä¸­ä½“ç°" class="headerlink" title="åœ¨androidæºç ä¸­ä½“ç°"></a>åœ¨androidæºç ä¸­ä½“ç°</h4><p>å•ä¾‹æ¨¡å¼å¾ˆå¸¸è§ï¼Œæ¯”å¦‚è·å¾—å„ç§ç³»ç»ŸæœåŠ¡ï¼Œå®ƒä»¬éƒ½æ˜¯ä»¥å•ä¾‹çš„å½¢å¼æ³¨å†Œåˆ°Managerçš„ã€‚</p><h3 id="Builderæ¨¡å¼"><a href="#Builderæ¨¡å¼" class="headerlink" title="Builderæ¨¡å¼"></a>Builderæ¨¡å¼</h3><p>å¯¹è±¡çš„æ„å»ºäº¤ç»™æ„å»ºå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Car</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = builder.name;</span><br><span class="line">        <span class="keyword">this</span>.color = builder.color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> class <span class="title">Builder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> String color;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">color</span><span class="params">(String color)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.color = color;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Car <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Car(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœ¨æºç ä¸­ä½“ç°"><a href="#åœ¨æºç ä¸­ä½“ç°" class="headerlink" title="åœ¨æºç ä¸­ä½“ç°"></a>åœ¨æºç ä¸­ä½“ç°</h4><p>æ¯”å¦‚<code>AlertDialog</code>ï¼Œ<code>OkHttp</code>ä¸­çš„<code>Request</code>ï¼Œ<code>RequestBody</code>ï¼Œéƒ½æŒºå¸¸è§çš„</p><h3 id="å·¥å‚"><a href="#å·¥å‚" class="headerlink" title="å·¥å‚"></a>å·¥å‚</h3><p>ç”¨äºç”Ÿäº§å¯¹è±¡</p><h4 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h4><p>ä¹Ÿç§°ä½œé™æ€å·¥å‚æ–¹æ³•æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Option</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptionA</span> <span class="keyword">implements</span> <span class="title">Option</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acion</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptionB</span> <span class="keyword">implements</span> <span class="title">Option</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Option <span class="title">getOption</span><span class="params">(String optionName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(optionName) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"A"</span>: <span class="keyword">return</span> <span class="keyword">new</span> OptionA();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"B"</span>: <span class="keyword">return</span> <span class="keyword">new</span> OptionB();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Option a = Factory.getOption(<span class="string">"A"</span>);</span><br><span class="line">        Option b = Factory.getOption(<span class="string">"B"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥äº§å‡ºå¤šä¸ªä¸åŒç±»å‹çš„å®ä¾‹ï¼Œä½†æ˜¯å¯¹äºåç»­å¦‚æœéœ€è¦åŠ ç”Ÿäº§å‡ºå…¶å®ƒçš„å¯¹è±¡ï¼Œå°±è¦å¯¹ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸ç¬¦åˆå¼€é—­åŸåˆ™çš„ã€‚å¯¹ç»´æŠ¤å’Œæ‰©å±•ä¸åˆ©</p><h4 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Option</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptionA</span> <span class="keyword">implements</span> <span class="title">Option</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acion</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptionB</span> <span class="keyword">implements</span> <span class="title">Option</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IFactory</span> </span>&#123;</span><br><span class="line">    <span class="function">Option <span class="title">createOption</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptionAFactory</span> <span class="keyword">implements</span> <span class="title">IFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Option <span class="title">createOption</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OptionA();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptionBFactory</span> <span class="keyword">implements</span> <span class="title">IFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Option <span class="title">createOption</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OptionB();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IFactory factory = <span class="keyword">new</span> OptionAFactory();</span><br><span class="line">        Option a = factory.createOption();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„æ–¹å¼æ˜¯å®Œå…¨ç¬¦åˆå¼€é—­åŸåˆ™çš„ï¼Œè¿™æ ·çš„è¯éœ€è¦æ‰©å±•ï¼Œå°±ç›´æ¥å®ç°éœ€è¦çš„å·¥å‚å°±è¡Œäº†ï¼Œæœ‰è‰¯å¥½çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ï¼Œä½†æ˜¯éšç€ä»£ç è¿­ä»£ï¼Œå·¥å‚è¶Šæ¥è¶Šå¤šï¼Œå°±ä¼šåœ¨ä¸€å®šç¨‹åº¦å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚</p><h4 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h4><p>ä»¥ä¸Šä¸¤ç§å·¥å‚ï¼Œä¸€ä¸ªçµæ´»ï¼Œä¸€ä¸ªä¾¿äºæ‰©å±•ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼å°±æ˜¯äºŒè€…æŠ˜ä¸­çš„è€ƒè™‘äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">B</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span> <span class="keyword">implements</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AA</span> <span class="keyword">implements</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span> <span class="keyword">implements</span> <span class="title">B</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BB</span> <span class="keyword">implements</span> <span class="title">B</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="function">A <span class="title">getA</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">B <span class="title">getB</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DoubleFactory</span> <span class="keyword">implements</span> <span class="title">Facotry</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> A <span class="title">getA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AA();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> B <span class="title">getB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BB();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TripleFactory</span> <span class="title">implement</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> A <span class="title">getA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AAA();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> B <span class="title">getB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BBB();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½“ç°"><a href="#ä½“ç°" class="headerlink" title="ä½“ç°"></a>ä½“ç°</h4><p>è¿™ä¸ªä¹Ÿæ˜¯æŒºå¸¸è§çš„ï¼Œæ¯”å¦‚BitmapFactory</p><h3 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h3><p>é€šè¿‡åŸå‹å®ä¾‹æ¥åˆ›é”®æ–°çš„å¯¹è±¡</p><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><ul><li>ç±»åˆå§‹åŒ–éœ€è¦æ¶ˆè€—å¤§é‡èµ„æºï¼ŒåŒ…æ‹¬æ•°æ®èµ„æºå’Œç¡¬ä»¶èµ„æºï¼Œé€šè¿‡åŸå‹æ‹·è´æ¥é¿å…è¿™äº›æ¶ˆè€—</li><li>é€šè¿‡newæ¥äº§ç”Ÿå®ä¾‹éœ€è¦é…ç½®ç¹ççš„æ•°æ®å’Œè®¿é—®æƒé™</li><li>ä¸€ä¸ªå¯¹è±¡éœ€è¦æä¾›ç»™å…¶å®ƒå¯¹è±¡ä½¿ç”¨ï¼Œè€Œä¸”å„ä¸ªè°ƒç”¨è€…éƒ½æœ‰å¯èƒ½æ”¹å˜å…¶å€¼ï¼Œè€ƒè™‘ä½¿ç”¨åŸå‹æ‹·è´å¯¹è±¡æä¾›è°ƒç”¨ï¼Œä¿æŠ¤ä¸‹æ‹·è´</li></ul><h4 id="how"><a href="#how" class="headerlink" title="how"></a>how</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scratch</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        WordDocument prototype = <span class="keyword">new</span> WordDocument();</span><br><span class="line">        prototype.mText = <span class="string">"hello"</span>;</span><br><span class="line">        WordDocument copy = prototype.clone();</span><br><span class="line">        System.out.println(prototype);</span><br><span class="line">        System.out.println(copy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WordDocument</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</span><br><span class="line">        String mText;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">WordDocument</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> WordDocument <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                WordDocument obj = (WordDocument) <span class="keyword">super</span>.clone();</span><br><span class="line">                obj.mText = <span class="keyword">this</span>.mText;</span><br><span class="line">                <span class="keyword">return</span> obj;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±æ‹·è´å’Œæµ…æ‹·è´"><a href="#æ·±æ‹·è´å’Œæµ…æ‹·è´" class="headerlink" title="æ·±æ‹·è´å’Œæµ…æ‹·è´"></a>æ·±æ‹·è´å’Œæµ…æ‹·è´</h4><p>ä¸ºäº†é¿å…æ‹·è´æ—¶äº§ç”Ÿçš„å‰¯æœ¬å½±å“åŸå‹ï¼Œå°½é‡ä½¿ç”¨æ·±æ‹·è´ã€‚</p><ul><li>æµ…æ‹·è´ï¼šå†…éƒ¨å¯¹è±¡åªæ˜¯å¤åˆ¶å¼•ç”¨</li><li>æ·±æ‹·è´ï¼šå†…éƒ¨å¯¹è±¡éœ€è¦å±‚å±‚æ‹·è´ï¼Œè€Œä¸æ˜¯å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦æ‰‹åŠ¨clone</li></ul><h2 id="è¡Œä¸ºå‹"><a href="#è¡Œä¸ºå‹" class="headerlink" title="è¡Œä¸ºå‹"></a>è¡Œä¸ºå‹</h2><h3 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h3><h4 id="what"><a href="#what" class="headerlink" title="what"></a>what</h4><p>æ¯ä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€è¯·æ±‚ï¼Œä»è€Œé¿å…äº†è¯·æ±‚çš„å‘é€è€…å’Œæ¥å—è€…ä¹‹é—´çš„è€¦åˆï¼Œå°†è¿™äº›å¯¹è±¡æ„æˆä¸€æ¡é“¾ï¼Œæ²¿ç€é“¾ä¼ é€’è¯·æ±‚ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢</p><h4 id="ä½“ç°-1"><a href="#ä½“ç°-1" class="headerlink" title="ä½“ç°"></a>ä½“ç°</h4><h5 id="androidäº‹ä»¶ä¼ é€’"><a href="#androidäº‹ä»¶ä¼ é€’" class="headerlink" title="androidäº‹ä»¶ä¼ é€’"></a>androidäº‹ä»¶ä¼ é€’</h5><p>è¿™ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯<code>androidçš„äº‹ä»¶ä¼ é€’</code>ï¼šä»Activityçš„<code>dispatchTouchEvent</code>ä¼ é€’åˆ°windowï¼ŒDoecViewï¼Œå†åˆ°ViewGroupçš„<code>dispatchTouchEvent</code>ï¼Œé€šè¿‡<code>onInterceptTouchEvent</code>åˆ¤æ–­æ˜¯å¦æ‹¦æˆªï¼Œæ‹¦æˆªåˆ™è‡ªèº«å¤„ç†äº‹ä»¶ï¼Œå¦åˆ™ä¼ é€’äº‹ä»¶åŒºåŸŸçš„å­Viewï¼Œè¿™ä¸ªViewæœ‰å¯èƒ½æ˜¯ViewGroupï¼Œå¦‚åŒå‰é¢çš„æ­¥éª¤ä¸€æ ·åˆ†å‘ï¼Œæ‹¦æˆªï¼Œåˆ†å‘ã€‚å¦‚æœæ˜¯Viewé€šè¿‡äº‹ä»¶onTouchEventæ¶ˆè´¹ï¼ŒonTouchEvenè¿”å›å€¼ä¸ºtrueä»£è¡¨æ¶ˆè´¹ï¼Œè¡¨ç¤ºæ­¤æ¬¡äº‹ä»¶å¤„ç†å®Œæ¯•ï¼Œè¿”å›ä¸ºfalseåˆ™äº¤ç”±çˆ¶Viewæ¶ˆè´¹å¤„ç†ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p><h5 id="æœ‰åºå¹¿æ’­"><a href="#æœ‰åºå¹¿æ’­" class="headerlink" title="æœ‰åºå¹¿æ’­"></a>æœ‰åºå¹¿æ’­</h5><h3 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h3><p>å®šä¹‰ï¼šå°†è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œè®©ä¸åŒçš„ç”¨æˆ·ä½¿ç”¨ä¸åŒçš„è¯·æ±‚æ¥æŠŠå®¢æˆ·ç«¯å‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æ’é˜Ÿæˆ–è€…è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€æ“ä½œã€‚</p><h3 id="è§£é‡Šå™¨æ¨¡å¼"><a href="#è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="è§£é‡Šå™¨æ¨¡å¼"></a>è§£é‡Šå™¨æ¨¡å¼</h3><p>å®šä¹‰ï¼šç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œä½¿ç”¨è§£é‡Šå™¨æ¥è§£é‡Šè¯­å¥</p><p>ä½“ç°ï¼šPMSå¯¹Manifestæ–‡ä»¶çš„è§£æ</p><h3 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h3><p>å®šä¹‰ï¼šæä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªå®¹å™¨å¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p><p>ä½“ç°ï¼šjavaä¸­Mapï¼ŒListï¼ŒSetéƒ½æœ‰ï¼Œä»¥åŠandroid æ•°æ®åº“Cursoræ¸¸æ ‡å¯¹è±¡ä¹Ÿæ˜¯è¿­ä»£å™¨çš„ä½“ç°</p><h3 id="ä¸­ä»‹è€…æ¨¡å¼"><a href="#ä¸­ä»‹è€…æ¨¡å¼" class="headerlink" title="ä¸­ä»‹è€…æ¨¡å¼"></a>ä¸­ä»‹è€…æ¨¡å¼</h3><p>å®šä¹‰ï¼šåŒ…å«ä¸€ç³»åˆ—å¯¹è±¡çš„ç›¸äº’ä½œç”¨çš„æ–¹å¼ï¼Œä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾ç¤ºçš„ç›¸äº’å¼•ç”¨ï¼Œä»è€Œå®ç°è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹çš„æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’</p><p>ä½“ç°ï¼š</p><h3 id="å¤‡å¿˜å½•æ¨¡å¼"><a href="#å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼"></a>å¤‡å¿˜å½•æ¨¡å¼</h3><p>å®šä¹‰ï¼šåœ¨ä¸ç ´åå°é—­çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥åå¯ä»¥å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚</p><p>ä½“ç°ï¼šandroidä¸­Activityçš„çŠ¶æ€ä¿å­˜</p><h3 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h3><p>å®šä¹‰ï¼šå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡ä¼šçš„åˆ°æŸåˆ°é€šçŸ¥å¹¶ä¸”åšå‡ºååº”ã€‚</p><p>ä½“ç°ï¼šRxJavaï¼Œå„ç§å“åº”äº‹ä»¶ï¼Œäº‹ä»¶æ€»çº¿ï¼Œå›è°ƒï¼Œéƒ½æ˜¯åº”ç”¨è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><h3 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h3><p>å®šä¹‰ï¼šå½“ä¸€ä¸ªå¯¹è±¡çš„å†…åœ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶å…è®¸åšå‡ºè¡Œä¸ºçš„å˜æ›´ã€‚</p><p>ä½“ç°ï¼šandroidç³»ç»Ÿæºç ä¸­çš„çŠ¶æ€æœºï¼Œæ¯”å¦‚è“ç‰™å®ä½“ï¼Œä¼šæœ‰å¾ˆå¤šçŠ¶æ€ï¼Œåœ¨ä¸åŒçš„çŠ¶æ€é—´åšå‡ºä¸åŒçš„å“åº”è¡Œä¸ºï¼Œä»¥åŠå˜æ¢çŠ¶æ€ã€‚</p><h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h3><p>å®šä¹‰ï¼šç­–ç•¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸€ä¸ªç®—æ³•è¿›è¡ŒåŒ…è£…èµ·æ¥ï¼Œè€Œå®ƒä»¬è¿˜å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨çš„å®ƒçš„å®¢æˆ·ç«¯è€Œç‹¬ç«‹å˜åŒ–ã€‚</p><p>ä½“ç°ï¼šandroidä¸­åŠ¨ç”»ä¸­çš„æ’å€¼å™¨ï¼Œé€šè¿‡å®šä¹‰ä¸åŒçš„æ’å€¼å™¨ä½¿å¾—åŠ¨ç”»çš„æ•ˆæœå‘ç”Ÿæ”¹å˜ã€‚</p><h3 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3><p>å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªæ“ä½œçš„ç®—æ³•çš„æ¡†æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ï¼Œä½¿å¾—å­ç±»ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p><p>ä½“ç°ï¼šAsyncTaskçš„å®ç°ï¼Œå­ç±»åªéœ€è¦å®ç°å›ºå®šçš„å‡ ä¸ªæ–¹æ³•å³å¯å®Œæˆä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚</p><h3 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h3><p>å®šä¹‰ï¼šå°è£…ä¸€äº›ä½œç”¨äºæŸäº›æ•°æ®ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œï¼Œå®ƒå¯ä»¥åœ¨ä¸æ”¹å˜è¿™ä¸ªæ•°æ®ç»“æ„çš„å‰æä¸‹å®šä¹‰æ€»ç”¨äºè¿™äº›å…ƒç´ çš„æ“¦æ“ä½œã€‚</p><h2 id="ç»“æ„å‹"><a href="#ç»“æ„å‹" class="headerlink" title="ç»“æ„å‹"></a>ç»“æ„å‹</h2><h3 id="è®¾é…å™¨æ¨¡å¼"><a href="#è®¾é…å™¨æ¨¡å¼" class="headerlink" title="è®¾é…å™¨æ¨¡å¼"></a>è®¾é…å™¨æ¨¡å¼</h3><p>å®šä¹‰ï¼šæŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿å¾—åŸæœ¬æ¥å£ä¸åŒ¹é…è€Œæ— æ³•å·¥ä½œåœ¨ä¸€èµ·çš„ä¸¤ä¸ªç±»å…±åŒå·¥ä½œã€‚</p><p>ä½“ç°ï¼šRecyclerViewçš„Adapterï¼Œä»¥åŠRetrofitçš„æ•°æ®è½¬æ¢å’ŒCallè½¬æ¢çš„Adapter</p><h3 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h3><p>å®šä¹‰ï¼šå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚</p><p>ä½“ç°ï¼šandroid Viewå’ŒViewGroupçš„viewä½“ç³»</p><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><p>å®šä¹‰ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p><p>ä½“ç°ï¼šActivityManagerProxyï¼Œä»¥åŠRetrofitçš„æ¥å£åŠ¨æ€ä»£ç†</p><h3 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h3><p>å®šä¹‰ï¼šè¿ç”¨å…±äº«æŠ€æœ¯å¯ä»¥æœ‰æ•ˆçš„æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ï¼Œå¯¹è±¡æ± ï¼Œé‡ç”¨å¯¹è±¡ï¼Œå‡å°‘å†…å­˜ä½¿ç”¨</p><p>ä½“ç°ï¼šAndoridæ¶ˆæ¯æœºåˆ¶ä¸­Messageï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªé•¿åº¦50ä¸æ–­å¤ç”¨çš„æ¶ˆæ¯å¯¹è±¡æ± </p><h3 id="å¤–è§‚æ¨¡å¼"><a href="#å¤–è§‚æ¨¡å¼" class="headerlink" title="å¤–è§‚æ¨¡å¼"></a>å¤–è§‚æ¨¡å¼</h3><p>å®šä¹‰ï¼šè¦æ±‚å­ç³»ç»Ÿçš„å¤–éƒ¨ä¸å…¶å†…éƒ¨é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¯¹è±¡è¿›è¡Œã€‚æä¾›ç»Ÿä¸€æ¥å£è¿›è¡Œè°ƒç”¨</p><p>ä½“ç°ï¼š</p><ul><li>Contextå°†è®¸å¤šåŠŸèƒ½çš„å…·ä½“å®ç°æ˜¯AMSï¼ŒPMSç­‰ï¼Œä½†æ˜¯å¤–éƒ¨å¤§å®¶åªéœ€è¦é€šè¿‡contextæ¥è°ƒç”¨å°±è¡Œäº†ã€‚</li><li>ä»£ç å¼€å‘ä¸­ä¸‰çº§ç¼“å­˜ï¼Œä»å†…å­˜ï¼Œæ•°æ®åº“ï¼Œç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯ç”¨æˆ·ä¸éœ€è¦äº†è§£ç»†èŠ‚</li></ul><h3 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h3><p>å®šä¹‰ï¼šå°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä½¿å¾—å®ƒä»¬ç‹¬ç«‹çš„è¿›è¡Œå˜åŒ–</p><h3 id="è£…é¥°å™¨æ¨¡å¼"><a href="#è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="è£…é¥°å™¨æ¨¡å¼"></a>è£…é¥°å™¨æ¨¡å¼</h3><p>å®šä¹‰ï¼šåŠ¨æ€çš„ç»™å¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼Œå°±åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ›´åŠ çµæ´»</p><p>ä½“ç°ï¼šContext å’Œ ContextWrapperå’ŒContextImplï¼Œæˆ‘è§‰å¾—RxJavaå¾—ä¸­å±‚å±‚Observableå’ŒOberverä¹Ÿæ˜¯ç»è¿‡åŒ…è£…å¾—ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android-äº‹ä»¶åˆ†å‘æœºåˆ¶</title>
      <link href="/2019/07/22/Android-%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/"/>
      <url>/2019/07/22/Android-%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>ä»Activityï¼šdispatchTouchEventï¼Œ</p><p>è°ƒç”¨Windowï¼šdispatchTouchEventï¼Œ</p><p>è°ƒç”¨DecorViewï¼šdispatchTouchEvent</p><p>è°ƒç”¨ViewGroupï¼šdispatchTouchEvent</p><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/d3758eef1f72" target="_blank" rel="noopener">https://www.jianshu.com/p/d3758eef1f72</a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ç¯‡ææ‡‚AsynsTask</title>
      <link href="/2019/07/17/Android-%E4%B8%80%E7%AF%87%E6%90%9E%E6%87%82AsynsTask/"/>
      <url>/2019/07/17/Android-%E4%B8%80%E7%AF%87%E6%90%9E%E6%87%82AsynsTask/</url>
      
        <content type="html"><![CDATA[<h2 id="what"><a href="#what" class="headerlink" title="what"></a>what</h2><p>android ä½¿ç”¨æ¨¡æ¿æ¨¡å¼ï¼Œå°è£…ç”¨äºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚åœ¨androidä¸­é€šå¸¸æƒ…å†µä¸‹éœ€è¦å®ç°å¤šçº¿ç¨‹ä»»åŠ¡ä»¥åŠUIçš„æ›´æ–°ï¼Œä½†æ˜¯UIé€šå¸¸æƒ…å†µä¸‹åªèƒ½ç”±UIçº¿ç¨‹æ¥æ›´æ–°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç®€å•ç‚¹å¯èƒ½ä¼šä½¿ç”¨handlerå•Šï¼ŒrunOnUIæ–¹æ³•å•Šï¼Œå…¶å®æœ¬è´¨ä¹Ÿæ˜¯ä½¿ç”¨UIä¸»çº¿ç¨‹çš„handlerã€‚ä½†æ˜¯å†™èµ·æ¥å¾ˆå¥½çœ‹ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥androidä½¿ç”¨handlerå’Œçº¿ç¨‹æ± å°è£…äº†ä¸€ä¸ªç”¨äºæ‰§è¡Œå¼‚æ­¥çš„AsyncTaskã€‚</p><h2 id="how"><a href="#how" class="headerlink" title="how"></a>how</h2><p>é¦–å…ˆçœ‹çœ‹æ€ä¹ˆç”¨å§ï¼Œå·¨ç®€å•ã€‚</p><a id="more"></a><h3 id="ç»§æ‰¿AsyncTask"><a href="#ç»§æ‰¿AsyncTask" class="headerlink" title="ç»§æ‰¿AsyncTask"></a>ç»§æ‰¿AsyncTask</h3><p>ä¸‰æ³›å‹ä»£è¡¨ï¼š</p><ul><li>Params è¾“å…¥å‚æ•°ç±»å‹</li><li>Result æ‰§è¡Œç»“æœç±»å‹</li><li>Progress è¿›åº¦é‡ç±»å‹</li></ul><p>ä¾æ¬¡é‡å†™æ„é€ æ–¹æ³•:</p><ul><li><code>doInBackground</code> å…·ä½“ä»»åŠ¡æ‰§è¡Œ</li><li><code>onPreExecute</code> ä»»åŠ¡ä¹‹å‰ï¼ŒUIçº¿ç¨‹ï¼Œä¸€èˆ¬ç”¨äºæ·»åŠ æ‰§è¡Œå¼€å§‹æç¤º</li><li><code>onPostExecute</code> ä»»åŠ¡æ‰§è¡Œä¹‹åï¼ŒUIçº¿ç¨‹ï¼Œç”¨äºæ·»åŠ æ‰§è¡Œå®Œæˆæç¤º</li><li><code>onProgressUpdate</code> è¿›åº¦å˜åŒ–å›è°ƒï¼ŒUIçº¿ç¨‹ï¼Œç”¨äºæ·»åŠ è¿›åº¦æç¤º</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeleteAsyncTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">ArrayList</span>&lt;<span class="title">Model</span>&gt;, <span class="title">Integer</span>, <span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DeleteAsyncTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Boolean <span class="title">doInBackground</span><span class="params">(ArrayList&lt;Model&gt;... lists)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> delete(lists[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPreExecute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Boolean succeed)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Integer[] values)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°å»ºå®ä¾‹ï¼Œæ‰§è¡Œ"><a href="#æ–°å»ºå®ä¾‹ï¼Œæ‰§è¡Œ" class="headerlink" title="æ–°å»ºå®ä¾‹ï¼Œæ‰§è¡Œ"></a>æ–°å»ºå®ä¾‹ï¼Œæ‰§è¡Œ</h3><p>è¿™ä¸ªæ˜¯ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± ï¼Œä¼šå»æ’é˜Ÿçš„å“¦ï¼ˆä¸²è¡Œæ‰§è¡Œï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> DeleteAsyncTask().execute(mSelectedList);</span><br></pre></td></tr></table></figure><p>ä½ è¦è§‰å¾—ä¸çˆ½ï¼Œæˆ–è€…ä½ çš„ä»»åŠ¡å¾ˆç‰¹åˆ«æ˜¯é‚£ç§IOä»»åŠ¡å•Šï¼Œæˆ–è€…è®¡ç®—ä»»åŠ¡å•Šã€‚æŒ‡å®šä½ çš„çº¿ç¨‹æ± </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> DeleteAsyncTask().executeOnExecutor(executor,mSelectedList);</span><br></pre></td></tr></table></figure><h2 id="why"><a href="#why" class="headerlink" title="why"></a>why</h2><p>é¦–å…ˆè®²ä¸‹ä¸ºå•¥ä»¥<code>execute(paramm)</code>çš„æ–¹å¼æ‰§è¡ŒAsyncTaskæ˜¯ä¸²è¡Œçš„æ‰§è¡Œçš„ã€‚ä¸ºå•¥å‘¢ï¼Œå› ä¸ºAsyncTaskå†…éƒ¨æ˜¯ç»´æŒäº†ä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œ<code>SERIAL_EXECUTOR</code>ï¼šç”¨äºä»»åŠ¡æ’é˜Ÿå³æ‰€æœ‰ä»»åŠ¡é¡ºåºæ‰§è¡Œçš„çº¿ç¨‹æ± ã€‚<code>THREAD_POOL_EXECUTOR</code>:ç”¨äºå®é™…æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œè°ƒç”¨executeæ—¶ä¼šé€šè¿‡<code>SERIAL_EXECUTOR</code>æ¥æ‰§è¡Œï¼Œè€Œè¿™ä¸ªåˆ™æ˜¯å…¥é˜Ÿåˆ—ï¼Œç„¶åè°ƒç”¨<code>THREAD_POOL_EXECUTOR</code>æ¥å®é™…æ‰§è¡Œä»»åŠ¡ã€‚å¯¹äº†ä»–ä»¬éƒ½æ˜¯é™æ€çš„ã€‚</p><h3 id="AsyncTaskçŠ¶æ€"><a href="#AsyncTaskçŠ¶æ€" class="headerlink" title="AsyncTaskçŠ¶æ€"></a>AsyncTaskçŠ¶æ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Status &#123;</span><br><span class="line">    PENDING,<span class="comment">//å³å°†</span></span><br><span class="line">    RUNNING,<span class="comment">//æ­£åœ¨æ‰§è¡Œ</span></span><br><span class="line">    FINISHED,<span class="comment">//ç»“æŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SERIAL-EXECUTORçº¿ç¨‹æ± "><a href="#SERIAL-EXECUTORçº¿ç¨‹æ± " class="headerlink" title="SERIAL_EXECUTORçº¿ç¨‹æ± "></a>SERIAL_EXECUTORçº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ArrayDeque&lt;Runnable&gt; mTasks = <span class="keyword">new</span> ArrayDeque&lt;Runnable&gt;();</span><br><span class="line">        Runnable mActive;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">final</span> Runnable r)</span> </span>&#123;</span><br><span class="line">            mTasks.offer(<span class="keyword">new</span> Runnable() &#123;<span class="comment">//åŒ…è£…ä¸€å±‚å…¥é˜Ÿåˆ—</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        r.run();<span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        scheduleNext();<span class="comment">//æ‰§è¡Œä¸‹ä¸€ä¸ª</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span> (mActive == <span class="keyword">null</span>) &#123;</span><br><span class="line">                scheduleNext();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">scheduleNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ((mActive = mTasks.poll()) != <span class="keyword">null</span>) &#123;<span class="comment">//å‡ºé˜Ÿ</span></span><br><span class="line">                THREAD_POOL_EXECUTOR.execute(mActive);<span class="comment">//è°ƒç”¨å®é™…çš„çº¿ç¨‹æ± </span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="THREAD-POOL-EXECUTOR-çº¿ç¨‹æ± "><a href="#THREAD-POOL-EXECUTOR-çº¿ç¨‹æ± " class="headerlink" title="THREAD_POOL_EXECUTOR çº¿ç¨‹æ± "></a>THREAD_POOL_EXECUTOR çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor THREAD_POOL_EXECUTOR;</span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       ThreadPoolExecutor threadPoolExecutor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">               CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE_SECONDS, TimeUnit.SECONDS,</span><br><span class="line">               sPoolWorkQueue, sThreadFactory);</span><br><span class="line">       threadPoolExecutor.allowCoreThreadTimeOut(<span class="keyword">true</span>);</span><br><span class="line">       THREAD_POOL_EXECUTOR = threadPoolExecutor;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="InternalHandler"><a href="#InternalHandler" class="headerlink" title="InternalHandler"></a>InternalHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InternalHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InternalHandler</span><span class="params">(Looper looper)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(looper);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"unchecked"</span>, <span class="string">"RawUseOfParameterizedType"</span>&#125;)</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;</span><br><span class="line">            <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">                <span class="keyword">case</span> MESSAGE_POST_RESULT:</span><br><span class="line">                    <span class="comment">// There is only one result</span></span><br><span class="line">                    result.mTask.finish(result.mData[<span class="number">0</span>]);<span class="comment">//å‘é€ç»“æœ</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> MESSAGE_POST_PROGRESS:</span><br><span class="line">                    result.mTask.onProgressUpdate(result.mData);<span class="comment">//æ‰§è¡Œè¿›åº¦æ›´æ–°å›è°ƒ</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="é¦–å…ˆä»æ„é€ æ–¹æ³•çœ‹"><a href="#é¦–å…ˆä»æ„é€ æ–¹æ³•çœ‹" class="headerlink" title="é¦–å…ˆä»æ„é€ æ–¹æ³•çœ‹"></a>é¦–å…ˆä»æ„é€ æ–¹æ³•çœ‹</h3><p>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨å‚æ•°ä¸ºLooperçš„æ„é€ æ–¹æ³•ï¼Œåœ¨æ„é€ æ–¹æ³•é‡Œé¢è¿›è¡Œè·å¾—UI handlerï¼Œä»¥åŠåˆå§‹åŒ–CallAbleå’ŒFutureTask</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">AsyncTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>((Looper) <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AsyncTask</span><span class="params">(@Nullable Handler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(handler != <span class="keyword">null</span> ? handler.getLooper() : <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AsyncTask</span><span class="params">(@Nullable Looper callbackLooper)</span> </span>&#123;</span><br><span class="line">        mHandler = callbackLooper == <span class="keyword">null</span> || callbackLooper == Looper.getMainLooper()</span><br><span class="line">            ? getMainHandler()<span class="comment">//è‡ªå®šä¹‰çš„ä¸»çº¿ç¨‹handlerï¼Œè¿”å›çš„é™æ€çš„UI handler</span></span><br><span class="line">            : <span class="keyword">new</span> Handler(callbackLooper);<span class="comment">//handler</span></span><br><span class="line">        <span class="comment">//æ„å»ºcallable</span></span><br><span class="line">        mWorker = <span class="keyword">new</span> WorkerRunnable&lt;Params, Result&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Result <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                mTaskInvoked.set(<span class="keyword">true</span>);<span class="comment">//è¢«è°ƒç”¨æ ‡å¿—</span></span><br><span class="line">                Result result = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);<span class="comment">//è®¾ç½®è¿›ç¨‹ä¼˜å…ˆçº§</span></span><br><span class="line">                    <span class="comment">//noinspection unchecked</span></span><br><span class="line">                    result = doInBackground(mParams);<span class="comment">//æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                    Binder.flushPendingCommands();<span class="comment">//</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable tr) &#123;</span><br><span class="line">                    mCancelled.set(<span class="keyword">true</span>);<span class="comment">//è®¾ç½®å–æ¶ˆæ ‡å¿—</span></span><br><span class="line">                    <span class="keyword">throw</span> tr;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    postResult(result);<span class="comment">//å‘é€ç»“æœï¼Œä¹Ÿå°±æœ€ç»ˆä¼šè§¦å‘OnPostExecute</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="comment">//æ„å»ºFutureTaskä¿å­˜ç»“æœ</span></span><br><span class="line">        mFuture = <span class="keyword">new</span> FutureTask&lt;Result&gt;(mWorker) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    postResultIfNotInvoked(get());<span class="comment">//å‘é€ç»“æœ</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    android.util.Log.w(LOG_TAG, e);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"An error occurred while executing doInBackground()"</span>,</span><br><span class="line">                            e.getCause());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (CancellationException e) &#123;</span><br><span class="line">                    postResultIfNotInvoked(<span class="keyword">null</span>);<span class="comment">//å‘é€ç»“æœ</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="çœ‹executeæ‰§è¡Œ"><a href="#çœ‹executeæ‰§è¡Œ" class="headerlink" title="çœ‹executeæ‰§è¡Œ"></a>çœ‹executeæ‰§è¡Œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> AsyncTask&lt;Params, Progress, Result&gt; <span class="title">execute</span><span class="params">(Params... params)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> executeOnExecutor(sDefaultExecutor, params);<span class="comment">//å¯ç”¨é»˜è®¤ä¸²è¡Œçº¿ç¨‹æ± </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èµ°å‘executeOnExecutorï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒï¼Œè¿™ä¸ªå°±æ˜¯è¯´è®©ä»»åŠ¡åœ¨ä¼ å…¥çš„çº¿ç¨‹æ± ä¸­è¿è¡Œ</p><p>é¦–å…ˆåˆ¤æ–­æ ‡å¿—ä½æ˜¯å¦åˆæ ¼ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œè¿‡çš„æˆ–è€…æ‰§è¡Œå®Œçš„éƒ½ä¸èƒ½å†æ¬¡æ‰§è¡Œäº†ã€‚å›è°ƒonPreExecuteï¼Œç„¶åæ·»åŠ å‚æ•°è¿›å…¥çº¿ç¨‹æ± </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> AsyncTask&lt;Params, Progress, Result&gt; <span class="title">executeOnExecutor</span><span class="params">(Executor exec,</span></span></span><br><span class="line"><span class="function"><span class="params">        Params... params)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mStatus != Status.PENDING) &#123;<span class="comment">//Asyncä»»åŠ¡æ‰§è¡Œæ‰§è¡Œå‰çŠ¶æ€å¿…é¡»ä¸ºPENDING</span></span><br><span class="line">        <span class="keyword">switch</span> (mStatus) &#123;</span><br><span class="line">            <span class="keyword">case</span> RUNNING:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot execute task:"</span></span><br><span class="line">                        + <span class="string">" the task is already running."</span>);</span><br><span class="line">            <span class="keyword">case</span> FINISHED:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot execute task:"</span></span><br><span class="line">                        + <span class="string">" the task has already been executed "</span></span><br><span class="line">                        + <span class="string">"(a task can be executed only once)"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mStatus = Status.RUNNING;<span class="comment">//ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">    onPreExecute();<span class="comment">//å›è°ƒæ‰§è¡Œå‰</span></span><br><span class="line">    mWorker.mParams = params;<span class="comment">//æ·»åŠ å‚æ•°</span></span><br><span class="line">    exec.execute(mFuture);<span class="comment">//è¿›å…¥çº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¥åˆ°ä¸²è¡Œçº¿ç¨‹æ± "><a href="#æ¥åˆ°ä¸²è¡Œçº¿ç¨‹æ± " class="headerlink" title="æ¥åˆ°ä¸²è¡Œçº¿ç¨‹æ± "></a>æ¥åˆ°ä¸²è¡Œçº¿ç¨‹æ± </h3><p>å°†ä»»åŠ¡å…¥é˜Ÿåˆ—ï¼Œé¡ºåºæ‰§è¡Œï¼Œè°ƒç”¨å®é™…çš„çº¿ç¨‹æ± </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ArrayDeque&lt;Runnable&gt; mTasks = <span class="keyword">new</span> ArrayDeque&lt;Runnable&gt;();</span><br><span class="line">        Runnable mActive;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">final</span> Runnable r)</span> </span>&#123;</span><br><span class="line">            mTasks.offer(<span class="keyword">new</span> Runnable() &#123;<span class="comment">//åŒ…è£…ä¸€å±‚å…¥é˜Ÿåˆ—</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        r.run();<span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        scheduleNext();<span class="comment">//æ‰§è¡Œä¸‹ä¸€ä¸ª</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span> (mActive == <span class="keyword">null</span>) &#123;</span><br><span class="line">                scheduleNext();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">scheduleNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ((mActive = mTasks.poll()) != <span class="keyword">null</span>) &#123;<span class="comment">//å‡ºé˜Ÿ</span></span><br><span class="line">                THREAD_POOL_EXECUTOR.execute(mActive);<span class="comment">//è°ƒç”¨å®é™…çš„çº¿ç¨‹æ± </span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å‡ ä¸ªå›è°ƒ"><a href="#å‡ ä¸ªå›è°ƒ" class="headerlink" title="å‡ ä¸ªå›è°ƒ"></a>å‡ ä¸ªå›è°ƒ</h3><h4 id="doInBackground"><a href="#doInBackground" class="headerlink" title="doInBackground"></a>doInBackground</h4><p>åœ¨Callableä¸­æ‰§è¡Œçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mWorker = <span class="keyword">new</span> WorkerRunnable&lt;Params, Result&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Result <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                mTaskInvoked.set(<span class="keyword">true</span>);<span class="comment">//è¢«è°ƒç”¨æ ‡å¿—</span></span><br><span class="line">                Result result = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);<span class="comment">//è®¾ç½®è¿›ç¨‹ä¼˜å…ˆçº§</span></span><br><span class="line">                    <span class="comment">//noinspection unchecked</span></span><br><span class="line">                    result = doInBackground(mParams);<span class="comment">//æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                    Binder.flushPendingCommands();<span class="comment">//</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable tr) &#123;</span><br><span class="line">                    mCancelled.set(<span class="keyword">true</span>);<span class="comment">//è®¾ç½®å–æ¶ˆæ ‡å¿—</span></span><br><span class="line">                    <span class="keyword">throw</span> tr;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    postResult(result);<span class="comment">//å‘é€ç»“æœï¼Œä¹Ÿå°±æœ€ç»ˆä¼šè§¦å‘OnPostExecute</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><h4 id="onPreExecute"><a href="#onPreExecute" class="headerlink" title="onPreExecute"></a>onPreExecute</h4><p>åœ¨ä»»åŠ¡è¿›å…¥çº¿ç¨‹æ± ä¹‹å‰æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mStatus = Status.RUNNING;<span class="comment">//ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">onPreExecute();<span class="comment">//å›è°ƒæ‰§è¡Œå‰</span></span><br><span class="line">mWorker.mParams = params;<span class="comment">//æ·»åŠ å‚æ•°</span></span><br><span class="line">exec.execute(mFuture);<span class="comment">//è¿›å…¥çº¿ç¨‹æ± </span></span><br></pre></td></tr></table></figure><h4 id="onPostExecute"><a href="#onPostExecute" class="headerlink" title="onPostExecute"></a>onPostExecute</h4><p>handlerå‘é€ç»“æœåfinishä¸­æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">(Result result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isCancelled()) &#123;</span><br><span class="line">            onCancelled(result);<span class="comment">//è§¦å‘å–æ¶ˆ</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            onPostExecute(result);<span class="comment">//ç»“æŸ</span></span><br><span class="line">        &#125;</span><br><span class="line">        mStatus = Status.FINISHED;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="onProgressUpdate"><a href="#onProgressUpdate" class="headerlink" title="onProgressUpdate"></a>onProgressUpdate</h4><p>åœ¨æ‰‹åŠ¨è°ƒç”¨publishProgressï¼Œhandlerå‘é€æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">publishProgress</span><span class="params">(Progress... values)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (!isCancelled()) &#123;</span><br><span class="line">           getHandler().obtainMessage(MESSAGE_POST_PROGRESS,</span><br><span class="line">                   <span class="keyword">new</span> AsyncTaskResult&lt;Progress&gt;(<span class="keyword">this</span>, values)).sendToTarget();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">           AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;</span><br><span class="line">           <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">               <span class="keyword">case</span> MESSAGE_POST_RESULT:</span><br><span class="line">                   <span class="comment">// There is only one result</span></span><br><span class="line">                   result.mTask.finish(result.mData[<span class="number">0</span>]);</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">               <span class="keyword">case</span> MESSAGE_POST_PROGRESS:</span><br><span class="line">                   result.mTask.onProgressUpdate(result.mData);<span class="comment">//è§¦å‘</span></span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><h4 id="onCancelled"><a href="#onCancelled" class="headerlink" title="onCancelled"></a>onCancelled</h4><p>ä½¿ç”¨cancelï¼Œå–æ¶ˆä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</span><br><span class="line">        mCancelled.set(<span class="keyword">true</span>);<span class="comment">//è®¾ç½®åˆ¤æ–­ä½</span></span><br><span class="line">        <span class="keyword">return</span> mFuture.cancel(mayInterruptIfRunning);<span class="comment">//ä¸­æ–­ä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dagger2å­¦ä¹ </title>
      <link href="/2019/07/14/Android-Dagger%E5%AD%A6%E4%B9%A0/"/>
      <url>/2019/07/14/Android-Dagger%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>å…³äº<code>IOCï¼ˆæ§åˆ¶åè½¬ï¼‰</code>å’Œ<code>DIï¼ˆä¾èµ–æ³¨å…¥ï¼‰</code>ï¼Œ<code>DI</code>åªæ˜¯<code>IOC</code>çš„å®ç°çš„ä¸€ç§æ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯<code>ä¾èµ–æŸ¥æ‰¾</code>ï¼Œè¯¦ç»†è§ <a href="[https://zh.wikipedia.org/zh-cn/%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC](https://zh.wikipedia.org/zh-cn/æ§åˆ¶åè½¬)">æ§åˆ¶åè½¬ç»´åŸºç™¾ç§‘</a></p><p>å®Œå…¨é™æ€çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚ä¾èµ–æ³¨å…¥çš„æ¦‚å¿µçœŸçš„æ˜¯åˆ°å“ªéƒ½æœ‰ï¼Œä»¥å‰å­¦Springçš„å°±å¤©å¤©çœ‹å®ƒï¼Œåˆ°äº†androidè¿˜æ˜¯è·‘ä¸äº†ï¼Œç°åœ¨çš„daggeræ˜¯ä»¥åŠé™æ€æ³¨å…¥çš„å½¢å¼ï¼Œè¯´ç™½äº†ï¼Œé€šè¿‡æ³¨è§£å¤„ç†å™¨åˆ†ææ³¨è§£ï¼Œç”Ÿæˆjavaä»£ç ï¼Œå°†å¯¹è±¡æ± å’Œéœ€è¦å¯¹è±¡çš„åœ°æ–¹è¿æ¥èµ·æ¥ï¼Œå…¶å®å°±å’Œè‡ªå·±åˆ›é”®å·®ä¸å¤šï¼Œæˆ‘å°±ç®€å•æ€»ç»“ä¸‹æ€ä¹ˆç”¨å§(é‡Œé¢çš„æ¦‚å¿µæˆ‘ä¹ŸæŒºæ™•ä¹çš„ï¼Œæ³¨è§£å¤„ç†å™¨é‚£é‡Œæˆ‘ä¹Ÿæ˜¯æŒºå¤´ç–¼çš„ã€‚)</p><p>å®˜ç½‘ï¼š  <a href="https://dagger.dev/users-guide" target="_blank" rel="noopener">Dagger users-guide</a> ï¼ˆæœç„¶è¿˜æ˜¯è¿˜æ˜¯å®˜æ–¹æ–‡æ¡£è®²çš„å¥½å‘ƒå‘ƒï¼‰</p><h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><h3 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.google.dagger:dagger:2.20'</span></span><br><span class="line">annotationProcessor <span class="string">'com.google.dagger:dagger-compiler:2.20'</span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="æœ€ç®€å•çš„ä¾‹å­"><a href="#æœ€ç®€å•çš„ä¾‹å­" class="headerlink" title="æœ€ç®€å•çš„ä¾‹å­"></a>æœ€ç®€å•çš„ä¾‹å­</h3><p>é¦–å…ˆéœ€æ±‚æ˜¯æˆ‘éœ€è¦ä¸€ä¸ªå¯¹è±¡ã€‚ä½¿ç”¨<code>@Inject</code>æ³¨è§£æ„é€ æ–¹æ³•è¡¨ç¤ºæ„é€ å™¨æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™æ³¨å…¥å™¨ï¼Œç”¨<code>@Component</code>æ³¨è§£çš„ä¸€ä¸ªæ¥å£å³å¯ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª<code>inject</code>æ–¹æ³•ï¼Œå‚æ•°ç±»å‹æ˜¯ä½ è¦æ³¨å…¥çš„åœ°æ–¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppleComponet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(TestActivity activity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å…¥ï¼Œæ„å»ºé¡¹ç›®ï¼Œç„¶åç”Ÿæˆè®¸å¤šç±»ï¼Œæˆ‘ä»¬åªç”¨åœ¨æ„å½¢å¦‚DaggerAppleComponetè¿™æ ·ä»¥Daggerå¼€å¤´çš„ç”Ÿæˆå™¨å°±è¡Œäº†ã€‚</p><p>åŒæ ·ç”¨<code>@Inject</code>æ³¨è§£æˆ‘è¦æ³¨å…¥çš„å¯¹è±¡ï¼Œ<code>DaggerAppleComponet.builder().build().inject(this);</code>è¿™æ ·å°±å®Œæˆæ³¨å…¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span> Apple mApple;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        DaggerAppleComponet.builder().build().inject(<span class="keyword">this</span>);</span><br><span class="line">        Log.d(<span class="string">"TestActivity"</span>, <span class="string">"onCreate: "</span> + mApple);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¾èµ–æ³¨å…¥é‡Œé¢æ˜¯ä¼šè‡ªåŠ¨è§£å†³ä¾èµ–çš„ã€‚æ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span> A(B)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">   <span class="meta">@Inject</span> B()&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶Aä¾èµ–Bï¼Œåœ¨æ³¨å…¥Açš„æ—¶å€™ä¼šè‡ªåŠ¨å–æ³¨å…¥Bã€‚åªéœ€è¦äºŒè€…å­˜åœ¨æ³¨å…¥å½¢å¼å°±è¡Œã€‚</p><h3 id="ä½¿ç”¨moduleæ³¨å…¥"><a href="#ä½¿ç”¨moduleæ³¨å…¥" class="headerlink" title="ä½¿ç”¨moduleæ³¨å…¥"></a>ä½¿ç”¨moduleæ³¨å…¥</h3><p>æ„é€ å™¨æ³¨å…¥æŒºç®€å•æ–¹ä¾¿ï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½èƒ½å¤Ÿæ„é€ å™¨æ³¨å…¥ï¼Œæ¯”å¦‚ç¬¬ä¸‰æ–¹ç±»å®ä¾‹ï¼Œä½ å°±æ— æ³•æ·»åŠ æ³¨è§£ï¼Œè¿˜æœ‰æ¯”å¦‚Retrofitä¸­åŠ¨æ€ç”Ÿæˆçš„æ¥å£APIå¯¹è±¡ï¼Œä¹Ÿä¸èƒ½ã€‚æ‰€ä»¥<code>æ³¨å…¥module</code>ç™»åœºï¼Œåœ¨è¿™é‡Œé¢ç”¨äºäº§å‡ºå¯¹è±¡ã€‚</p><p>ä½¿ç”¨<code>@Module</code>æ³¨è§£ç±»åï¼Œå°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªmoduleï¼Œå¯ä»¥æœ‰æ„é€ å‡½æ•°ä¼ å…¥æˆ‘ä»¬éœ€è¦çš„ä¾èµ–ï¼Œæ¯”å¦‚<code>Context</code>ã€‚</p><p>ä½¿ç”¨<code>@Provides</code>ä¿®é¥°æ–¹æ³•ï¼Œå‘½åä¸ºï¼š<code>providesXX</code>ï¼Œå°±è¡¨ç¤ºäº§å‡ºå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonModule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonModule</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">TextView <span class="title">providesTextView</span><span class="params">(Context context, Cat cat)</span></span>&#123;</span><br><span class="line">        TextView textView = <span class="keyword">new</span> TextView(context);</span><br><span class="line">        textView.setText(cat.sayHello());</span><br><span class="line">        <span class="keyword">return</span> textView;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">Context <span class="title">providesContextContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mContext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">Cat <span class="title">providesCat</span><span class="params">(Hello hello)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat(hello);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">Hello <span class="title">providesHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·éœ€è¦å£°æ˜æ³¨å…¥å™¨</p><p>å’Œä¸Šé¢ä¸åŒçš„æ˜¯éœ€è¦ï¼Œå†™å…¥Moduleç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = &#123;CommonModule.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloCompont</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(TestDagger2Activity activity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDagger2Activity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = TestDagger2Activity.class.getSimpleName();</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    TextView mTextView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        DaggerHelloCompont.builder().commonModule(<span class="keyword">new</span> CommonModule(<span class="keyword">this</span>)).build().inject(<span class="keyword">this</span>);</span><br><span class="line">        setContentView(mTextView);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™åªæ˜¯å¦ä¸€ç§æ³¨å…¥æ–¹å¼è€Œå·²ã€‚</p><h3 id="æ³¨è§£è¯´æ˜"><a href="#æ³¨è§£è¯´æ˜" class="headerlink" title="æ³¨è§£è¯´æ˜"></a>æ³¨è§£è¯´æ˜</h3><h4 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h4><p>æ³¨è§£æ¥å£ï¼Œæ ‡æ³¨ä¸ºæ³¨å…¥å™¨ï¼Œæ„å»ºåä¼šç”Ÿæˆå‰ç¼€Daggerçš„ç±»ï¼Œç”¨äºæ³¨å…¥</p><h4 id="Module"><a href="#Module" class="headerlink" title="@Module"></a>@Module</h4><p>æ³¨è§£ç±»ï¼Œæ ‡æ³¨ä¸ºæ³¨å…¥æ¨¡å‹ï¼Œç”¨äºç”Ÿæˆæ¨¡å‹æ³¨å…¥å¯¹è±¡</p><h4 id="Inject"><a href="#Inject" class="headerlink" title="@Inject"></a>@Inject</h4><ul><li><p>æ³¨è§£æ„é€ æ–¹æ³•è¡¨ç¤ºï¼Œæ„é€ å™¨æ³¨å…¥</p></li><li><p>æ³¨è§£å˜é‡ï¼Œè¡¨ç¤ºè¢«æ³¨å…¥çš„å¼•ç”¨ï¼Œè®¿é—®é™å®šä¸èƒ½ä¸ºprivate</p></li><li><p><strong>ä¸å¯ä»¥ä¿®é¥°æ¥å£ï¼Œå³ä½¿æ˜¯é€šè¿‡Providesäº§å‡ºçš„æ¥å£ç±»å‹ï¼Œä¹Ÿåªæ˜¯èƒ½å¤Ÿé€šè¿‡æ–¹æ³•ä¾èµ–ä¼ é€’ï¼Œå¹¶ä¸èƒ½æ³¨å…¥åˆ°æ ‡æ³¨äº†@Injectçš„å¼•ç”¨ä¸Šå»</strong></p><p>å› ä¸ºæˆ‘é‡åˆ°äº†è¿‡è¿™ä¸ªé—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤§æ¦‚ä¸¾ä¾‹</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">//é€šè¿‡Retrofitç”ŸæˆA</span></span><br><span class="line"><span class="function">A <span class="title">providesA</span><span class="params">(Retrofit retrofit)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> retrofit.create(A.class);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ­¤æ—¶æˆ‘ä»¬æ˜¯æ— æ³•é€šè¿‡@Injectè·å¾—Açš„</span></span><br><span class="line"><span class="meta">@Inject</span> A;<span class="comment">//æ— æ•ˆ</span></span><br><span class="line"><span class="comment">//åŒ…è£…ä¸‹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataModel</span> </span>&#123;</span><br><span class="line">    A mA;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    DataModel(A a) &#123;</span><br><span class="line">        mA = a;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> A <span class="title">getA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ­¤æ—¶æˆ‘å°±å¯ä»¥è¿™æ ·</span></span><br><span class="line"><span class="meta">@Inject</span> DataModel mModel;</span><br><span class="line">A a = mModel.getA();</span><br></pre></td></tr></table></figure></li></ul><h4 id="Provides"><a href="#Provides" class="headerlink" title="@Provides"></a>@Provides</h4><p>åœ¨æ¨¡å‹ä¸­ï¼Œæ³¨è§£æ–¹æ³•ï¼Œä¸€èˆ¬è§„èŒƒä»¥provideså‰ç¼€å¼€å¤´æ–¹æ³•ï¼Œè¡¨ç¤ºäº§å‡ºæŸå¯¹è±¡</p><h4 id="Named"><a href="#Named" class="headerlink" title="@Named"></a>@Named</h4><p>å¯èƒ½å­˜åœ¨åŒç§ç±»å‹çš„å¯¹è±¡ï¼Œéœ€è¦é€šè¿‡å‘½ååŒºåˆ†ï¼Œå…¶å®@Namedä¹Ÿæ˜¯é€šè¿‡@Qualifierå®šä¹‰çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Named</span>(<span class="string">"one"</span>)</span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="function">Hello <span class="title">providesHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Hello();<span class="comment">//äº§å‡º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Named</span>(<span class="string">"tow"</span>)</span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="function">Hello <span class="title">providesHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Hello();<span class="comment">//äº§å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•å¯ä»¥æ˜¯é™æ€çš„ï¼Œè¿™å°±æ„å‘³ç€Moduleä¸éœ€è¦å®ä¾‹åŒ–ä¼ å…¥compoent</p><h4 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h4><p>ä¿®é¥°æ³¨è§£ï¼Œæ¥æ ‡æ³¨å…·ä½“é‚£ä¸ªå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@interface</span> A&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@interface</span> B&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@A</span></span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="function">Hello <span class="title">providesHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Hello();<span class="comment">//äº§å‡º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@B</span></span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="function">Hello <span class="title">providesHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Hello();<span class="comment">//äº§å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Scope"><a href="#Scope" class="headerlink" title="@Scope"></a>@Scope</h4><p>ä¿®é¥°æ³¨è§£ï¼Œç”¨äºç”Ÿæˆæ ‡æ³¨æ³¨å…¥å¯¹è±¡çš„ä½œç”¨åŸŸå•ä¾‹çš„æ³¨è§£</p><p>ä¾‹å¦‚ä»¥ä¸‹å°±ç”Ÿæˆäº†ä¸€ä¸ª@PerFragmentçš„ä½œç”¨åŸŸæ³¨è§£ï¼Œåœ¨è¿™ä¸ªä½œç”¨åŸŸå†…ï¼Œ@PerFragmentä¿®é¥°çš„å¯¹è±¡ä¸ºå•ä¾‹ï¼Œå³å±€éƒ¨å•ä¾‹ï¼Œäº¦æˆ–è€…æ­é…é™å®šç¬¦ä½¿ç”¨ï¼Œäº§å‡ºä¸åŒé™å®šçš„å•ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> PerFragment &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†è¯¥æ³¨è§£ç”¨äºä¿®é¥°æ³¨å…¥å™¨ï¼Œå’Œäº§å‡ºå¯¹è±¡çš„åœ°æ–¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PerFragment</span></span><br><span class="line"><span class="meta">@Subcomponent</span>(modules = HomeFragmentModule.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HomeFragmentComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(HomeFragment homeFragment)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeArticlesFragmentModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PerFragment</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">List&lt;Article&gt; <span class="title">providesArticles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Singleton"><a href="#Singleton" class="headerlink" title="@Singleton"></a>@Singleton</h4><p>è¿™ä¸ªæ³¨è§£ä¹Ÿæ˜¯å®˜æ–¹é€šè¿‡@Scopeå®ç°çš„ï¼Œç›´æ¥è¡¨æ˜å•ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Singleton &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‡’åŠ è½½"><a href="#æ‡’åŠ è½½" class="headerlink" title="æ‡’åŠ è½½"></a>æ‡’åŠ è½½</h3><p>é»˜è®¤ä¼šåœ¨è°ƒç”¨å‰å°±å°†å¯¹è±¡æ³¨å…¥åˆ°å¼•ç”¨ï¼Œä½¿ç”¨ä»¥ä¸‹å½¢å¼å¯ä»¥æ‡’åŠ è½½ï¼Œä¸ä¼šç«‹é©¬æ³¨å…¥å¯¹è±¡ï¼Œåªæœ‰åœ¨lazy.get()æ—¶æ‰ä¼šå»è·å¾—å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line">Lazy&lt;Object&gt; object;</span><br></pre></td></tr></table></figure><h3 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h3><p>æœ‰æ—¶å€™è®¸å¤šè¦ä¸æ–­æ³¨å…¥åŒä¸€ç±»å‹çš„å¯¹è±¡æ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span> A a1;</span><br><span class="line"><span class="meta">@Inject</span> A a2;</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">List&lt;A&gt; list;</span><br><span class="line"></span><br><span class="line">list.add(a1);</span><br><span class="line">list.add(a2);</span><br></pre></td></tr></table></figure><p>åƒè¿™æ ·éœ€è¦ä¸æ­¢ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨Provideräº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span> Provider&lt;Filter&gt; filterProvider;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">(<span class="keyword">int</span> numberOfPots)</span> </span>&#123;</span><br><span class="line"> ...</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>; p &lt; numberOfPots; p++) &#123;</span><br><span class="line">     maker.addFilter(filterProvider.get()); <span class="comment">//æ¯æ¬¡éƒ½ä¼šå»è·å¾—æ–°çš„å¯¹è±¡</span></span><br><span class="line">     maker.addCoffee(...);</span><br><span class="line">     maker.percolate();</span><br><span class="line">     ...</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="Componetæ³¨å…¥å™¨ä¹‹é—´å…³ç³»"><a href="#Componetæ³¨å…¥å™¨ä¹‹é—´å…³ç³»" class="headerlink" title="Componetæ³¨å…¥å™¨ä¹‹é—´å…³ç³»"></a>Componetæ³¨å…¥å™¨ä¹‹é—´å…³ç³»</h3><p>ä¹‹å‰çš„ç®€å•åœºæ™¯éƒ½æ˜¯ä»…é™äºå½“å‰æ³¨å…¥ç¯å¢ƒï¼Œå€˜è‹¥æˆ‘ä»¬åˆè¿™ä¸ªéœ€æ±‚ï¼Œæ¯”å¦‚Fragmentéœ€è¦ç”¨åˆ°Activityçš„å¯¹è±¡ï¼Œäº¦æˆ–è€…å…¨å±€ç¯å¢ƒéœ€è¦ç”¨åˆ°å…¨å±€æ³¨å…¥å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™å‰é¢çš„åŸºç¡€æ“ä½œå°±ä¸ç®¡ç”¨äº†ã€‚å› ä¸ºå®ƒåªå…³å¿ƒæ³¨å…¥çš„å½“å‰ç¯å¢ƒT<code>inject(T)</code>ï¼Œç¦»å¼€äº†è¿™ä¸ªç¯å¢ƒä½ ä¹Ÿå°±æ— æ³•è·å¾—æ³¨å…¥å¯¹è±¡äº†ã€‚</p><p>æ‰€æœ‰æˆ‘ä»¬å°±å¾—éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µ</p><h4 id="æ³¨å…¥å™¨ä¹‹é—´ç›¸äº’ä¾èµ–"><a href="#æ³¨å…¥å™¨ä¹‹é—´ç›¸äº’ä¾èµ–" class="headerlink" title="æ³¨å…¥å™¨ä¹‹é—´ç›¸äº’ä¾èµ–"></a>æ³¨å…¥å™¨ä¹‹é—´ç›¸äº’ä¾èµ–</h4><p>ä¾èµ–å°±æ˜¯ï¼ŒAçš„å·¥ä½œéœ€è¦Bçš„å¸®å¿™ï¼Œä¹Ÿå°±èƒ½åæ­£è¨€é¡ºçš„è·å¾—Bæ³¨å…¥å™¨çš„æ³¨å…¥å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A(B b);</span><br></pre></td></tr></table></figure><p>åœ¨æ³¨å…¥å™¨æˆ‘ä»¬å¯è¿™æ ·å£°æ˜ä¾èµ–çš„æ³¨å…¥å™¨ï¼Œé€šè¿‡åœ¨@Componetæ·»åŠ ä¾èµ–çš„æ³¨å…¥å™¨ï¼Œå¯ä»¥æ·»åŠ å¾ˆå¤šçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PerFragment</span></span><br><span class="line"><span class="meta">@Component</span>(modules = LoginFragmentModule.class, dependencies = AppComponent.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LoginFragmentComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(LoginFragment fragment)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å…¥è¿‡ç¨‹ï¼Œæ—¢ç„¶æ˜¯å·²ä¾èµ–çš„æ–¹å¼æ³¨å…¥ï¼Œå°±å¾—è¦æ‹¿åˆ°ä¾èµ–çš„æ³¨å…¥å™¨å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DaggerLoginFragmentComponent.builder()</span><br><span class="line">    .appComponent(App.getAppComponent())</span><br><span class="line">    .build()</span><br><span class="line">    .inject(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³è·å¾—ä¾èµ–çš„å¯¹è±¡ï¼Œå¿…é¡»è¦åœ¨æ³¨å…¥å™¨æš´éœ²æ¥å£ï¼Œæ‰èƒ½æ‰“å¼€ä¸€ä¸ªé€šå¾€æ³¨å…¥å™¨ä¾èµ–çš„å…¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component</span>(modules = AppModule.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(App app)</span></span>;</span><br><span class="line">    <span class="function">App <span class="title">getApp</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">DataModel <span class="title">getDataModel</span><span class="params">()</span></span>;<span class="comment">//æš´éœ²</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½åæ­£è¨€é¡ºçš„ä½¿ç”¨ä¾èµ–æ³¨å…¥å™¨çš„ä¾èµ–å¯¹è±¡äº†ã€‚</p><h4 id="æ³¨å…¥å™¨ç»§æ‰¿"><a href="#æ³¨å…¥å™¨ç»§æ‰¿" class="headerlink" title="æ³¨å…¥å™¨ç»§æ‰¿"></a>æ³¨å…¥å™¨ç»§æ‰¿</h4><p>ç¬¬äºŒç§æ–¹å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªActivityæœ‰å¾ˆå¤šçš„Fragmentï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥è·å–æ³¨å…¥å™¨å†…å®¹æ›´å¥½ï¼Œä¸éœ€è¦æš´éœ²ä¾èµ–å¯¹è±¡æ¥å£</p><p>çœ‹çˆ¶æ³¨å…¥å™¨å£°æ˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PerActivity</span></span><br><span class="line"><span class="meta">@Component</span>(dependencies = AppComponent.class, modules = MainActivityModule.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MainActivityComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</span><br><span class="line">    <span class="function">HomeFragmentComponent <span class="title">getHomeFragmentComponent</span><span class="params">(HomeFragmentModule homeFragmentModule)</span></span>;<span class="comment">//æä¾›å­æ³¨å…¥å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­æ³¨å…¥å™¨å£°æ˜ï¼Œä½¿ç”¨@SubComponetè¡¨æ˜è¿™ä¸ªå­æ³¨å…¥å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PerFragment</span></span><br><span class="line"><span class="meta">@Subcomponent</span>(modules = HomeFragmentModule.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HomeFragmentComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(HomeFragment homeFragment)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">((MainActivity) mActivity)</span><br><span class="line">.getComponent()<span class="comment">//é€šè¿‡Activityè·å¾—çˆ¶æ³¨å…¥å™¨</span></span><br><span class="line">    .getHomeFragmentComponent(<span class="keyword">new</span> HomeFragmentModule())<span class="comment">//é€šè¿‡çˆ¶æ³¨å…¥å™¨è·å¾—å­æ³¨å…¥å™¨å¹¶ä¸”ä¼ å…¥Modele</span></span><br><span class="line">    .inject(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç»§æ‰¿çš„æ–¹å¼å°†åº”ç”¨å¯¹è±¡å›¾è°±åˆ†å‰²æˆä¸åŒçš„éƒ¨åˆ†ï¼Œå­æ³¨å…¥å™¨å¯ä»¥ä¾èµ–ç¥–å…ˆæ³¨å…¥å™¨çš„ç»‘å®šå¯¹è±¡ï¼Œåä¹‹çˆ¶æ³¨å…¥å™¨ä¸èƒ½ä¾èµ–å­æ³¨å…¥å™¨ç»‘å®šå¯¹è±¡ï¼ŒåŒçº§æ³¨å…¥å™¨ä¹Ÿæ— æ³•ä¾èµ–ã€‚æ¢å¥è¯è¯´çˆ¶æ³¨å…¥å™¨çš„å¯¹è±¡å›¾æ˜¯å­æ³¨å…¥å™¨çš„å¯¹è±¡å›¾çš„å­å¯¹è±¡å›¾ã€‚</p><p>å‘ƒå‘ƒå¥½åƒå®˜æ–¹æ–‡æ¡£ä½¿ç”¨Builderå¦ä¸€ç§æ–¹å¼å†™çš„SubComponent</p><p>è¿™ç§åŸºäºBuilderå†™èµ·æ¥çœŸéº»çƒ¦å•Š</p><h4 id="åœ¨Componentæä¾›ä¾èµ–"><a href="#åœ¨Componentæä¾›ä¾èµ–" class="headerlink" title="åœ¨Componentæä¾›ä¾èµ–"></a>åœ¨Componentæä¾›ä¾èµ–</h4><p>è¿™æ ·ä¸»åŠ¨æš´éœ²ä¾èµ–ï¼Œå…¶å®å»å·¥å‚é‡Œæ‹¿</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Componet</span><br><span class="line">public interface AComponet&#123;</span><br><span class="line">Apple getApple();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Multibindings"><a href="#Multibindings" class="headerlink" title="Multibindings"></a>Multibindings</h3><p>å…è®¸å°†ç»‘å®šå¯¹è±¡è¿›é›†åˆ</p><h4 id="ç»‘å®šè¿›Set"><a href="#ç»‘å®šè¿›Set" class="headerlink" title="ç»‘å®šè¿›Set"></a>ç»‘å®šè¿›Set</h4><p>ä½¿ç”¨<code>@IntoSet</code>è¡¨ç¤ºå°†ç»‘å®šå¯¹è±¡è¾“å…¥set</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModuleA</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@IntoSet</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> String <span class="title">provideOneString</span><span class="params">(DepA depA, DepB depB)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"ABC"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>@ElementsIntoSet</code>è¡¨ç¤ºå°†ä¸€ä¸ªsetè¾“é€è¿›set</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModuleB</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@ElementsIntoSet</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> Set&lt;String&gt; <span class="title">provideSomeStrings</span><span class="params">(DepA depA, DepB depB)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;String&gt;(Arrays.asList(<span class="string">"DEF"</span>, <span class="string">"GHI"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»‘å®šå¥½çš„setå¯ä»¥è§£å†³setçš„ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> Bar(Set&lt;String&gt; strings) &#123;</span><br><span class="line">    <span class="keyword">assert</span> strings.contains(<span class="string">"ABC"</span>);</span><br><span class="line">    <span class="keyword">assert</span> strings.contains(<span class="string">"DEF"</span>);</span><br><span class="line">    <span class="keyword">assert</span> strings.contains(<span class="string">"GHI"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…è¿™æ ·ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = &#123;MyModuleA.class, MyModuleB.class&#125;)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyComponent</span> </span>&#123;</span><br><span class="line">  <span class="function">Set&lt;String&gt; <span class="title">strings</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">void</span> <span class="title">testMyComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  MyComponent myComponent = DaggerMyComponent.create();</span><br><span class="line">  assertThat(myComponent.strings()).containsExactly(<span class="string">"ABC"</span>, <span class="string">"DEF"</span>, <span class="string">"GHI"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç»“åˆ <code>Set&lt;Foo&gt;</code>ä»¥åŠ <code>Provider&lt;Set&lt;Foo&gt;&gt;</code> or <code>Lazy&lt;Set&lt;Foo&gt;&gt;</code>è¿™æ ·çš„å½¢å¼ï¼Œä½†æ˜¯ä¸èƒ½<code>Set&lt;Provider&lt;Foo&gt;&gt;</code></p><p>åŒæ ·å¯ä»¥ç»“åˆ<code>@Qualifier</code>æ¥é™å®š</p><h4 id="ç»‘å®šè¿›Map"><a href="#ç»‘å®šè¿›Map" class="headerlink" title="ç»‘å®šè¿›Map"></a>ç»‘å®šè¿›Map</h4><p>è¿˜å¯ä»¥ç»‘å®šè¿›mapï¼Œå¥½å§æœ¬æ¥æˆ‘æƒ³çœ‹åˆ°ä¸Šé¢å°±å†™çš„ã€‚ä¸‹é¢å…¶å®å°±æ˜¯çœ‹åˆ°å®˜æ–¹æ–‡æ¡£ä¸Šçš„23333</p><h5 id="æ™®é€šä½¿ç”¨"><a href="#æ™®é€šä½¿ç”¨" class="headerlink" title="æ™®é€šä½¿ç”¨"></a>æ™®é€šä½¿ç”¨</h5><p>ä½¿ç”¨<code>@IntoMap</code>æ³¨è§£è¿›å…¥mapçš„å¯¹è±¡ï¼Œä½¿ç”¨<code>@StringKey</code>è¡¨ç¤ºStringç±»å‹çš„keyï¼Œä½¿ç”¨<code>@ClassKey</code>è¡¨ç¤ºClassç±»å‹çš„key</p><p>ä¹‹åæˆ‘ä»¬å°±å¯è·å¾—<code>Map&lt;String, Long&gt;</code>çš„Map</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModule</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@IntoMap</span></span><br><span class="line">  <span class="meta">@StringKey</span>(<span class="string">"foo"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">static</span> Long <span class="title">provideFooValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100L</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@IntoMap</span></span><br><span class="line">  <span class="meta">@ClassKey</span>(Thing.class)</span><br><span class="line">  <span class="function"><span class="keyword">static</span> String <span class="title">provideThingValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"value for Thing"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(modules = MyModule.class)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyComponent</span> </span>&#123;</span><br><span class="line">  <span class="function">Map&lt;String, Long&gt; <span class="title">longsByString</span><span class="params">()</span></span>;</span><br><span class="line">  Map&lt;Class&lt;?&gt;, String&gt; stringsByClass();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">void</span> <span class="title">testMyComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  MyComponent myComponent = DaggerMyComponent.create();</span><br><span class="line">  assertThat(myComponent.longsByString().get(<span class="string">"foo"</span>)).isEqualTo(<span class="number">100L</span>);</span><br><span class="line">  assertThat(myComponent.stringsByClass().get(Thing.class))</span><br><span class="line">      .isEqualTo(<span class="string">"value for Thing"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æšä¸¾å’Œå¸¦æ³›å‹çš„KEY"><a href="#æšä¸¾å’Œå¸¦æ³›å‹çš„KEY" class="headerlink" title="æšä¸¾å’Œå¸¦æ³›å‹çš„KEY"></a>æšä¸¾å’Œå¸¦æ³›å‹çš„KEY</h5><p>é€šè¿‡<code>@MapKey</code>æ¥è‡ªå®šä»¥æšä¸¾keyï¼Œä»¥åŠç¬¦åˆæ³›å‹é€šé…çš„key</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> MyEnum &#123;</span><br><span class="line">  ABC, DEF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MapKey</span></span><br><span class="line"><span class="meta">@interface</span> MyEnumKey &#123;</span><br><span class="line">  <span class="function">MyEnum <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MapKey</span></span><br><span class="line"><span class="meta">@interface</span> MyNumberClassKey &#123;</span><br><span class="line">  Class&lt;? extends Number&gt; value();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModule</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@IntoMap</span></span><br><span class="line">  <span class="meta">@MyEnumKey</span>(MyEnum.ABC)</span><br><span class="line">  <span class="function"><span class="keyword">static</span> String <span class="title">provideABCValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"value for ABC"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@IntoMap</span></span><br><span class="line">  <span class="meta">@MyNumberClassKey</span>(BigDecimal.class)</span><br><span class="line">  <span class="function"><span class="keyword">static</span> String <span class="title">provideBigDecimalValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"value for BigDecimal"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(modules = MyModule.class)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyComponent</span> </span>&#123;</span><br><span class="line">  <span class="function">Map&lt;MyEnum, String&gt; <span class="title">myEnumStringMap</span><span class="params">()</span></span>;</span><br><span class="line">  Map&lt;Class&lt;? extends Number&gt;, String&gt; stringsByNumberClass();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">void</span> <span class="title">testMyComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  MyComponent myComponent = DaggerMyComponent.create();</span><br><span class="line">  assertThat(myComponent.myEnumStringMap().get(MyEnum.ABC)).isEqualTo(<span class="string">"value for ABC"</span>);</span><br><span class="line">  assertThat(myComponent.stringsByNumberClass.get(BigDecimal.class))</span><br><span class="line">      .isEqualTo(<span class="string">"value for BigDecimal"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ›´åŠ å¤æ‚çš„KEY"><a href="#æ›´åŠ å¤æ‚çš„KEY" class="headerlink" title="æ›´åŠ å¤æ‚çš„KEY"></a>æ›´åŠ å¤æ‚çš„KEY</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapKey</span>(unwrapValue = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@interface</span> MyKey &#123;</span><br><span class="line">  <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">  Class&lt;?&gt; implementingClass();</span><br><span class="line">  <span class="keyword">int</span>[] thresholds();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModule</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@IntoMap</span></span><br><span class="line">  <span class="meta">@MyKey</span>(name = <span class="string">"abc"</span>, implementingClass = Abc.class, thresholds = &#123;<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>&#125;)</span><br><span class="line">  <span class="function"><span class="keyword">static</span> String <span class="title">provideAbc1510Value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"foo"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(modules = MyModule.class)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyComponent</span> </span>&#123;</span><br><span class="line">  <span class="function">Map&lt;MyKey, String&gt; <span class="title">myKeyStringMap</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå¤æ‚çš„Keyæ¥è¯´ï¼Œç¼–è¯‘æ—¶æ˜¯æ— æ³•å…·ä½“ç¡®è®¤çš„ï¼Œè€ƒè™‘ä½¿ç”¨<code>Set&lt;Map.KeyEntry&gt;</code>æ¥å®ŒæˆåŒæ ·å¯ä»¥è¾¾åˆ°mapæ•ˆæœ</p><p>ä¸Šé¢çš„åªæ˜¯è®²äº†ä¸ªå¤§æ¦‚ç›®å‰ç”¨åˆ°ï¼Œå…¶å®è¿˜æœ‰å…³äºå­æ³¨å…¥å™¨æ›´å¤šçš„çŸ¥è¯†å’ŒProducersçš„å†…å®¹ï¼Œä»¥åå†è¡¥å……å§ã€‚</p><h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><p>å‚è€ƒ</p><ul><li><a href="https://www.jianshu.com/p/26d9f99ea3bb" target="_blank" rel="noopener">https://www.jianshu.com/p/26d9f99ea3bb</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Retrofitå­¦ä¹ </title>
      <link href="/2019/07/14/Android-Retrofit%E5%AD%A6%E4%B9%A0/"/>
      <url>/2019/07/14/Android-Retrofit%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="what"><a href="#what" class="headerlink" title="what"></a>what</h2><p>ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œåº•å±‚æ˜¯ä½¿ç”¨OkHttpè¯·æ±‚å®ç°çš„ã€‚é€šè¿‡åŠ¨æ€ä»£ç†æ¥åˆ›é”®åˆ›é”®è§£è€¦çš„è¯·æ±‚ï¼Œå…·ä½“çš„è¯·æ±‚äº¤ç»™OkHttpã€‚åŒæ—¶æ”¯æŒRxjavaï¼Œä»¥åŠå„ç§æ ¼å¼çš„è½¬æ¢ã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://square.github.io/retrofit/" target="_blank" rel="noopener">Retrofit</a></p><h2 id="how"><a href="#how" class="headerlink" title="how"></a>how</h2><h3 id="å®šä¹‰è¯·æ±‚API"><a href="#å®šä¹‰è¯·æ±‚API" class="headerlink" title="å®šä¹‰è¯·æ±‚API"></a>å®šä¹‰è¯·æ±‚API</h3><p>åˆ›é”®æ¥å£ï¼Œä»¥åŠè¯·æ±‚å®šä¹‰æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> okhttp3.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> retrofit2.Call;</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.GET;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TestApi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"article/list/0/json"</span>)</span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">getArticle</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(url).build();</span><br><span class="line">TestApi testApi = retrofit.create(TestApi.class);</span><br><span class="line">Response&lt;ResponseBody&gt; response = testApi.getArticle().execute();</span><br><span class="line">System.out.println(response.code());</span><br><span class="line">System.out.println(response.isSuccessful());</span><br><span class="line">System.out.println(response.body().string());</span><br><span class="line"></span><br><span class="line"><span class="comment">//ouput</span></span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="keyword">true</span></span><br><span class="line">æ•°æ®</span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚æ–¹æ³•å£°æ˜"><a href="#è¯·æ±‚æ–¹æ³•å£°æ˜" class="headerlink" title="è¯·æ±‚æ–¹æ³•å£°æ˜"></a>è¯·æ±‚æ–¹æ³•å£°æ˜</h3><h4 id="GET"><a href="#GET" class="headerlink" title="@GET"></a>@GET</h4><p>getè¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET</span>(<span class="string">"article/list/0/json"</span>)</span><br><span class="line"><span class="function">Call&lt;ResponseBody&gt; <span class="title">getArticle</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h4 id="POST"><a href="#POST" class="headerlink" title="@POST"></a>@POST</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@POST</span>(<span class="string">"login"</span>)</span><br><span class="line"><span class="function">Call&lt;ResponseBody&gt; <span class="title">login</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h4 id="å…¶å®ƒçš„è¯·æ±‚æ–¹å¼"><a href="#å…¶å®ƒçš„è¯·æ±‚æ–¹å¼" class="headerlink" title="å…¶å®ƒçš„è¯·æ±‚æ–¹å¼"></a>å…¶å®ƒçš„è¯·æ±‚æ–¹å¼</h4><p> <code>PUT</code>, <code>DELETE</code>, and <code>HEAD</code></p><h3 id="Urlæ„å»º"><a href="#Urlæ„å»º" class="headerlink" title="Urlæ„å»º"></a>Urlæ„å»º</h3><h4 id="Path"><a href="#Path" class="headerlink" title="@Path"></a>@Path</h4><p>å½“æˆ‘ä»¬éœ€è¦å¯¹è·¯å¾„è¿›è¡ŒåŠ¨æ€å‚æ•°ï¼Œæ¯”å¦‚`/page/1/jsonï¼Œè¿™ç§å¸¦å‚è·¯å¾„ï¼Œå¥½åƒå’ŒspringMVCçš„æŒºåƒï¼Œè¿™æ ·å°±ä¼šæ›¿æ¢äº†</p><p><strong>å¦‚æœè·¯å¾„ç§å‡ºç°äº†å¤šä¸ªå‚æ•°ï¼Œæ˜ å°„å½¢å‚ä¸€å®šè¦æŒ‰ç…§é¡ºåºå†™ï¼Œä¸ç„¶ä¼šå‡ºé—®é¢˜</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET</span>(<span class="string">"article/list/&#123;pageNum&#125;/json"</span>)</span><br><span class="line"><span class="function">Call&lt;ResponseBody&gt; <span class="title">getArticle</span><span class="params">(@Path(<span class="string">"pageNum"</span>)</span> <span class="keyword">int</span> pageNum)</span>;</span><br><span class="line"><span class="comment">//article/list/0/json</span></span><br></pre></td></tr></table></figure><h4 id="Query"><a href="#Query" class="headerlink" title="@Query"></a>@Query</h4><p>urlæŸ¥è¯¢å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET</span>(<span class="string">"article/list/0/json"</span>)</span><br><span class="line">Observable&lt;BaseResponse&lt;Articles&gt;&gt; getArticlesByCid(<span class="meta">@Query</span>(<span class="string">"cid"</span>) <span class="keyword">int</span> cid);</span><br><span class="line"></span><br><span class="line"><span class="comment">//article/list/0/json?cid=1</span></span><br></pre></td></tr></table></figure><p><strong>@Pathå’Œ@Queryå…±åŒå‡ºç°æ—¶ï¼Œæ˜ å°„å½¢å‚ä¸€å®šè¦å…ˆpathå†queryçš„å†™ï¼Œä¸ç„¶çœŸçš„ä¼šå‡ºé—®é¢˜å‘ƒå‘ƒ</strong></p><h4 id="QueryMap"><a href="#QueryMap" class="headerlink" title="@QueryMap"></a>@QueryMap</h4><p>è¿™ä¸ªå’Œ@Queryç±»ä¼¼ï¼Œä¼ å…¥mapè¡¨ç¤ºæŸ¥è¯¢å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET</span>(<span class="string">"group/&#123;id&#125;/users"</span>)</span><br><span class="line">Call&lt;List&lt;User&gt;&gt; groupList(<span class="meta">@Path</span>(<span class="string">"id"</span>) <span class="keyword">int</span> groupId, <span class="meta">@QueryMap</span> Map&lt;String, String&gt; options);</span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚ä½“æ„å»º"><a href="#è¯·æ±‚ä½“æ„å»º" class="headerlink" title="è¯·æ±‚ä½“æ„å»º"></a>è¯·æ±‚ä½“æ„å»º</h3><h4 id="Fieldå’Œ-FormUrlEncoded"><a href="#Fieldå’Œ-FormUrlEncoded" class="headerlink" title="@Fieldå’Œ@FormUrlEncoded"></a>@Fieldå’Œ@FormUrlEncoded</h4><p>postæäº¤è¡¨å•å¾—è¿™æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@POST</span>(<span class="string">"user/login"</span>)</span><br><span class="line"><span class="meta">@FormUrlEncoded</span></span><br><span class="line">Observable&lt;BaseResponse&lt;Login&gt;&gt; login(</span><br><span class="line">    <span class="meta">@Field</span>(<span class="string">"username"</span>) String userName,</span><br><span class="line">    <span class="meta">@Field</span>(<span class="string">"password"</span>) String password</span><br><span class="line">    );</span><br></pre></td></tr></table></figure><h4 id="Body"><a href="#Body" class="headerlink" title="@Body"></a>@Body</h4><p>æ ‡æ³¨è¯·æ±‚ä½“</p><p>è‡ªå®šä¹‰RequestBodyï¼Œå‚çœ‹OkHttpï¼Œè¿™é‡Œä¸éœ€è¦FormUrlEncoded</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@POST</span>(<span class="string">"xxxxxxx"</span>)   </span><br><span class="line"><span class="function">Call&lt;Object&gt; <span class="title">login</span><span class="params">( @Body RequestBody body)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰åŠ å…¥è½¬åŒ–å™¨çš„è¯å°±åªèƒ½ä¿®é¥°RequestBody</p><p>è¯·æ±‚ä½“ä¸ºjsonå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@POST</span>(<span class="string">"xxxxxxx"</span>)   </span><br><span class="line"><span class="function">Call&lt;Object&gt; <span class="title">login</span><span class="params">( @Body JSONObject parmas )</span></span>;</span><br></pre></td></tr></table></figure><h4 id="Multipart-å’Œ-Part"><a href="#Multipart-å’Œ-Part" class="headerlink" title="@Multipart å’Œ @Part"></a>@Multipart å’Œ @Part</h4><p>å…¶å®ä¹Ÿæ˜¯å®Œå…¨å¯¹åº”OkHttpçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Multipart</span></span><br><span class="line"><span class="meta">@PUT</span>(<span class="string">"user/photo"</span>)</span><br><span class="line"><span class="function">Call&lt;User&gt; <span class="title">updateUser</span><span class="params">(@Part(<span class="string">"photo"</span>)</span> RequestBody photo, @<span class="title">Part</span><span class="params">(<span class="string">"description"</span>)</span> RequestBody description)</span>;</span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å¤´æ„å»º"><a href="#è¯·æ±‚å¤´æ„å»º" class="headerlink" title="è¯·æ±‚å¤´æ„å»º"></a>è¯·æ±‚å¤´æ„å»º</h3><h4 id="Headers-å’Œ-Headers-HeaderMap"><a href="#Headers-å’Œ-Headers-HeaderMap" class="headerlink" title="@Headers å’Œ @Headers @HeaderMap"></a>@Headers å’Œ @Headers @HeaderMap</h4><p>æ·»åŠ å•ä¸ªHeaderå¤´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Headers</span>(<span class="string">"Cache-Control: max-age=640000"</span>)</span><br><span class="line"><span class="meta">@GET</span>(<span class="string">"widget/list"</span>)</span><br><span class="line">Call&lt;List&lt;Widget&gt;&gt; widgetList();</span><br></pre></td></tr></table></figure><p>æ·»åŠ å¤šä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Headers</span>(&#123;</span><br><span class="line">    <span class="string">"Accept: application/vnd.github.v3.full+json"</span>,</span><br><span class="line">    <span class="string">"User-Agent: Retrofit-Sample-App"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="meta">@GET</span>(<span class="string">"users/&#123;username&#125;"</span>)</span><br><span class="line"><span class="function">Call&lt;User&gt; <span class="title">getUser</span><span class="params">(@Path(<span class="string">"username"</span>)</span> String username)</span>;</span><br></pre></td></tr></table></figure><p>åŠ¨æ€èµ‹å€¼Header</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET</span>(<span class="string">"user"</span>)</span><br><span class="line"><span class="function">Call&lt;User&gt; <span class="title">getUser</span><span class="params">(@Header(<span class="string">"Authorization"</span>)</span> String authorization)</span></span><br></pre></td></tr></table></figure><p>åŠ¨æ€æ·»åŠ å¤šä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET</span>(<span class="string">"user"</span>)</span><br><span class="line"><span class="function">Call&lt;User&gt; <span class="title">getUser</span><span class="params">(@HeaderMap Map&lt;String, String&gt; headers)</span></span></span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šä¸€ä¸€å¯¹åº”ç€OkHttpï¼ŒçœŸå¥½ç”¨å•Š</p><h3 id="è½¬æ¢å™¨"><a href="#è½¬æ¢å™¨" class="headerlink" title="è½¬æ¢å™¨"></a>è½¬æ¢å™¨</h3><p>é»˜è®¤Retrofitæ˜¯å“åº”æ„å»ºæ˜¯å‘å‡º<code>RequestBody</code>å’Œå“åº”<code>ResponseBody</code>ï¼Œå¦‚æœéœ€è¦è¿›ä¸€æ­¥å¯¹å“åº”è¿›è¡Œè½¬æ¢å¤„ç†å°±éœ€è¦ç”¨åˆ°è½¬æ¢å™¨äº†ã€‚</p><p>å¤§æ¦‚æœ‰è¿™ä¹ˆå‡ ç§æŠŠï¼šï¼ˆå®˜ç½‘æ‹·çš„ï¼‰</p><ul><li><a href="https://github.com/google/gson" target="_blank" rel="noopener">Gson</a>: <code>com.squareup.retrofit2:converter-gson</code></li><li><a href="http://wiki.fasterxml.com/JacksonHome" target="_blank" rel="noopener">Jackson</a>: <code>com.squareup.retrofit2:converter-jackson</code></li><li><a href="https://github.com/square/moshi/" target="_blank" rel="noopener">Moshi</a>: <code>com.squareup.retrofit2:converter-moshi</code></li><li><a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener">Protobuf</a>: <code>com.squareup.retrofit2:converter-protobuf</code></li><li><a href="https://github.com/square/wire" target="_blank" rel="noopener">Wire</a>: <code>com.squareup.retrofit2:converter-wire</code></li><li><a href="http://simple.sourceforge.net/" target="_blank" rel="noopener">Simple XML</a>: <code>com.squareup.retrofit2:converter-simplexml</code></li><li>Scalars (primitives, boxed, and String): <code>com.squareup.retrofit2:converter-scalars</code></li></ul><h4 id="Gson"><a href="#Gson" class="headerlink" title="Gson"></a>Gson</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">    .baseUrl(<span class="string">"https://api.github.com"</span>)</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">GitHubService service = retrofit.create(GitHubService.class);</span><br></pre></td></tr></table></figure><h3 id="callé€‚é…å™¨"><a href="#callé€‚é…å™¨" class="headerlink" title="callé€‚é…å™¨"></a>callé€‚é…å™¨</h3><h4 id="è”åŠ¨Rxjava"><a href="#è”åŠ¨Rxjava" class="headerlink" title="è”åŠ¨Rxjava"></a>è”åŠ¨Rxjava</h4><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:converter-gson:2.5.0'</span></span><br><span class="line">implementation <span class="string">'com.squareup.retrofit2:adapter-rxjava2:2.5.0'</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="function">Retrofit <span class="title">provideRetrofit</span><span class="params">(OkHttpClient client)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">        .baseUrl(Constant.BASE_URL)</span><br><span class="line">        .client(client)</span><br><span class="line">        .addConverterFactory(GsonConverterFactory.create())<span class="comment">//Gson</span></span><br><span class="line">        .addCallAdapterFactory(RxJava2CallAdapterFactory.create())<span class="comment">//Rxjava</span></span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Gsonå’ŒRxajvaç»“åˆåï¼Œæ¥ç€æˆ‘ä»¬è¯·æ±‚APIå°±å¯ä»¥è¿™æ ·å†™äº†</p><p>å®šä¹‰å’Œå“åº”å¯¹åº”çš„å®ä½“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseResponse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> errorCode;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> String errorMsg;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getErrorCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> errorCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setErrorCode</span><span class="params">(<span class="keyword">int</span> errorCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.errorCode = errorCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getErrorMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> errorMsg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setErrorMsg</span><span class="params">(String errorMsg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.errorMsg = errorMsg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"BaseResponse&#123;"</span> + <span class="string">"errorCode="</span> + errorCode + <span class="string">", data="</span> + data + <span class="string">", errorMsg='"</span> + errorMsg + <span class="string">'\''</span> + <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HomeApis</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"article/list/&#123;pageNum&#125;/json"</span>)</span><br><span class="line">    Observable&lt;BaseResponse&lt;Articles&gt;&gt; getArticles(<span class="meta">@Path</span>(<span class="string">"pageNum"</span>) <span class="keyword">int</span> pageNum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€è¯·æ±‚å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">addRxSubscribe( mModel.getArticles(pageNum)</span><br><span class="line">               .compose(RxUtil.rxSchedulerhelper())</span><br><span class="line">               .compose(RxUtil.handleResult())</span><br><span class="line">               .subscribeWith(<span class="keyword">new</span> BaseObserver&lt;Articles&gt;(getView()) &#123;</span><br><span class="line">                   <span class="meta">@Override</span></span><br><span class="line">                   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Articles articles)</span> </span>&#123;</span><br><span class="line">                       <span class="keyword">super</span>.onNext(articles);</span><br><span class="line">                       getView().showArticles(articles.getDatas());</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;));</span><br></pre></td></tr></table></figure><p>é¡ºå¸¦ç€æˆ‘ä»¬å¯ä»¥å°†çº¿ç¨‹å˜æ¢ï¼Œä»¥åŠåˆæ­¥çš„å“åº”å¤„ç†è¿›è¡Œå¤ç”¨ï¼Œä½¿ç”¨Rxjavaè¿›è¡Œæµå¤„ç†å°±è¡Œï¼Œç”šè‡³æˆ‘ä»¬å¯ä»¥å†é‡å†™ä¸€ä¸ªObserverç­‰ç­‰(æˆ‘ä¹Ÿæ˜¯çœ‹åˆ«äººä»£ç è¿™æ ·å­¦çš„å†™çš„å“ˆå“ˆ)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ObservableTransformer&lt;T, T&gt; <span class="title">rxSchedulerhelper</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> observable -&gt; observable.subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ObservableTransformer&lt;BaseResponse&lt;T&gt;,T&gt; handleResult() &#123;</span><br><span class="line">        <span class="keyword">return</span> upstream -&gt;</span><br><span class="line">            upstream.flatMap(baseResponse -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (baseResponse.getErrorCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> createObservable(baseResponse.getData());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> Observable.error(<span class="keyword">new</span> ApiException(baseResponse.getErrorCode(), baseResponse.getErrorMsg()));</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">createObservable</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Observable.create(emitter -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                emitter.onNext(data);</span><br><span class="line">                emitter.onComplete();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                emitter.onError(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="why"><a href="#why" class="headerlink" title="why"></a>why</h2><p>è¿™ä¸ªå¤§æ¦‚çš„åŸç†å°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å–ç”Ÿæˆapiï¼Œè¯»å–æ³¨è§£ï¼Œç»„è£…requestï¼Œæ„å»ºæˆçœŸæ­£çš„OkHttpçš„Callï¼Œç»§è€Œè°ƒç”¨ã€‚</p><p>åˆ›é”®API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">    .baseUrl(<span class="string">"https://api.github.com"</span>)</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .build();</span><br><span class="line">GitHubService service = retrofit.create(GitHubService.class);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„Builderæ¨¡å¼å°±å…ˆä¸çœ‹äº†ï¼Œç›´æ¥ä»createå¼€å§‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">create</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; service)</span> </span>&#123;</span><br><span class="line">  Utils.validateServiceInterface(service);<span class="comment">//æ ¡éªŒæ˜¯å¦æ˜¯æ¥å£</span></span><br><span class="line">  <span class="keyword">if</span> (validateEagerly) &#123;</span><br><span class="line">    eagerlyValidateMethods(service);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//åŠ¨æ€ä»£ç†</span></span><br><span class="line">  <span class="keyword">return</span> (T) Proxy.newProxyInstance(service.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[] &#123; service &#125;,</span><br><span class="line">      <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Platform platform = Platform.get();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Object[] emptyArgs = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line">        <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, @Nullable Object[] args)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">          <span class="comment">// If the method is a method from Object then defer to normal invocation.</span></span><br><span class="line">          <span class="keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;<span class="comment">//è‚¯å®šä¸ç­‰</span></span><br><span class="line">            <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>, args);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (platform.isDefaultMethod(method)) &#123;<span class="comment">//é»˜è®¤å°±è¿”å›fasle</span></span><br><span class="line">            <span class="keyword">return</span> platform.invokeDefaultMethod(method, service, proxy, args);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> loadServiceMethod(method).invoke(args != <span class="keyword">null</span> ? args : emptyArgs);<span class="comment">//çœŸæ­£è°ƒç”¨è¿™é‡Œ</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ¨æ€ä»£ç†è¿”å›çš„å¯¹è±¡ï¼Œå®é™…è°ƒç”¨çš„è°ƒç”¨æ˜¯æ ¹æ®å…·ä½“çš„methdoå»æ„å»ºçš„ServiceMethod.invokeæ–¹æ³•ã€‚</p><p>å…ˆçœ‹ä¸‹<code>loadServiceMethod(method)</code>å§ï¼Œé¦–å…ˆå»mapæŸ¥è¯¢ï¼Œæ²¡æŸ¥è¯¢åˆ°å°±è§£ææ„å»º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ServiceMethod&lt;?&gt; loadServiceMethod(Method method) &#123;</span><br><span class="line">  ServiceMethod&lt;?&gt; result = serviceMethodCache.get(method);<span class="comment">//ä»ç¼“å­˜mapæ‹¿å»</span></span><br><span class="line">  <span class="keyword">if</span> (result != <span class="keyword">null</span>) <span class="keyword">return</span> result;<span class="comment">//æ‹¿åˆ°è¿”å›</span></span><br><span class="line">  <span class="keyword">synchronized</span> (serviceMethodCache) &#123;</span><br><span class="line">    result = serviceMethodCache.get(method);<span class="comment">//ç»§ç»­æ‹¿</span></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">      result = ServiceMethod.parseAnnotations(<span class="keyword">this</span>, method);<span class="comment">//è§£ææ³¨è§£æ„å»º</span></span><br><span class="line">      serviceMethodCache.put(method, result);<span class="comment">//å…¥ç¼“å­˜map</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;<span class="comment">//è¿”å›</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€åˆ°<code>ServiceMethod#parseAnnotations</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;T&gt; <span class="function">ServiceMethod&lt;T&gt; <span class="title">parseAnnotations</span><span class="params">(Retrofit retrofit, Method method)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è§£ææ³¨è§£å¹¶è·å¾—Requestå·¥å‚</span></span><br><span class="line">    RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, method);</span><br><span class="line">    Type returnType = method.getGenericReturnType();</span><br><span class="line">    <span class="keyword">if</span> (Utils.hasUnresolvableType(returnType)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> methodError(method,</span><br><span class="line">          <span class="string">"Method return type must not include a type variable or wildcard: %s"</span>, returnType);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (returnType == <span class="keyword">void</span>.class) &#123;</span><br><span class="line">      <span class="keyword">throw</span> methodError(method, <span class="string">"Service methods cannot return void."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> HttpServiceMethod.parseAnnotations(retrofit, method, requestFactory);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€èµ°å‘RequestFactory#parseAnnotationså»è§£ææ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> RequestFactory <span class="title">parseAnnotations</span><span class="params">(Retrofit retrofit, Method method)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Builder(retrofit, method).build();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥çœ‹buildæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">RequestFactory <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (Annotation annotation : methodAnnotations) &#123;</span><br><span class="line">    parseMethodAnnotation(annotation);<span class="comment">//éå†æ¯ä¸ªæ³¨è§£ï¼Œè§£æ</span></span><br><span class="line">  &#125;</span><br><span class="line"> <span class="comment">//ã€‚ã€‚ã€‚çœç•¥</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RequestFactory(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨<code>parseMethodAnnotation</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseMethodAnnotation</span><span class="params">(Annotation annotation)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> DELETE) &#123;</span><br><span class="line">     parseHttpMethodAndPath(<span class="string">"DELETE"</span>, ((DELETE) annotation).value(), <span class="keyword">false</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> GET) &#123;</span><br><span class="line">     parseHttpMethodAndPath(<span class="string">"GET"</span>, ((GET) annotation).value(), <span class="keyword">false</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> HEAD) &#123;</span><br><span class="line">     parseHttpMethodAndPath(<span class="string">"HEAD"</span>, ((HEAD) annotation).value(), <span class="keyword">false</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> PATCH) &#123;</span><br><span class="line">     parseHttpMethodAndPath(<span class="string">"PATCH"</span>, ((PATCH) annotation).value(), <span class="keyword">true</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> POST) &#123;</span><br><span class="line">     parseHttpMethodAndPath(<span class="string">"POST"</span>, ((POST) annotation).value(), <span class="keyword">true</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> PUT) &#123;</span><br><span class="line">     parseHttpMethodAndPath(<span class="string">"PUT"</span>, ((PUT) annotation).value(), <span class="keyword">true</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> OPTIONS) &#123;</span><br><span class="line">     parseHttpMethodAndPath(<span class="string">"OPTIONS"</span>, ((OPTIONS) annotation).value(), <span class="keyword">false</span>);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> HTTP) &#123;</span><br><span class="line">     HTTP http = (HTTP) annotation;</span><br><span class="line">     parseHttpMethodAndPath(http.method(), http.path(), http.hasBody());</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> retrofit2.http.Headers) &#123;</span><br><span class="line">     String[] headersToParse = ((retrofit2.http.Headers) annotation).value();</span><br><span class="line">     <span class="keyword">if</span> (headersToParse.length == <span class="number">0</span>) &#123;</span><br><span class="line">       <span class="keyword">throw</span> methodError(method, <span class="string">"@Headers annotation is empty."</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     headers = parseHeaders(headersToParse);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> Multipart) &#123;</span><br><span class="line">     <span class="keyword">if</span> (isFormEncoded) &#123;</span><br><span class="line">       <span class="keyword">throw</span> methodError(method, <span class="string">"Only one encoding annotation is allowed."</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     isMultipart = <span class="keyword">true</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (annotation <span class="keyword">instanceof</span> FormUrlEncoded) &#123;</span><br><span class="line">     <span class="keyword">if</span> (isMultipart) &#123;</span><br><span class="line">       <span class="keyword">throw</span> methodError(method, <span class="string">"Only one encoding annotation is allowed."</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     isFormEncoded = <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå°±å¾ˆæ˜æ˜¾ï¼Œæ ¹æ®ä¸åŒçš„æ³¨è§£è¿›è¡Œè§£æã€‚åæ­£éƒ½æ˜¯å»è·å¾—æ³¨è§£çš„å€¼å•Šç”Ÿæˆï¼Œæœ€ç»ˆåœ¨invokeç»„å»ºçœŸæ­£çš„callå°½è°ƒç”¨ã€‚</p><p>åé¢éƒ½æ˜¯ç›´æ¥è£…é…ä¹‹å‰è§£æçš„ä¸œè¥¿äº†</p><p>æœ€åçœ‹çœ‹<code>HttpServiceMethod#invoke</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function">ReturnT <span class="title">invoke</span><span class="params">(Object[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callAdapter.adapt(</span><br><span class="line">        <span class="keyword">new</span> OkHttpCall&lt;&gt;(requestFactory, args, callFactory, responseConverter));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯å°±ä¼šå»è¿”å›<code>OkHttpCall</code>é‡Œé¢è°ƒç”¨äº§ç”Ÿçš„åŸç”Ÿçš„<code>OkHttp</code>çš„<code>Call</code>ï¼Œå¤–é¢åŒ…è£¹ç€<code>callAdapter</code>ï¼Œè¿™é‡Œæ˜¯ç”¨äºè½¬æ¢Callçš„ï¼Œå³åˆè¿›è¡Œäº†ä¸€æ¬¡é€‚é…ï¼Œä¸è¿‡è¿™æ¬¡çš„å¯¹è±¡æ˜¯callï¼Œè¿™ä¸ªä¸ºå•¥è¦é€‚é…å‘¢ï¼Œé»˜è®¤çš„è¯æˆ‘ä»¬è¿”å›çš„æ˜¯<code>Call&lt;&gt;</code>è¿™ç§æ ·å­çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç»™å®šAdapteriè¿›è¡Œå¯¹Callè¿›ä¸€æ­¥å¤„ç†ï¼Œæ¯”å¦‚RxJavaé€‚é…å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Retrofit <span class="title">provideRetrofit</span><span class="params">(OkHttpClient client)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">                .baseUrl(Constant.BASE_URL)</span><br><span class="line">                .client(client)</span><br><span class="line">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())<span class="comment">//è¿™ä¸ª</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±èƒ½äº§ç”Ÿ<code>Observale&lt;&gt;</code>çš„ä¸œè¥¿äº†ã€‚</p><p>ç»§ç»­çœ‹OkHttpCallæ˜¯ä¸ªå•¥ä¸œè¥¿ã€‚å®ƒå®ç°äº†Retrofiçš„Callï¼Œé‡Œé¢åŒ…è£¹ç€çœŸæ­£çš„OkHttpçš„Callã€‚æ‰€ä»¥å½¢å¼å¾ˆæ˜äº†äº†ã€‚</p><p>é€šè¿‡è°ƒRetorfitçš„Callçš„executeæˆ–è€…enqueueï¼Œå»ç»„å»ºçœŸæ­£çš„Callç„¶åè°ƒç”¨åˆ°OkHttpäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Response&lt;T&gt; <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    okhttp3.Call call;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (executed) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Already executed."</span>);</span><br><span class="line">      executed = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (creationFailure != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (creationFailure <span class="keyword">instanceof</span> IOException) &#123;</span><br><span class="line">          <span class="keyword">throw</span> (IOException) creationFailure;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (creationFailure <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line">          <span class="keyword">throw</span> (RuntimeException) creationFailure;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> (Error) creationFailure;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      call = rawCall;</span><br><span class="line">      <span class="keyword">if</span> (call == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          call = rawCall = createRawCall();<span class="comment">//ç»„å»ºçœŸæ­£çš„OkHttpçš„Call</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | RuntimeException | Error e) &#123;</span><br><span class="line">          throwIfFatal(e); <span class="comment">//  Do not assign a fatal error to creationFailure.</span></span><br><span class="line">          creationFailure = e;</span><br><span class="line">          <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (canceled) &#123;</span><br><span class="line">      call.cancel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parseResponse(call.execute());<span class="comment">//è°ƒç”¨</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>åŸç†å‘¢å°±å¤§æ¦‚æ˜¯è¿™æ ·ã€‚é€‚é…å™¨å’Œè½¬æ¢å™¨ä¹Ÿå¾ˆæ˜äº†</p><p>Gsonç›¸åº”ä½“è½¬æ¢å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">GsonResponseBodyConverter</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">ResponseBody</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Gson gson;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> TypeAdapter&lt;T&gt; adapter;</span><br><span class="line"></span><br><span class="line">  GsonResponseBodyConverter(Gson gson, TypeAdapter&lt;T&gt; adapter) &#123;</span><br><span class="line">    <span class="keyword">this</span>.gson = gson;</span><br><span class="line">    <span class="keyword">this</span>.adapter = adapter;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> T <span class="title">convert</span><span class="params">(ResponseBody value)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    JsonReader jsonReader = gson.newJsonReader(value.charStream());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      T result = adapter.read(jsonReader);</span><br><span class="line">      <span class="keyword">if</span> (jsonReader.peek() != JsonToken.END_DOCUMENT) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> JsonIOException(<span class="string">"JSON document was not fully consumed."</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      value.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RxJava Callé€‚é…å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RxJava2CallAdapter</span>&lt;<span class="title">R</span>&gt; <span class="keyword">implements</span> <span class="title">CallAdapter</span>&lt;<span class="title">R</span>, <span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Type responseType;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="meta">@Nullable</span> Scheduler scheduler;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isAsync;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isResult;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isBody;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isFlowable;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isSingle;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isMaybe;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isCompletable;</span><br><span class="line"></span><br><span class="line">  RxJava2CallAdapter(Type responseType, <span class="meta">@Nullable</span> Scheduler scheduler, <span class="keyword">boolean</span> isAsync,</span><br><span class="line">      <span class="keyword">boolean</span> isResult, <span class="keyword">boolean</span> isBody, <span class="keyword">boolean</span> isFlowable, <span class="keyword">boolean</span> isSingle, <span class="keyword">boolean</span> isMaybe,</span><br><span class="line">      <span class="keyword">boolean</span> isCompletable) &#123;</span><br><span class="line">    <span class="keyword">this</span>.responseType = responseType;</span><br><span class="line">    <span class="keyword">this</span>.scheduler = scheduler;</span><br><span class="line">    <span class="keyword">this</span>.isAsync = isAsync;</span><br><span class="line">    <span class="keyword">this</span>.isResult = isResult;</span><br><span class="line">    <span class="keyword">this</span>.isBody = isBody;</span><br><span class="line">    <span class="keyword">this</span>.isFlowable = isFlowable;</span><br><span class="line">    <span class="keyword">this</span>.isSingle = isSingle;</span><br><span class="line">    <span class="keyword">this</span>.isMaybe = isMaybe;</span><br><span class="line">    <span class="keyword">this</span>.isCompletable = isCompletable;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Type <span class="title">responseType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> responseType;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Object <span class="title">adapt</span><span class="params">(Call&lt;R&gt; call)</span> </span>&#123;</span><br><span class="line">    Observable&lt;Response&lt;R&gt;&gt; responseObservable = isAsync</span><br><span class="line">        ? <span class="keyword">new</span> CallEnqueueObservable&lt;&gt;(call)</span><br><span class="line">        : <span class="keyword">new</span> CallExecuteObservable&lt;&gt;(call);</span><br><span class="line">    Observable&lt;?&gt; observable;</span><br><span class="line">    <span class="keyword">if</span> (isResult) &#123;</span><br><span class="line">      observable = <span class="keyword">new</span> ResultObservable&lt;&gt;(responseObservable);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isBody) &#123;</span><br><span class="line">      observable = <span class="keyword">new</span> BodyObservable&lt;&gt;(responseObservable);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      observable = responseObservable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (scheduler != <span class="keyword">null</span>) &#123;</span><br><span class="line">      observable = observable.subscribeOn(scheduler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isFlowable) &#123;</span><br><span class="line">      <span class="keyword">return</span> observable.toFlowable(BackpressureStrategy.LATEST);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSingle) &#123;</span><br><span class="line">      <span class="keyword">return</span> observable.singleOrError();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isMaybe) &#123;</span><br><span class="line">      <span class="keyword">return</span> observable.singleElement();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isCompletable) &#123;</span><br><span class="line">      <span class="keyword">return</span> observable.ignoreElements();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> RxJavaPlugins.onAssembly(observable);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OkHttpå­¦ä¹ </title>
      <link href="/2019/07/13/Android-OkHttp%E5%AD%A6%E4%B9%A0/"/>
      <url>/2019/07/13/Android-OkHttp%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="what"><a href="#what" class="headerlink" title="what"></a>what</h2><p>éå¸¸å¥½ç”¨çš„è¯·æ±‚åº“ï¼Œè¿˜æ˜¯é™„ä¸Š<a href="https://square.github.io/okhttp/calls/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><h2 id="how"><a href="#how" class="headerlink" title="how"></a>how</h2><p>æ­£å¸¸æ­¥éª¤å°±æ˜¯</p><ol><li>æ„å»ºé”®Client<ol><li>æ·»åŠ header</li><li>æ‹¦æˆªå™¨</li><li>ç¼“å­˜</li><li>dns</li><li>ä»£ç†</li><li>è¶…æ—¶</li><li>ç›‘å¬äº‹ä»¶</li></ol></li><li>æ„å»ºè¯·æ±‚Request<ol><li>url</li><li>header</li><li>è¯·æ±‚æ–¹å¼</li><li>è¯·æ±‚ä½“</li></ol></li><li>å‘é€è¯·æ±‚Call</li><li>è·å¾—å“åº”Response</li><li>å¤„ç†å“åº”</li></ol><a id="more"></a><h3 id="ç®€å•åŒæ­¥è¯·æ±‚"><a href="#ç®€å•åŒæ­¥è¯·æ±‚" class="headerlink" title="ç®€å•åŒæ­¥è¯·æ±‚"></a>ç®€å•åŒæ­¥è¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">    .url(<span class="string">"https://www.wanandroid.com/article/list/0/json"</span>)</span><br><span class="line">    .build();</span><br><span class="line">Call call = client.newCall(request);</span><br><span class="line"><span class="keyword">try</span>(Response response = call.execute()) &#123;</span><br><span class="line">    System.out.println(response.code());</span><br><span class="line">    System.out.println(response.message());</span><br><span class="line">    System.out.println(response.body().string());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">200</span></span><br><span class="line">OK</span><br><span class="line">(ç›¸åº”ä½“æ•°æ®)</span><br></pre></td></tr></table></figure><h3 id="ç®€å•å¼‚æ­¥è¯·æ±‚"><a href="#ç®€å•å¼‚æ­¥è¯·æ±‚" class="headerlink" title="ç®€å•å¼‚æ­¥è¯·æ±‚"></a>ç®€å•å¼‚æ­¥è¯·æ±‚</h3><p>å°±æ˜¯ç®€å•çš„å°†executeæ¢æˆäº†enqueueä¼ å…¥å›è°ƒï¼Œè¿™æ˜¯å¼‚æ­¥çš„å“¦ï¼Œä¼šåˆ‡æ¢çº¿ç¨‹ã€‚ä½†æ˜¯å†Testæµ‹è¯•æ–¹æ³•ä¸­ï¼Œéœ€è¦è®©å¤–é¢çš„çº¿ç¨‹ç­‰å¾…ä¸‹ï¼Œä¸ç„¶æ˜¯çœ‹ä¸åˆ°çš„ç»“æœçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">  OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(<span class="string">"https://www.wanandroid.com/article/list/0/json"</span>)</span><br><span class="line">                .build();</span><br><span class="line">        Call call = client.newCall(request);</span><br><span class="line">        call.enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"onFailure"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                System.out.println(&#123;<span class="string">"in "</span>+Thread.currentThread().getId());</span><br><span class="line">                System.out.println(response.code());</span><br><span class="line">                System.out.println(response.message());</span><br><span class="line">                System.out.println(response.body().string());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println( <span class="string">"out "</span>+ Thread.currentThread().getId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line">out <span class="number">1</span></span><br><span class="line">in <span class="number">13</span></span><br><span class="line"><span class="number">200</span></span><br><span class="line">OK</span><br><span class="line">(ç›¸åº”ä½“æ•°æ®)</span><br></pre></td></tr></table></figure><h3 id="å‘é€Postè¯·æ±‚"><a href="#å‘é€Postè¯·æ±‚" class="headerlink" title="å‘é€Postè¯·æ±‚"></a>å‘é€Postè¯·æ±‚</h3><p>å¦‚æœä¸å¯¹Requestè¿›è¡Œè®¾ç½®ï¼Œé»˜è®¤å°±æ˜¯getè¯·æ±‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RequestBody requestBody = <span class="keyword">new</span> Request.Builder().addHeader().build();</span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">    .url(<span class="string">"https://www.wanandroid.com/login"</span>)</span><br><span class="line">    .post(requestBody)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸»è¦å°±æ˜¯çœ‹RequestBodyçš„æ„å»ºäº†</p><h4 id="é€šè¿‡é™æ€æ–¹æ³•createè¿›è¡Œæ„å»º"><a href="#é€šè¿‡é™æ€æ–¹æ³•createè¿›è¡Œæ„å»º" class="headerlink" title="é€šè¿‡é™æ€æ–¹æ³•createè¿›è¡Œæ„å»º"></a>é€šè¿‡é™æ€æ–¹æ³•createè¿›è¡Œæ„å»º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MediaType contentType = MediaType.parse(<span class="string">"text/x-markdown; charset=utf-8"</span>);</span><br><span class="line">RequestBody requestBody = RequestBody.create(contentType, <span class="string">"hello"</span>);</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æœ‰è¿™ä¹ˆå‡ ç§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="meta">@Nullable</span> MediaType contentType, String content);<span class="comment">//å­—ç¬¦ä¸²</span></span><br><span class="line">create(<span class="keyword">final</span> <span class="meta">@Nullable</span> MediaType contentType, <span class="keyword">final</span> ByteString content);</span><br><span class="line">create(<span class="keyword">final</span> <span class="meta">@Nullable</span> MediaType contentType, <span class="keyword">final</span> <span class="keyword">byte</span>[] content);<span class="comment">//å­—èŠ‚æ•°ç»„</span></span><br><span class="line">create(<span class="keyword">final</span> <span class="meta">@Nullable</span> MediaType contentType, <span class="keyword">final</span> <span class="keyword">byte</span>[] content,<span class="keyword">final</span> <span class="keyword">int</span> offset, <span class="keyword">final</span> <span class="keyword">int</span> byteCount);</span><br><span class="line">create(<span class="keyword">final</span> <span class="meta">@Nullable</span> MediaType contentType, <span class="keyword">final</span> File file);<span class="comment">//æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¹Ÿå¯ä»¥ç›´æ¥æ„å»ºæäº¤æ–‡ä»¶RequestBodyçš„ã€‚</p><h4 id="å®ç°RequestBody"><a href="#å®ç°RequestBody" class="headerlink" title="å®ç°RequestBody"></a>å®ç°RequestBody</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">RequestBody requestBody1 = <span class="keyword">new</span> RequestBody() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> MediaType <span class="title">contentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(BufferedSink sink)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><h4 id="å‘é€æ™®é€šè¡¨å•"><a href="#å‘é€æ™®é€šè¡¨å•" class="headerlink" title="å‘é€æ™®é€šè¡¨å•"></a>å‘é€æ™®é€šè¡¨å•</h4><p>RequestBodyæœ‰ä¸€ä¸ªå®ç°ç±»FormBody</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FormBody formBody = <span class="keyword">new</span> FormBody.Builder()</span><br><span class="line">               .add(<span class="string">"name"</span>, <span class="string">"zhangsan"</span>)</span><br><span class="line">               .add(<span class="string">"password"</span>, <span class="string">"123"</span>)</span><br><span class="line">               .build();</span><br></pre></td></tr></table></figure><h4 id="å‘é€Multiè¡¨å•"><a href="#å‘é€Multiè¡¨å•" class="headerlink" title="å‘é€Multiè¡¨å•"></a>å‘é€Multiè¡¨å•</h4><p>RequestBodyå¦ä¸€ä¸ªä¸€ä¸ªå®ç°ç±»MultipartBodyï¼Œæ·»åŠ è®¸å¤šPart</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MultipartBody body = <span class="keyword">new</span> MultipartBody.Builder()</span><br><span class="line">               .addFormDataPart(<span class="string">"name"</span>, <span class="string">"zhangsan"</span>)</span><br><span class="line">               .addPart(MultipartBody.Part.create(<span class="keyword">null</span>))</span><br><span class="line">               .build();</span><br></pre></td></tr></table></figure><h3 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h3><p>OkHttpçš„æ ¸å¿ƒå¯ä»¥å°±åœ¨äºæ‹¦æˆªå™¨ï¼Œå†…éƒ¨é€šè¿‡æ‹¦æˆªå™¨é“¾å¼è°ƒç”¨ã€‚ç›‘å¬ï¼Œé‡å†™ï¼Œé‡è¯•call</p><p>çœ‹ä¸‹å®˜ç½‘ç»™çš„ä¾‹å­ï¼Œç”¨äºæµ‹è¯•è¯·æ±‚æ¶ˆè€—çš„æ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoggingInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Interceptor.Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Request request = chain.request();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">    logger.info(String.format(<span class="string">"Sending request %s on %s%n%s"</span>,</span><br><span class="line">        request.url(), chain.connection(), request.headers()));</span><br><span class="line"></span><br><span class="line">    Response response = chain.proceed(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> t2 = System.nanoTime();</span><br><span class="line">    logger.info(String.format(<span class="string">"Received response for %s in %.1fms%n%s"</span>,</span><br><span class="line">        response.request().url(), (t2 - t1) / <span class="number">1e6</span>d, response.headers()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¦æˆªåˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><p>å…¨å±€æ‹¦æˆªå™¨ é€šè¿‡<code>OkHttpClient.Builder#addInterceptor(Interceptor)</code>åŠ å…¥</p></li><li><p>ç½‘ç»œæ‹¦æˆªå™¨ é€šè¿‡ <code>OkHttpClient.Builder#addNetworkInterceptor(Interceptor)</code>åŠ å…¥ï¼ŒçœŸæ­£å‘èµ·ç½‘ç»œè¯·æ±‚è°ƒç”¨</p></li></ul><p><img src="https://square.github.io/okhttp/images/interceptors@2x.png" alt></p><h4 id="Application-Interceptors"><a href="#Application-Interceptors" class="headerlink" title="Application Interceptors"></a>Application Interceptors</h4><p>å…¨å±€æ‹¦æˆªå™¨ï¼š</p><ul><li>ä¸ç”¨å…³å¿ƒé‡è¿ï¼Œé‡å®šå‘</li><li>æ€»æ˜¯è°ƒç”¨ä¸€æ¬¡ï¼Œå³ä½¿httpå“åº”æ˜¯æ¥è‡ªç¼“å­˜ã€‚</li><li>å¯ä»¥è§‚å¯ŸåŸå§‹è¯·æ±‚æ„å›¾ï¼Œ</li><li>å…è®¸çŸ­è·¯ï¼Œä¸è°ƒç”¨<code>Chain.proceed()</code></li><li>å…è®¸å¤šæ¬¡è°ƒç”¨<code>Chain.proceed()</code></li></ul><p>ä¸€èˆ¬æˆ‘ä»¬å¯æ¯”å¦‚ï¼šä»æœ¬åœ°å–å‡ºå¹¶æ³¨å…¥cookieï¼Œä»¥åŠå–å‡ºcookieæŒä¹…åŒ–åˆ°æœ¬åœ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»å–å¹¶è®¾ç½®cookie</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadCookiesInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReadCookiesInterceptor</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Request.Builder builder = chain.request().newBuilder();</span><br><span class="line">        SharedPreferences pref = PreferenceManager.getDefaultSharedPreferences(mContext);</span><br><span class="line">        HashSet&lt;String&gt; cookies = (HashSet&lt;String&gt;) pref.getStringSet(<span class="string">"cookies"</span>, <span class="keyword">new</span> HashSet&lt;&gt;());</span><br><span class="line">        <span class="keyword">for</span> (String cookie : cookies) &#123;</span><br><span class="line">            builder.addHeader(<span class="string">"Cookie"</span>, cookie);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.proceed(builder.build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿å­˜cookie</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaveCookiesInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SaveCookiesInterceptor</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Response originalResponse = chain.proceed(chain.request());</span><br><span class="line">        <span class="keyword">if</span> (!originalResponse.headers(<span class="string">"Set-Cookie"</span>).isEmpty()) &#123;</span><br><span class="line">            HashSet&lt;String&gt; cookies = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">            cookies.addAll(originalResponse.headers(<span class="string">"Set-Cookie"</span>));</span><br><span class="line">            SharedPreferences.Editor editor = PreferenceManager.getDefaultSharedPreferences(mContext).edit();</span><br><span class="line">            editor.putStringSet(<span class="string">"cookies"</span>, cookies).apply();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> originalResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Network-Interceptors"><a href="#Network-Interceptors" class="headerlink" title="Network Interceptors"></a>Network Interceptors</h4><ul><li>èƒ½å¤Ÿæ“çºµä¸­é—´å“åº”ï¼Œé‡å®šå‘ï¼Œé‡è¯•</li><li>ç¼“å­˜ä¸­å“åº”ä¸ä¼šè°ƒç”¨</li><li>å¯è§‚å¯Ÿç½‘ç»œä¼ è¾“æ•°æ®</li><li>å¯ä»¥è·å¾—å…·ä½“Connectionè¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚IPï¼ŒTLSç­‰</li></ul><h2 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h2><p>é¦–å…ˆçœ‹ä¸‹å„ä¸ªç±»çš„æ¦‚å¿µ</p><ul><li>OkHttpClient å®¢æˆ·ç«¯ï¼šç»´æŒäº†çº¿ç¨‹æ± ï¼Œé¿å…é‡å¤åˆ›é”®æ¶ˆè€—èµ„æºï¼Œæœ€å¥½ä½¿ç”¨å¤ç”¨ä¸€ä¸ª</li><li>Dispatcher çº¿ç¨‹æ± æŠ½è±¡èšåˆï¼šç»´æŠ¤ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ä¸ºäº†0ï¼Œä¸Šé™Intæœ€å¤§æ•°ï¼Œå­˜æ´»æ—¶é—´60sçš„çº¿ç¨‹æ± </li><li>Response è¯·æ±‚çš„å°è£…ï¼šåŒ…å«äº†è¯·æ±‚urlï¼Œè¯·æ±‚å¤´ï¼Œè¯·æ±‚ä½“</li><li>Response å“åº”çš„å°è£…ï¼šåŒ…å«äº†çŠ¶æ€ç ï¼Œå“åº”å¤´ï¼Œå“åº”ä½“</li><li>Call ä¸€æ¬¡è¯·æ±‚çš„å…·ä½“å¯¹è±¡ï¼Œåˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥</li><li>Interceptor æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå¹¶å¤„ç†ï¼Œäº¤ä¸‹ä¸ªæ‹¦æˆªå™¨</li><li>Chain è¯·æ±‚é“¾ï¼Œå’Œæ‹¦æˆªå™¨ä¸€èµ·æ„æˆè´£ä»»é“¾æ¨¡å¼</li></ul><h3 id="æ„å»ºClient"><a href="#æ„å»ºClient" class="headerlink" title="æ„å»ºClient"></a>æ„å»ºClient</h3><p>Builderæ¨¡å¼ï¼Œæ„å»ºclientï¼Œæœ‰é»˜è®¤é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">OkHttpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(<span class="keyword">new</span> Builder());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºè¯·æ±‚"><a href="#æ„å»ºè¯·æ±‚" class="headerlink" title="æ„å»ºè¯·æ±‚"></a>æ„å»ºè¯·æ±‚</h3><p>åŒæ ·Builderæ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Request(Builder builder) &#123;</span><br><span class="line">  <span class="keyword">this</span>.url = builder.url;</span><br><span class="line">  <span class="keyword">this</span>.method = builder.method;</span><br><span class="line">  <span class="keyword">this</span>.headers = builder.headers.build();</span><br><span class="line">  <span class="keyword">this</span>.body = builder.body;</span><br><span class="line">  <span class="keyword">this</span>.tags = Util.immutableMap(builder.tags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="newCall"><a href="#newCall" class="headerlink" title="newCall"></a>newCall</h3><p>å®ä¾‹å‡ºRealCall</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Call <span class="title">newCall</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> RealCall.newRealCall(<span class="keyword">this</span>, request, <span class="keyword">false</span> <span class="comment">/* for web socket */</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> RealCall <span class="title">newRealCall</span><span class="params">(OkHttpClient client, Request originalRequest, <span class="keyword">boolean</span> forWebSocket)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Safely publish the Call instance to the EventListener.</span></span><br><span class="line">    RealCall call = <span class="keyword">new</span> RealCall(client, originalRequest, forWebSocket);</span><br><span class="line">    call.transmitter = <span class="keyword">new</span> Transmitter(client, call);</span><br><span class="line">    <span class="keyword">return</span> call;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒæ­¥è¯·æ±‚"><a href="#åŒæ­¥è¯·æ±‚" class="headerlink" title="åŒæ­¥è¯·æ±‚"></a>åŒæ­¥è¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Response <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (executed) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Already Executed"</span>);<span class="comment">//æ‰§è¡Œè¿‡ä¸èƒ½æ‰§è¡Œ</span></span><br><span class="line">        executed = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    transmitter.timeoutEnter();<span class="comment">//Okioè¶…æ—¶ï¼Œæˆ‘è¿˜æ²¡ææ‡‚233</span></span><br><span class="line">    transmitter.callStart();<span class="comment">//è§¦å‘ç›‘å¬</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        client.dispatcher().executed(<span class="keyword">this</span>);<span class="comment">//RealCallå…¥dispatcherçš„runningCallé˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">return</span> getResponseWithInterceptorChain();<span class="comment">//è¿›å…¥</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        client.dispatcher().finished(<span class="keyword">this</span>);<span class="comment">//ç»§ç»­è°ƒç”¨å…¶å®ƒå¼‚æ­¥call</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>callå…¥é˜Ÿåˆ—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">executed</span><span class="params">(RealCall call)</span> </span>&#123;  runningSyncCalls.add(call);&#125;</span><br></pre></td></tr></table></figure><p>è¿›è¡Œè¯·æ±‚è¿”å›å“åº”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Response <span class="title">getResponseWithInterceptorChain</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// Build a full stack of interceptors.</span></span><br><span class="line">  List&lt;Interceptor&gt; interceptors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  interceptors.addAll(client.interceptors());<span class="comment">//å…¨å±€æ‹¦æˆªå™¨</span></span><br><span class="line">  interceptors.add(<span class="keyword">new</span> RetryAndFollowUpInterceptor(client));<span class="comment">//è¯·æ±‚é‡è¿æ‹¦æˆªå™¨</span></span><br><span class="line">  interceptors.add(<span class="keyword">new</span> BridgeInterceptor(client.cookieJar()));<span class="comment">//æ„å»ºç½‘ç»œè¯·æ±‚</span></span><br><span class="line">  interceptors.add(<span class="keyword">new</span> CacheInterceptor(client.internalCache()));<span class="comment">//cache</span></span><br><span class="line">  interceptors.add(<span class="keyword">new</span> ConnectInterceptor(client));<span class="comment">//å°è£…httpCodec</span></span><br><span class="line">  <span class="keyword">if</span> (!forWebSocket) &#123;</span><br><span class="line">    interceptors.addAll(client.networkInterceptors());</span><br><span class="line">  &#125;</span><br><span class="line">  interceptors.add(<span class="keyword">new</span> CallServerInterceptor(forWebSocket));<span class="comment">//å‘é€å…·ä½“ç½‘ç»œè¯·æ±‚</span></span><br><span class="line"></span><br><span class="line">  Interceptor.Chain chain = <span class="keyword">new</span> RealInterceptorChain(interceptors, transmitter, <span class="keyword">null</span>, <span class="number">0</span>,</span><br><span class="line">      originalRequest, <span class="keyword">this</span>, client.connectTimeoutMillis(),</span><br><span class="line">      client.readTimeoutMillis(), client.writeTimeoutMillis());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">boolean</span> calledNoMoreExchanges = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Response response = chain.proceed(originalRequest);<span class="comment">//è¿›å…¥æ‹¦æˆªå™¨é“¾</span></span><br><span class="line">    <span class="keyword">if</span> (transmitter.isCanceled()) &#123;</span><br><span class="line">      closeQuietly(response);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Canceled"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    calledNoMoreExchanges = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">throw</span> transmitter.noMoreExchanges(e);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!calledNoMoreExchanges) &#123;</span><br><span class="line">      transmitter.noMoreExchanges(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥æ‹¦æˆªå™¨é“¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">proceed</span><span class="params">(Request request, Transmitter transmitter, @Nullable Exchange exchange)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= interceptors.size()) <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</span><br><span class="line"></span><br><span class="line">    calls++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If we already have a stream, confirm that the incoming request will use it.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.exchange != <span class="keyword">null</span> &amp;&amp; !<span class="keyword">this</span>.exchange.connection().supportsUrl(request.url())) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"network interceptor "</span> + interceptors.get(index - <span class="number">1</span>)</span><br><span class="line">          + <span class="string">" must retain the same host and port"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If we already have a stream, confirm that this is the only call to chain.proceed().</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.exchange != <span class="keyword">null</span> &amp;&amp; calls &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"network interceptor "</span> + interceptors.get(index - <span class="number">1</span>)</span><br><span class="line">          + <span class="string">" must call proceed() exactly once"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Call the next interceptor in the chain.é‡æ–°æ„å»ºé“¾</span></span><br><span class="line">    RealInterceptorChain next = <span class="keyword">new</span> RealInterceptorChain(interceptors, transmitter, exchange,</span><br><span class="line">        index + <span class="number">1</span>, request, call, connectTimeout, readTimeout, writeTimeout);</span><br><span class="line">    Interceptor interceptor = interceptors.get(index);</span><br><span class="line">    Response response = interceptor.intercept(next);<span class="comment">//è¿›å…¥ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Confirm that the next interceptor made its required call to chain.proceed().</span></span><br><span class="line">    <span class="keyword">if</span> (exchange != <span class="keyword">null</span> &amp;&amp; index + <span class="number">1</span> &lt; interceptors.size() &amp;&amp; next.calls != <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"network interceptor "</span> + interceptor</span><br><span class="line">          + <span class="string">" must call proceed() exactly once"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Confirm that the intercepted response isn't null.</span></span><br><span class="line">    <span class="keyword">if</span> (response == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"interceptor "</span> + interceptor + <span class="string">" returned null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (response.body() == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">          <span class="string">"interceptor "</span> + interceptor + <span class="string">" returned a response with no body"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ç»å†é‡é‡æ‹¦æˆªå™¨ï¼Œé€šè¿‡Okioåº“è¿›è¡Œå¯¹Socketè¿›è¡Œæµçš„è¯»å†™ï¼Œå°±å®Œæˆä¸€æ¬¡è¯·æ±‚ã€‚</p><h3 id="å¼‚æ­¥è¯·æ±‚"><a href="#å¼‚æ­¥è¯·æ±‚" class="headerlink" title="å¼‚æ­¥è¯·æ±‚"></a>å¼‚æ­¥è¯·æ±‚</h3><p>å’ŒåŒæ­¥è¯·æ±‚ä¸ä¸€æ ·ï¼Œå…·ä½“æ˜¯AsyncCallï¼Œå°†è¯·æ±‚æäº¤ç»™çº¿ç¨‹æ± ï¼Œè§¦å‘å›è°ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(Callback responseCallback)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (executed) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Already Executed"</span>);</span><br><span class="line">        executed = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    transmitter.callStart();<span class="comment">//è§¦å‘äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    client.dispatcher().enqueue(<span class="keyword">new</span> AsyncCall(responseCallback));<span class="comment">//å…¥é˜Ÿåˆ—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(AsyncCall call)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        readyAsyncCalls.add(call);<span class="comment">//å…¥é˜Ÿåˆ—</span></span><br><span class="line">        <span class="comment">// Mutate the AsyncCall so that it shares the AtomicInteger of an existing running call to</span></span><br><span class="line">        <span class="comment">// the same host.</span></span><br><span class="line">        <span class="keyword">if</span> (!call.get().forWebSocket) &#123;</span><br><span class="line">            AsyncCall existingCall = findExistingCallWithHost(call.host());</span><br><span class="line">            <span class="keyword">if</span> (existingCall != <span class="keyword">null</span>) call.reuseCallsPerHostFrom(existingCall);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    promoteAndExecute();<span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">promoteAndExecute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">assert</span> (!Thread.holdsLock(<span class="keyword">this</span>));</span><br><span class="line">    List&lt;AsyncCall&gt; executableCalls = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">boolean</span> isRunning;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (Iterator&lt;AsyncCall&gt; i = readyAsyncCalls.iterator(); i.hasNext(); ) &#123;<span class="comment">//éå†å‡†å¤‡é˜Ÿåˆ—</span></span><br><span class="line">        AsyncCall asyncCall = i.next();</span><br><span class="line">        <span class="keyword">if</span> (runningAsyncCalls.size() &gt;= maxRequests) <span class="keyword">break</span>; <span class="comment">// Max capacity.è¿è¡Œé˜Ÿåˆ—æ»¡</span></span><br><span class="line">        <span class="comment">//è¯·æ±‚Hostçš„æ•°é‡è¶…å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (asyncCall.callsPerHost().get() &gt;= maxRequestsPerHost) <span class="keyword">continue</span>; <span class="comment">// Host max capacity.</span></span><br><span class="line">        i.remove();<span class="comment">//å‡ºå‡†å¤‡é˜Ÿåˆ—</span></span><br><span class="line">        asyncCall.callsPerHost().incrementAndGet();</span><br><span class="line">        executableCalls.add(asyncCall);<span class="comment">//å…¥æ‰§è¡Œé˜Ÿåˆ—</span></span><br><span class="line">        runningAsyncCalls.add(asyncCall);<span class="comment">//å…¥è¿è¡Œé˜Ÿåˆ—</span></span><br><span class="line">      &#125;</span><br><span class="line">      isRunning = runningCallsCount() &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = executableCalls.size(); i &lt; size; i++) &#123;</span><br><span class="line">      AsyncCall asyncCall = executableCalls.get(i);</span><br><span class="line">      asyncCall.executeOn(executorService());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isRunning;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>AsnycCallæ˜¯ä¸ªRunaableå®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">executeOn</span><span class="params">(ExecutorService executorService)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">assert</span> (!Thread.holdsLock(client.dispatcher()));</span><br><span class="line">      <span class="keyword">boolean</span> success = <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        executorService.execute(<span class="keyword">this</span>);<span class="comment">//æäº¤åˆ°çº¿ç¨‹æ± </span></span><br><span class="line">        success = <span class="keyword">true</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (RejectedExecutionException e) &#123;</span><br><span class="line">        InterruptedIOException ioException = <span class="keyword">new</span> InterruptedIOException(<span class="string">"executor rejected"</span>);</span><br><span class="line">        ioException.initCause(e);</span><br><span class="line">        transmitter.noMoreExchanges(ioException);</span><br><span class="line">        responseCallback.onFailure(RealCall.<span class="keyword">this</span>, ioException);<span class="comment">//è§¦å‘å¤±è´¥å›è°ƒ</span></span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">          client.dispatcher().finished(<span class="keyword">this</span>); <span class="comment">// This call is no longer running!</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹å…·ä½“æ‰§è¡Œçš„åœ°æ–¹</p><p>èµ°åˆ°è¿™é‡Œå°±å’ŒåŒæ­¥è¯·æ±‚ä¸€è‡´äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> signalledCallback = <span class="keyword">false</span>;</span><br><span class="line">    transmitter.timeoutEnter();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Response response = getResponseWithInterceptorChain();<span class="comment">//è¯·æ±‚å“åº”</span></span><br><span class="line">        signalledCallback = <span class="keyword">true</span>;</span><br><span class="line">        responseCallback.onResponse(RealCall.<span class="keyword">this</span>, response);<span class="comment">//æˆåŠŸå›è°ƒ</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (signalledCallback) &#123;</span><br><span class="line">            <span class="comment">// Do not signal the callback twice!</span></span><br><span class="line">            Platform.get().log(INFO, <span class="string">"Callback failure for "</span> + toLoggableString(), e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            responseCallback.onFailure(RealCall.<span class="keyword">this</span>, e);<span class="comment">//å¤±è´¥å›è°ƒ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        client.dispatcher().finished(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><ul><li>Responseè¯»å–ä¸€æ¬¡å†…å®¹ä¼šå…³é—­ï¼Œæ‰€ä»¥åªèƒ½è¯»å–ä¸€æ¬¡</li><li>Responseè¯»å–byteStreamæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨closeå®ƒ</li></ul><p>å‚è€ƒï¼š</p><ul><li><a href="https://square.github.io/okhttp/" target="_blank" rel="noopener">https://square.github.io/okhttp/</a></li><li><a href="https://www.jianshu.com/p/9ed2c2f2a52c" target="_blank" rel="noopener">https://www.jianshu.com/p/9ed2c2f2a52c</a></li><li><a href="https://www.jianshu.com/p/da4a806e599b" target="_blank" rel="noopener">https://www.jianshu.com/p/da4a806e599b</a></li><li><a href="https://www.jianshu.com/p/70dfa335916c" target="_blank" rel="noopener">OkHttpè¸©å‘è®°ï¼šä¸ºä½• response.body().string() åªèƒ½è°ƒç”¨ä¸€æ¬¡</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ ä½¿ç”¨Rxjava</title>
      <link href="/2019/07/10/Android-RxJava%E5%AD%A6%E4%B9%A0/"/>
      <url>/2019/07/10/Android-RxJava%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="RxJava"><a href="#RxJava" class="headerlink" title="RxJava"></a>RxJava</h2><h3 id="What"><a href="#What" class="headerlink" title="What:"></a>What:</h3><p>å¼‚æ­¥</p><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><ul><li>Observable é€šç”¨çš„è¢«è§‚å¯Ÿè€…</li><li>Observer  é€šç”¨çš„è§‚å¯Ÿè€…</li><li>Scheduler çº¿ç¨‹è°ƒåº¦å™¨</li><li>Disposable ä¸€æ¬¡æ€§çš„</li></ul><h3 id="how"><a href="#how" class="headerlink" title="how"></a>how</h3><a id="more"></a><h4 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é¦–å…ˆåˆ›å»ºè¢«è§‚å¯Ÿè€…</span></span><br><span class="line">Observable observable = Observable.create(</span><br><span class="line">                <span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; observableEmitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        observableEmitter.onNext(<span class="string">"hello"</span>);</span><br><span class="line">                        <span class="keyword">int</span> error = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">if</span> (error == <span class="number">0</span>) &#123;</span><br><span class="line">                            observableEmitter.onError(<span class="keyword">new</span> Exception(<span class="string">"error == 0"</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                        observableEmitter.onComplete();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"><span class="comment">//åˆ›å»ºè§‚å¯Ÿè€…</span></span><br><span class="line"></span><br><span class="line"> Observer observer = <span class="keyword">new</span> Observer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable disposable)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"onSubscribe"</span>);<span class="comment">//äº§ç”Ÿè®¢é˜…å…³ç³»è°ƒç”¨ï¼Œå³åœ¨è°ƒç”¨subscribeçº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">                System.out.println(str);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"error!!"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"onComplete"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¢é˜…ï¼Œï¼ˆæ³¨å…¥çµé­‚233ï¼‰</span></span><br><span class="line">    observable.subscribe(oberver);</span><br><span class="line"></span><br><span class="line"><span class="comment">//output</span></span><br><span class="line">onSubscribe</span><br><span class="line">hello</span><br><span class="line">onComplete</span><br></pre></td></tr></table></figure><p>ç»“åˆä½¿ç”¨lambdaé“¾å¼å†™æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(subscribe-&gt; &#123;</span><br><span class="line">            subscribe.onNext(<span class="string">"hello"</span>);</span><br><span class="line">            <span class="keyword">int</span> errorCode = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (errorCode == <span class="number">1</span>) &#123;</span><br><span class="line">                subscribe.onError(<span class="keyword">new</span> Exception(<span class="string">"errorCode = 1"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            subscribe.onComplete();</span><br><span class="line">        &#125;).doOnSubscribe(str -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">"onSubscribe"</span>);</span><br><span class="line">        &#125;).subscribe(</span><br><span class="line">                str-&gt; System.out.println(str),</span><br><span class="line">                throwable -&gt; throwable.printStackTrace(),</span><br><span class="line">                ()-&gt; System.out.println(<span class="string">"complete"</span>));</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line">onSubscribe</span><br><span class="line">hello</span><br><span class="line">complete</span><br></pre></td></tr></table></figure><h4 id="çº¿ç¨‹è°ƒåº¦"><a href="#çº¿ç¨‹è°ƒåº¦" class="headerlink" title="çº¿ç¨‹è°ƒåº¦"></a>çº¿ç¨‹è°ƒåº¦</h4><p>Rxjavaæä¾›äº†ä»¥ä¸‹å‡ ç§çº¿ç¨‹è°ƒåº¦å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Schedulers.single();<span class="comment">//æ‰€æœ‰ä»»åŠ¡åœ¨å•çº¿ç¨‹</span></span><br><span class="line">Schedulers.newThread();<span class="comment">//ä½¿ç”¨æ–°çº¿ç¨‹</span></span><br><span class="line">Schedulers.trampoline();<span class="comment">//</span></span><br><span class="line">Schedulers.io();<span class="comment">//ç”¨äºIOå¯†é›†å‹æ“ä½œï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ï¼Œæ•°æ®åº“ï¼Œç½‘ç»œ</span></span><br><span class="line">Schedulers.computation();<span class="comment">//ç”¨äºCPUå¯†é›†å‹è®¡ç®—ï¼Œæ¯”å¦‚xmlï¼Œjsonè§£æï¼ŒBitmapå‹ç¼©å–æ ·</span></span><br><span class="line">AndroidSchedulers.mainThread();<span class="comment">//android ä¸»çº¿ç¨‹</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> Observable.create(emitter -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">"observable"</span>);</span><br><span class="line">            emitter.onNext(<span class="string">"hello"</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getId());</span><br><span class="line">        &#125;) .subscribeOn(Schedulers.newThread())<span class="comment">//è¢«è§‚å¯Ÿè€…æ‰§è¡ŒåŠ¨ä½œæ‰€åœ¨çº¿ç¨‹</span></span><br><span class="line">                .observeOn(Schedulers.newThread())<span class="comment">//è§‚å¯Ÿè€…æ‰§è¡ŒåŠ¨ä½œæ‰€åœ¨çº¿ç¨‹</span></span><br><span class="line">                .subscribe(str-&gt;&#123;</span><br><span class="line">                    System.out.println(<span class="string">"observer"</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getId());</span><br><span class="line">                    System.out.println(str);</span><br><span class="line">                &#125;);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line">observable</span><br><span class="line"><span class="number">14</span></span><br><span class="line">observer</span><br><span class="line"><span class="number">15</span></span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±åŸºæœ¬ä¸Šèƒ½å®Œæˆå¾ˆå¤šçº¿ç¨‹åˆ‡æ¢çš„æ“ä½œã€‚</p><h4 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h4><p>æ ¼å¼å„æ ·çš„æ“ä½œç¬¦ï¼Œæˆ‘å°±è®°ä¸‹æˆ‘çœ‹æ‡‚çš„æ“ä½œç¬¦å§å‘ƒå‘ƒ</p><p>å˜æ¢</p><ul><li>map</li><li>flatMap</li></ul><p>è¿‡æ»¤</p><ul><li>filter</li><li>take</li><li>takeLast</li><li>skip</li><li>skipLast</li><li>elementAt</li><li>debounce</li><li>distinct</li><li>first</li><li>last</li></ul><p>ç»„åˆ</p><ul><li>merge</li><li>startWith</li><li>concat</li><li>zip</li></ul><p>å…¶å®ƒ</p><ul><li>interval</li><li>compose</li></ul><h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><p>å°†å‘å°„å€¼è¿›è¡Œè½¬æ¢æˆå¦ä¸€ç§å‘è®¾å€¼</p><p>map(Func1&lt;? super T, ? extends R&gt; func))</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">                .map(integer -&gt; &#123;</span><br><span class="line">                    <span class="keyword">char</span> tmp = (<span class="keyword">char</span>) (<span class="string">'a'</span> + integer);</span><br><span class="line">                    <span class="keyword">return</span> String.valueOf(integer) + tmp;</span><br><span class="line">                &#125;).subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">1</span>b</span><br><span class="line"><span class="number">2</span>c</span><br><span class="line"><span class="number">3</span>d</span><br><span class="line"><span class="number">4</span>e</span><br><span class="line"><span class="number">5f</span></span><br></pre></td></tr></table></figure><h5 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h5><p>å‘å°„å€¼è¿›è¡Œè¿›ä¸€æ­¥è½¬æ¢æˆObservableåºåˆ—ï¼Œå¹³æ‘ŠæˆObservableåºåˆ—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"1234"</span>, <span class="string">"5678"</span>)</span><br><span class="line">                .flatMap((Function&lt;String, ObservableSource&lt;Character&gt;&gt;) s -&gt; &#123;</span><br><span class="line">                    Character[] characters = <span class="keyword">new</span> Character[s.length()];</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">                        characters[i] = s.charAt(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> Observable.fromArray(characters);</span><br><span class="line">                &#125;).subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure><h5 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h5><p>å°†ä¸Šä¸€ä¸ªç»è¿‡å‡½æ•°å¤„ç†çš„å‘å°„å€¼ä½œä¸ºä¸‹ä¸€ä¸ªå‚æ•°ç»§ç»­å¤„ç†ã€‚</p><p>å¥½æ¯”å¦‚ï¼šç¬¬ä¸€æ¬¡å¤„ç†ä¸º1ï¼Œç¬¬äºŒæ¬¡å°±æ˜¯1+2=3ï¼Œç„¶åç¬¬ä¸‰æ¬¡3+3=6ï¼Œä¾æ¬¡ç±»æ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">                .scan((integer, integer2) -&gt; integer + integer2)</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure><h5 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h5><p>åˆ¤æ–­å¼è¿‡æ»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">                .filter(integer -&gt; integer % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure><h5 id="take"><a href="#take" class="headerlink" title="take"></a>take</h5><p>åªå–å‰nä¸ªå…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">                .take(<span class="number">3</span>)</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><h5 id="takeLast"><a href="#takeLast" class="headerlink" title="takeLast"></a>takeLast</h5><p>åªå»ånä¸ªå…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">                .takeLast(<span class="number">3</span>)</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure><h5 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h5><p>è·³è¿‡å‰nä¸ªå…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">                .skip(<span class="number">2</span>)</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure><h5 id="skipLast"><a href="#skipLast" class="headerlink" title="skipLast"></a>skipLast</h5><p>è·³è¿‡ånä¸ªå…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">                .skipLast(<span class="number">2</span>)</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure><h5 id="elementAt"><a href="#elementAt" class="headerlink" title="elementAt"></a>elementAt</h5><p>åªå»å›ºå®šåºå·å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">                .elementAt(<span class="number">3</span>)</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure><h5 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h5><p>è¿‡æ»¤æ‰äº†ç”±Observableå‘å°„çš„é€Ÿç‡è¿‡å¿«çš„æ•°æ®ï¼›å¦‚æœåœ¨ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´é—´éš”è¿‡å»äº†ä»æ—§æ²¡æœ‰å‘å°„ä¸€ä¸ªï¼Œé‚£ä¹ˆå®ƒå°†å‘å°„æœ€åçš„é‚£ä¸ªã€‚é€šå¸¸æˆ‘ä»¬ç”¨æ¥ç»“åˆRxBinding(Jake Whartonå¤§ç¥ä½¿ç”¨RxJavaå°è£…çš„Android UIç»„ä»¶)ä½¿ç”¨ï¼Œé˜²æ­¢buttoné‡å¤ç‚¹å‡»ã€‚</p><h5 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h5><p>å»é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">                .distinct()</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><p>distinct(Func1) åˆ™éœ€è¦ä½ ç»™å‡ºkeyä½œä¸ºå»é‡ä¾æ®</p><p>distinctUntilChanged(Func1)å’Œdistinct(Func1)ä¸€æ ·ï¼Œæ ¹æ®Func1ä¸­callæ–¹æ³•äº§ç”Ÿä¸€ä¸ªKeyæ¥åˆ¤æ–­ä¸¤ä¸ªç›¸é‚»çš„æ•°æ®é¡¹æ˜¯å¦ç›¸åŒã€‚</p><h5 id="first"><a href="#first" class="headerlink" title="first"></a>first</h5><p>åªå‘é€ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œfirstå‚æ•°ä¸ºï¼Œå½“æ²¡æœ‰å…ƒç´ å‘å‡ºï¼Œåˆ™ä½¿ç”¨å‚æ•°å‘å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">                .first(<span class="number">2</span>)</span><br><span class="line">                .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="last"><a href="#last" class="headerlink" title="last"></a>last</h5><p>ç±»ä¼¼firstï¼Œæœ€åä¸€ä¸ª</p><h5 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h5><p>ä¸¤ä¸ªäº‹ä»¶åºåˆ—å’Œä¸€ä¸ªï¼Œåˆå¹¶çš„æ•°æ®æ˜¯æ— åºçš„ã€‚</p><h5 id="startWith"><a href="#startWith" class="headerlink" title="startWith"></a>startWith</h5><p>åœ¨æŸåºåˆ—å‰åˆå¹¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">startWith(T);</span><br><span class="line">startWith(T...);</span><br><span class="line">startWith(Observable&lt;T&gt;);</span><br><span class="line">startWith(Iterable&lt;T&gt;);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Observable a = Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">Observable b = Observable.just(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>);</span><br><span class="line">a.startWith(Arrays.asList(<span class="number">0</span>,<span class="number">9</span>,<span class="number">22</span>)).subscribe(System.out::println);</span><br><span class="line">System.out.println(<span class="string">"--------------"</span>);</span><br><span class="line">a.startWith(b).subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">22</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">--------------</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure><h5 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h5><p>ä¸¥æ ¼æŒ‰ç…§å‘å°„é¡ºåºç»„åˆï¼Œä¸Šä¸€ä¸ªæ²¡å‘å°„å®Œï¼Œä¸‹ä¸€ä¸ªä¸ä¼šå‘å°„ã€‚</p><h5 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h5><p>å°†ä¸¤ä¸ªäº‹ä»¶åºåˆ—ï¼Œé€šè¿‡å‡½æ•°ç»„åˆæ–°çš„ï¼Œæ•°é‡ä¸åŒ¹é…çš„å…ƒç´ ä¸¢å¼ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable a = Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>);</span><br><span class="line">Observable b = Observable.just(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>);</span><br><span class="line">Observable.zip(a,b,(BiFunction&lt;Integer, Character, String&gt;) </span><br><span class="line">    (integer, character) -&gt; integer + String.valueOf(character))</span><br><span class="line">    .subscribe(System.out::println);</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="number">1</span>a</span><br><span class="line"><span class="number">2</span>b</span><br><span class="line"><span class="number">3</span>c</span><br></pre></td></tr></table></figure><h5 id="interval"><a href="#interval" class="headerlink" title="interval"></a>interval</h5><p>æŒ‰ç…§é—´éš”æ‰§è¡Œï¼Œä½†æ˜¯è¦äº§ç”Ÿè®¢é˜…å…³ç³»çš„çº¿ç¨‹ä¸èƒ½ç«‹å³æ‰§è¡Œå®Œæ¯•ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.interval(<span class="number">300</span>,TimeUnit.MILLISECONDS).subscribe(position -&gt; System.out.println(position));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">20000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line">æŒ‰ç…§é—´éš”<span class="number">300</span>msæ‰“å°positonï¼Œä»<span class="number">0</span>å¼€å§‹ï¼Œä»£è¡¨æ¬¡æ•°</span><br></pre></td></tr></table></figure><h5 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h5><p>å¯¹äº‹ä»¶åºåˆ—çš„å˜æ¢ä¹Ÿå°±æ˜¯Obervableçš„å˜åŒ–ï¼Œä¹‹å‰æ˜¯mapflatMapæ˜¯å¯¹å‘å°„å…ƒç´ çš„å˜æ¢ï¼Œè¿™ä¸ªå¯ä»¥ç›´æ¥å¤„ç†äº‹ä»¶æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">                .compose(upstream -&gt; upstream.subscribeOn(Schedulers.io()).observeOn(Schedulers.newThread()))</span><br><span class="line">                .subscribe();</span><br><span class="line"><span class="comment">//ç­‰ä»·äº</span></span><br><span class="line">  Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">      .subscribeOn(Schedulers.io())</span><br><span class="line">      .observeOn(Schedulers.newThread()))</span><br><span class="line">      .subscribe();</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚é‡å¤ä»£ç ï¼šçº¿ç¨‹åˆ‡æ¢ï¼Œå¯ä»¥å†™æˆé€šç”¨ä»£ç ï¼Œç„¶åç›´æ¥ä¼ ç»™composeå°±è¡Œäº†åŒç†æœ‰å…¶ä»–çš„æµå¤„ç†æ“ä½œä¹Ÿå¯ä»¥å¤ç”¨ï¼Œç„¶åè°ƒç”¨compose</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ObservableTransformer&lt;T, T&gt; <span class="title">rxSchedulerhelper</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> observable -&gt; observable.subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="why"><a href="#why" class="headerlink" title="why"></a>why</h3><p>è°ƒç”¨è¿˜æ˜¯æŒºç®€å•çš„ï¼Œå†…éƒ¨å®ç°çš„è¯å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š</p><p>è‡ªä¸Šè€Œä¸‹ç”Ÿæˆè£…é¥°çš„Observableï¼Œåœ¨subscribeæ—¶ï¼Œä»ä¸‹å¾€ä¸Šè®¢é˜…ä¸Šæ¸¸Observableå¹¶ä¸”ç”Ÿæˆè£…é¥°çš„Observerã€‚</p><p>è‡ªä¸Šè€Œä¸‹åŒ…è£…Observableï¼Œsubscriberè‡ªä¸‹è€Œä¸Šç”Ÿè°ƒç”¨ä¸Šæµçš„observaleï¼ŒåŒæ—¶æ¶ˆè´¹å¯¹åº”çš„Observerï¼Œå³è‡ªä¸‹è€Œä¸ŠåŒ…è£…Obsererï¼Œåœ¨é¡ºåºä¸Šè¡¨ç°ä¸ºï¼Œä¸‹æµObervableä¸æ–­çš„è°ƒç”¨å­˜å‚¨ä¸Šæµçš„Obervableï¼Œåœ¨onNextæ—¶ï¼Œä¸Šæ¸¸Oberverä¾æ¬¡è°ƒç”¨ä¸‹æ¸¸Oberverã€‚</p><h4 id="åˆ†ææœ€ç®€å•çš„è®¢é˜…"><a href="#åˆ†ææœ€ç®€å•çš„è®¢é˜…" class="headerlink" title="åˆ†ææœ€ç®€å•çš„è®¢é˜…"></a>åˆ†ææœ€ç®€å•çš„è®¢é˜…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Observable observable = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">               System.out.println(Thread.currentThread().getId());</span><br><span class="line">               System.out.println(<span class="string">"run"</span>);</span><br><span class="line">               emitter.onNext(<span class="string">"test"</span>);</span><br><span class="line">               emitter.onComplete();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       Observer observer = <span class="keyword">new</span> Observer&lt;String&gt;() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">               System.out.println(Thread.currentThread().getId());</span><br><span class="line">               System.out.println(<span class="string">"onSubscribe"</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String o)</span> </span>&#123;</span><br><span class="line">               System.out.println(Thread.currentThread().getId());</span><br><span class="line">               System.out.println(<span class="string">"onNext"</span> + o);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">               System.out.println(<span class="string">"onError"</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               System.out.println(<span class="string">"onComplete"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line"></span><br><span class="line">    observable.subscribe(observer);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆObservable.createåˆ›é”®å‡ºObervableã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">create</span><span class="params">(ObservableOnSubscribe&lt;T&gt; source)</span> </span>&#123;</span><br><span class="line">        ObjectHelper.requireNonNull(source, <span class="string">"source is null"</span>);</span><br><span class="line">        <span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> ObservableCreate&lt;T&gt;(source));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿”å›äº†ä¸€ä¸ªObservableCreateçš„å¹¶ä¸”æŠŠæˆ‘ä»¬çš„æºå‚¨å­˜èµ·æ¥äº†</p><p>è°ƒç”¨subscribe</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">    ObjectHelper.requireNonNull(observer, <span class="string">"observer is null"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        observer = RxJavaPlugins.onSubscribe(<span class="keyword">this</span>, observer);</span><br><span class="line"></span><br><span class="line">        ObjectHelper.requireNonNull(observer, <span class="string">"Plugin returned null Observer"</span>);</span><br><span class="line"></span><br><span class="line">        subscribeActual(observer);/</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NullPointerException e) &#123; <span class="comment">// NOPMD</span></span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        Exceptions.throwIfFatal(e);</span><br><span class="line">        <span class="comment">// can't call onError because no way to know if a Disposable has been set or not</span></span><br><span class="line">        <span class="comment">// can't call onSubscribe because the call might have set a Subscription already</span></span><br><span class="line">        RxJavaPlugins.onError(e);</span><br><span class="line"></span><br><span class="line">        NullPointerException npe = <span class="keyword">new</span> NullPointerException(<span class="string">"Actually not, but can't throw other exceptions due to RS"</span>);</span><br><span class="line">        npe.initCause(e);</span><br><span class="line">        <span class="keyword">throw</span> npe;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€å®é™…è°ƒç”¨subscribeActualï¼Œè¿™ä¸ªæ˜¯æŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥å¾—çœ‹ObservableCreateå¾—å®ç°å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">        CreateEmitter&lt;T&gt; parent = <span class="keyword">new</span> CreateEmitter&lt;T&gt;(observer);<span class="comment">//å°†observerä¼ å…¥CreateEmitter</span></span><br><span class="line">        observer.onSubscribe(parent);<span class="comment">//è§¦å‘onSubscribe</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            source.subscribe(parent);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">            Exceptions.throwIfFatal(ex);</span><br><span class="line">            parent.onError(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æˆ‘ä»¬æºå¤´çš„sourceï¼Œä¹Ÿå°±æ˜¯å¼€å§‹å®šä¹‰å¾—ã€‚ç„¶åå°±æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable observable = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getId());</span><br><span class="line">                System.out.println(<span class="string">"run"</span>);</span><br><span class="line">                emitter.onNext(<span class="string">"test"</span>);<span class="comment">//è§¦å‘observerçš„onNext</span></span><br><span class="line">                emitter.onComplete();<span class="comment">//è§¦å‘observerçš„onComplete</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆä¸€ä¸ªè®¢é˜…å…³ç³»ã€‚å¯ä»¥çœ‹å‡ºæ¯ä¸€å±‚Observableå’ŒObserveré€šè¿‡subscribeè®¢é˜…è§¦å‘ï¼Œå¦‚æœè°ƒç”¨äº†çº¿ç¨‹åˆ‡æ¢ï¼Œå„ç§æ“ä½œç¬¦ï¼Œå…¶å®ä¹Ÿæ˜¯åœ¨ä»ä¸Šå±‚ç”Ÿæˆæ–°çš„ObservableåŒ…è£¹ç€ä¸Šæ¸¸çš„Observableï¼Œæœ€ååœ¨æœ€ä¸‹å±‚è®¢é˜…ï¼Œä»ä¸‹å±‚å¼€å§‹ä¸€å±‚ä¸€å±‚è°ƒç”¨subscribeçš„æœ€ç»ˆè°ƒåˆ°æºå¤´çš„Observableã€‚</p><h4 id="å¸¦çº¿ç¨‹çš„è°ƒåº¦åˆ†æ"><a href="#å¸¦çº¿ç¨‹çš„è°ƒåº¦åˆ†æ" class="headerlink" title="å¸¦çº¿ç¨‹çš„è°ƒåº¦åˆ†æ"></a>å¸¦çº¿ç¨‹çš„è°ƒåº¦åˆ†æ</h4><p>çŸ¥é“ä»–çš„è§¦å‘åŸç†åæˆ‘ä»¬å¯ä»¥ç›´æ¥å»çœ‹é‚£ä¸€å±‚çš„Observableå’ŒObserver</p><h5 id="ObservableSubscribeOn"><a href="#ObservableSubscribeOn" class="headerlink" title="ObservableSubscribeOn"></a>ObservableSubscribeOn</h5><p>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨subscribeOnå³åœ¨Observableçº¿ç¨‹è°ƒåº¦ï¼Œçœ‹çœ‹å®ƒå®é™…è§¦å‘è®¢é˜…çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(<span class="keyword">final</span> Observer&lt;? <span class="keyword">super</span> T&gt; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> SubscribeOnObserver&lt;T&gt; parent = <span class="keyword">new</span> SubscribeOnObserver&lt;T&gt;(s);<span class="comment">//æ–°çš„Observer</span></span><br><span class="line"></span><br><span class="line">        s.onSubscribe(parent);<span class="comment">//onSubscribeæ€»æ˜¯åœ¨è®¢é˜…è§¦å‘çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">        parent.setDisposable(scheduler.scheduleDirect(<span class="keyword">new</span> SubscribeTask(parent)));<span class="comment">//ä½¿ç”¨å…·ä½“çš„è°ƒåº¦å™¨å–æ‰§è¡Œè°ƒåº¦</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SubscribeTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SubscribeOnObserver&lt;T&gt; parent;</span><br><span class="line"></span><br><span class="line">        SubscribeTask(SubscribeOnObserver&lt;T&gt; parent) &#123;</span><br><span class="line">            <span class="keyword">this</span>.parent = parent;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            source.subscribe(parent);<span class="comment">//è§¦å‘ä¸Šä¸€å±‚çš„è®¢é˜…</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é¢ï¼Œschedulerçš„è°ƒåº¦æˆ‘ä¸‹æ¬¡åˆ†ææŠŠï¼Œåæ­£å¤§æŠµä¸Šå°±æ˜¯ä½¿ç”¨çº¿ç¨‹æ± å•Šç­‰æ¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚</p><h5 id="ObservableObserveOn"><a href="#ObservableObserveOn" class="headerlink" title="ObservableObserveOn"></a>ObservableObserveOn</h5><p>è¿™ä¸ªå°±æ˜¯å½¢æˆobsrverOnçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯observerçš„çº¿ç¨‹è°ƒåº¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (scheduler <span class="keyword">instanceof</span> TrampolineScheduler) &#123;</span><br><span class="line">            source.subscribe(observer);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Scheduler.Worker w = scheduler.createWorker();</span><br><span class="line"></span><br><span class="line">            source.subscribe(<span class="keyword">new</span> ObserveOnObserver&lt;T&gt;(observer, w, delayError, bufferSize));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//è¿™æ¬¡å°±æ²¡æœ‰å†subscribeä¸Šåšæ‰‹è„šï¼Œè€Œæ˜¯å†ObserveOnObserveråŒ…è£…ç±»ä¸Šåšäº†çº¿ç¨‹åˆ‡æ¢ï¼Œä¸‹æ¸¸çš„onNextè¿›è¡Œçº¿ç¨‹åˆ‡æ¢å¤„ç†</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºObervableæ˜¯ä»ä¸Šåˆ°ä¸‹è¿›è¡ŒåŒ…è£¹ï¼Œæ‰€ä»¥subscribOnå¤šæ¬¡è°ƒç”¨ä¹Ÿåªä¼šæ˜¯ç¬¬ä¸€èµ·ä½œç”¨ã€‚è€ŒObserveræ˜¯è®¢é˜…æ—¶ä»ä¸‹å¾€ä¸ŠåŒ…è£¹ï¼Œæ‰€ä»¥observerOnå¯ä»¥å˜åŒ–è®¸å¤šæ¬¡ã€‚</p><p>å…¶å®ƒæ“ä½œç¬¦ä¹Ÿæ˜¯å¦‚æ­¤æŠŠã€‚</p><h4 id="RxBus"><a href="#RxBus" class="headerlink" title="RxBus"></a>RxBus</h4><p>RxBus å®ç°æ˜¯åœ¨ä¸€ä¸ªæ—¢ä¸ºObservableå’ŒObserverçš„å®ä¾‹ä¸­å†…éƒ¨ä¿å­˜äº†äº‹ä»¶æ•°ç»„ï¼Œé€šè¿‡è§¦å‘onNextéå†åˆ°å¯¹åº”çš„äº‹ä»¶ï¼Œè¿›è¡Œè°ƒç”¨ã€‚</p><p>å¾…è¡¥å……ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½’çº³ä¸‹å¹¿æ’­å’Œå†…å®¹æä¾›å™¨</title>
      <link href="/2019/07/10/Android-%E5%BD%92%E7%BA%B3%E4%B8%8B%E5%B9%BF%E6%92%AD%E5%92%8C%E5%86%85%E5%AE%B9%E6%8F%90%E4%BE%9B%E5%99%A8/"/>
      <url>/2019/07/10/Android-%E5%BD%92%E7%BA%B3%E4%B8%8B%E5%B9%BF%E6%92%AD%E5%92%8C%E5%86%85%E5%AE%B9%E6%8F%90%E4%BE%9B%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="å¹¿æ’­"><a href="#å¹¿æ’­" class="headerlink" title="å¹¿æ’­"></a>å¹¿æ’­</h2><h3 id="what"><a href="#what" class="headerlink" title="what"></a>what</h3><p>androidå†…éƒ¨å°è£…çš„ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œå¦‚å…¶åï¼Œå¹¿æ’­ï¼Œå‘æ³¨å†Œçš„æ¥æ”¶è€…å¹¿æ’­ä¿¡æ¯</p><ul><li>æ ‡å‡†å¹¿æ’­ï¼šå¼‚æ­¥æ‰§è¡Œï¼Œæ‰€æœ‰æ¥å—å™¨å‡ ä¹åŒæ—¶æ”¶åˆ°ï¼Œæ— æ³•è¢«æ‹¦æˆª</li><li>æœ‰åºå¹¿æ’­ï¼šåŒæ­¥æ‰§è¡Œï¼Œæœ‰å…ˆåé¡ºåºï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ï¼Œå¯ä»¥è¢«æ‹¦æˆª</li></ul><h3 id="æ¥å—ç³»ç»Ÿå¹¿æ’­"><a href="#æ¥å—ç³»ç»Ÿå¹¿æ’­" class="headerlink" title="æ¥å—ç³»ç»Ÿå¹¿æ’­"></a>æ¥å—ç³»ç»Ÿå¹¿æ’­</h3><p>åœ¨androidç³»ç»Ÿå†…éƒ¨ä¼šæœ‰å·¨å¤šçš„å¹¿æ’­ï¼Œæ¥å‘å‘åº”ç”¨æ‰©æ•£é‡è¦ä¿¡æ¯ã€‚æ¯”å¦‚å¼€æœºï¼Œç½‘ç»œï¼Œsdå¡ç­‰ç­‰ã€‚</p><p>æƒ³è¦æ¥å—ç³»ç»Ÿå¹¿æ’­é¦–å…ˆéœ€è¦å®šä¹‰<code>å¹¿æ’­æ¥æ”¶å™¨</code>ï¼š</p><ul><li>é™æ€æ³¨å†Œï¼šåœ¨Manifestä¸­å£°æ˜å…³å¿ƒçš„å¹¿æ’­</li><li>åŠ¨æ€æ³¨å†Œï¼šé€šè¿‡ä»£ç å£°æ˜</li></ul><a id="more"></a><h4 id="å®šä¹‰å¹¿æ’­æ¥æ”¶å™¨"><a href="#å®šä¹‰å¹¿æ’­æ¥æ”¶å™¨" class="headerlink" title="å®šä¹‰å¹¿æ’­æ¥æ”¶å™¨"></a>å®šä¹‰å¹¿æ’­æ¥æ”¶å™¨</h4><p>ç»§æ‰¿<code>BroadcastReceiver</code>é‡å†™onReceiveå³å¯åˆ¤æ–­å¹¿æ’­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkChangeRecevier</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        ConnectivityManager connectivityManager = (ConnectivityManager)        getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line">        NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();</span><br><span class="line">        <span class="keyword">if</span> (networkInfo != <span class="keyword">null</span> &amp;&amp; networkInfo.isAvailable()) &#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>,<span class="string">"ç½‘ç»œå¯ç”¨"</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>,<span class="string">"ç½‘ç»œä¸å¯ç”¨"</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é™æ€æ³¨å†Œ"><a href="#é™æ€æ³¨å†Œ" class="headerlink" title="é™æ€æ³¨å†Œ"></a>é™æ€æ³¨å†Œ</h4><p>ç›´æ¥åœ¨Manifestä¸­ä¹¦å†™<code>receiver</code>æ ‡ç­¾ï¼ŒåŒå¦‚activityå’Œserviceï¼Œå†™å¥½<code>intent-filter</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//1ã€æ–°å»ºä¸€ä¸ªBroadcastReceiver</span><br><span class="line">//2ã€åœ¨åº”ç”¨é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®å¥½æƒé™ï¼Œä»¥åŠç›‘å¬çš„å¹¿æ’­</span><br><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">".BootCompleteReceiver"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.BOOT_COMPLETED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line">//enabledè¡¨ç¤ºæ˜¯å¦å¯ç”¨</span><br><span class="line">//exprotedè¡¨ç¤ºæ˜¯å¦æ¥å—åº”ç”¨ä»¥å¤–çš„å¹¿æ’­</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€æ³¨å†Œ"><a href="#åŠ¨æ€æ³¨å†Œ" class="headerlink" title="åŠ¨æ€æ³¨å†Œ"></a>åŠ¨æ€æ³¨å†Œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">intentFilter = <span class="keyword">new</span> IntentFilter();</span><br><span class="line">intentFilter.addAction(<span class="string">"android.net.conn.CONNECTIVITY_CHANGE"</span>);</span><br><span class="line">recevier = <span class="keyword">new</span> NetworkChangeRecevier();</span><br><span class="line">registerReceiver(recevier,intentFilter);</span><br></pre></td></tr></table></figure><p>åªæœ‰æ³¨å†Œå®Œä¹‹åæ‰èƒ½ç›‘å¬å¹¿æ’­ã€‚</p><p>è®°å¾—åœ¨å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸå–æ¶ˆæ³¨å†Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unregisterReceiver(recevier);</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰å¹¿æ’­"><a href="#è‡ªå®šä¹‰å¹¿æ’­" class="headerlink" title="è‡ªå®šä¹‰å¹¿æ’­"></a>è‡ªå®šä¹‰å¹¿æ’­</h3><p>éœ€è¦è‡ªè¡Œä¼ è¾¾æŸäº›æ¶ˆæ¯</p><h4 id="å‘é€æ ‡å‡†å¹¿æ’­"><a href="#å‘é€æ ‡å‡†å¹¿æ’­" class="headerlink" title="å‘é€æ ‡å‡†å¹¿æ’­"></a>å‘é€æ ‡å‡†å¹¿æ’­</h4><p>8.0åè‡ªå®šä¹‰å¹¿æ’­æ¥å—ä¸åˆ°è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ä½¿ç”¨åŠ¨æ€æ³¨å†Œ</li><li>é™æ€æ³¨å†Œï¼Œå‘é€å¹¿æ’­æ—¶æºå¸¦ComponentName</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1ã€æ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¹¿æ’­æ¥å—å™¨</span></span><br><span class="line"><span class="comment">//2ã€é™æ€æ³¨å†Œæ¥å—è‡ªå®šä¹‰çš„å¹¿æ’­</span></span><br><span class="line"><span class="comment">//3ã€å‘é€å¹¿æ’­</span></span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="string">"com.example.tt.MY_BROADCAST"</span>);</span><br><span class="line">Log.d(<span class="string">"button"</span>, <span class="string">"onClick: "</span>);</span><br><span class="line">intent.setComponent(<span class="keyword">new</span> ComponentName(<span class="string">"com.example.hujie2.broadcasttest"</span>,</span><br><span class="line">        <span class="string">"com.example.hujie2.broadcasttest.MyBroadcastReceiver"</span>));</span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure><h4 id="å‘é€æœ‰åºå¹¿æ’­"><a href="#å‘é€æœ‰åºå¹¿æ’­" class="headerlink" title="å‘é€æœ‰åºå¹¿æ’­"></a>å‘é€æœ‰åºå¹¿æ’­</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setOrderBroadcast(intent);</span><br><span class="line">Manifesté€šè¿‡è®¾ç½®android:priorityè®¾ç½®ä¼˜å…ˆçº§</span><br><span class="line">ä½¿ç”¨ abortBroadcast() æ‹¦æˆªå¹¿æ’­</span><br></pre></td></tr></table></figure><h4 id="ç²˜æ€§å¹¿æ’­"><a href="#ç²˜æ€§å¹¿æ’­" class="headerlink" title="ç²˜æ€§å¹¿æ’­"></a>ç²˜æ€§å¹¿æ’­</h4><p><strong>éœ€è¦é¢å¤–ç”³è¯·æƒé™</strong>åœ¨Androidç³»ç»Ÿç²˜æ€§å¹¿æ’­ä¸€èˆ¬ç”¨æ¥ç¡®ä¿é‡è¦çš„çŠ¶æ€æ”¹å˜åçš„ä¿¡æ¯è¢«æŒä¹…ä¿å­˜ï¼Œå¹¶ä¸”èƒ½éšæ—¶å¹¿æ’­ç»™æ–°çš„å¹¿æ’­æ¥æ”¶å™¨ä½¿ç”¨ï¼Œä½¿ç”¨isInitialStickyBroadcastæ¥åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªç²˜æ€§çš„åˆå§‹å¹¿æ’­å€¼ï¼Œæ¯”å¦‚æˆ‘é‡è§çš„è€³æœºæ’æ‹”çš„æ—¶å€™å°±å‡ºç°çš„ç²˜æ€§å¹¿æ’­ã€‚</p><p>å£°æ˜æƒé™</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BROADCAST_STICKY"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>å‘é€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sendStickyBroadcast(intent);<span class="comment">//å¥½åƒAPIå†™äº†åºŸå¼ƒã€‚ã€‚</span></span><br></pre></td></tr></table></figure><p>åˆ¤æ–­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isInitialStickyBroadcast()</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°å¹¿æ’­"><a href="#æœ¬åœ°å¹¿æ’­" class="headerlink" title="æœ¬åœ°å¹¿æ’­"></a>æœ¬åœ°å¹¿æ’­</h3><p>åªåœ¨æœ¬åœ°åº”ç”¨å®è¡Œçš„å¹¿æ’­ï¼Œå¦‚æœä¸éœ€è¦å‘å¤–éƒ¨å¹¿æ’­ï¼Œé‚£å°±ç”¨æœ¬åœ°å¹¿æ’­å’¯</p><p>å‘é€å’Œæ³¨å†Œæ–¹å¼ç•¥æœ‰ä¸åŒï¼Œé€šè¿‡è·å¾—<code>LocalBroadcastManager</code>å®ä¾‹æ¥ç®¡ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">localBroadcastManager = LocalBroadcastManager.getInstance(<span class="keyword">this</span>);<span class="comment">//æœ¬åœ°å¹¿æ’­ç®¡ç†å™¨</span></span><br><span class="line">Button button = findViewById(R.id.button2);</span><br><span class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="string">"MY.LocalBroadcast"</span>);<span class="comment">//æ„å›¾</span></span><br><span class="line">        localBroadcastManager.sendBroadcast(intent);<span class="comment">//å‘é€æœ¬åœ°å¹¿æ’­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">intentFilter = <span class="keyword">new</span> IntentFilter();<span class="comment">//æ„å›¾è¿‡æ»¤</span></span><br><span class="line">intentFilter.addAction(<span class="string">"MY.LocalBroadcast"</span>);<span class="comment">//è®¾ç½®ç›‘å¬å¹¿æ’­è¡Œä¸º</span></span><br><span class="line">localReceiver = <span class="keyword">new</span> LocalReceiver();<span class="comment">//è‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶å™¨</span></span><br><span class="line">localBroadcastManager.registerReceiver(localReceiver,intentFilter);<span class="comment">//æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨</span></span><br><span class="line">localBroadcastManager.unregisterReceiver(localReceiver);<span class="comment">//æ³¨é”€å¹¿æ’­æ¥å—å™¨</span></span><br></pre></td></tr></table></figure><h3 id="åç»­è¡¥å……"><a href="#åç»­è¡¥å……" class="headerlink" title="åç»­è¡¥å……"></a>åç»­è¡¥å……</h3><h2 id="å†…å®¹æä¾›å™¨"><a href="#å†…å®¹æä¾›å™¨" class="headerlink" title="å†…å®¹æä¾›å™¨"></a>å†…å®¹æä¾›å™¨</h2><h3 id="what-1"><a href="#what-1" class="headerlink" title="what"></a>what</h3><p>åœ¨andoridå¾€å¾€éœ€è¦è®¿é—®å…¶å®ƒåº”ç”¨çš„æ•°æ®å…±åŒåä½œã€‚é€šè¿‡å†…å®¹æä¾›å™¨çš„æ–¹å¼å®‰å…¨çš„æä¾›ç»™å…¶ä»–åº”ç”¨è®¿é—®ä¿®æ”¹æ•°æ®ã€‚æ¯”å¦‚è¯»å–é€šè®¯å½•ï¼Œè¯»å–MediaCenterçš„æ•°æ®ï¼Œä»–ä»¬éƒ½æ˜¯æš´éœ²é™¤äº†å†…å®¹æä¾›å™¨æ¥ä¾›å…¶å®ƒåº”ç”¨è®¿é—®æ•°æ®ã€‚å…¶å®ƒåº”ç”¨é€šè¿‡å†…å®¹è§£æå™¨è®¿é—®uriï¼Œå¦‚åŒè®¿é—®æ•°æ®åº“çš„æ–¹å¼ä¸€æ ·è®¿é—®ä¿®æ”¹æ•°æ®ã€‚</p><h3 id="FileContentProvider"><a href="#FileContentProvider" class="headerlink" title="FileContentProvider"></a>FileContentProvider</h3><p>ä»android 7.0å¼€å§‹ç›´æ¥ä½¿ç”¨<code>file://Uri</code>è¿™æ ·æš´åŠ›çš„ä¼ è¾¾æ–‡ä»¶è·¯å¾„è¿›è¡Œåˆ†äº«æ“ä½œå°†ä¸å¯ç”¨ï¼Œä¼šæŠ¥<code>FileUriExposedException</code>å¼‚å¸¸ï¼Œå¿…é¡»å¾—ç”¨<code>content://Uri</code>è¿™æ ·å¾—å½¢å¼æ¥è§£æåˆ†äº«æ–‡ä»¶çš„è·¯å¾„</p><h4 id="å£°æ˜FileContentProvider"><a href="#å£°æ˜FileContentProvider" class="headerlink" title="å£°æ˜FileContentProvider"></a>å£°æ˜FileContentProvider</h4><p>Manifestä¸­é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"android.support.v4.content.FileProvider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:authorities</span>=<span class="string">"appçš„åŒ…å.fileProvider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:grantUriPermissions</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"android.support.FILE_PROVIDER_PATHS"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:resource</span>=<span class="string">"@xml/file_paths"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="è·¯å¾„é…ç½®æ–‡ä»¶"><a href="#è·¯å¾„é…ç½®æ–‡ä»¶" class="headerlink" title="è·¯å¾„é…ç½®æ–‡ä»¶"></a>è·¯å¾„é…ç½®æ–‡ä»¶</h4><p>åœ¨xmlèµ„æºæ–‡ä»¶å¤¹ä¸‹åˆ›é”®file_paths.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//æ¯ä¸ªèŠ‚ç‚¹éƒ½æ”¯æŒä¸¤ä¸ªå±æ€§ï¼šname+path</span><br><span class="line">//pathï¼šéœ€è¦ä¸´æ—¶æˆæƒè®¿é—®çš„è·¯å¾„ï¼ˆ.ä»£è¡¨æ‰€æœ‰è·¯å¾„ï¼‰ </span><br><span class="line">//nameï¼šå°±æ˜¯ä½ ç»™è¿™ä¸ªè®¿é—®è·¯å¾„èµ·ä¸ªåå­—</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root-path</span> <span class="attr">name</span>=<span class="string">"root"</span> <span class="attr">path</span>=<span class="string">""</span> /&gt;</span> //ä»£è¡¨è®¾å¤‡çš„æ ¹ç›®å½•new File("/");</span><br><span class="line">    <span class="tag">&lt;<span class="name">files-path</span> <span class="attr">name</span>=<span class="string">"files"</span> <span class="attr">path</span>=<span class="string">""</span> /&gt;</span> //context.getFilesDir()</span><br><span class="line">    <span class="tag">&lt;<span class="name">cache-path</span> <span class="attr">name</span>=<span class="string">"cache"</span> <span class="attr">path</span>=<span class="string">""</span> /&gt;</span> //context.getCacheDir()</span><br><span class="line">    <span class="tag">&lt;<span class="name">external-path</span> <span class="attr">name</span>=<span class="string">"external"</span> <span class="attr">path</span>=<span class="string">""</span> /&gt;</span> //Environment.getExternalStorageDirectory()</span><br><span class="line">    <span class="tag">&lt;<span class="name">external-files-path</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">path</span>=<span class="string">"path"</span> /&gt;</span> //context.getExternalFilesDirs()</span><br><span class="line">    <span class="tag">&lt;<span class="name">external-cache-path</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">path</span>=<span class="string">"path"</span> /&gt;</span> //getExternalCacheDirs()</span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">    Uri uri = FileProvider.getUriForFile(CameraActivity.<span class="keyword">this</span>, <span class="string">"appçš„åŒ…å.fileProvider"</span>, photoFile);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Uri uri = Uri.fromFile(photoFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡è¿™æ ·çš„åŒ…è£…å½¢æˆuri:<code>content://appçš„åŒ…å/files/path/æ–‡ä»¶</code> å°±å¯ä»¥åŒ¹é…åˆ°å…·ä½“å®é™…è·¯å¾„äº†</p><h3 id="è®¿é—®åº”ç”¨æ•°æ®"><a href="#è®¿é—®åº”ç”¨æ•°æ®" class="headerlink" title="è®¿é—®åº”ç”¨æ•°æ®"></a>è®¿é—®åº”ç”¨æ•°æ®</h3><p>android çš„è®¸å¤šæ•°æ®éƒ½å¯ä»¥è·å¾—ï¼Œä½†æ˜¯è¦ç”³è¯·æƒé™</p><p>æ¯”å¦‚ï¼šé€šè®¯å½•ï¼ŒçŸ­ä¿¡ï¼Œå„ç§ç±»åˆ«çš„æ–‡ä»¶</p><h4 id="å‡†å¤‡uri"><a href="#å‡†å¤‡uri" class="headerlink" title="å‡†å¤‡uri"></a>å‡†å¤‡uri</h4><p>apiçš„ç±»ä¸€èˆ¬éƒ½ä¼šæš´éœ²uriï¼Œæ¯”å¦‚ï¼š<code>MediaStore.Files.getContentUri(&quot;external&quot;)</code> </p><h5 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">context.getContentResolver().query();</span><br><span class="line">context.getContentResolver().insert();</span><br><span class="line">context.getContentResolver().delete();</span><br><span class="line">context.getContentResolver().update();</span><br></pre></td></tr></table></figure><p>å°±å’Œæ“ä½œæ•°æ®åº“ä¸€æ ·ï¼Œå› ä¸ºå†…å®¹æä¾›å™¨æœ¬èº«å°±æ˜¯ç›¸å½“äºåŒ…è£…äº†ä¸€å±‚æ•°æ®åº“è®¿é—®æ“ä½œã€‚</p><h3 id="è‡ªå®šä¹‰å†…å®¹æä¾›å™¨"><a href="#è‡ªå®šä¹‰å†…å®¹æä¾›å™¨" class="headerlink" title="è‡ªå®šä¹‰å†…å®¹æä¾›å™¨"></a>è‡ªå®šä¹‰å†…å®¹æä¾›å™¨</h3><h4 id="è‡ªç„¶è¿˜æ˜¯è¦Manifestå£°æ˜"><a href="#è‡ªç„¶è¿˜æ˜¯è¦Manifestå£°æ˜" class="headerlink" title="è‡ªç„¶è¿˜æ˜¯è¦Manifestå£°æ˜"></a>è‡ªç„¶è¿˜æ˜¯è¦Manifestå£°æ˜</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:name</span>=<span class="string">".provider.MyContentProvider"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:authorities</span>=<span class="string">"com.my.demo.provider"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:exported</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç»§æ‰¿å®ç°"><a href="#ç»§æ‰¿å®ç°" class="headerlink" title="ç»§æ‰¿å®ç°"></a>ç»§æ‰¿å®ç°</h4><p>æ„Ÿè§‰æ˜¯å›ºå®šä»£ç ï¼Œå†…éƒ¨è®¿é—®æ•°æ®åº“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.hujie2.filepersistencetest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.ContentProvider;</span><br><span class="line"><span class="keyword">import</span> android.content.ContentValues;</span><br><span class="line"><span class="keyword">import</span> android.content.UriMatcher;</span><br><span class="line"><span class="keyword">import</span> android.database.Cursor;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseContentProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BOOK_DIR = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BOOK_ITEM = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CATEGORY_DIR = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CATEGORY_ITEM = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AUTHORITY = <span class="string">"com.example.hujie2.filepersistencetest.provider"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> UriMatcher uriMatcher;</span><br><span class="line">    <span class="keyword">private</span>  MyDatabaseHelper dbHelper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//uriåŒ¹é…</span></span><br><span class="line">        uriMatcher = <span class="keyword">new</span> UriMatcher(UriMatcher.NO_MATCH);</span><br><span class="line">        uriMatcher.addURI(AUTHORITY, <span class="string">"book"</span>, BOOK_DIR);</span><br><span class="line">        uriMatcher.addURI(AUTHORITY, <span class="string">"book/#"</span>, BOOK_ITEM);</span><br><span class="line">        uriMatcher.addURI(AUTHORITY, <span class="string">"category"</span>, CATEGORY_DIR);</span><br><span class="line">        uriMatcher.addURI(AUTHORITY, <span class="string">"category/#"</span>, CATEGORY_ITEM);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DatabaseContentProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å¾—æ•°æ®åº“è¾…åŠ©ç±»å¯¹è±¡</span></span><br><span class="line">        dbHelper = <span class="keyword">new</span> MyDatabaseHelper(getContext(), <span class="string">"BookStore.db"</span>, <span class="keyword">null</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cursor <span class="title">query</span><span class="params">(Uri uri, String[] projection, String selection,</span></span></span><br><span class="line"><span class="function"><span class="params">                        String[] selectionArgs, String sortOrder)</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase db = dbHelper.getReadableDatabase();</span><br><span class="line">        Cursor cursor = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> BOOK_DIR:</span><br><span class="line">                cursor = db.query(<span class="string">"book"</span>, projection, selection, selectionArgs, <span class="keyword">null</span>, <span class="keyword">null</span>, sortOrder);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> BOOK_ITEM:</span><br><span class="line">                String bookId = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                cursor = db.query(<span class="string">"book"</span>, projection, <span class="string">"id = ?"</span>, <span class="keyword">new</span> String[]&#123;bookId&#125;, <span class="keyword">null</span>, <span class="keyword">null</span>, sortOrder);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_DIR:</span><br><span class="line">                cursor = db.query(<span class="string">"category"</span>, projection, selection, selectionArgs, <span class="keyword">null</span>, <span class="keyword">null</span>, sortOrder);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_ITEM:</span><br><span class="line">                String categoryId = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                cursor = db.query(<span class="string">"category"</span>, projection, <span class="string">"id = ?"</span>, <span class="keyword">new</span> String[]&#123;categoryId&#125;, <span class="keyword">null</span>, <span class="keyword">null</span>, sortOrder);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cursor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Uri <span class="title">insert</span><span class="params">(Uri uri, ContentValues values)</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line">        Uri uriReturn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> BOOK_DIR:</span><br><span class="line">            <span class="keyword">case</span> BOOK_ITEM:</span><br><span class="line">                <span class="keyword">long</span> newBookId = db.insert(<span class="string">"book"</span>, <span class="keyword">null</span>, values);</span><br><span class="line">                uriReturn = Uri.parse(<span class="string">"content://"</span> + AUTHORITY + <span class="string">"/book/"</span> + newBookId);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_DIR:</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_ITEM:</span><br><span class="line">                <span class="keyword">long</span> newCategoryId = db.insert(<span class="string">"category"</span>, <span class="keyword">null</span>, values);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uriReturn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(Uri uri, ContentValues values, String selection,</span></span></span><br><span class="line"><span class="function"><span class="params">                      String[] selectionArgs)</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line">        <span class="keyword">int</span> updatedRows = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> BOOK_DIR:</span><br><span class="line">                updatedRows = db.update(<span class="string">"book"</span>, values, selection, selectionArgs);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> BOOK_ITEM:</span><br><span class="line">                String bookId = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                updatedRows = db.update(<span class="string">"book"</span>, values, <span class="string">"id = ?"</span>, <span class="keyword">new</span> String[]&#123;bookId&#125;);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_DIR:</span><br><span class="line">                updatedRows = db.update(<span class="string">"category"</span>, values, selection, selectionArgs);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_ITEM:</span><br><span class="line">                String categoryId = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                updatedRows = db.update(<span class="string">"category"</span>, values, <span class="string">"id = ?"</span>, <span class="keyword">new</span> String[]&#123;categoryId&#125;);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> updatedRows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(Uri uri, String selection, String[] selectionArgs)</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase db = dbHelper.getWritableDatabase();</span><br><span class="line">        <span class="keyword">int</span> deletedRows = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> BOOK_DIR:</span><br><span class="line">                deletedRows = db.delete(<span class="string">"book"</span>, selection, selectionArgs);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> BOOK_ITEM:</span><br><span class="line">                String bookId = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                deletedRows = db.delete(<span class="string">"book"</span>, <span class="string">"id = ?"</span>, <span class="keyword">new</span> String[]&#123;bookId&#125;);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_DIR:</span><br><span class="line">                deletedRows = db.delete(<span class="string">"category"</span>, selection, selectionArgs);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_ITEM:</span><br><span class="line">                String categoryId = uri.getPathSegments().get(<span class="number">1</span>);</span><br><span class="line">                deletedRows = db.delete(<span class="string">"category"</span>, <span class="string">"id = ?"</span>, <span class="keyword">new</span> String[]&#123;categoryId&#125;);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> deletedRows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">(Uri uri)</span> </span>&#123;</span><br><span class="line">        String vndDir = <span class="string">"vnd.android.cursor.dir/"</span>;</span><br><span class="line">        String vndItem = <span class="string">"vnd.android.cursor.item/"</span>;</span><br><span class="line">        <span class="keyword">switch</span> (uriMatcher.match(uri)) &#123;</span><br><span class="line">            <span class="keyword">case</span> BOOK_DIR:</span><br><span class="line">                <span class="keyword">return</span> vndDir + <span class="string">"vnd."</span> + AUTHORITY + <span class="string">".book"</span>;</span><br><span class="line">            <span class="keyword">case</span> BOOK_ITEM:</span><br><span class="line">                <span class="keyword">return</span> vndItem + <span class="string">"vnd."</span> + AUTHORITY + <span class="string">".book"</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_DIR:</span><br><span class="line">                <span class="keyword">return</span> vndDir + <span class="string">"vnd."</span> + AUTHORITY + <span class="string">".category"</span>;</span><br><span class="line">            <span class="keyword">case</span> CATEGORY_ITEM:</span><br><span class="line">                <span class="keyword">return</span> vndItem + <span class="string">"vnd."</span> + AUTHORITY + <span class="string">".category"</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºHandleræ¶ˆæ¯æœºåˆ¶æ¢³ç†</title>
      <link href="/2019/07/07/Android-%E5%85%B3%E4%BA%8EHandler%E7%AD%89/"/>
      <url>/2019/07/07/Android-%E5%85%B3%E4%BA%8EHandler%E7%AD%89/</url>
      
        <content type="html"><![CDATA[<h3 id="what"><a href="#what" class="headerlink" title="what"></a>what</h3><p>åœ¨Androidå¼€å‘ä¸­ï¼ŒHanldleræ¶ˆæ¯æœºåˆ¶å¯ä»¥è¯´æ— å¤„ä¸åœ¨ï¼Œä¸»çº¿ç¨‹çš„è°ƒåº¦ï¼ŒViewï¼Œä»»åŠ¡æäº¤ï¼ŒIntentServiceï¼ŒMessagerä¸­éƒ½å‡ºç°äº†ï¼Œå¯è°“æ— å¤„ä¸åœ¨ã€‚handleræ¶ˆæ¯å‘æŒ¥ä½œç”¨çš„åŒ…å«äº†ï¼šHandlerï¼ŒLooperï¼ŒMessageï¼ŒMessagerQueueï¼Œè¿™å››ä¸ªé‡è¦ç»„æˆã€‚Handlerå‘é€æ¶ˆæ¯ï¼ŒLooperå¼€å¯è½®è¯¢ä»MessageQueueä¸­è·å–æ¶ˆæ¯ï¼Œäº¤ç”±Handlerå¤„ç†ã€‚</p><h3 id="how"><a href="#how" class="headerlink" title="how"></a>how</h3><p>è¿˜æ˜¯ä»ä¸€ä¸ªä½¿ç”¨è€…è§’åº¦å…ˆäº†è§£ï¼Œå…·ä½“æ€ä¹ˆç”¨Handlerå§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler(Looper.getMainLooper())&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    doSomeThing();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    doSomeThing();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mHandler.sendEmptyMessage(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›é”®Handlerå¯¹è±¡ï¼Œä¼ å…¥Looperï¼Œå‘é€æ¶ˆæ¯ã€‚å†Hanlderå†…éƒ¨å¤„ç†æ¶ˆæ¯ï¼Œå½“ç„¶è¿˜å¯ä»¥ç›´æ¥å‘é€Runnableï¼Œæˆ–è€…åŠ å…¥å»¶æ—¶ç­‰ã€‚ç”¨æ³•å°±è¿™ä¹ˆç®€å•ã€‚ä¸‹é¢è¿˜æ˜¯å…·ä½“ä»‹ç»å§</p><a id="more"></a><h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><p>å¯ä»¥å‘é€æ¶ˆæ¯å’Œå¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥æœ‰å¾ˆå¤šä¸ªå®ä¾‹ï¼Œå…·ä½“æ ¹æ®æ¶ˆæ¯æ¥åˆ†è¾¨å¤„ç†ã€‚</p><p>å®ƒçš„æˆå‘˜åŒ…æ‹¬äº†Looperï¼ŒMessageQueueï¼ŒCallback</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¸¸ç”¨apiï¼Œä»¥åŠåŠ ä¸Šå»¶æ—¶ç­‰</span></span><br><span class="line">post(Runnable);<span class="comment">//æäº¤ä»»åŠ¡</span></span><br><span class="line">sendMessage(Message);<span class="comment">//æäº¤æ¶ˆæ¯</span></span><br><span class="line">handleMessage(Message);<span class="comment">//å¤„ç†æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬ä½¿ç”¨Handleræœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€èˆ¬æ˜¯éœ€è¦ä¼ å…¥Looperï¼Œå¦‚æœä¸åˆ™é»˜è®¤ä¼ å…¥å½“å‰çº¿ç¨‹çš„Looper</p><ul><li>æ‰©å±•Handlerï¼Œé‡å†™handleMessage</li><li>ä¼ å…¥å›è°ƒï¼Œå›è°ƒä¹Ÿåªéœ€è¦å®ç°handleMessage</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ€ç»ˆè¢«è°ƒç”¨çš„æ„é€ å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Looper looper, Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</span><br><span class="line">        mLooper = looper;<span class="comment">//looper</span></span><br><span class="line">        mQueue = looper.mQueue;<span class="comment">//looperçš„messagequeue</span></span><br><span class="line">        mCallback = callback;<span class="comment">//å›è°ƒå½¢å¼å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">        mAsynchronous = async;<span class="comment">//å¼€å¯å‘é€å¼‚æ­¥æ¶ˆæ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Looper"><a href="#Looper" class="headerlink" title="Looper"></a>Looper</h3><p>è¿™ä¸ªçš„è¯ç®¡ä»–å«è½®è¯¢ï¼Œåæ­£æ˜¯æœ‰å¾ªç¯çš„æ„æ€ã€‚é¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªThreadLocalå˜é‡ï¼Œä¿è¯äº†æ¯ä¸ªçº¿ç¨‹é—´ç‹¬ç«‹è¿è¡Œï¼Œå†è€Œå®ƒçš„è¯å°±æ˜¯ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œè½¬äº¤åˆ°Handlerå¤„ç†</p><p>å®ƒçš„æˆå‘˜åŒ…æ‹¬äº†ThreadLocalï¼ŒMessageQueueï¼ŒThreadã€‚</p><p>çœ‹ä¸‹é‡è¦api</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">prepare();<span class="comment">//è·å–çº¿ç¨‹æœ¬åœ°Looperå®ä¾‹</span></span><br><span class="line">loop();<span class="comment">//è¿›å…¥è½®è¯¢</span></span><br><span class="line">quit();<span class="comment">//é€€å‡º</span></span><br><span class="line">getMainLooper();<span class="comment">//è·å¾—ä¸»çº¿ç¨‹Looper</span></span><br></pre></td></tr></table></figure><h3 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h3><p>å°è£…äº†æ¶ˆæ¯ç ï¼Œè§¦å‘æ—¶æœºï¼Œrunnableï¼Œç›®æ ‡handlerçš„æ¶ˆæ¯ï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªé•¿åº¦50ä¸æ–­å¤ç”¨çš„æ¶ˆæ¯æ± ï¼ˆé“¾è¡¨ç»“æ„ï¼‰ï¼Œæ¶ˆæ¯åˆ†ä¸ºå¼‚æ­¥å’ŒåŒæ­¥</p><p>çœ‹ä¸‹é‡è¦api</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Message.obtain();<span class="comment">//ä»æ± é‡Œè·å¾—æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><h3 id="MessageQueue"><a href="#MessageQueue" class="headerlink" title="MessageQueue"></a>MessageQueue</h3><p>å°¾æ’æ³•å®ç°çš„æ¶ˆæ¯é“¾è¡¨ï¼Œå¼‚æ­¥æ¶ˆæ¯ä¼˜å…ˆå‡ºï¼Œç§°ä¹‹ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†æ˜¯ä¸æ˜¯é‚£ä¸ªæ“ä½œç³»ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—å•Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">next();<span class="comment">//æ‹¿å–æ¶ˆæ¯</span></span><br><span class="line">quit();<span class="comment">//é€€å‡º</span></span><br><span class="line">enqueueMessage();<span class="comment">//å…¥æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><h3 id="ä»æºç æ¥è§’åº¦å†æ¢æ"><a href="#ä»æºç æ¥è§’åº¦å†æ¢æ" class="headerlink" title="ä»æºç æ¥è§’åº¦å†æ¢æ"></a>ä»æºç æ¥è§’åº¦å†æ¢æ</h3><p>æœ¬æ¥å‘ä»ä¸»çº¿ç¨‹æ¥åˆ†æçš„ï¼Œä½†æ˜¯å¥½åƒä¸æ€ä¹ˆå®Œæ•´ï¼Œé‚£å°±ç”¨HandlerTreadæ¥åˆ†æå§ï¼Œè¿™ä¸ªå°±éå¸¸å®Œæ•´äº†</p><h4 id="HandlerThread"><a href="#HandlerThread" class="headerlink" title="HandlerThread"></a>HandlerThread</h4><p>é¦–å…ˆè¿™æ˜¯ä¸€ä¸ªThreadï¼Œå†…éƒ¨å®ç°äº†Handleræ¶ˆæ¯æœºåˆ¶ï¼Œå³å¯ä»¥é€šè¿‡Handleræ¥è¿›è¡Œæäº¤ä»»åŠ¡å’Œæ¶ˆæ¯åˆ°çº¿ç¨‹ä¸­è¿è¡Œã€‚</p><p>å…ˆçœ‹ä¸‹æ˜¯æ€ä¹ˆç”¨çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HandlerThread handlerThread = <span class="keyword">new</span> HandlerThread(<span class="string">"test"</span>);<span class="comment">//åˆ›é”®HandlerThread</span></span><br><span class="line">handlerThrad.start();<span class="comment">//å¼€å¯çº¿ç¨‹</span></span><br><span class="line">Handler handler = <span class="keyword">new</span> Handler(handlerThread.getLooper());<span class="comment">//å…³è”Handler</span></span><br><span class="line">handler.post(()-&gt; System.out.println(<span class="string">"run1"</span>));<span class="comment">//æäº¤ä»»åŠ¡æˆ–è€…æ¶ˆæ¯</span></span><br><span class="line">handler.sendEmptyMessage(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>ç”¨å°±æ˜¯è¿™ä¹ˆç”¨çš„ã€‚åŸç†å°±æ˜¯handleræäº¤æ¶ˆæ¯ï¼ŒHandlerThreadçº¿ç¨‹å¼€å¯è½®è¯¢ï¼Œåˆ†å‘æ¶ˆæ¯ï¼Œå¤„ç†ã€‚</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥åˆ†ææºç äº†ï¼š</p><h4 id="HandlerThreadæ„é€ "><a href="#HandlerThreadæ„é€ " class="headerlink" title="HandlerThreadæ„é€ "></a>HandlerThreadæ„é€ </h4><p>é¦–å…ˆè¿›å…¥HandlerThreadæ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HandlerThread</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        mPriority = Process.THREAD_PRIORITY_DEFAULT;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HandlerThread</span><span class="params">(String name, <span class="keyword">int</span> priority)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        mPriority = priority;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°±èµ·äº†ä¸ªåå­—è€Œå·²</span></span><br></pre></td></tr></table></figure><h4 id="HandlerThreadè¿›å…¥run"><a href="#HandlerThreadè¿›å…¥run" class="headerlink" title="HandlerThreadè¿›å…¥run"></a>HandlerThreadè¿›å…¥run</h4><p>æ¥ç€çº¿ç¨‹å¼€å¯è¿›å…¥runæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HandlerThread.run</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mTid = Process.myTid();<span class="comment">//è·å–è¿›ç¨‹PID</span></span><br><span class="line">    Looper.prepare();<span class="comment">//Looperå‡†å¤‡</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        mLooper = Looper.myLooper();<span class="comment">//è·å–Looper</span></span><br><span class="line">        notifyAll();<span class="comment">//å”¤é†’</span></span><br><span class="line">    &#125;</span><br><span class="line">    Process.setThreadPriority(mPriority);</span><br><span class="line">    onLooperPrepared();<span class="comment">//å›æ‰</span></span><br><span class="line">    Looper.loop();<span class="comment">//è¿›å…¥Looperè½®è¯¢</span></span><br><span class="line">    mTid = -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨runæ–¹æ³•ä¸­ç­‰äºè¯´å‡†å¤‡looperï¼Œè¿›å…¥è½®è¯¢</p><h4 id="å‡†å¤‡Looper"><a href="#å‡†å¤‡Looper" class="headerlink" title="å‡†å¤‡Looper"></a>å‡†å¤‡Looper</h4><p>æ¥ç€çœ‹ä¸‹å¦‚ä½•å‡†å¤‡Looperå’Œè·å¾—Looperçš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Looper.prepare</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    prepare(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));<span class="comment">//åˆ›é”®æœ¬çº¿ç¨‹çš„Looper</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿™é‡Œå°±æ˜¯å…¥å‡†å¤‡æœ¬çº¿ç¨‹çš„Looper</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Looper.myLooper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="meta">@Nullable</span> <span class="function">Looper <span class="title">myLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sThreadLocal.get();<span class="comment">//è·å¾—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿›å…¥Looperè½®è¯¢"><a href="#è¿›å…¥Looperè½®è¯¢" class="headerlink" title="è¿›å…¥Looperè½®è¯¢"></a>è¿›å…¥Looperè½®è¯¢</h4><p>æ¥ä¸‹å°±æ˜¯é‡å¤´æˆäº†ï¼Œè¿›å…¥è½®è¯¢ï¼ŒæŒ‘å…³é”®ä»£ç çœ‹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Looper.loop</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Looper me = myLooper();<span class="comment">//è·å–looper</span></span><br><span class="line">    <span class="keyword">if</span> (me == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> MessageQueue queue = me.mQueue;<span class="comment">//è·å–MessageQueue</span></span><br><span class="line">    <span class="comment">//...çœç•¥</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Message msg = queue.next(); <span class="comment">// might blockï¼Œä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼Œä¹Ÿè®¸é˜»å¡</span></span><br><span class="line">        <span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">            <span class="keyword">return</span>;<span class="comment">//æ²¡æœ‰æ¶ˆæ¯åˆ™ä»£è¡¨é˜Ÿåˆ—é€€å‡ºäº†</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//...çœç•¥</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            msg.target.dispatchMessage(msg);<span class="comment">//äº¤ç”±ç»™Handleråˆ†å‘æ¶ˆæ¯</span></span><br><span class="line">            dispatchEnd = needEndTime ? SystemClock.uptimeMillis() : <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (traceTag != <span class="number">0</span>) &#123;</span><br><span class="line">                Trace.traceEnd(traceTag);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//...çœç•¥</span></span><br><span class="line">        msg.recycleUnchecked();<span class="comment">//å›æ”¶æ¶ˆæ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªè¿‡ç¨‹ä¹Ÿè¿˜å¥½ç†è§£ï¼Œå¼€å¯æ­»å¾ªç¯ï¼Œä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¸æ–­çš„æ‹¿å»æ¶ˆæ¯ï¼Œç„¶åç”±æ¶ˆæ¯ç›®æ ‡ handlerè¿›è¡Œåˆ†å‘å¤„ç†ã€‚</p><p>æ¥ä¸‹æˆ‘å…ˆçœ‹ç®€å•çš„handlerå¦‚ä½•åˆ†å‘å¤„ç†æ¶ˆæ¯çš„ã€‚å¾…ä¼šå†çœ‹å¦‚ä½•è·å–æ¶ˆæ¯çš„</p><h4 id="æ¶ˆæ¯å¤„ç†"><a href="#æ¶ˆæ¯å¤„ç†" class="headerlink" title="æ¶ˆæ¯å¤„ç†"></a>æ¶ˆæ¯å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Handler.dispatchMessage</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//çœ‹æ¶ˆæ¯æœ¬çœæ˜¯å¦æœ‰å›æ‰å¤„ç†ï¼Œé¢ï¼Œè¿™ä¸ªcallbackç±»å‹å…¶å®æ˜¯Runnableï¼Œå…¶å®å°±æ˜¯çœ‹çœ‹è¿™ä¸ªæ¶ˆæ¯æ˜¯ä¸æ˜¯Runnableç±»å‹</span></span><br><span class="line">        handleCallback(msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;<span class="comment">//äº¤ç”±åˆ›é”®å›è°ƒhandleMessageçš„å¤„ç†æ¶ˆæ¯ï¼Œä¹Ÿå°±å®ç°çš„handleMessage</span></span><br><span class="line">            <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        handleMessage(msg);<span class="comment">//äº¤ç”±æœ¬çœçš„handleMessageå¤„ç†ï¼Œä¹Ÿå°±æ˜¯æ‰©å±•çš„handleMessage</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handleCallback</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">    message.callback.run();<span class="comment">//ç›´æ¥è°ƒç”¨runnableçš„runæ–¹æ³•ï¼Œå®Œæˆæäº¤ä»»åŠ¡çš„run</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†å‘æ¶ˆæ¯æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆåˆ¤æ–­è¿™ä¸ªæ¶ˆæ¯æ˜¯å¦æ˜¯Runnableç±»å‹ï¼Œæ˜¯åˆ™ç›´æ¥è°ƒrunï¼Œä¸æ˜¯çš„åœ¨çœ‹æ˜¯ç”±æœ¬èº«çš„handleMessageå¤„ç†è¿˜æ˜¯å›è°ƒçš„handleMessageå¤„ç†ã€‚</p><h4 id="å–å‡ºæ¶ˆæ¯"><a href="#å–å‡ºæ¶ˆæ¯" class="headerlink" title="å–å‡ºæ¶ˆæ¯"></a>å–å‡ºæ¶ˆæ¯</h4><p>æ¥ç€å°±çœ‹å¦‚ä½•è·å–æ¶ˆæ¯çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MessageQueue.next</span></span><br><span class="line"><span class="function">Message <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Return here if the message loop has already quit and been disposed.</span></span><br><span class="line">    <span class="comment">// This can happen if the application tries to restart a looper after quit</span></span><br><span class="line">    <span class="comment">// which is not supported.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> ptr = mPtr;</span><br><span class="line">    <span class="keyword">if</span> (ptr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> pendingIdleHandlerCount = -<span class="number">1</span>; <span class="comment">// -1 only during first iteration</span></span><br><span class="line">    <span class="keyword">int</span> nextPollTimeoutMillis = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;<span class="comment">//å¾ªç¯å»æ‹¿å‡ºåˆé€‚æ—¶æœºæ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">if</span> (nextPollTimeoutMillis != <span class="number">0</span>) &#123;</span><br><span class="line">            Binder.flushPendingCommands();</span><br><span class="line">        &#125;</span><br><span class="line">   <span class="comment">//Linuxçš„ç®¡é“åŸºç¡€ä¸Šçš„ï¼Œç©ºé—²ç­‰å¾…nextPollTimeoutMillisï¼Œå’Œä¼ ç»Ÿçš„é˜»å¡ä¸ä¸€æ ·ï¼Œ</span></span><br><span class="line">        <span class="comment">//nextPollTimeoutMillisè¿™ä¸ªæ—¶é—´åˆ™æ˜¯æ¶ˆæ¯å»¶æ—¶æ—¶é—´</span></span><br><span class="line">        nativePollOnce(ptr, nextPollTimeoutMillis);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="comment">// Try to retrieve the next message.  Return if found.</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">long</span> now = SystemClock.uptimeMillis();</span><br><span class="line">            Message prevMsg = <span class="keyword">null</span>;</span><br><span class="line">            Message msg = mMessages;</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="keyword">null</span> &amp;&amp; msg.target == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Stalled by a barrier.  Find the next asynchronous message in the queue.</span></span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    prevMsg = msg;</span><br><span class="line">                    msg = msg.next;</span><br><span class="line">                &#125; <span class="keyword">while</span> (msg != <span class="keyword">null</span> &amp;&amp; !msg.isAsynchronous());<span class="comment">//ä¼˜å…ˆå‡ºå¼‚æ­¥æ¶ˆæ¯</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (now &lt; msg.when) &#123;</span><br><span class="line">                    <span class="comment">// Next message is not ready.  Set a timeout to wake up when it is ready.</span></span><br><span class="line">                    <span class="comment">//æ¶ˆæ¯æ²¡æœ‰å‡†å¤‡å¥½è¿è¡Œï¼Œè®¾å®šäº†å»¶æ—¶æ‰§è¡Œï¼Œè®¡ç®—å‡ºå»¶æ—¶æ—¶é—´ï¼Œç©ºé—²ç­‰å¾…</span></span><br><span class="line">                    nextPollTimeoutMillis = (<span class="keyword">int</span>) Math.min(msg.when - now, Integer.MAX_VALUE);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//æ¶ˆæ¯å‡†å¤‡å¥½äº†ï¼Œå‡ºæ¶ˆæ¯</span></span><br><span class="line">                    <span class="comment">// Got a message.</span></span><br><span class="line">                    mBlocked = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (prevMsg != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        prevMsg.next = msg.next;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        mMessages = msg.next;</span><br><span class="line">                    &#125;</span><br><span class="line">                    msg.next = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">if</span> (DEBUG) Log.v(TAG, <span class="string">"Returning message: "</span> + msg);</span><br><span class="line">                    msg.markInUse();</span><br><span class="line">                    <span class="keyword">return</span> msg;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// No more messages.æ²¡æœ‰æ¶ˆæ¯</span></span><br><span class="line">                nextPollTimeoutMillis = -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Process the quit message now that all pending messages have been handled.</span></span><br><span class="line">            <span class="keyword">if</span> (mQuitting) &#123;</span><br><span class="line">                dispose();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...çœç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MessageQueueä¸­nextä¸­è¿›å…¥æ­»å¾ªç¯è·å–æ¶ˆæ¯ï¼Œä»é˜Ÿåˆ—ä¸­å»æ‹¿å»æ¶ˆæ¯ï¼Œéå†é˜Ÿåˆ—æ¶ˆæ¯ï¼Œé˜Ÿåˆ—çš„æ¶ˆæ¯æ˜¯æŒ‰ç…§æ‰§è¡Œæ—¶åˆ»ä»å°åˆ°å¤§æ’åˆ—çš„ï¼Œæ ¹æ®å½“å‰æ—¶åˆ»å–å‡ºè¯¥æ‰§è¡Œçš„æ¶ˆæ¯ï¼ˆä¼˜å…ˆå–å¼‚æ­¥æ¶ˆæ¯ï¼‰ï¼Œå¦‚æœæ—¶æœºæœªåˆ°åˆ™ä¼šè¿›å…¥ç©ºé—²ç­‰å¾…(åŸºäºlinuxçš„ç®¡é“)ã€‚ç­‰åˆ°äº†æ—¶æœºåˆ™ä¼šå–å‡ºæ¶ˆæ¯ã€‚</p><p>è¿™ä¸€è·¯ä¸‹æ¥ä»Looperè½®è¯¢ï¼Œæ¶ˆæ¯å–å‡ºï¼Œæ¶ˆæ¯æ‰§è¡Œçš„æ­¥éª¤ã€‚</p><p>æ¥ä¸‹çœ‹çœ‹æ˜¯å¦‚ä½•æäº¤æ¶ˆæ¯çš„</p><h4 id="æ„å»ºæ¶ˆæ¯"><a href="#æ„å»ºæ¶ˆæ¯" class="headerlink" title="æ„å»ºæ¶ˆæ¯"></a>æ„å»ºæ¶ˆæ¯</h4><p>æ„å»ºæ¶ˆæ¯ï¼Œé¦–å…ˆä»æ¶ˆæ¯å¤ç”¨æ± æ‹¿å»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Message.obtain</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title">obtain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sPool != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//é“¾è¡¨å’¯</span></span><br><span class="line">            Message m = sPool;</span><br><span class="line">            sPool = m.next;</span><br><span class="line">            m.next = <span class="keyword">null</span>;</span><br><span class="line">            m.flags = <span class="number">0</span>; <span class="comment">// clear in-use flag</span></span><br><span class="line">            sPoolSize--;</span><br><span class="line">            <span class="keyword">return</span> m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Message();<span class="comment">//æ± ä¸ºç©ºåˆ™æ–°å»º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æäº¤æ¶ˆæ¯"><a href="#æäº¤æ¶ˆæ¯" class="headerlink" title="æäº¤æ¶ˆæ¯"></a>æäº¤æ¶ˆæ¯</h4><p>æ¥ç€Handleræäº¤æ¶ˆæ¯ï¼Œæ— è®ºæ˜¯runnableæ¶ˆæ¯ï¼Œæˆ–è€…ç©ºæ¶ˆæ¯ï¼Œæˆ–è€…å…¶å®ƒçš„æ¶ˆæ¯ï¼Œæˆ–è€…å¸¦å»¶æ—¶çš„ï¼Œæœ€ç»ˆsendMessageAtTime</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Handler.sendMessageAtTime</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">        MessageQueue queue = mQueue;</span><br><span class="line">        <span class="keyword">if</span> (queue == <span class="keyword">null</span>) &#123;</span><br><span class="line">            RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                    <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</span><br><span class="line">            Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);<span class="comment">//å…¥æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯å…¥é˜Ÿåˆ—"><a href="#æ¶ˆæ¯å…¥é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯å…¥é˜Ÿåˆ—"></a>æ¶ˆæ¯å…¥é˜Ÿåˆ—</h4><p>æ¥ç€å°±æ˜¯è¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰§è¡Œæ—¶åˆ»å°çš„åœ¨å‰æ’å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(Message msg, <span class="keyword">long</span> when)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (msg.target == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Message must have a target."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (msg.isInUse()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(msg + <span class="string">" This message is already in use."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mQuitting) &#123;<span class="comment">//å¦‚æœé€€å‡º</span></span><br><span class="line">            IllegalStateException e = <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                    msg.target + <span class="string">" sending message to a Handler on a dead thread"</span>);</span><br><span class="line">            Log.w(TAG, e.getMessage(), e);</span><br><span class="line">            msg.recycle();<span class="comment">//å›æ”¶</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        msg.markInUse();</span><br><span class="line">        msg.when = when;</span><br><span class="line">        Message p = mMessages;</span><br><span class="line">        <span class="keyword">boolean</span> needWake;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="keyword">null</span> || when == <span class="number">0</span> || when &lt; p.when) &#123;</span><br><span class="line">            <span class="comment">// New head, wake up the event queue if blocked. æ–°å»ºé“¾è¡¨å¤´</span></span><br><span class="line">            msg.next = p;</span><br><span class="line">            mMessages = msg;</span><br><span class="line">            needWake = mBlocked;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Inserted within the middle of the queue.  Usually we don't have to wake</span></span><br><span class="line">            <span class="comment">// up the event queue unless there is a barrier at the head of the queue</span></span><br><span class="line">            <span class="comment">// and the message is the earliest asynchronous message in the queue.</span></span><br><span class="line">            needWake = mBlocked &amp;&amp; p.target == <span class="keyword">null</span> &amp;&amp; msg.isAsynchronous();</span><br><span class="line">            Message prev;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                prev = p;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">if</span> (p == <span class="keyword">null</span> || when &lt; p.when) &#123;<span class="comment">//æ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œä¿è¯æ—¶åˆ»é¡ºåº</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (needWake &amp;&amp; p.isAsynchronous()) &#123;</span><br><span class="line">                    needWake = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            msg.next = p; <span class="comment">// invariant: p == prev.next æ’å…¥</span></span><br><span class="line">            prev.next = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We can assume mPtr != 0 because mQuitting is false.</span></span><br><span class="line">        <span class="keyword">if</span> (needWake) &#123;</span><br><span class="line">            nativeWake(mPtr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·®ä¸å¤šæµç¨‹å°±æ˜¯è¿™æ ·äº†ã€‚è¿™ä¸ªä¾‹å­ä½¿ç”¨HandlerThreadåšç¤ºèŒƒçš„ï¼ŒUIä¸»çº¿ç¨‹åŒæ ·ä¹Ÿæ˜¯ä½¿ç”¨è¿™æ ·çš„å®ç°çš„ã€‚</p><h3 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h3><p>å†…éƒ¨å®ç°HandlerThreadçš„Servcieï¼Œå¼€å¯å­çº¿ç¨‹æ‰§è¡Œï¼Œä»£ç æ¯”è¾ƒç®€å•ç›´æ¥æˆªä¸‹æ¥äº†ï¼Œæ„å»ºHandlerThreadï¼ŒHandlerï¼Œåœ¨onStartCommandä¸­å‘é€æ¶ˆæ¯ï¼Œå¹¶æœ€ç»ˆåœ¨onHandleIntentå“åº”æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">IntentService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Looper mServiceLooper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> ServiceHandler mServiceHandler;</span><br><span class="line">    <span class="keyword">private</span> String mName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mRedelivery;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServiceHandler</span><span class="params">(Looper looper)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(looper);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            onHandleIntent((Intent)msg.obj);<span class="comment">//è°ƒç”¨</span></span><br><span class="line">            stopSelf(msg.arg1);<span class="comment">//ç»“æŸservcie</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IntentService</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        mName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIntentRedelivery</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</span><br><span class="line">        mRedelivery = enabled;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        HandlerThread thread = <span class="keyword">new</span> HandlerThread(<span class="string">"IntentService["</span> + mName + <span class="string">"]"</span>);<span class="comment">//æ„å»º</span></span><br><span class="line">        thread.start();<span class="comment">//å¼€å¯</span></span><br><span class="line"></span><br><span class="line">        mServiceLooper = thread.getLooper();</span><br><span class="line">        mServiceHandler = <span class="keyword">new</span> ServiceHandler(mServiceLooper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">(@Nullable Intent intent, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        Message msg = mServiceHandler.obtainMessage();</span><br><span class="line">        msg.arg1 = startId;</span><br><span class="line">        msg.obj = intent;</span><br><span class="line">        mServiceHandler.sendMessage(msg);<span class="comment">//å‘é€</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(@Nullable Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        onStart(intent, startId);</span><br><span class="line">        <span class="keyword">return</span> mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mServiceLooper.quit();<span class="comment">//é€€å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WorkerThread</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onHandleIntent</span><span class="params">(@Nullable Intent intent)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¢³ç†ä¸€æ³¢Service</title>
      <link href="/2019/07/06/Android-%E6%A2%B3%E7%90%86%E4%B8%80%E6%B3%A2Service/"/>
      <url>/2019/07/06/Android-%E6%A2%B3%E7%90%86%E4%B8%80%E6%B3%A2Service/</url>
      
        <content type="html"><![CDATA[<h2 id="what"><a href="#what" class="headerlink" title="what"></a>what</h2><p>Android å››å¤§ç»„ä»¶ä¹‹ä¸€ï¼Œåä¸ºæœåŠ¡ï¼Œå¯è§ä¸activityå…·æœ‰åŒç­‰åœ°ä½ï¼Œçœ‹åå­—ä¹Ÿåªåˆ°ï¼ŒæœåŠ¡å˜›ï¼Œä¸€èˆ¬ç”¨äºæä¾›è¿›è¡ŒUIæ— å…³çš„ç­‰ä»»åŠ¡æ“ä½œã€‚å’Œactivityå­˜åœ¨ä¸ä¸€æ ·ï¼Œè¿™å®¶ä¼™çš„å­˜åœ¨æ˜¯å¯ä»¥è¯´æ˜¯æ— å£°æ— æ¯ï¼Œç”šè‡³åœ¨æœ‰äº›æµæ°“çš„è½¯ä»¶ä¸­ï¼Œä½ å…³æ‰äº†appï¼Œé‚£è¿˜ä¸ä¸€å®šå…³æ‰äº†æœåŠ¡[æ‚è„¸] ï¼Œä¸è¿‡è¿™ä¹Ÿæ­£çªå‡ºäº†serviceçš„ç‰¹ç‚¹ï¼Œåå°ã€‚å¼€å§‹çŸ¥é“æ˜¯ç”¨æ¥è¿›è¡Œåå°ä»»åŠ¡å°±è¡Œäº†ï¼Œçœ‹çœ‹æ€ä¹ˆç”¨å§ã€‚</p><blockquote><p><code>Service</code> æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œè€Œä¸æä¾›ç”¨æˆ·ç•Œé¢çš„åº”ç”¨ç»„ä»¶ã€‚æœåŠ¡å¯ç”±å…¶ä»–åº”ç”¨ç»„ä»¶å¯åŠ¨ï¼Œè€Œä¸”å³ä½¿ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨ï¼ŒæœåŠ¡ä»å°†åœ¨åå°ç»§ç»­è¿è¡Œã€‚ æ­¤å¤–ï¼Œç»„ä»¶å¯ä»¥ç»‘å®šåˆ°æœåŠ¡ï¼Œä»¥ä¸ä¹‹è¿›è¡Œäº¤äº’ï¼Œç”šè‡³æ˜¯æ‰§è¡Œè¿›ç¨‹é—´é€šä¿¡ (IPC)ã€‚ ä¾‹å¦‚ï¼ŒæœåŠ¡å¯ä»¥å¤„ç†ç½‘ç»œäº‹åŠ¡ã€æ’­æ”¾éŸ³ä¹ï¼Œæ‰§è¡Œæ–‡ä»¶ I/O æˆ–ä¸å†…å®¹æä¾›ç¨‹åºäº¤äº’ï¼Œè€Œæ‰€æœ‰è¿™ä¸€åˆ‡å‡å¯åœ¨åå°è¿›è¡Œã€‚</p></blockquote><p>googleçˆ¸çˆ¸è¯´çš„å¥½æ¡ç†å“¦</p><p><code>ç‰¹åˆ«ï¼šServiceé»˜è®¤ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œçš„ã€‚æ‰€ä»¥ä¹Ÿä¼šæœ‰ANRé£é™©ã€‚</code></p><a id="more"></a><h2 id="how"><a href="#how" class="headerlink" title="how"></a>how</h2><h3 id="å®šä¹‰ä¸€ä¸ªæœåŠ¡"><a href="#å®šä¹‰ä¸€ä¸ªæœåŠ¡" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæœåŠ¡"></a>å®šä¹‰ä¸€ä¸ªæœåŠ¡</h3><h4 id="ç»§æ‰¿Service"><a href="#ç»§æ‰¿Service" class="headerlink" title="ç»§æ‰¿Service"></a>ç»§æ‰¿Service</h4><p>é¦–å…ˆçš„è‚¯å®šæ˜¯è¦ç»§æ‰¿ä¸€ä¸ªServiceçš„å’¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//æœåŠ¡è¢«ç¬¬ä¸€æ¬¡åˆ›å»ºè°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//è¢«è°ƒç”¨æœåŠ¡è°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//ç»‘å®šæ—¶è°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Manifestå£°æ˜"><a href="#Manifestå£°æ˜" class="headerlink" title="Manifestå£°æ˜"></a>Manifestå£°æ˜</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:enabled</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]</span></span><br><span class="line"><span class="tag">         <span class="attr">android:exported</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]</span></span><br><span class="line"><span class="tag">         <span class="attr">android:icon</span>=<span class="string">"drawable resource"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:isolatedProcess</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]</span></span><br><span class="line"><span class="tag">         <span class="attr">android:label</span>=<span class="string">"string resource"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:name</span>=<span class="string">"string"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:permission</span>=<span class="string">"string"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:process</span>=<span class="string">"string"</span> &gt;</span></span><br><span class="line">    . . .</span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¼€å¯æœåŠ¡"><a href="#å¼€å¯æœåŠ¡" class="headerlink" title="å¼€å¯æœåŠ¡"></a>å¼€å¯æœåŠ¡</h3><p>å—¯ï¼ŒIntentåˆæ¥äº†ï¼Œå“ˆå“ˆï¼Œåœ¨æŒæœ‰contextçš„åœ°æ–¹è°ƒç”¨ï¼Œæ—¢ç„¶æ˜¯ç”¨Intentï¼Œè‡ªç„¶servieçš„ä¹Ÿä¼šæœ‰Intent-Filteræ ‡ç­¾æ¥è¿‡æ»¤ã€‚ä¸è¿‡å¥½åƒä»æ¥æ²¡ç”¨è¿‡ç±»ä¼¼activityçš„éšå¼å¯åŠ¨ï¼Œgoogleå‘ç°åŸæ¥æ˜¯5.0ä»¥ä¸Šå°±ä¸å…è®¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(context, TestService.class);</span><br><span class="line">context.startService(intent);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆçš„è¯å¿…ç„¶å…ˆè°ƒç”¨onCreateï¼Œç„¶åå°±æ˜¯onStartCommmandï¼Œè¿™ä¸ªæœåŠ¡å°±ç®—æ˜¯å¼€å¯äº†ï¼Œæ´»äº†ã€‚åé¢å†startServiceä¹Ÿåªä¼šè°ƒç”¨onStartCommandäº†ã€‚</p><h3 id="åœæ­¢æœåŠ¡"><a href="#åœæ­¢æœåŠ¡" class="headerlink" title="åœæ­¢æœåŠ¡"></a>åœæ­¢æœåŠ¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§ï¼Œé€šè¿‡contextå…³é—­</span></span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(context, TestService.class);</span><br><span class="line">context.stopservcie(intent);</span><br><span class="line"><span class="comment">//ç¬¬äºŒç§ï¼Œåœ¨servieå†…éƒ¨åœæ­¢</span></span><br><span class="line">stopSelf();</span><br></pre></td></tr></table></figure><p>åœæ­¢æœåŠ¡åç³»ç»Ÿä¼šå°½å¿«é”€æ¯æœåŠ¡ï¼Œå½“ç„¶ä¹Ÿå°±ä¼šè°ƒç”¨onDestroyå’¯</p><h3 id="æœåŠ¡äº¤äº’â€“ç»‘å®šæœåŠ¡"><a href="#æœåŠ¡äº¤äº’â€“ç»‘å®šæœåŠ¡" class="headerlink" title="æœåŠ¡äº¤äº’â€“ç»‘å®šæœåŠ¡"></a>æœåŠ¡äº¤äº’â€“ç»‘å®šæœåŠ¡</h3><p>å¥½åƒä¹‹å‰ä½¿ç”¨å¼€å¯æœåŠ¡å’Œå…³é—­æœåŠ¡ï¼Œè°ƒç”¨è€…å’ŒæœåŠ¡åŸºæœ¬æ²¡ä»€ä¹ˆè€¦åˆå…³ç³»ã€‚å„èµ°å„è·¯äº†å‘ƒå‘ƒã€‚ä¸ºäº†èƒ½å¤Ÿä¿æŒè°ƒç”¨è€…å’ŒæœåŠ¡ä¹‹é—´çš„äº¤äº’ã€‚ä½¿ç”¨<code>ç»‘å®šæœåŠ¡</code>ï¼Œè¿™ä¹Ÿæ˜¯å¼€å¯æœåŠ¡çš„å¦ä¸€ç§æ–¹å¼ï¼Œè¯å¥è¯è¯´é€šè¿‡ç»‘å®šçš„æ–¹å¼æ¥å¼€å¯æœåŠ¡ã€‚è¿™å°±è¦ç”¨åˆ°onBindçš„æ–¹æ³•äº†ã€‚</p><h4 id="ç»‘å®šæœ¬åœ°æœåŠ¡"><a href="#ç»‘å®šæœ¬åœ°æœåŠ¡" class="headerlink" title="ç»‘å®šæœ¬åœ°æœåŠ¡"></a>ç»‘å®šæœ¬åœ°æœåŠ¡</h4><h5 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h5><p>é™¤äº†åŸºæœ¬çš„ä½¿ç”¨æ‰©å±•Binderï¼Œæˆ–è€…ä½¿ç”¨Messengerï¼ŒAIDLï¼ˆå…¶å®ä¹Ÿæ˜¯Binderï¼Œ233ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœåŠ¡ç«¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;<span class="comment">//è¢«ç»‘å®šæ—¶è°ƒç”¨</span></span><br><span class="line">        <span class="comment">//éœ€è¦ç»™å‡ºä¸€ä¸ªBinderå¯¹è±¡ï¼Œå…·ä½“æ€ä¹ˆç»™ï¼Œéƒ½å¯ä»¥ï¼Œå†…éƒ¨ç±»ï¼ŒåŒ¿åå¯¹è±¡ï¼Œåªè¦æ˜¯Binderå°±è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Binder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someActionA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"do some action A"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someActionB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"do some actin B"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h5><p>å‡†å¤‡ServiceConnectionï¼Œå‘èµ·ç»‘å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MyBinder mMyBinder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServiceConnection mServiceConnection = <span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"on connected"</span>);</span><br><span class="line">            mMyBinder = (MyBinder) service;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"on disconnected"</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toBindService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(context, TestService.class);</span><br><span class="line">        context.bindService(intent, mServiceConnection, flag);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//è¿‡ç¨‹ä¸ºtoBindService --&gt; onBinder --&gt; onServiceConnected</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™æ ·çš„æ–¹æ³•æˆ‘ä»¬å°±èƒ½å¤Ÿæ‹¿åˆ°ä¸€ä¸ªBinderå¯¹è±¡ï¼Œæˆ–è€…å…¶å®ƒä¸œè¥¿ï¼Œè¿™æ ·å°±ç®—å’ŒServiceå»ºç«‹èµ·äº†äº¤äº’</p><h5 id="å–æ¶ˆç»‘å®š"><a href="#å–æ¶ˆç»‘å®š" class="headerlink" title="å–æ¶ˆç»‘å®š"></a>å–æ¶ˆç»‘å®š</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unBindService(serviceConnection);</span><br></pre></td></tr></table></figure><p><strong>Flag</strong> ï¼š å…³äºç»‘å®šæœåŠ¡çš„Flag</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">BIND_AUTO_CREATE,<span class="comment">//è‹¥ç»‘å®šæœåŠ¡æ—¶æœåŠ¡æœªå¯åŠ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨å¯åŠ¨æœåŠ¡ã€‚ æ³¨æ„ï¼Œè¿™ç§æƒ…å†µä¸‹æœåŠ¡çš„onStartCommand,ä»ç„¶æœªè¢«è°ƒç”¨ï¼ˆå®ƒåªä¼šåœ¨æ˜¾å¼è°ƒç”¨startServiceæ—¶æ‰ä¼šè¢«è°ƒç”¨ï¼‰ã€‚</span></span><br><span class="line">BIND_DEBUG_UNBIND,<span class="comment">//ä½¿ç”¨æ­¤æ ‡å¿—ç»‘å®šæœåŠ¡ä¹‹åçš„unBindServiceæ–¹æ³•ä¼šæ— æ•ˆã€‚ è¿™ç§æ–¹æ³•ä¼šå¼•èµ·å†…å­˜æ³„éœ²ï¼Œåªèƒ½åœ¨è°ƒè¯•æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line">BIND_NOT_FOREGROUND,<span class="comment">//è¢«ç»‘å®šçš„æœåŠ¡è¿›ç¨‹ä¼˜å…ˆçº§ä¸å…è®¸è¢«æåˆ°FOREGROUNDçº§åˆ«</span></span><br><span class="line">BIND_ABOVE_CLIENT,<span class="comment">//æœåŠ¡æ¯”appé‡è¦ï¼Œoomç§»é™¤killeræ€æ­»serviceå‰æ€æ­»app</span></span><br><span class="line">BIND_ALLOW_OOM_MANAGEMENT,</span><br><span class="line">BIND_WAIVE_PRIORITY,<span class="comment">//è¢«ç»‘å®šçš„æœåŠ¡è¿›ç¨‹ä¸ä¼šè¢«OOMåˆ—å…¥çŒæ€å¯¹è±¡ä¸­ã€‚</span></span><br><span class="line">BIND_IMPORTANT,<span class="comment">//è¢«ç»‘å®šçš„æœåŠ¡è¿›ç¨‹ä¼˜å…ˆçº§ä¼šè¢«æåˆ°FOREGROUNDçº§åˆ«</span></span><br><span class="line">BIND_ADJUST_WITH_ACTIVITY<span class="comment">//å…è®¸activityè°ƒæ•´é‡è¦æ€§</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸€ä¸ªå’¯ï¼Œè¿™é‡Œæˆ‘æ”¶é›†åˆ°çš„ç¿»è¯‘çš„ä¸æ˜ç¡®ï¼Œè¿˜æ˜¯å…·ä½“å‚çœ‹<code>Context.java</code>æºç çš„è‹±æ–‡æ³¨é‡Š</p><h4 id="ç»‘å®šè¿œç¨‹æœåŠ¡"><a href="#ç»‘å®šè¿œç¨‹æœåŠ¡" class="headerlink" title="ç»‘å®šè¿œç¨‹æœåŠ¡"></a>ç»‘å®šè¿œç¨‹æœåŠ¡</h4><p>ä¹Ÿå°±æ˜¯IPCï¼Œåœ¨android ç³»ç»Ÿä¸­å¾ˆå¤šæœåŠ¡éƒ½æ˜¯å¯ä»¥ç›´æ¥è·¨è¿›ç¨‹è°ƒç”¨çš„ï¼Œè€Œè¿™äº›æœåŠ¡ä¹Ÿéƒ½æ˜¯ç”±æŸäº›ç»„ä»¶åº”ç”¨æä¾›çš„ã€‚é€šè¿‡ç»‘å®šè¿œç¨‹çš„æœåŠ¡å¯ä»¥è°ƒç”¨å…¶å®ƒçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è“ç‰™ï¼Œwifiç­‰ç­‰ã€‚è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿™ä¸ªæˆ‘æ”¾åœ¨å•ç‹¬çš„IPCåé¢è¯¦ç»†å½’çº³</p><ul><li>Messenger</li><li>AIDL</li></ul><h3 id="å‰å°æœåŠ¡"><a href="#å‰å°æœåŠ¡" class="headerlink" title="å‰å°æœåŠ¡"></a>å‰å°æœåŠ¡</h3><p>è¿™ä¸ªç®—æ˜¯ç”¨æˆ·ä¸»åŠ¨æ„è¯†åˆ°çš„ä¸€ç§æœåŠ¡ï¼Œ<code>å³ä½¿å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¸ä¼šè€ƒè™‘ç»ˆæ­¢</code>ï¼Œä¼˜å…ˆçº§å¾ˆé«˜ï¼Œå…¶å®è¯´ç™½ç‚¹äº†ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æœåŠ¡é€šè¿‡å¼€å¯é€šçŸ¥æ çš„å½¢å¼ï¼Œè®²æ˜äº†æœåŠ¡åœ¨è¿è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›é”®é€šçŸ¥</span></span><br><span class="line">Notification notification = <span class="keyword">new</span> Notification(R.drawable.icon, getText(R.string.ticker_text),</span><br><span class="line">        System.currentTimeMillis());</span><br><span class="line">Intent notificationIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ExampleActivity.class);</span><br><span class="line">PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, notificationIntent, <span class="number">0</span>);</span><br><span class="line">notification.setLatestEventInfo(<span class="keyword">this</span>, getText(R.string.notification_title),</span><br><span class="line">        getText(R.string.notification_message), pendingIntent);</span><br><span class="line"><span class="comment">//æœåŠ¡å¼€å¯å‰å°ï¼Œå¹¶ä¸”å…³è”é€šçŸ¥</span></span><br><span class="line">startForeground(ONGOING_NOTIFICATION_ID, notification);</span><br></pre></td></tr></table></figure><h3 id="IntentæœåŠ¡"><a href="#IntentæœåŠ¡" class="headerlink" title="IntentæœåŠ¡"></a>IntentæœåŠ¡</h3><h5 id="what-1"><a href="#what-1" class="headerlink" title="what"></a>what</h5><p>ç±»ï¼šIntentServiceï¼Œé€šè¿‡æ‰©å±•è¿™ä¸ªç±»å®ç°çš„æœåŠ¡ï¼Œé‡Œé¢æ“ä½œä¼šåœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œã€‚è€Œä¸”ä¸éœ€è¦æ‰‹åŠ¨å…³é—­æœåŠ¡ï¼Œå®ƒè‡ªå·±å°±ä¼šå…³é—­ã€‚é‚£ä¹ˆçœ‹çœ‹æ€ä¹ˆç”¨å§</p><h5 id="how-1"><a href="#how-1" class="headerlink" title="how"></a>how</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloIntentService</span> <span class="keyword">extends</span> <span class="title">IntentService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * A constructor is required, and must call the super IntentService(String)</span></span><br><span class="line"><span class="comment">   * constructor with a name for the worker thread.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">HelloIntentService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>(<span class="string">"HelloIntentService"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The IntentService calls this method from the default worker thread with</span></span><br><span class="line"><span class="comment">   * the intent that started the service. When this method returns, IntentService</span></span><br><span class="line"><span class="comment">   * stops the service, as appropriate.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onHandleIntent</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// Normally we would do some work here, like download a file.</span></span><br><span class="line">      <span class="comment">// For our sample, we just sleep for 5 seconds.</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          <span class="comment">// Restore interrupt status.</span></span><br><span class="line">          Thread.currentThread().interrupt();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼€å¯æœåŠ¡è¿˜æ˜¯å’Œæ™®é€šçš„æ²¡åŒºåˆ«ï¼Œä½†æ˜¯æ‰€æœ‰çš„æ“ä½œå¯ä»¥åœ¨<code>onHandleIntent</code>ä¸­å“åº”ã€‚è€Œä¸”æ­¤æ—¶è¿™ä¸ªæ–¹æ³•å†…å°±æ˜¯å­çº¿ç¨‹äº†ã€‚è¿˜ä¸ç”¨å…³å¿ƒæœåŠ¡åœæ­¢</p><h5 id="why"><a href="#why" class="headerlink" title="why"></a>why</h5><p>é‚£ä¹ˆä¸ºå•¥IntentServiceæœ‰è¿™ä¹ˆå¤§é­”åŠ›å‘¢ï¼Œå­çº¿ç¨‹ï¼Œè‡ªå¸¦å…³é—­ï¼Œå…¶å®åŸç†å¾ˆç®€å•ï¼Œå†…éƒ¨ç»´æŠ¤äº†ç®€å•çš„Looperå’ŒHandleræ“ä½œï¼ˆå…³äºHandlerå’ŒIntentServiceåŸç†ä¸‹æ¬¡ä¸€èµ·è¯¦ç»†å½’çº³ä¸‹ï¼‰ï¼Œä½¿å¾—æ‰€æœ‰çš„ä»onStartCommandçš„æ“ä½œè¿›å…¥äº†ä¸€ä¸ªHandlerThreadä¸­ï¼Œç„¶åæ¯æ¬¡è°ƒç”¨éƒ½å‘æäº¤ä»»åŠ¡ç»™çº¿ç¨‹ã€‚æœ€åä¹Ÿä¼šæ‰§è¡Œå®Œä¹Ÿä¼šåœæ­¢è‡ªå·±ã€‚</p><h3 id="è¿œç¨‹æœåŠ¡"><a href="#è¿œç¨‹æœåŠ¡" class="headerlink" title="è¿œç¨‹æœåŠ¡"></a>è¿œç¨‹æœåŠ¡</h3><p>åœ¨serviceé…ç½®å£°æ˜ä¸­æœ‰ä¸€ä¸ªå±æ€§<code>process</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:process</span>=<span class="string">":remote"</span> <span class="attr">android:enable</span>=<span class="string">"true"</span> <span class="attr">andorid:exported</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸ªserviceå°±å’Œæœ¬åº”ç”¨ä½äºä¸åŒçš„è¿›ç¨‹ä¸­äº†ï¼Œé‚£ä¹ˆå°±è½®åˆ°IPCä¸Šåœºäº†ã€‚å¯¹å’¯ï¼Œæ—¢ç„¶æ˜¯IPCäº†ï¼ŒåŸæ¥çš„å¼€å¯æœåŠ¡çš„æ–¹å¼å°±è¡Œä¸é€šï¼Œé‚£å°±çš„ç”¨AIDLå’¯</p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li><p>å°å¿ƒANR:å¸¸æ€ä¸‹Serviceçš„ä»£ç æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹æ»´</p></li><li><p>ä¸è¦è¿‡å¤šçš„å®ç°ä»£ç åœ¨è¿™é‡Œï¼Œè¦æŠŠæœåŠ¡çœ‹æˆä¸€ä¸ªåå°ä»»åŠ¡è°ƒç”¨ä»£ç†ã€‚ã€‚</p></li><li><p>å…³äºonStartCommandè¿”å›å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//è¯¥è¿”å›å€¼æè¿°äº†åœ¨æ€æ­»äº‹ä»¶ä¸­å¦‚ä½•ç»§ç»­è¿™ä¸ªæœåŠ¡</span><br><span class="line">START_NOT_STICKY</span><br><span class="line">æ€æ­»åä¸ä¼šé‡å¯</span><br><span class="line">START_STICKY</span><br><span class="line">æ€æ­»åä¼šé‡å¯ï¼Œä½†æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨çš„startCommand()çš„Intentä¸ºnull</span><br><span class="line">START_REDELIVER_INTENT</span><br><span class="line">æ€æ­»åä¼šé‡å¯ï¼Œå¹¶ä¸”ä¼šé‡ä¼ Intent</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>æ™®é€šå¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">call to start service</span><br><span class="line">|</span><br><span class="line">onCreate</span><br><span class="line">|</span><br><span class="line">onStartCommand</span><br><span class="line">|</span><br><span class="line">service is running</span><br><span class="line">|</span><br><span class="line">onDestory</span><br><span class="line">|</span><br><span class="line">service shut down</span><br></pre></td></tr></table></figure><p>ç»‘å®š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">call to bind servie</span><br><span class="line">|</span><br><span class="line">onCreate</span><br><span class="line">|</span><br><span class="line">onBind</span><br><span class="line">|</span><br><span class="line">client are bound to servcie</span><br><span class="line">|</span><br><span class="line">onUnbind</span><br><span class="line">|</span><br><span class="line">onDesotry</span><br><span class="line">|</span><br><span class="line">service shut down</span><br></pre></td></tr></table></figure><p>onStartCommandä¸€å®šæ˜¯åœ¨è°ƒç”¨startServieæ‰ä¼šè°ƒç”¨çš„ã€‚å³ä½¿æ˜¯ç»‘å®šæœåŠ¡ï¼Œä¹Ÿä¸ä¼šè°ƒç”¨å®ƒçš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¢³ç†ä¸€æ³¢ActivityåŸºç¡€ä½¿ç”¨</title>
      <link href="/2019/07/03/Android-%E6%A2%B3%E7%90%86%E4%B8%80%E6%B3%A2Activity/"/>
      <url>/2019/07/03/Android-%E6%A2%B3%E7%90%86%E4%B8%80%E6%B3%A2Activity/</url>
      
        <content type="html"><![CDATA[<h2 id="what"><a href="#what" class="headerlink" title="what"></a>what</h2><p>é¦–å…ˆåˆå­¦androidç¬¬ä¸€ä¸ªå­¦çš„ç»é€¼æ˜¯Activityï¼Œç¿»è¯‘ä¸ºæ´»åŠ¨ï¼Œå³çœ‹çš„è§ï¼Œæ‘¸å¾—ç€çš„ç©æ„ã€‚android SDKæä¾›äº†ä¸€å¥—æ¨¡æ¿ç±»å³Activityï¼Œå¼€å‘è€…éœ€è¦ç»§æ‰¿å®ƒï¼Œå¹¶ä¸”åœ¨å¯¹çš„æ—¶é—´åšç›¸åº”çš„äº‹æƒ…ï¼Œæ¯”å¦‚UIåˆå§‹åŒ–ï¼Œæ•°æ®åŠ è½½ç­‰ç­‰ï¼Œé€šè¿‡åœ¨Manifestæ–‡ä»¶ä¸­å£°æ˜è¿™ä¸ªæ–°çš„Activityå°±å¯ä»¥äº†ã€‚è¿™æ¬¡å°±å…ˆä¸æ¢è®¨Activityæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œä»åº”ç”¨çš„è§’åº¦æ¥çœ‹çœ‹å®ƒï¼Œï¼ˆAMSè¿˜å¾—å†å­¦ä¹ å­¦ä¹ 2333ï¼‰ã€‚</p><h2 id="how"><a href="#how" class="headerlink" title="how"></a>how</h2><p>æ— éå°±æ˜¯åˆ›å»ºç±»ç„¶åå®ç°Activityï¼Œç„¶åæ³¨å†Œåˆ°Manifestä¸­ã€‚å¯ä»¥äº†ã€‚</p><p>ä¸»è¦æ¥çœ‹çœ‹Activityä¸­é‡è¦çš„APIå§ã€‚</p><a id="more"></a><h3 id="é¦–å…ˆçœ‹çœ‹Activityç»§æ‰¿ç»“æ„ã€‚"><a href="#é¦–å…ˆçœ‹çœ‹Activityç»§æ‰¿ç»“æ„ã€‚" class="headerlink" title="é¦–å…ˆçœ‹çœ‹Activityç»§æ‰¿ç»“æ„ã€‚"></a>é¦–å…ˆçœ‹çœ‹Activityç»§æ‰¿ç»“æ„ã€‚</h3><ul><li><p>AppCompatActivity ï¼šç›®å‰æ¥è¯´é»˜è®¤ASåˆ›å»ºçš„Activityç»§æ‰¿è‡ªAppcompatActivity,ç›´æ¥æ„æ€å…¼å®¹çš„Activityå’¯ï¼Œæ”¯æŒActionBar,åŒæ—¶å¯¹MDæ§ä»¶æä¾›æ”¯æŒã€‚</p></li><li><p>FragmentActivityï¼šæ”¯æŒFagmentä½¿ç”¨çš„Activityï¼Œå› ä¸º3.0ä¹‹å‰æ˜¯æ²¡æœ‰Fragmntï¼Œæ‰€ä»¥ä¸ºäº†å…¼å®¹å¼•å…¥ã€‚</p></li><li><p>Activityï¼šåŸæ±åŸå‘³çš„ã€‚ã€‚</p></li></ul><h3 id="æ¥ç€çœ‹çœ‹æ—¥å¸¸å¿…é¡»ç”¨å¾—åˆ°æ–¹æ³•"><a href="#æ¥ç€çœ‹çœ‹æ—¥å¸¸å¿…é¡»ç”¨å¾—åˆ°æ–¹æ³•" class="headerlink" title="æ¥ç€çœ‹çœ‹æ—¥å¸¸å¿…é¡»ç”¨å¾—åˆ°æ–¹æ³•"></a>æ¥ç€çœ‹çœ‹æ—¥å¸¸å¿…é¡»ç”¨å¾—åˆ°æ–¹æ³•</h3><ul><li><p>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæ”¾åœ¨ä¸‹é¢å¥½äº†ã€‚</p></li><li><p>setSupportActionBarå’ŒgetSupportActionBarï¼Œè¿›å»ToolBar,å‡ºæ¥AcionBar,å·¥å…·æ ç›¸å…³çš„è€…ä¸¤ä¸ªä¸€å®šå¾—ç”¨</p></li><li><p>onConfigurationChangedï¼Œé…ç½®å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šå›è°ƒè¿™é‡Œã€‚å†Manifestä¸­activityçš„é…ç½®ä¸­è¦è®¾å®šå…³å¿ƒé‚£äº›å˜åŒ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">""</span> <span class="attr">android:configChanges</span>=<span class="string">"orientation|keyboard"</span>/&gt;</span></span><br><span class="line">æ¨ªç«–å±åˆ‡æ¢ï¼Œé”®ç›˜ç­‰ç­‰</span><br></pre></td></tr></table></figure></li><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">onSaveInstanceState å’Œ onRestoreInstanceState ä¿å­˜å’Œæ¢å¤å½“å‰çš„æŸäº›çŠ¶æ€å’Œæ•°æ®</span><br><span class="line">å†…å­˜å›æ”¶åé‡æ–°åˆ›å»ºActivtyï¼Œå¯ä»¥ä¼ é€’Bundle</span><br><span class="line">onCreateOptionsMenu //åˆ›å»ºmenuçš„å›è°ƒ</span><br><span class="line">onOptionsItemSelected //è®¾ç½®å“åº”menuäº‹ä»¶çš„å›è°ƒ</span><br><span class="line">getMenuInflater //å¡«å……menuçš„å¡«å……å™¨</span><br><span class="line">onRequestPermissionsResult //è¯·æ±‚æƒé™åå¤„ç†ç»“æœçš„å›è°ƒ</span><br><span class="line">onBackPressed //æŒ‰ä¸‹è¿”å›å›è°ƒ</span><br><span class="line">onLowMemory //ä½å†…å­˜å›è°ƒ</span><br><span class="line">onActivityResult //å¯åŠ¨å…¶å®ƒactivityè¿”å›ç»“æœå›è°ƒ</span><br></pre></td></tr></table></figure></li></ul><p>å¥½åƒåˆ—å‡ºæ¥æ²¡ä»€ä¹ˆè½¯ç”¨ã€‚ã€‚</p><h3 id="Intentä½¿ç”¨"><a href="#Intentä½¿ç”¨" class="headerlink" title="Intentä½¿ç”¨"></a>Intentä½¿ç”¨</h3><p>èƒ½å¤Ÿå®šä¹‰Activityåï¼Œæ¥ç€å°±æ˜¯åˆ©ç”¨Intentè¿›è¡Œé¡µé¢çš„è·³è½¬äº†ã€‚Intentæ„ä¸ºæ„å›¾ï¼Œåœ¨å››å¤§ç»„ä»¶ä¸­åŸºæœ¬éƒ½æ˜¯åˆ©ç”¨Intentè¿›è¡Œè°ƒç”¨å’Œä¼ é€’ã€‚</p><p>Intentåˆ†ä¸ºå¯åŠ¨æ–¹å’Œæ¥å—æ–¹ï¼Œå¯åŠ¨æ–¹å‘å‡ºIntentï¼Œæ¥æ”¶æ–¹æ¥æ”¶ã€‚å®Œæˆè·³è½¬æˆ–å¯åŠ¨ï¼Œå¯åŠ¨æ–¹éœ€è¦ç»™å‡ºIntentç›®æ ‡æˆ–æ–¹å‘ï¼Œè€Œæ¥å—æ–¹éœ€è¦æ˜ç¡®è‡ªå·±èƒ½æ¥å—ä»€ä¹ˆIntent</p><p>é¦–å…ˆIntentå¾ˆå¹²è„†ï¼Œå°±æ˜¯ä¸€ä¸ªParcelable å’Œ Cloneableè€Œå·²ï¼ŒIntentåŒæ ·å¯¹åº”ç€Manifestæ–‡ä»¶intent-filteræ ‡ç­¾ï¼Œä»£è¡¨å½“å‰ç»„ä»¶èƒ½å¤Ÿå“åº”ä»€ä¹ˆæ ·çš„æ„å›¾</p><p>æ˜¾å¼ä½¿ç”¨Intentè¿›è¡Œè·³è½¬Activityï¼šæ˜ç¡®ç›®æ ‡åœ°ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Context from, Class&lt;? extends Activity&gt; to, Bundle bundle)</span> </span>&#123;</span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(from, to);</span><br><span class="line">    <span class="keyword">if</span> (bundle != <span class="keyword">null</span>) &#123;</span><br><span class="line">        intent.putExtras(bundle);</span><br><span class="line">    &#125;</span><br><span class="line">    from.startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšå¼ä½¿ç”¨Intentï¼šä¸æ˜ç¡®ç›®æ ‡åœ°ç‚¹ï¼Œä½†æ˜¯èƒ½ç»™å‡ºå¤§è‡´çš„æ–¹å‘ã€‚é€šè¿‡actionï¼Œcategoryï¼Œdataä¸‰ç§éšå¼è¿‡æ»¤ï¼Œæ¥æœå¯»ç›®æ ‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">intent.addCategory(String);<span class="comment">//å¯ä»¥å¤šä¸ª</span></span><br><span class="line">intent.setAction(String);<span class="comment">//å•ä¸ª</span></span><br><span class="line">intent.setData(Uri);<span class="comment">//å•ä¸ª</span></span><br></pre></td></tr></table></figure><p>å“åº”çš„ä¸€æ–¹å¯ä»¥è®¾ç½®å¤šä¸ªIntent-filter</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:host</span>=<span class="string">""</span> <span class="attr">android:mimeType</span>=<span class="string">""</span> <span class="attr">android:port</span>=<span class="string">""</span> <span class="attr">android:scheme</span>=<span class="string">""</span> <span class="attr">android:path</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æºå¸¦æ•°æ®</p><p>Intentå¯ä»¥æºå¸¦åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ•°ç»„ï¼ŒParcelableï¼ŒSerializableï¼Œä¸çˆ½çš„è¯ç›´æ¥Bundleæ‰“åŒ…ã€‚ä¸è¿‡å†…éƒ¨å®ç°ä¹Ÿæ˜¯ä¸€èµ·æ‰“åŒ…åœ¨Bundleä¸­ã€‚</p><p>startActivityForResult è¿™åˆ™æ˜¯å¯åŠ¨activityåè¿”å›å¯ä»¥è¯»å–è¿”å›çš„æ•°æ®ï¼Œéœ€è¦é‡å†™onActivityResultæ¥è¯»å–Intent</p><p>åˆ°äº†è¿™é‡Œå…¶å®ä¹Ÿèƒ½å¤Ÿåšå¬è¿‡äº‹äº†ï¼Œä¸å…‰èƒ½å¤Ÿè‡ªå·±åº”ç”¨å†…è·³è½¬ï¼Œä»¥åŠå¼€å¯ç›¸æœºå•Šï¼Œç›¸å†Œï¼Œå¾ˆå¤šå¾ˆå¤šã€‚</p><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><h3 id="è¿”å›æ ˆ"><a href="#è¿”å›æ ˆ" class="headerlink" title="è¿”å›æ ˆ"></a>è¿”å›æ ˆ</h3><p>ç”¨äºç®¡ç†ä»»åŠ¡æ ˆï¼Œæ–°Activityå…¥æ ˆï¼Œfinishå‡ºæ ˆã€‚</p><h3 id="æ´»åŠ¨çŠ¶æ€"><a href="#æ´»åŠ¨çŠ¶æ€" class="headerlink" title="æ´»åŠ¨çŠ¶æ€"></a>æ´»åŠ¨çŠ¶æ€</h3><ul><li>è¿è¡ŒçŠ¶æ€ï¼šactivityä½äºæ ˆé¡¶</li><li>æš‚åœçŠ¶æ€ï¼šå¯è§ï¼Œä¸ä½äºæ ˆé¡¶</li><li>åœæ­¢çŠ¶æ€ï¼šä¸å¯è§ï¼Œä¸ä½äºæ ˆé¡¶</li><li>é”€æ¯çŠ¶æ€ï¼šå‡ºæ ˆ</li></ul><h3 id="ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><a href="#ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"></a>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">onCreate<span class="comment">//è®¾ç½®Layout</span></span><br><span class="line">onStart<span class="comment">//å¯è§</span></span><br><span class="line">onResume<span class="comment">//å¯è§å¯äº¤äº’</span></span><br><span class="line">onPause<span class="comment">//å¯è§ä¸å¯äº¤äº’</span></span><br><span class="line">onStop<span class="comment">//ä¸å¯è§</span></span><br><span class="line">onDesotry<span class="comment">//é”€æ¯</span></span><br><span class="line">onRestart<span class="comment">//onStopæ¢å¤åä¼šèµ°</span></span><br></pre></td></tr></table></figure><p>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¯¹åº”äº†æ´»åŠ¨çŠ¶æ€æ—¶çš„å›è°ƒ</p><h2 id="å¯åŠ¨æ¨¡å¼"><a href="#å¯åŠ¨æ¨¡å¼" class="headerlink" title="å¯åŠ¨æ¨¡å¼"></a>å¯åŠ¨æ¨¡å¼</h2><p>æŒ‡å®šActivityçš„å¯åŠ¨æ¨¡å¼ï¼Œå¯¹åº”ç€<strong>android:launchMode</strong>å±æ€§</p><ul><li>Standard æ ‡å‡†æ¨¡å¼ï¼Œæ— è®ºç«™å†…æ˜¯å¦å­˜åœ¨å®ä¾‹ï¼Œéƒ½ä¼šåˆ›å»ºæ–°çš„</li><li>SingleTop æ ˆé¡¶å­˜åœ¨åˆ™ä¸åˆ›å»ºæ–°çš„</li><li>SingleTask æ ˆå†…å­˜åœ¨åˆ™ä¸åˆ›å»ºæ–°çš„ï¼Œå¹¶ä¸”æŠŠä¸Šé¢çš„å…¨éƒ½å‡ºæ ˆ</li><li>SingleInstance ç”¨ä¸€ä¸ªå•ç‹¬çš„æ ˆæ¥ç®¡ç†</li></ul>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java æ³›å‹</title>
      <link href="/2019/07/02/Java-%E6%B3%9B%E5%9E%8B/"/>
      <url>/2019/07/02/Java-%E6%B3%9B%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="what"><a href="#what" class="headerlink" title="what"></a>what</h3><p>æ³›å‹æˆ‘é€šä¿—çš„è®¤ä¸ºå°±æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œå³ä¼ å…¥ç±»å‹æç¤ºã€‚å‘Šè¯‰å®ƒæˆ‘å³å°†è¦åœ¨è¿™ä¸ªç±»å‹çš„ç‰ˆæœ¬ä¸Šä½¿ç”¨ä½ äº†ã€‚å¹¶ä¸”åœ¨å†™å‡ºå¤§é‡ä»£ç æ—¶ä½¿ç”¨æ³›å‹å¯ä»¥å†™å‡ºä¸€å¥—æ¨¡æ¿ä»£ç ã€‚è€Œä¸”ä½¿ç”¨äº†æ³›å‹åï¼Œåœ¨ç¼–è¯‘æœŸé—´æ³›å‹è¿™ä¸ªæ˜¯èƒ½å¤Ÿæ£€æµ‹ä½ çš„ä»£ç æœ‰æ²¡æœ‰ä½¿ç”¨ä¸è§„èŒƒç±»å‹çš„å¯¹è±¡ï¼Œåœ¨ç¼–è¯‘æœŸé—´æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ç”¨IDEçš„æ—¶å€™ï¼Œä¸€æ—¦ä½ ä½¿ç”¨æ³›å‹ï¼Œäº§ç”Ÿçš„å¯¹è±¡ï¼Œåœ¨IDEçœ‹æ¥æ‰€ç»™å‡ºçš„ä»£ç æç¤ºç­‰æ£€æŸ¥ä¹Ÿéƒ½æ˜¯åŸºäºä¼ å…¥çš„æ³›å‹å‚æ•°ã€‚ä½†æ˜¯å‘¢ï¼Œç¼–è¯‘é€šè¿‡ååœ¨jvmä¸­è¿è¡Œè¡¨ç°çœ‹æ¥ï¼Œæ‰€æœ‰ç”¨äºå‚æ•°ç±»å‹çš„å¯¹è±¡è¡¨ç°ä¸ºObjectï¼Œ è¿™ä¹Ÿä¿—ç§°ç±»å‹æ“¦é™¤ã€‚<strong>æ³›å‹å‚æ•°ä¸èƒ½æ—¶åŸºæœ¬ç±»å‹</strong></p><a id="more"></a><h3 id="how"><a href="#how" class="headerlink" title="how"></a>how</h3><h4 id="æ³›å‹ç±»"><a href="#æ³›å‹ç±»" class="headerlink" title="æ³›å‹ç±»"></a>æ³›å‹ç±»</h4><p>é¦–å…ˆåˆ—ä¸¾ä¸‹æˆ‘ä»¬ç»å¸¸ç”¨åˆ°ä¸€äº›å…³äºæ³›å‹çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br></pre></td></tr></table></figure><p>å¦‚ä½•è‡ªè¡Œå®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class Person&lt;T&gt; &#123;</span><br><span class="line">    T t;</span><br><span class="line">    <span class="function">T <span class="title">getT</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setT</span><span class="params">(T t)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person&lt;String&gt; person = <span class="keyword">new</span> Person&lt;&gt;();</span><br><span class="line">        person.setT(<span class="string">"ffff"</span>);</span><br><span class="line">        Person&lt;Integer&gt; person1 = <span class="keyword">new</span> Person&lt;&gt;();</span><br><span class="line">        person1.setT(<span class="number">9</span>);</span><br><span class="line">        System.out.println(person.getT().getClass());</span><br><span class="line">        System.out.println(person1.getT().getClass());</span><br><span class="line">        System.out.println(person.getClass());<span class="comment">//class learn2.GenericTest$Person</span></span><br><span class="line">        System.out.println(person1.getClass());<span class="comment">//class learn2.GenericTest$Person</span></span><br><span class="line">        GenericTest test = <span class="keyword">new</span> GenericTest();</span><br><span class="line">        test.getArray(<span class="number">1</span>,<span class="number">23</span>,<span class="number">4</span>);</span><br><span class="line">        test.getArray(<span class="string">"f"</span>, <span class="string">"f"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> &lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> T t;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setT</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.t = t;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">getT</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½ å°±èƒ½å‘æŒ¥æƒ³è±¡åˆ›é€ ä»£ç äº†å‘€ï¼Œåˆ«çœ‹å®ƒåŠ äº†å°–æ‹¬å·å’Œç±»å‹ï¼Œå…¶å®çœ‹ç©¿äº†è¿˜æ˜¯ä¸€ä¸ªæ™®é€šç±»ã€‚é€šè¿‡Classæ¯”è¾ƒä½ éƒ½çœ‹ä¸åˆ°å…³äºæ³›å‹çš„ä¸œè¥¿</p><p>ä»¥åŠåç»­çš„ç»§æ‰¿</p><h4 id="æ³›å‹æ¥å£"><a href="#æ³›å‹æ¥å£" class="headerlink" title="æ³›å‹æ¥å£"></a>æ³›å‹æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Presenter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">attachView</span><span class="params">(T t)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dettachView</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å’Œæ³›å‹ç±»æ²¡å•¥ä¸åŒ</p><h4 id="æ³›å‹æ–¹æ³•"><a href="#æ³›å‹æ–¹æ³•" class="headerlink" title="æ³›å‹æ–¹æ³•"></a>æ³›å‹æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; T[] getArray(T ...ts) &#123;</span><br><span class="line">        <span class="keyword">return</span> ts;</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">static</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        <span class="keyword">int</span>[] nums = test.getArray(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">        String[] strs = test.getArray(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­æ˜¯æˆ‘æ¯”è¾ƒå–œæ¬¢çš„ï¼Œé€šè¿‡å˜é•¿çš„å‚æ•°è¿”å›æ•°ç»„ã€‚çœ‹åœ¨ä½ ä¼ å…¥å‚æ•°ä¸€åˆ¹é‚£ï¼Œå…¶å®å°±æ˜¯ç›¸å½“äºæŠŠç±»å‹å‚æ•°å¼„è¿›å…¥äº†ã€‚</p><h4 id="è¿›é˜¶ä½¿ç”¨"><a href="#è¿›é˜¶ä½¿ç”¨" class="headerlink" title="è¿›é˜¶ä½¿ç”¨"></a>è¿›é˜¶ä½¿ç”¨</h4><p>åœ¨jdkçš„ä»£ç ä¸­ä»¥åŠæ¡†æ¶å‘€å¤§é‡ä½¿ç”¨å…³äºæ³›å‹çš„ä¸œè¥¿ï¼Œè¯´æ˜äº†è¿™ç©æ„å¾ˆå¥½ä½¿ã€‚é€šè¿‡æ¥å£å®ç°ï¼Œæˆ–è€…ç±»çš„ç»§æ‰¿ä¸­åŠ å…¥æ³›å‹ï¼Œåˆèƒ½å¤Ÿå†™å‡ºå¯å¤ç”¨çš„ä»£ç ã€‚ä»¥åŠé…åˆé€šé…ç¬¦ï¼Œé…åˆå¤šæ€å‘€ï¼Œé‚£ç®€ç›´çˆ½çš„ä¸è¦ä¸è¦çš„ã€‚</p><p><code>extends</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPresenter</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">IView</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¯´æ˜äº†ä¼ å…¥çš„å‚æ•°ç±»å‹ï¼Œå¾—è¦æ˜¯IViewå­ç±»</span></span><br></pre></td></tr></table></figure><p>å¥½å§æˆ‘è€æ˜¯æŠŠ&lt;? extends T&gt; å’Œ <t extends sometype>ææ··ã€‚ã€‚</t></p><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><ul><li><p>æ³›å‹å‚æ•°ä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹</p></li><li><p>ä¸èƒ½å¸¦æ³›å‹ç”¨äº<code>instancof</code>å…³é”®å­—</p></li><li><p>ä¸å¯ä»¥ç”¨äºæ³›å‹æ•°ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;[] lists = <span class="keyword">new</span> ArrayList&lt;String&gt;[<span class="number">10</span>];<span class="comment">//æ— æ³•è¿™æ ·ä¸è¡Œçš„</span></span><br><span class="line">List&lt;String&gt;[] lists = <span class="keyword">new</span> ArrayList[<span class="number">10</span>];<span class="comment">//è¿™æ ·å´æ˜¯å¯ä»¥çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å”¯ä¸€çš„æ–¹å¼å°±æ˜¯åˆ›å»ºç±»å‹æ“¦å‡ºçš„æ•°ç»„ï¼Œç„¶åå†è½¬å‹</span></span><br><span class="line">List&lt;String&gt;[] lists = <span class="keyword">new</span> ArrayList[<span class="number">10</span>];</span><br><span class="line">lists[<span class="number">0</span>] = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">lists[<span class="number">0</span>].add(<span class="string">"aa"</span>);</span><br><span class="line">System.out.println(lists.getClass());</span><br></pre></td></tr></table></figure></li><li><p>ç±»å‹æ•è·</p><p>é€šåŒgetClassæ¥è·å–çœŸå®çš„ç±»å‹å’¯</p></li><li><p>æ³›å‹å’Œé‡è½½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span>&lt;<span class="title">T</span>,<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//å› ä¸ºæ³›å‹æ“¦åˆï¼Œæ‰€ä»¥äºŒè€…æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾å</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(List&lt;E&gt; list)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åŒæ ·</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(T t)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(E e)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è‡ªé™å®šçš„ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">C</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">//è¿™è‡ªé™å®šçš„ä¾‹å­æ¯”è¾ƒç®€å•ï¼Œå³é™å®šæ¯”è¾ƒå¯¹è±¡ä¸ºè‡ªå·±ï¼Œå…¶å®ä»”ç»†ç ”ç©¶è¿˜æ˜¯æ³›å‹çš„äº‹</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(C o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">A</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;&#125; <span class="comment">//è¿™ä¸ªæœ‰ç‚¹æŠ½è±¡ï¼Œä½†æ˜¯ä»”ç»†çœ‹å¥½åƒé™·å…¥ä¸€ä¸ªæ— é™å¾ªç¯æ ·å­</span></span><br><span class="line"><span class="comment">//é¦–å…ˆæˆ‘ä»¬ç»§æ‰¿å®ƒçœ‹çœ‹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span>&lt;<span class="title">B</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//è¿™æ ·å†™æ˜¯å¦åˆç†ï¼Œå°±çœ‹Bæ˜¯å¦èƒ½å¥—å…¥&lt;T extentd A&lt;T&gt;&gt; ä¸­ï¼Œå‘ƒå‘ƒï¼Œçœ‹äº†å¥½ä¹…ï¼Œæ˜¯å¯ä»¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é‚£ä¹ˆåˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œè¿™ä¸ªé€šå¸¸ç”¨äºç»§æ‰¿å…³ç³»ä¸­çš„é™å®šã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">A</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">         <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T t)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span>&lt;<span class="title">B</span>&gt; </span>&#123;<span class="comment">//è¿™ä¸ªæ³›å‹å‚æ•°åªèƒ½äº‹ç»§æ‰¿é“¾ä¸Šçš„ï¼Œæ¢äº†å…¶å®ƒçš„ä¸å¯ä»¥ï¼Œå°±æ˜¯è¿™æ˜¯å¦™ç”¨å•Š</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(B b)</span> </span>&#123;<span class="comment">//ç”±äºé™å®šäº†è¿™ä¸ªå®ç°çš„æ–¹æ³•å°±å¿…é¡»ä¸ºè‡ªå·±ã€‚å…¶å®ƒä¸è¡Œã€‚æœ‰æ„æ€å‘µå‘µ</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>å¼‚å¸¸å¤„ç†ä¸­catchæ˜¯ä¸èƒ½æ•è·æ³›å‹ç±»å‹çš„å¼‚å¸¸ï¼Œå› ä¸ºå†è¿è¡ŒæœŸé—´å¿…é¡»çŸ¥é“å¼‚å¸¸çš„ç¡®åˆ‡ç±»å‹</p></li></ul><h3 id="why"><a href="#why" class="headerlink" title="why"></a>why</h3><p>ç¼–å†™ç”¨äºå¤šç§ç±»å‹çš„ä»£ç ã€‚</p><h3 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦"></a>é€šé…ç¬¦</h3><p>å‰é¢çš„å…¶å®éƒ½è¿˜å¥½ç†è§£ï¼Œåˆ°äº†è¿™é‡Œå°±æœ‰ç‚¹è¦æƒ³æƒ³äº†ï¼Œä¸ç„¶å‚»å‚»åˆ†ä¸æ¸…æ¥šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?&gt;</span><br><span class="line">&lt;? extends E&gt; <span class="comment">//è¿™ä¸ªEä¸€èˆ¬å°±ä»£è¡¨å£°æ˜å‡ºæ¥çš„ç±»å‹å‚æ•°ã€‚æŒ‡ä»£ä½ å£°æ˜&lt;E&gt;</span></span><br><span class="line">&lt;? <span class="keyword">super</span> E&gt;</span><br></pre></td></tr></table></figure><h4 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h4><p>è¿˜æ˜¯çœ‹æ —å­æŠŠ2333</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> learn2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTest2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericTest2 test2 = <span class="keyword">new</span> GenericTest2();</span><br><span class="line">        List&lt;String&gt; stringList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        stringList.add(<span class="string">"aaa"</span>);</span><br><span class="line">        stringList.add(<span class="string">"bbb"</span>);</span><br><span class="line">        stringList.add(<span class="string">"ccc"</span>);</span><br><span class="line">        List&lt;Integer&gt; integerList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        integerList.add(<span class="number">1</span>);</span><br><span class="line">        integerList.add(<span class="number">2</span>);</span><br><span class="line">        integerList.add(<span class="number">3</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ?ä»»æ„</span></span><br><span class="line">        test2.runTest(stringList);</span><br><span class="line">        test2.runTest(integerList);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä¸Šç•Œä¸ºNumber</span></span><br><span class="line">        List&lt;Long&gt; longList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        test2.runTest2(longList, <span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä¸‹ç•ŒNumber</span></span><br><span class="line">        List&lt;Object&gt; objectList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        test2.runTest3(objectList, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runTest</span><span class="params">(List&lt;?&gt; list)</span> </span>&#123;<span class="comment">//å¯ä»¥æ¥å—ä»»æ„æ³›å‹å‚æ•°çš„List</span></span><br><span class="line">        list.add(<span class="keyword">null</span>);<span class="comment">//åªèƒ½å†™null</span></span><br><span class="line"><span class="comment">//        list.add(new Object());// error</span></span><br><span class="line">        System.out.println(list.get(<span class="number">3</span>).getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runTest2</span><span class="params">(List&lt;? extends Number&gt; list, Number number2)</span> </span>&#123;<span class="comment">//åªèƒ½æ¥å—æ³›å‹å‚æ•°ç»§æ‰¿Numberçš„List</span></span><br><span class="line">        Number number = list.get(<span class="number">0</span>);<span class="comment">// åªå¯ä»¥è¯»Numberç±»å‹</span></span><br><span class="line">        <span class="comment">//list.add(new Object());//å†™ä¸äº†</span></span><br><span class="line">        <span class="comment">//list.add(number2);//ç¼–è¯‘ä¸é€šè¿‡</span></span><br><span class="line">        <span class="comment">//list.add(number);//ç¼–è¯‘ä¸é€šè¿‡</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runTest3</span><span class="params">(List&lt;? <span class="keyword">super</span> Number&gt; list, Number number)</span> </span>&#123;<span class="comment">//åªèƒ½æ¥å—æ³›å‹å‚æ•°ä¸ºNumberçˆ¶ç±»çš„List</span></span><br><span class="line">        list.add(number);<span class="comment">//å¯ä»¥å†™Numberç±»å‹</span></span><br><span class="line">        <span class="comment">//list.add(new Object()); ä¸è¡Œ</span></span><br><span class="line">        Object object = list.get(<span class="number">0</span>);<span class="comment">//åªèƒ½æ•è·ä¸ºObject</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ†æä¸€æ³¢"><a href="#åˆ†æä¸€æ³¢" class="headerlink" title="åˆ†æä¸€æ³¢"></a>åˆ†æä¸€æ³¢</h4><ul><li><p><code>&lt;?&gt;</code>è¿™ä¸ªç»Ÿé…ç¬¦ä»£è¡¨ï¼Œå¯ä»¥æ¥å—ä»»æ„æ³›å‹å‚æ•°ï¼Œä¸ä¹‹åŒæ—¶ï¼Œå¯¹åº”çš„<code>List&lt;?&gt; list</code> å¯ä»¥æ¥å—<code>List&lt;Number&gt;</code> <code>List&lt;String&gt;</code>å¯¹è±¡ç­‰ç­‰ï¼Œæ‰€ä»¥å˜ï¼Œå®ƒä¹Ÿå°±æ ¹æœ¬ä¸çŸ¥é“å®é™…å¯¹è±¡ä¼šæ˜¯å¸¦ä»€ä¹ˆæ³›å‹å‚æ•°ï¼Œæ‰€ä»¥åªèƒ½<strong>å†™<code>null</code></strong>ï¼Œæˆ‘æ²¡æƒ³åˆ°çš„æ˜¯å±…ç„¶<strong>å†™Object</strong>ä¹Ÿä¸è¡Œï¼Œè¯»è¿˜æ˜¯çš„å•Šï¼Œä½†æ˜¯åªèƒ½ä¸ºObjectï¼Œæ²¡äº‹å•Šï¼Œä½ å¯åŠ¨æ€çš„<code>instance of</code>åˆ¤æ–­ä¸‹å˜›ï¼Œå†™æ­»è½¬æ¢è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå®ƒå‹æ ¹å•¥ä¹Ÿä¸çŸ¥é“ï¼Œå’±ä¹Ÿä¸æ•¢é—®æ˜¯å§ã€‚</p></li><li><p><code>&lt;? extends E&gt;</code>è¿™ä¸ªé€šé…ç¬¦ä»£è¡¨äº†ï¼Œå¯ä»¥æ¥å—å¸¦ä¸Šç•Œä¸ºEæ³›å‹å‚æ•°ã€‚å³ä½ çš„æ³›å‹å‚æ•°å¾—æ˜¯Eæˆ–Eçš„å­ç±»æ‰è¡Œ</p><p>List&lt;? extends Number&gt; listè¿™ä¸ªèƒ½èƒ½æ¥å—<code>List&lt;Int&gt;</code> <code>List&lt;Long&gt;</code>ç­‰ç­‰ä¸ºNumberçš„å­ç±»æ³›å‹å‚æ•° ã€‚å¯èƒ½æœ‰äººä¼šè§‰å¾—æœ‰äº†ä¸Šç•Œé‚£ä¸ä¸ºæ‰€æ¬²ä¸ºã€‚æˆ‘ä»¥å‰ä¹Ÿæ˜¯è¿™ä¹ˆè§‰å¾—çš„å“ˆå“ˆã€‚ä¸Šè¿°å®è·µå¾—çŸ¥ï¼Œåª<code>èƒ½å†™ä¸ºE</code>ï¼Œ<code>ä¸èƒ½è¯»ä¸ºE</code>ï¼Œå½“ç„¶èƒ½è¯»ä¸ºObjectã€‚å› ä¸ºå®ƒçŸ¥é“ä½ ä¼ è¿›æ¥çš„è‚¯å®šæ˜¯å¸¦Eåä»£æ³›å‹ï¼Œæ‰€ä»¥å‘¢ï¼Œæˆ‘é‡Œé¢çš„å…ƒç´ è‚¯å®šèƒ½è¡¨ç°ä¸ºEï¼Œæ‰€ä»¥è¯»æ˜¯æ²¡é—®é¢˜ã€‚ä½†æ˜¯å†™Eå°±æœ‰é—®é¢˜äº†ï¼Œæ¯”å¦‚æˆ‘æŸä¸€æ¬¡è¯†åˆ«çš„åˆ°æ˜¯Longï¼Œç„¶åä½ è¦å†™ä¸€ä¸ªNumberï¼Œä½ è¯´æ€ä¹ˆèƒ½å†™ã€‚</p></li><li><p><code>&lt;? super E&gt;</code> è¿™ä¸ªå°±åˆšå¥½äº†ä¸Šé¢é‚£ä¸ªç›¸åï¼ŒEä¸ºä¸‹ç•Œï¼Œå¯ä»¥æ¥å—Eçˆ¶ç±»ç­‰æ³›å‹å‚æ•°ã€‚å¯¹äºè¿™ä¸ªè€Œè¨€ï¼Œå°±åª<code>èƒ½å†™E</code>ï¼Œ<code>ä¸èƒ½è¯»E</code> ï¼Œä½ çš„æ³›å‹å‚æ•°ä¸ºè¶…ç±»ï¼Œä½ å‹æ ¹ä¸çŸ¥åˆ°å†…å®¹è¡¨ç°ä¸ºå…·ä½“æ˜¯ä¸ªå•¥ä¸œè¥¿ï¼Œæ‰€ä»¥è¯»å°±åˆ«æƒ³äº†ã€‚ä½†æ˜¯Eå¯ä»¥è¡¨ç°ä¸ºè¶…ç±»ï¼Œæ‰€ä»¥å†™Eå°±æ²¡é—®é¢˜å’¯ã€‚</p></li></ul><p>æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼š</p><p>&lt;?&gt; å¯ä»¥åŒ¹é…ä»»ä½•æ³›å‹å‚æ•°ï¼Œä½†æ˜¯åªèƒ½å†™null</p><p>&lt;? extends E&gt; å¯ä»¥åŒ¹é…Eçš„å­ç±»æ³›å‹å‚æ•°ï¼Œåªèƒ½è¯»Eï¼Œä¸èƒ½å†™E</p><p>&lt;? super E&gt; å¯ä»¥åŒ¹é…Eçš„è¶…ç±»æ³›å‹å‚æ•°ï¼Œä¸èƒ½è¯»Eï¼Œåªèƒ½å†™E</p><h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>å…¶å®æ³›å‹è¿™ä¸ªä¸œè¥¿å‘¢ï¼Œä»¥å‰æˆ‘æƒ³çš„å¤ªç®€å•äº†ï¼Œä¼ ä¸ªç±»å‹å‚æ•°å°±å®Œäº‹äº†ï¼Œä»¥å‰æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ï¼Œä½†æ˜¯çœ‹äº†ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ï¼Œå§æ§½è¿˜æœ‰è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œè€Œä¸”ç¨ç¨ä¸æ·±å…¥å°±ä¼šè¢«å¸¦è·‘åå‘ƒå‘ƒã€‚ç›®å‰è¿˜æ˜¯å½’çº³çš„ä¸å¤Ÿè¯¦ç»†ï¼Œä»¥åå­¦åˆ°å†è¡¥å……ï¼âœŒï¼Œå¯¹äº†æƒ³ä¸é€šçš„åœ°æ–¹ï¼Œæ²¡äº‹ä¸€å®šè¦æ•²ä¸€æ•²ï¼Œæ¯”çæƒ³å¼ºï¼Œæ€»æœ‰å¥½å¤„çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java å¹¶å‘æ¢³ç†</title>
      <link href="/2019/07/01/Java-%E5%B9%B6%E5%8F%91/"/>
      <url>/2019/07/01/Java-%E5%B9%B6%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>Java å¹¶å‘</p><h4 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h4><p>whatï¼šcpuè°ƒåº¦çš„æœ€å°å•ä½</p><p>åˆ›å»ºæ–¹å¼ï¼š</p><ul><li>ç»§æ‰¿Threadï¼Œå®ç°é‡å†™runæ–¹æ³•ï¼Œåˆ›å»ºThreadå¯¹è±¡ï¼Œè°ƒç”¨startæ–¹æ³•ã€‚</li><li>å®ç°Runnableï¼Œå®ç°runæ–¹æ³•ï¼Œåˆ›å»ºRunnableå¯¹è±¡ï¼Œä¼ å…¥Threadå¯¹è±¡ï¼Œè°ƒç”¨startæ–¹æ³•</li><li>åæ–‡çš„ä¸­Callable</li></ul><p>çº¿ç¨‹çš„çŠ¶æ€ï¼šæ–°å»ºï¼Œå¯æ‰§è¡Œï¼Œæ‰§è¡Œï¼Œé˜»å¡ï¼Œæ­»äº¡</p><p><img src="/images/1561517414845.png" alt="1561517414845"></p><p>yieldåªæ˜¯è®©å‡ºcpuçš„ä½¿ç”¨æƒï¼Œä¸‹æ¬¡è¿˜æœ‰å¯èƒ½æŠ¢å cpu</p><p>è°ƒç”¨å…¶å®ƒçº¿ç¨‹çš„joinï¼Œå½“å‰çº¿ç¨‹ä¼šé˜»å¡ï¼ŒçŸ¥é“é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚</p><h5 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h5><p>å¤šçº¿ç¨‹è®¿å¹¶å‘è®¿é—®å…±äº«èµ„æºï¼Œä¼šå¯¼è‡´æ•°æ®å®‰å…¨é—®é¢˜ã€‚</p><h6 id="synchronized-åŠ æ‚²è§‚é”"><a href="#synchronized-åŠ æ‚²è§‚é”" class="headerlink" title="synchronized åŠ æ‚²è§‚é”"></a>synchronized åŠ æ‚²è§‚é”</h6><p>é€šè¿‡synchronizedæ·»åŠ é”ï¼Œå¯ä»¥åŠ è½½æ–¹æ³•ä¸Šå’Œä»£ç å—ä¸Šã€‚åœ¨è¢«é”èµ·æ¥çš„åœ°æ–¹åªä¼šåˆä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œç›´åˆ°è¯¥ä»£ç æ‰§è¡Œå®Œæ¯•ã€‚è¯¥å®ç°ä¸ºjvmå†…ç½®å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">synchronized</span>(obj)&#123;&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹8é”é—®é¢˜ï¼š</p><p>synchronizedé”éœ€è¦çœ‹é”çš„å¯¹è±¡æ˜¯è°ï¼Œçº¿ç¨‹éœ€è¦é”å¯¹è±¡ä¸ºåŒä¸€ä¸ªçš„æƒ…å†µä¸‹ï¼Œè¿›å…¥äº†é”åŒºåŸŸå¦å¤–çš„çº¿ç¨‹å°±å¿…é¡»ç­‰å¾…ã€‚</p><ul><li>é”å¯¹è±¡ä¸ºæ™®é€šå¯¹è±¡</li><li>æ‰€å¯¹è±¡ä¸ºclasså¯¹è±¡ï¼Œå³åœ¨é™æ€æ–¹æ³•ä¸ŠåŠ é”</li></ul><p>è¦æ ¹æ®å…·ä½“é”å¯¹è±¡æ¥åˆ¤æ–­æ‰§è¡Œæ•ˆæœã€‚æŒæœ‰åŒä¸€é”å¯¹è±¡ï¼Œæ“ä½œå³ä¸ºäº’æ–¥ã€‚</p><h6 id="Lock-ä¹è§‚é”"><a href="#Lock-ä¹è§‚é”" class="headerlink" title="Lock ä¹è§‚é”"></a>Lock ä¹è§‚é”</h6><p>ä»£ç å®ç°ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œä¸ç„¶ä¼šé€ æˆæ­»é”ï¼Œéœ€è¦åœ¨finallyé‡Šæ”¾é”</p><p>æœ‰ä¸‰ä¸ªå®ç°ç±»</p><ul><li>ReentrantLock  å¯é‡å…¥é”</li><li>ReadLock è¯»é”ï¼Œé€šè¿‡new ReentrantReadWriteLock .readLock()è·å¾—</li><li>WriteLockå†™é”ï¼Œé€šè¿‡new ReentrantReadWriteLock .writeLock()è·å¾—</li></ul><p>è¯»å†™é”ï¼šè¯»å†™äº’æ–¥ï¼Œå†™å†™äº’æ–¥ï¼Œè¯»è¯»å…±äº«</p><p><strong>Condition</strong></p><p>åœ¨synchronizedé”ä¸‹é¢ï¼Œjvmæä¾›äº†obect.wait,å’Œnotifyï¼Œè¿™ä¸¤ä¸ªé€šä¿¡æ˜¯ä¾èµ–synchronizedå…³é”®å­—çš„ï¼Œä»ç­‰å¾…æ± åˆ°é”æ± ã€‚è€Œåœ¨Locké”ä¸‹ä¸ä¹‹å¯¹åº”çº¿ç¨‹é€šä¿¡çš„åˆ™æ˜¯Conditionå¯¹è±¡ï¼Œcondition.await()è¿›å…¥ç­‰å¾…å’Œcondition.sigal()å”¤é†’</p><h6 id="Lockå’Œsynchronizedçš„é€‰æ‹©"><a href="#Lockå’Œsynchronizedçš„é€‰æ‹©" class="headerlink" title="Lockå’Œsynchronizedçš„é€‰æ‹©"></a>Lockå’Œsynchronizedçš„é€‰æ‹©</h6><p>ã€€ã€€æ€»ç»“æ¥è¯´ï¼ŒLockå’Œsynchronizedæœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒï¼š</p><p>ã€€ã€€1ï¼‰Lockæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œsynchronizedæ˜¯Javaä¸­çš„å…³é”®å­—ï¼Œsynchronizedæ˜¯å†…ç½®çš„è¯­è¨€å®ç°ï¼›</p><p>ã€€ã€€2ï¼‰synchronizedåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹å æœ‰çš„é”ï¼Œå› æ­¤ä¸ä¼šå¯¼è‡´æ­»é”ç°è±¡å‘ç”Ÿï¼›è€ŒLockåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é€šè¿‡unLock()å»é‡Šæ”¾é”ï¼Œåˆ™å¾ˆå¯èƒ½é€ æˆæ­»é”ç°è±¡ï¼Œå› æ­¤ä½¿ç”¨Lockæ—¶éœ€è¦åœ¨finallyå—ä¸­é‡Šæ”¾é”ï¼›</p><p>ã€€ã€€3ï¼‰Lockå¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œè€Œsynchronizedå´ä¸è¡Œï¼Œä½¿ç”¨synchronizedæ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œä¸èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼›</p><p>ã€€ã€€4ï¼‰é€šè¿‡Lockå¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œsynchronizedå´æ— æ³•åŠåˆ°ã€‚</p><p>ã€€ã€€5ï¼‰Lockå¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œçš„æ•ˆç‡ã€‚</p><p>ã€€ã€€åœ¨æ€§èƒ½ä¸Šæ¥è¯´ï¼Œå¦‚æœç«äº‰èµ„æºä¸æ¿€çƒˆï¼Œä¸¤è€…çš„æ€§èƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œè€Œå½“ç«äº‰èµ„æºéå¸¸æ¿€çƒˆæ—¶ï¼ˆå³æœ‰å¤§é‡çº¿ç¨‹åŒæ—¶ç«äº‰ï¼‰ï¼Œæ­¤æ—¶Lockçš„æ€§èƒ½è¦è¿œè¿œä¼˜äºsynchronizedã€‚æ‰€ä»¥è¯´ï¼Œåœ¨å…·ä½“ä½¿ç”¨æ—¶è¦æ ¹æ®é€‚å½“æƒ…å†µé€‰æ‹©ã€‚</p><h6 id="é”çš„æ¦‚å¿µ"><a href="#é”çš„æ¦‚å¿µ" class="headerlink" title="é”çš„æ¦‚å¿µ"></a>é”çš„æ¦‚å¿µ</h6><p>ã€€ã€€<strong>1.å¯é‡å…¥é”</strong></p><p>å¦‚æœé”å…·å¤‡å¯é‡å…¥æ€§ï¼Œåˆ™ç§°ä½œä¸ºå¯é‡å…¥é”ã€‚åƒsynchronizedå’ŒReentrantLockéƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¯é‡å…¥æ€§åœ¨æˆ‘çœ‹æ¥å®é™…ä¸Šè¡¨æ˜äº†é”çš„åˆ†é…æœºåˆ¶ï¼šåŸºäºçº¿ç¨‹çš„åˆ†é…ï¼Œè€Œä¸æ˜¯åŸºäºæ–¹æ³•è°ƒç”¨çš„åˆ†é…ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°æŸä¸ªsynchronizedæ–¹æ³•æ—¶ï¼Œæ¯”å¦‚è¯´method1ï¼Œè€Œåœ¨method1ä¸­ä¼šè°ƒç”¨å¦å¤–ä¸€ä¸ªsynchronizedæ–¹æ³•method2ï¼Œæ­¤æ—¶çº¿ç¨‹ä¸å¿…é‡æ–°å»ç”³è¯·é”ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œæ–¹æ³•method2ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        method2();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>synchronizedå’ŒLockéƒ½å…·å¤‡å¯é‡å…¥æ€§</p><p>â€‹        <strong>2.å¯ä¸­æ–­é”</strong></p><p>ã€€ã€€å¯ä¸­æ–­é”ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯ä»¥ç›¸åº”ä¸­æ–­çš„é”ã€‚</p><p>ã€€ã€€åœ¨Javaä¸­ï¼Œsynchronizedå°±ä¸æ˜¯å¯ä¸­æ–­é”ï¼Œè€ŒLockæ˜¯å¯ä¸­æ–­é”ã€‚</p><p>ã€€ã€€å¦‚æœæŸä¸€çº¿ç¨‹Aæ­£åœ¨æ‰§è¡Œé”ä¸­çš„ä»£ç ï¼Œå¦ä¸€çº¿ç¨‹Bæ­£åœ¨ç­‰å¾…è·å–è¯¥é”ï¼Œå¯èƒ½ç”±äºç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œçº¿ç¨‹Bä¸æƒ³ç­‰å¾…äº†ï¼Œæƒ³å…ˆå¤„ç†å…¶ä»–äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒä¸­æ–­è‡ªå·±æˆ–è€…åœ¨åˆ«çš„çº¿ç¨‹ä¸­ä¸­æ–­å®ƒï¼Œè¿™ç§å°±æ˜¯å¯ä¸­æ–­é”ã€‚</p><p>ã€€ã€€åœ¨å‰é¢æ¼”ç¤ºlockInterruptibly()çš„ç”¨æ³•æ—¶å·²ç»ä½“ç°äº†Lockçš„å¯ä¸­æ–­æ€§ã€‚</p><p>â€‹        <strong>3.å…¬å¹³é”</strong></p><p>ã€€ã€€å…¬å¹³é”å³å°½é‡ä»¥è¯·æ±‚é”çš„é¡ºåºæ¥è·å–é”ã€‚æ¯”å¦‚åŒæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªé”ï¼Œå½“è¿™ä¸ªé”è¢«é‡Šæ”¾æ—¶ï¼Œç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹ï¼ˆæœ€å…ˆè¯·æ±‚çš„çº¿ç¨‹ï¼‰ä¼šè·å¾—è¯¥æ‰€ï¼Œè¿™ç§å°±æ˜¯å…¬å¹³é”ã€‚</p><p>ã€€ã€€éå…¬å¹³é”å³æ— æ³•ä¿è¯é”çš„è·å–æ˜¯æŒ‰ç…§è¯·æ±‚é”çš„é¡ºåºè¿›è¡Œçš„ã€‚è¿™æ ·å°±å¯èƒ½å¯¼è‡´æŸä¸ªæˆ–è€…ä¸€äº›çº¿ç¨‹æ°¸è¿œè·å–ä¸åˆ°é”ã€‚</p><p>ã€€ã€€åœ¨Javaä¸­ï¼Œsynchronizedå°±æ˜¯éå…¬å¹³é”ï¼Œå®ƒæ— æ³•ä¿è¯ç­‰å¾…çš„çº¿ç¨‹è·å–é”çš„é¡ºåºã€‚</p><p>ã€€ã€€è€Œå¯¹äºReentrantLockå’ŒReentrantReadWriteLockï¼Œå®ƒé»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³é”ï¼Œä½†æ˜¯å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”ã€‚</p><p><code>ReentrantLock lock = new</code> <code>ReentrantLock(true);</code></p><p>true ä¸ºå…¬å¹³ï¼Œfalseä¸ºä¸å…¬å¹³</p><p>å¦å¤–åœ¨ReentrantLockç±»ä¸­å®šä¹‰äº†å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><p>ã€€ã€€isFair()        //åˆ¤æ–­é”æ˜¯å¦æ˜¯å…¬å¹³é”</p><p>ã€€ã€€isLocked()    //åˆ¤æ–­é”æ˜¯å¦è¢«ä»»ä½•çº¿ç¨‹è·å–äº†</p><p>ã€€ã€€isHeldByCurrentThread()   //åˆ¤æ–­é”æ˜¯å¦è¢«å½“å‰çº¿ç¨‹è·å–äº†</p><p>ã€€ã€€hasQueuedThreads()   //åˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è¯¥é”</p><p>ã€€ã€€åœ¨ReentrantReadWriteLockä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ–¹æ³•ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ä¸è¿‡è¦è®°ä½ï¼ŒReentrantReadWriteLockå¹¶æœªå®ç°Lockæ¥å£ï¼Œå®ƒå®ç°çš„æ˜¯ReadWriteLockæ¥å£ã€‚</p><p>â€‹        <strong>4.è¯»å†™é”</strong></p><h6 id="Volatileå…³é”®å­—"><a href="#Volatileå…³é”®å­—" class="headerlink" title="Volatileå…³é”®å­—"></a><strong>Volatileå…³é”®å­—</strong></h6><p>å†…å­˜å¯è§æ€§æ˜¯æŒ‡å½“æŸä¸ªçº¿ç¨‹æ­£åœ¨ä½¿ç”¨å¯¹è±¡çŠ¶æ€è€Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨åŒæ—¶ä¿®æ”¹è¯¥çŠ¶æ€ï¼Œéœ€è¦ç¡®ä¿å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å¯¹è±¡çŠ¶æ€åï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°å‘ç”Ÿçš„çŠ¶æ€å˜åŒ–ã€‚å½“å¤šä¸ªçº¿ç¨‹è¿›è¡Œæ“ä½œå…±äº«æ•°æ®æ—¶ï¼Œå¯ä»¥ä¿è¯å†…å­˜ä¸­çš„æ•°æ®å¯è§ã€‚ç›¸è¾ƒäº synchronized æ˜¯ä¸€ç§è¾ƒä¸ºè½»é‡çº§çš„åŒæ­¥ç­–ç•¥</p><ol><li><p>volatile ä¸å…·å¤‡â€œäº’æ–¥æ€§â€</p></li><li><p>volatile ä¸èƒ½ä¿è¯å˜é‡çš„â€œåŸå­æ€§â€</p></li></ol><h6 id="CASç®—æ³•-æ— é”ç®—æ³•"><a href="#CASç®—æ³•-æ— é”ç®—æ³•" class="headerlink" title="CASç®—æ³• æ— é”ç®—æ³•"></a>CASç®—æ³• æ— é”ç®—æ³•</h6><p>åŸå­æ€§æ“ä½œé—®é¢˜ï¼ŒCASæ˜¯ä¸€ç§ç¡¬ä»¶å¯¹å¹¶å‘çš„æ”¯æŒï¼Œç”¨äºç®¡ç†å¯¹å…±äº«æ•°æ®çš„è®¿é—®ï¼ŒCASæ˜¯ä¸€ç§æ— é”çš„éé˜»å¡ç®—æ³•å®ç°</p><p>1ã€åŸå­å˜é‡ï¼šåœ¨java.util.concurrent.atomicåŒ…ä¸‹æä¾›äº†åŸºæœ¬çš„åŸå­å˜é‡</p><p>â€‹    ã€1ã€‘Volatileä¿è¯å†…å­˜å¯è§æ€§</p><p>â€‹    ã€2ã€‘CASç®—æ³•ä¿è¯æ•°æ®å˜é‡çš„åŸå­æ€§</p><p>2ã€CASç®—æ³•å®ç°CASåŒ…å«äº†ä¸‰ä¸ªæ“ä½œå˜é‡ï¼š</p><p>â€‹    ã€1ã€‘å†…å­˜å€¼V</p><p>â€‹    ã€2ã€‘å†…å­˜é¢„ä¼°å€¼A</p><p>â€‹    ã€3ã€‘å†…å­˜æ›´æ–°å€¼Bå½“ä¸”ä»…å½“V==Aæ—¶ï¼ŒV=Bï¼›å¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œæ¨¡æ‹ŸCASç®—æ³•</p><h5 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h5><h6 id="åŸºäºsynchronized-é”"><a href="#åŸºäºsynchronized-é”" class="headerlink" title="åŸºäºsynchronized é”"></a>åŸºäºsynchronized é”</h6><p>waitï¼šä¸­æ–­æ–¹æ³•çš„æ‰§è¡Œï¼Œä½¿æœ¬çº¿ç¨‹ç­‰å¾…ï¼Œæš‚æ—¶è®©å‡º cpu çš„ä½¿ç”¨æƒï¼Œå¹¶å…è®¸å…¶ä»–çº¿ç¨‹ä½¿ç”¨è¿™ä¸ªåŒæ­¥æ–¹æ³•ã€‚</p><p>notifyï¼šå”¤é†’ç”±äºä½¿ç”¨è¿™ä¸ªåŒæ­¥æ–¹æ³•è€Œå¤„äºç­‰å¾…çº¿ç¨‹çš„ æŸä¸€ä¸ªç»“æŸç­‰å¾…</p><p>notifyallï¼šå”¤é†’æ‰€æœ‰ç”±äºä½¿ç”¨è¿™ä¸ªåŒæ­¥æ–¹æ³•è€Œå¤„äºç­‰å¾…çš„çº¿ç¨‹ç»“æŸç­‰å¾…</p><p>é”æ± :å‡è®¾çº¿ç¨‹Aå·²ç»æ‹¥æœ‰äº†æŸä¸ªå¯¹è±¡(æ³¨æ„:ä¸æ˜¯ç±»)çš„é”ï¼Œè€Œå…¶å®ƒçš„çº¿ç¨‹æƒ³è¦è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æŸä¸ªsynchronizedæ–¹æ³•(æˆ–è€…synchronizedå—)ï¼Œç”±äºè¿™äº›çº¿ç¨‹åœ¨è¿›å…¥å¯¹è±¡çš„synchronizedæ–¹æ³•ä¹‹å‰å¿…é¡»å…ˆè·å¾—è¯¥å¯¹è±¡çš„é”çš„æ‹¥æœ‰æƒï¼Œä½†æ˜¯è¯¥å¯¹è±¡çš„é”ç›®å‰æ­£è¢«çº¿ç¨‹Aæ‹¥æœ‰ï¼Œæ‰€ä»¥è¿™äº›çº¿ç¨‹å°±è¿›å…¥äº†è¯¥å¯¹è±¡çš„é”æ± ä¸­ã€‚</p><p>ç­‰å¾…æ± :å‡è®¾ä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•ï¼Œçº¿ç¨‹Aå°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”åï¼Œè¿›å…¥åˆ°äº†è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­<br>æ‰€è°“å”¤é†’çº¿ç¨‹ï¼Œå¦ä¸€ç§è§£é‡Šå¯ä»¥è¯´æ˜¯å°†çº¿ç¨‹ç”±ç­‰å¾…æ± ç§»åŠ¨åˆ°é”æ± ï¼ŒnotifyAllè°ƒç”¨åï¼Œä¼šå°†å…¨éƒ¨çº¿ç¨‹ç”±ç­‰å¾…æ± ç§»åˆ°é”æ± ï¼Œç„¶åå‚ä¸é”çš„ç«äº‰ï¼Œç«äº‰æˆåŠŸåˆ™ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœä¸æˆåŠŸåˆ™ç•™åœ¨é”æ± ç­‰å¾…é”è¢«é‡Šæ”¾åå†æ¬¡å‚ä¸ç«äº‰ã€‚è€Œnotifyåªä¼šå”¤é†’ä¸€ä¸ªçº¿ç¨‹ã€‚</p><h6 id="åŸºäºLocké”"><a href="#åŸºäºLocké”" class="headerlink" title="åŸºäºLocké”"></a>åŸºäºLocké”</h6><p>ä»Lockä¸­è·å¾—Conditionï¼Œç±»ä¼¼äºä¸Šé¢çš„æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">awaitUninterruptibly</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">awaitNanos</span><span class="params">(<span class="keyword">long</span> var1)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> var1, TimeUnit var3)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">awaitUntil</span><span class="params">(Date var1)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">signalAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h4 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h4><h5 id="what"><a href="#what" class="headerlink" title="what"></a>what</h5><p>ç»´æŠ¤äº†ä¸€äº›çº¿ç¨‹çš„é˜Ÿåˆ—ï¼Œçº¿ç¨‹åˆ›å»ºå’Œé”€æ¯æ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ã€‚åˆ©ç”¨çº¿ç¨‹æ± æ¥é‡ç”¨è¿™äº›çº¿ç¨‹ï¼Œæé«˜äº†å“åº”é€Ÿåº¦</p><p>é™ä½ èµ„æºæ¶ˆè€—</p><p>æé«˜å“åº”é€Ÿåº¦</p><p>æé«˜çº¿ç¨‹çš„ å¯ç®¡ç†æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * ä¸€ã€çº¿ç¨‹æ± ï¼šæä¾›äº†ä¸€ä¸ªçº¿ç¨‹é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­ä¿å­˜ç€æ‰€æœ‰ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚é¿å…äº†åˆ›å»ºä¸é”€æ¯é¢å¤–å¼€é”€ï¼Œæé«˜äº†å“åº”çš„é€Ÿåº¦ã€‚</span><br><span class="line"> * </span><br><span class="line"> * äºŒã€çº¿ç¨‹æ± çš„ä½“ç³»ç»“æ„ï¼š</span><br><span class="line"> * java.util.concurrent.Executor : è´Ÿè´£çº¿ç¨‹çš„ä½¿ç”¨ä¸è°ƒåº¦çš„æ ¹æ¥å£</span><br><span class="line"> * |--**ExecutorService å­æ¥å£: çº¿ç¨‹æ± çš„ä¸»è¦æ¥å£</span><br><span class="line"> * |--ThreadPoolExecutor çº¿ç¨‹æ± çš„å®ç°ç±»</span><br><span class="line"> * |--ScheduledExecutorService å­æ¥å£ï¼šè´Ÿè´£çº¿ç¨‹çš„è°ƒåº¦</span><br><span class="line"> * |--ScheduledThreadPoolExecutor ï¼šç»§æ‰¿ ThreadPoolExecutorï¼Œ å®ç° ScheduledExecutorService</span><br><span class="line"> * </span><br><span class="line"> * ä¸‰ã€å·¥å…·ç±» : Executors </span><br><span class="line"> * ExecutorService newFixedThreadPool() : åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </span><br><span class="line"> * ExecutorService newCachedThreadPool() : ç¼“å­˜çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„æ•°é‡ä¸å›ºå®šï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è‡ªåŠ¨çš„æ›´æ”¹æ•°é‡ã€‚</span><br><span class="line"> * ExecutorService newSingleThreadExecutor() : åˆ›å»ºå•ä¸ªçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹</span><br><span class="line"> * </span><br><span class="line"> * ScheduledExecutorService newScheduledThreadPool() : åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹ï¼Œå¯ä»¥å»¶è¿Ÿæˆ–å®šæ—¶çš„æ‰§è¡Œä»»åŠ¡ã€‚</span><br><span class="line"> */</span><br></pre></td></tr></table></figure><h5 id="how"><a href="#how" class="headerlink" title="how"></a>how</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">execute æ‰§è¡Œä»»åŠ¡</span><br><span class="line">submit æäº¤ä»»åŠ¡ï¼Œå¹¶ä¸”è¿”å›Future</span><br><span class="line">shutDown ä¸­æ­¢çº¿ç¨‹æ± ï¼Œè®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNï¼Œä¸­æ–­æ²¡æœ‰è¿è¡Œçš„çº¿ç¨‹</span><br><span class="line">shtDownNow ä¸­æ­¢çº¿ç¨‹æ± ï¼Œè®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNï¼Œ å°è¯•åœæ­¢æ‰€æœ‰çº¿ç¨‹ï¼Œå¹¶è¿”å›ç­‰å¾…ä»»åŠ¡é˜Ÿåˆ—</span><br><span class="line">ä¸åŒåº”ç”¨åœºæ™¯ä½¿ç”¨ä¸åŒçš„é…ç½®çº¿ç¨‹</span><br><span class="line">ä»»åŠ¡çš„æ€§è´¨ï¼šCPUå¯†é›†å‹ä»»åŠ¡ã€IOå¯†é›†å‹ä»»åŠ¡å’Œæ··åˆå‹ä»»åŠ¡</span><br><span class="line">ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼šé«˜ã€ä¸­å’Œä½</span><br><span class="line">ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼šé•¿ã€ä¸­å’ŒçŸ­</span><br><span class="line">ä»»åŠ¡çš„ä¾èµ–æ€§ï¼šæ˜¯å¦ä¾èµ–å…¶ä»–ç³»ç»Ÿèµ„æºï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€‚</span><br><span class="line">CPUå¯†é›†å‹ä»»åŠ¡</span><br><span class="line">åº”é…ç½®å°½å¯èƒ½å°çš„çº¿ç¨‹,é…ç½®</span><br><span class="line">N(CPU)+<span class="number">1</span>æˆ–è€… N(CPU) * <span class="number">2</span></span><br><span class="line">I/Oå¯†é›†å‹ä»»åŠ¡</span><br><span class="line">ä¸šåŠ¡è¯»å–è¾ƒå¤š,çº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œä»»åŠ¡,åˆ™åº”é…ç½®å°½å¯èƒ½å¤šçš„çº¿ç¨‹</span><br><span class="line">N(CPU)/<span class="number">1</span> - é˜»å¡ç³»æ•°(<span class="number">0.8</span>~<span class="number">0.9</span>)</span><br><span class="line">æ··åˆå‹çš„ä»»åŠ¡,å¦‚æœå¯ä»¥æ‹†åˆ†,å°†å…¶æ‹†åˆ†æˆä¸€ä¸ªCPUå¯†é›†å‹ä»»åŠ¡å’Œä¸€ä¸ªIOå¯†é›†å‹ä»»åŠ¡,åªè¦è¿™ä¸¤ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ç›¸å·®ä¸æ˜¯å¤ªå¤§,é‚£ä¹ˆåˆ†è§£åæ‰§è¡Œçš„ååé‡å°†é«˜äºä¸²è¡Œæ‰§è¡Œçš„ååé‡.å¦‚æœè¿™ä¸¤ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´ç›¸å·®å¤ªå¤§,åˆ™æ²¡å¿…è¦è¿›è¡Œåˆ†è§£.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">             Executors.defaultThreadFactory(), defaultHandler);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…³äºçº¿ç¨‹æ± æ„é€ æ–¹æ³•å‚æ•°è¯´æ˜ï¼š</p><p>corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°é‡</p><p>maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°é‡</p><p>keepAliveTime å­˜æ´»æ—¶é—´</p><p>TimeUnit æ—¶é—´å•ä½</p><p>workQueue ç­‰å¾…é˜Ÿåˆ—</p><h5 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h5><ul><li>AbortPolicyï¼šä¸¢å¼ƒä»»åŠ¡ï¼ŒæŠ›å‡º RejectedExecutionException</li><li>CallerRunsPolicy:åªç”¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡,æœ‰åé¦ˆæœºåˆ¶ï¼Œä½¿ä»»åŠ¡æäº¤çš„é€Ÿåº¦å˜æ…¢ï¼‰ã€‚</li><li>DiscardOldestPolicy<br>è‹¥æ²¡æœ‰å‘ç”Ÿshutdown,å°è¯•ä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡,å¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡, ä¸¢å¼ƒä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ä¸­æœ€è€çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å°è¯•é‡æ–°æäº¤æ–°çš„ä»»åŠ¡</li><li>DiscardPolicy:ä¸å¤„ç†,ä¸¢å¼ƒæ‰, æ‹’ç»æ‰§è¡Œï¼Œä¸æŠ›å¼‚å¸¸<br>å½“ç„¶,ä¹Ÿå¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯éœ€è¦æ¥å®ç°RejectedExecutionHandleræ¥å£è‡ªå®šä¹‰ç­–ç•¥.å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–å­˜å‚¨ä¸èƒ½å¤„ç†çš„ä»»åŠ¡  </li></ul><p>ä¸€ä¸ªä»»åŠ¡è¢«æäº¤åˆ°çº¿ç¨‹æ± ä¸­ï¼Œé¦–å…ˆä¼šå»æ£€æŸ¥æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦è¾¾æœ€å¤§ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºæ–°çº¿æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœæ ¸å¿ƒçº¿ç¨‹è¾¾æœ€å¤§ä¸”éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œä¸‹ä¸€æ­¥å°†ä¼šå»åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦æ»¡ï¼Œå¦‚æœæ²¡æœ‰æ»¡åˆ™å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œå¦‚æœæ»¡äº†åˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œæ­¤æ—¶çº¿ç¨‹æ± æœ€å¤§èƒ½è¾¾åˆ°çš„çº¿ç¨‹æ•°é‡å³ä¸ºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹ç©ºé—²ä¹‹åç­‰å¾…å­˜æ´»æ—¶é—´åå°±ä¼šæ€æ­»çº¿ç¨‹ã€‚çŸ¥é“çº¿ç¨‹æ•°é‡ç»´æŒåœ¨æ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€‚</p><p>è¿™æ ·å°±å¥½æ¯”å¦‚ä¸€ä¸ªå·¥å‚æœ¬æ¥åˆå››ä¸ªäººåœ¨å·¥ä½œï¼Œä½†æ˜¯è®¢å•å¢åŠ äº†ï¼Œä½†æ˜¯èƒ½å·¥å‚è´Ÿè´£äººè®¤ä¸ºå·¥äººè¿˜èƒ½æ‰¿å—ä½ï¼Œäºæ˜¯å°±å°†ç´¯è®¡çš„è®¢å•æ¥æ’é˜Ÿï¼Œæ—¶é—´ä¸€é•¿è¿˜æ˜¯èƒ½å®Œæˆï¼Œä½†æ˜¯éšç€è®¢å•çš„å¢åŠ ï¼Œå·¥å‚çš„æ’é˜Ÿå·²ç»æ’ä¸ä¸‹äº†ã€‚å·¥å‚è´Ÿè´£äººæ‹›äº†äº†ä¸€äº›äº†ä¸´æ—¶å·¥å‚ä¸å·¥ä½œï¼Œéšç€æ—¶é—´æ¨ç§»è®¢å•è¿˜åœ¨å¢åŠ ï¼Œæ­¤æ—¶æ’é˜Ÿæ»¡äº†ï¼Œå·¥äººå·¥ä½œçš„ä½ç½®ä¹Ÿæ»¡äº†ã€‚æ­¤æ—¶å·¥å‚è´Ÿè´£äººå°±è¦è€ƒè™‘ä½¿ç”¨é‚£ç§ç­–ç•¥æ¥å¯¹å¾…æ–°çš„è®¢å•ã€‚å½“è®¢å•å‡å°‘äº†ï¼Œä¸´æ—¶å·¥æ²¡äº‹åšäº†ï¼Œæ­¤æ—¶å·¥å‚è´Ÿè´£äººä¸ºäº†æˆæœ¬è€ƒè™‘ï¼Œå°±è¦æ’¤ä¸‹ä¸´æ—¶å·¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> c = ctl.get();</span><br><span class="line"><span class="comment">//å·¥ä½œä»»åŠ¡å°äºæ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line"><span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">    <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))<span class="comment">//åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    c = ctl.get();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå°è¯•å…¥å·¥ä½œé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">    <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">    <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">        reject(command);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">        addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">&#125;<span class="comment">//å…¥é˜Ÿåˆ—å¤±è´¥ï¼Œå°è¯•æ–°å¢çº¿ç¨‹ï¼Œæ­¤æ—¶çº¿ç¨‹æ•°å³å°†å¤§äºæ ¸å¿ƒçº¿ç¨‹ï¼Œä½†æ˜¯è¦å°äºæœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">    reject(command);<span class="comment">//è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œé‡‡å–æ‹’ç»ç­–ç•¥</span></span><br></pre></td></tr></table></figure><h5 id="å…³äºè·å–Worker"><a href="#å…³äºè·å–Worker" class="headerlink" title="å…³äºè·å–Worker"></a>å…³äºè·å–Worker</h5><p>çº¿ç¨‹æ± ç»´æŒä¸€ä¸ªWorkerçš„HashSetï¼ŒWorkæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªRunnableï¼Œå†…éƒ¨åŒ…å«äº†ä¸€ä¸ªç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå’Œä¸€ä¸ªThreadå¯¹è±¡ï¼ˆçº¿ç¨‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªworkæŒæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹åœ¨addWorkeræˆåŠŸæ—¶ï¼Œä¼šå»å¼€å¯çº¿ç¨‹ã€‚ä¹Ÿå°±æ˜¯è°ƒç”¨çº¿ç¨‹æ± å¤–å›´çš„runWorkeræ–¹æ³•ã€‚ä»è¿™é‡Œå°±å¼€å§‹è¿›å…¥workerçš„çº¿ç¨‹ä»»åŠ¡äº†ï¼Œåœ¨çº¿ç¨‹ä¸­å¼€å¯whileå¾ªç¯å»è·å¾—Taskï¼ŒTaskçš„è·å¾—åŒæ ·æ—¶å¾ªç¯å»é˜»å¡é˜Ÿåˆ—æ‹¿runnableã€‚å¦‚æœå·¥ä½œé˜Ÿåˆ—ç©ºäº†ï¼Œæ‹¿å–è¶…æ—¶ï¼Œåˆ™ä¼šå»å‡å°‘Workeræ•°é‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.....</span><br><span class="line">//Workerç±»</span><br><span class="line">Worker(Runnable firstTask) &#123;</span><br><span class="line">            setState(-1); // inhibit interrupts until runWorker</span><br><span class="line">            this.firstTask = firstTask;</span><br><span class="line">            this.thread = getThreadFactory().newThread(this);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /** Delegates main run loop to outer runWorker. */</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            runWorker(this);</span><br><span class="line">        &#125;</span><br><span class="line">....</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//addWorkeæ–¹æ³• </span></span><br><span class="line">w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">            <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">            <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">                mainLock.lock();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// Recheck while holding lock.</span></span><br><span class="line">                    <span class="comment">// Back out on ThreadFactory failure or if</span></span><br><span class="line">                    <span class="comment">// shut down before lock acquired.</span></span><br><span class="line">                    <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (rs &lt; SHUTDOWN ||</span><br><span class="line">                        (rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                        workers.add(w);</span><br><span class="line">                        <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                        <span class="keyword">if</span> (s &gt; largestPoolSize)</span><br><span class="line">                            largestPoolSize = s;</span><br><span class="line">                        workerAdded = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    mainLock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (workerAdded) &#123;</span><br><span class="line">                    t.start();</span><br><span class="line">                    workerStarted = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//runThisæ–¹æ³•</span></span><br><span class="line"><span class="keyword">while</span> (task != <span class="keyword">null</span> || (task = getTask()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                w.lock();</span><br><span class="line">                <span class="comment">// If pool is stopping, ensure thread is interrupted;</span></span><br><span class="line">                <span class="comment">// if not, ensure thread is not interrupted.  This</span></span><br><span class="line">                <span class="comment">// requires a recheck in second case to deal with</span></span><br><span class="line">                <span class="comment">// shutdownNow race while clearing interrupt</span></span><br><span class="line">                <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                     (Thread.interrupted() &amp;&amp;</span><br><span class="line">                      runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                    !wt.isInterrupted())</span><br><span class="line">                    wt.interrupt();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    beforeExecute(wt, task);</span><br><span class="line">                    Throwable thrown = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        task.run();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (RuntimeException x) &#123;</span><br><span class="line">                        thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Error x) &#123;</span><br><span class="line">                        thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Throwable x) &#123;</span><br><span class="line">                        thrown = x; <span class="keyword">throw</span> <span class="keyword">new</span> Error(x);</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        afterExecute(task, thrown);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    task = <span class="keyword">null</span>;</span><br><span class="line">                    w.completedTasks++;</span><br><span class="line">                    w.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) &#123;</span><br><span class="line">               decrementWorkerCount();</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Are workers subject to culling?</span></span><br><span class="line">           <span class="keyword">boolean</span> timed = allowCoreThreadTimeOut || wc &gt; corePoolSize;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut))</span><br><span class="line">               &amp;&amp; (wc &gt; <span class="number">1</span> || workQueue.isEmpty())) &#123;</span><br><span class="line">               <span class="keyword">if</span> (compareAndDecrementWorkerCount(c))</span><br><span class="line">                   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://www.nowcoder.com/discuss/152050?type=0&amp;order=0&amp;pos=6&amp;page=0" target="_blank" rel="noopener">https://www.nowcoder.com/discuss/152050?type=0&amp;order=0&amp;pos=6&amp;page=0</a></p><h4 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h4><h5 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h5><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/yudiandemingzi/article/details/82318390" target="_blank" rel="noopener">https://blog.csdn.net/yudiandemingzi/article/details/82318390</a></p><p>å†…éƒ¨åŸºäºLocké”çš„é€šä¿¡å®ç°ç­‰å¾…é˜»å¡ã€‚</p><h5 id="å¹¶å‘å®¹å™¨"><a href="#å¹¶å‘å®¹å™¨" class="headerlink" title="å¹¶å‘å®¹å™¨"></a>å¹¶å‘å®¹å™¨</h5><p>ConcurrentMap</p><p>CopyOnWriteList</p><h5 id="åŸå­å˜é‡"><a href="#åŸå­å˜é‡" class="headerlink" title="åŸå­å˜é‡"></a>åŸå­å˜é‡</h5><p>ç¡¬ä»¶çº§åˆ«å®ç°ï¼Œæ™®é€šå˜é‡intè¿›è¡Œè‡ªå¢æ—¶ï¼Œåœ¨jvmè¡¨ç°çœ‹æ¥ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæ‰€ä»¥çº¿ç¨‹å°±æœ‰å¯èƒ½æ‰“æ–­ï¼Œä»è€Œé€ æˆæ•°æ®å®‰å…¨é—®é¢˜ã€‚</p><p>è€ŒåŸå­å˜é‡é€šè¿‡ä½¿ç”¨volatileæ¥ä¿è¯å†…å­˜å¯è§æ€§ä»¥åŠé€šè¿‡casç®—æ³•ä¿è¯åŸå­æ€§ã€‚</p><h5 id="CountDownLatch-é—­é”"><a href="#CountDownLatch-é—­é”" class="headerlink" title="CountDownLatch é—­é”"></a>CountDownLatch é—­é”</h5><p>ä¹Ÿå¯ä»¥å«å€’è®¡æ•°å™¨</p><p>what:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºè®¡æ•°ä¸º10çš„é—­é”</span></span><br><span class="line">CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//è®¡æ•°å‡ä¸€</span></span><br><span class="line">countDownLath.countDown();</span><br><span class="line"><span class="comment">//çº¿ç¨‹ç­‰å¾…,ç›´åˆ°è®¡æ•°ä¸º0</span></span><br><span class="line">countDownLath.await();</span><br></pre></td></tr></table></figure><p>åœ¨çº¿ç¨‹å®ŒæˆæŸé¡¹æ“ä½œä¹‹å‰å®ƒå…è®¸è®©ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è¿›è¡Œç­‰å¾…ã€‚å€’è®¡æ•°ï¼Œåœ¨å†…éƒ¨è®¡æ•°åˆ°é›¶ä¹‹å‰ï¼Œæ‰€è°ƒç”¨countDownLatch.awaitçš„çº¿ç¨‹ä¼šç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°åˆ°è¾¾0ä¸ºæ­¢ã€‚ </p><p>how:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> learn2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CountDownLatchTest test = <span class="keyword">new</span> CountDownLatchTest();</span><br><span class="line">        test.runTest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">2</span>);</span><br><span class="line">        Thread threadA = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        Thread threadB = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        threadA.start();</span><br><span class="line">        threadB.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Main is waiting."</span>);</span><br><span class="line">            countDownLatch.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"Main is over"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CountDownLatch countDownLatch;</span><br><span class="line"></span><br><span class="line">    Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Current Thred is "</span> + Thread.currentThread().getId() + <span class="string">",print : "</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line">Main is waiting.</span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">0</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">0</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">1</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">1</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">2</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">3</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">4</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">5</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">2</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">6</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">3</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">7</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">4</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">8</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">5</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">6</span></span><br><span class="line">Current Thred is <span class="number">12</span>,print : <span class="number">9</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">7</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">8</span></span><br><span class="line">Current Thred is <span class="number">13</span>,print : <span class="number">9</span></span><br><span class="line">Main is over</span><br></pre></td></tr></table></figure><h5 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h5><p>Whatï¼šæ …æ ï¼Œç±»ä¼¼äºé—­é”ï¼Œä½†æ˜¯å‘¢ï¼Œé—­é”æ˜¯ç­‰å¾…äº‹ä»¶ï¼Œå³çº¿ç¨‹ç­‰å¾…åˆ°countDownæ•°é‡ä¸º0ä¸ºæ­¢ã€‚è€Œæ …æ åˆ™æ˜¯ï¼Œçº¿ç¨‹åˆ°è¾¾æ …æ å¼€å§‹ç­‰å¾…ï¼ŒçŸ¥é“æ‰€æœ‰çº¿ç¨‹éƒ½è¾¾åˆ°æ …æ äº†ï¼Œå°±ä¸åœ¨ç­‰å¾…ã€‚è€Œä¸”é—­é”ä½¿ç”¨ä¸€æ¬¡ï¼Œæ …æ å¯ä»¥é‡ç½®ï¼Œç»§ç»­ä½¿ç”¨ã€‚</p><blockquote><p>ä¹¦ä¸Šæ˜¯è¿™ä¹ˆè¯´çš„ï¼šä½ å¸Œæœ›åˆ›å»ºä¸€ç»„ä»»åŠ¡ï¼Œä½¿ä»–ä»¬å¹¶è¡Œæ‰§è¡Œï¼Œç„¶åä¸‹ä¸€ä¸ªæ­¥éª¤ä¹‹å‰ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œå®ƒä½¿å¾—æ‰€æœ‰å¹¶è¡Œä»»åŠ¡åœ¨æ …æ å¤„æ’é˜Ÿï¼Œå› æ­¤å¯ä»¥ä¸€è‡´çš„å‘å‰ç§»åŠ¨ã€‚</p></blockquote><p>Howï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ„é€ æ–¹æ³•</span></span><br><span class="line">CyclicBarrier(<span class="keyword">int</span> parties);<span class="comment">//parties è¡¨ç¤ºä¼šæœ‰å¤šå°‘åˆ°è¾¾çš„æ …æ çš„çº¿ç¨‹</span></span><br><span class="line">CyclicBarrier(<span class="keyword">int</span> parties, Runnable barrierAction);<span class="comment">//barrierAction æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾æ …æ ï¼Œä¼šè§¦å‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å…³é”®æ–¹æ³•</span></span><br><span class="line">await();<span class="comment">//æŸçº¿ç¨‹åˆ°è¾¾æ …æ ï¼Œå¹¶ä¸”ç­‰å¾…ï¼ŒçŸ¥é“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æ …æ </span></span><br><span class="line">reset();<span class="comment">//é‡ç½®æ …æ åˆ°åˆå§‹çŠ¶æ€</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> learn2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CyclicBarrierTest test = <span class="keyword">new</span> CyclicBarrierTest();</span><br><span class="line">        test.runTest();</span><br><span class="line">    &#125;</span><br><span class="line">    CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(runnable, <span class="string">"thread "</span> + i);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"for is over"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Runnable runnable = () -&gt; &#123;</span><br><span class="line">        System.out.println( Thread.currentThread().getName() + <span class="string">" waited"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            cyclicBarrier.await();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" wake up"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//outputs å¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ•ˆæœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> is over</span><br><span class="line">thread <span class="number">2</span> waited</span><br><span class="line">thread <span class="number">1</span> waited</span><br><span class="line">thread <span class="number">3</span> waited</span><br><span class="line">thread <span class="number">0</span> waited</span><br><span class="line">thread <span class="number">4</span> waited</span><br><span class="line">thread <span class="number">4</span> wake up</span><br><span class="line">thread <span class="number">1</span> wake up</span><br><span class="line">thread <span class="number">0</span> wake up</span><br><span class="line">thread <span class="number">3</span> wake up</span><br><span class="line">thread <span class="number">2</span> wake up</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><h5 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h5><p>Whatï¼šç›®å‰çš„Runnableæ‰§è¡Œæ–¹å¼æ˜¯æ— æ³•è¿”å›æ•°æ®çš„ã€‚ä½¿ç”¨Callableåˆ›å»ºçº¿ç¨‹ä»¥åŠé…åˆFutureTaskä½¿ç”¨</p><p>FurtureTask.getæ—¶ä¼šæ‰€åœ¨çº¿ç¨‹é”ç­‰FurtureTaskæ‰§è¡Œå®Œæ¯•</p><p>Howï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä¸€ã€åˆ›å»ºæ‰§è¡Œçº¿ç¨‹çš„æ–¹å¼ä¸‰ï¼šå®ç° Callable æ¥å£ã€‚ ç›¸è¾ƒäºå®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œæ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* äºŒã€æ‰§è¡Œ Callable æ–¹å¼ï¼Œéœ€è¦ FutureTask å®ç°ç±»çš„æ”¯æŒï¼Œç”¨äºæ¥æ”¶è¿ç®—ç»“æœã€‚  FutureTask æ˜¯  Future æ¥å£çš„å®ç°ç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCallable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ThreadDemo td = <span class="keyword">new</span> ThreadDemo();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//1.æ‰§è¡Œ Callable æ–¹å¼ï¼Œéœ€è¦ FutureTask å®ç°ç±»çš„æ”¯æŒï¼Œç”¨äºæ¥æ”¶è¿ç®—ç»“æœã€‚</span></span><br><span class="line">        FutureTask&lt;Integer&gt; result = <span class="keyword">new</span> FutureTask&lt;&gt;(td);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">new</span> Thread(result).start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2.æ¥æ”¶çº¿ç¨‹è¿ç®—åçš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Integer sum = result.get();  <span class="comment">//FutureTask å¯ç”¨äº é—­é”</span></span><br><span class="line">            System.out.println(sum);</span><br><span class="line">            System.out.println(<span class="string">"------------------------------------"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h5><h5 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h5><h5 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h5><p>Whatï¼šç»§æ‰¿è‡ªAbstractExecutorServiceï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹æ± ï¼Œé€šè¿‡åˆ†æ²»æ³•æ¥åˆ†æ‹†åˆå¹¶ä»»åŠ¡ï¼Œä½¿ç”¨æœ‰é™çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ä»»åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.juc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.time.Instant;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinTask;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.RecursiveTask;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.LongStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestForkJoinPool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Instant start = Instant.now();</span><br><span class="line"></span><br><span class="line">ForkJoinPool pool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line"></span><br><span class="line">ForkJoinTask&lt;Long&gt; task = <span class="keyword">new</span> ForkJoinSumCalculate(<span class="number">0L</span>, <span class="number">50000000000L</span>);</span><br><span class="line"></span><br><span class="line">Long sum = pool.invoke(task);</span><br><span class="line"></span><br><span class="line">System.out.println(sum);</span><br><span class="line"></span><br><span class="line">Instant end = Instant.now();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"è€—è´¹æ—¶é—´ä¸ºï¼š"</span> + Duration.between(start, end).toMillis());<span class="comment">//166-1996-10590</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">Instant start = Instant.now();</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> sum = <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0L</span>; i &lt;= <span class="number">50000000000L</span>; i++) &#123;</span><br><span class="line">sum += i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(sum);</span><br><span class="line"></span><br><span class="line">Instant end = Instant.now();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"è€—è´¹æ—¶é—´ä¸ºï¼š"</span> + Duration.between(start, end).toMillis());<span class="comment">//35-3142-15704</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//java8 æ–°ç‰¹æ€§</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">Instant start = Instant.now();</span><br><span class="line"></span><br><span class="line">Long sum = LongStream.rangeClosed(<span class="number">0L</span>, <span class="number">50000000000L</span>)</span><br><span class="line"> .parallel()</span><br><span class="line"> .reduce(<span class="number">0L</span>, Long::sum);</span><br><span class="line"></span><br><span class="line">System.out.println(sum);</span><br><span class="line"></span><br><span class="line">Instant end = Instant.now();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"è€—è´¹æ—¶é—´ä¸ºï¼š"</span> + Duration.between(start, end).toMillis());<span class="comment">//1536-8118</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkJoinSumCalculate</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Long</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">259195479995561737L</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> start;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> end;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> THURSHOLD = <span class="number">10000L</span>;  <span class="comment">//ä¸´ç•Œå€¼</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ForkJoinSumCalculate</span><span class="params">(<span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.start = start;</span><br><span class="line"><span class="keyword">this</span>.end = end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Long <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">long</span> length = end - start;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(length &lt;= THURSHOLD)&#123;</span><br><span class="line"><span class="keyword">long</span> sum = <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">long</span> i = start; i &lt;= end; i++) &#123;</span><br><span class="line">sum += i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">long</span> middle = (start + end) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">ForkJoinSumCalculate left = <span class="keyword">new</span> ForkJoinSumCalculate(start, middle); </span><br><span class="line">left.fork(); <span class="comment">//è¿›è¡Œæ‹†åˆ†ï¼ŒåŒæ—¶å‹å…¥çº¿ç¨‹é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">ForkJoinSumCalculate right = <span class="keyword">new</span> ForkJoinSumCalculate(middle+<span class="number">1</span>, end);</span><br><span class="line">right.fork(); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> left.join() + right.join();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java åå°„</title>
      <link href="/2019/07/01/Java-%E5%8F%8D%E5%B0%84/"/>
      <url>/2019/07/01/Java-%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<p>Java åå°„</p><ul><li>ç±»åŠ è½½å™¨</li><li>åå°„</li><li>åŠ¨æ€ä»£ç†</li></ul><p>whatï¼šåœ¨è¿è¡Œæ—¶åŠ è½½æŸä¸ªç±»ï¼Œè·å¾—æŸä¸ªç±»çš„ç›¸å…³ä¿¡æ¯ï¼Œä»¥åŠè¿›è¡Œæ“ä½œã€‚</p><h4 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h4><p>what:ç”¨äºå°†èŠ‚å­—ç æ–‡ä»¶åŠ è½½åˆ°JVM</p><ul><li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼šbootstrapï¼Œc++ç¼–å†™ï¼Œjvmè‡ªå¸¦ï¼Œè´Ÿè´£åŠ è½½rt.jarï¼ˆruntimeï¼‰ï¼Œæ— æ³•ç›´æ¥è·å–ï¼Œå®ƒæ˜¯æ‰€æœ‰ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨</li><li>æ‰©å±•ç±»åŠ è½½å™¨ï¼šextension ï¼Œjdk_home/lib/extç›®å½•ä¸‹çš„jaråŒ…æˆ–è€… -D java.ext.dirsæŒ‡å®šç›®å½•ä¸‹çš„jaråŒ…è£…å…¥å·¥ä½œåº“</li><li>System ClassLoader ï¼šè´Ÿè´£java -classpathæˆ–è€…-D java.class.pathæ‰€æŒ‡ç›®å½• ä¸‹çš„ç±»å’ŒjaråŒ…è£…å…¥</li></ul><p>å§”æ‰˜ã€å¯è§æ€§ä»¥åŠå•ä¸€æ€§åŸç†</p><p>å§”æ‰˜:å³å­åŠ è½½å™¨ä¼šè¯·æ±‚çˆ¶åŠ è½½å™¨æ˜¯å¦åŠ è½½,å¹¶ä¸”åŠ è½½,å¦‚æœä¸èƒ½åŠ è½½å°±äº¤ä¼šå­åŠ è½½å™¨,å³è‡ªä¸‹è€Œä¸Šè¯·æ±‚,è‡ªä¸Šè€Œä¸‹åŠ è½½.</p><p>å¯è§æ€§: å­ç±»åŠ è½½å™¨å¯ä»¥çœ‹åˆ°çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œè€Œåä¹‹åˆ™ä¸è¡Œ</p><p>å•ä¸€æ€§: çˆ¶åŠ è½½å™¨åŠ è½½è¿‡çš„ç±»ä¸èƒ½è¢«å­åŠ è½½å™¨åŠ è½½ç¬¬äºŒæ¬¡</p><h4 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h4><p>whatï¼š<strong>è¿è¡Œ</strong>æ—¶è·å¾—ç±»ä¿¡æ¯ï¼Œæ³¨æ„æ˜¯è¿è¡Œæ—¶ã€‚</p><p>Classï¼šå­—èŠ‚ç åœ¨jvmå­˜åœ¨å½¢å¼å³ä¸ºClassçš„å¯¹è±¡ï¼Œæ˜¯ç”±jvmåˆ›å»ºçš„ã€‚</p><ul><li><p>è¿è¡Œæ—¶æ„é€ ä»»æ„ä¸€ä¸ªå¯¹è±¡</p></li><li><p>è¿è¡Œå–å¾—ä»»æ„ä¸€ä¸ªç±»æ‰€æ‹¥æœ‰æˆå‘˜å˜é‡å’Œæ–¹æ³•</p></li><li><p>è¿è¡Œæ—¶è·å¾—ä»»æ„å¯¹è±¡çš„æ–¹æ³•å±æ€§</p></li><li><p>åŠ¨æ€ä»£ç†</p></li></ul><p>howï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = Class.forName(<span class="string">"å…¨ç±»å"</span>);</span><br><span class="line">Class clazz = SomeClass.class;</span><br><span class="line">Class clazz = someClassObj.getClass();</span><br></pre></td></tr></table></figure><p>ç›¸å…³æ“ä½œï¼šå¯ä»¥æ‹¿åˆ°ä»¥ä¸‹çš„ä¿¡æ¯</p><p>Constructorï¼šgetConstructorï¼Œ getContructors</p><p>Methodï¼šgetMethodsï¼ˆç»§æ‰¿é“¾ä¸Špublicçš„ï¼‰ï¼ŒgetDeclareMethodsï¼ˆå½“å‰ç±»å£°æ˜çš„æ‰€æœ‰ï¼‰</p><p>Fieldï¼šgetFieldsï¼ˆç»§æ‰¿é“¾ä¸Špublicï¼‰ï¼ŒgetDeclareFieldsï¼ˆå½“å‰ç±»å£°æ˜æ‰€æœ‰ï¼‰</p><p>Annotationï¼šgetAnnotationï¼ŒgetDeclareAnnotaions(),getParameterAnnotations() </p><p>ä»¥åŠnewInstanceå»åˆ›å»ºå¯¹è±¡</p><p>invokeå»è°ƒç”¨æ–¹æ³•</p><h4 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Boy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Boy</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ‰“å°"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Boy boy = <span class="keyword">new</span> Student();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boy <span class="title">getProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Boy) Proxy.newProxyInstance(boy.getClass().getClassLoader(), boy.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"æˆ‘æ˜¯ä»£ç†"</span>);</span><br><span class="line">                <span class="keyword">return</span> method.invoke(boy,args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java æ³¨è§£</title>
      <link href="/2019/07/01/Java-%E6%B3%A8%E8%A7%A3/"/>
      <url>/2019/07/01/Java-%E6%B3%A8%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p><strong>æ³¨è§£</strong></p><p>whatï¼šç”¨äºæè¿°æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥è¢«ç¼–è¯‘æœŸä»¥åŠjvmæ•è·çš„ä¿¡æ¯</p><ul><li>æ³¨è§£åŸºæœ¬ä½¿ç”¨</li><li>è¿è¡Œæ—¶å¤„ç†æ³¨è§£</li><li>ç¼–è¯‘å¤„ç†æ³¨è§£</li><li>å…¶å®ƒç”¨å¤„</li></ul><h3 id="æ³¨è§£åŸºæœ¬ä½¿ç”¨"><a href="#æ³¨è§£åŸºæœ¬ä½¿ç”¨" class="headerlink" title="æ³¨è§£åŸºæœ¬ä½¿ç”¨"></a>æ³¨è§£åŸºæœ¬ä½¿ç”¨</h3><p>howï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰</span></span><br><span class="line"><span class="meta">@interface</span> One&#123;</span><br><span class="line">    <span class="comment">//ç±»ä¼¼æ–¹æ³•å£°æ˜çš„æ–¹å¼æ¥å£°æ˜å±æ€§</span></span><br><span class="line">     <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä½¿ç”¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="meta">@One</span>(name = <span class="string">"fdaf"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åŸºæœ¬æ³¨è§£</span></span><br><span class="line"><span class="meta">@Overrider</span> æè¿°é™å®šé‡ç°çˆ¶ç±»æ–¹æ³•</span><br><span class="line"><span class="meta">@Deprecated</span> æè¿°æŸä¸ªç±»æˆ–æ–¹æ³•è¿‡æ—¶</span><br><span class="line"><span class="meta">@SupressWarnings</span> æŠ‘åˆ¶ç¼–è¯‘æœŸè­¦å‘Š</span><br></pre></td></tr></table></figure><p>å…ƒæ³¨è§£ï¼šæè¿°æ³¨è§£çš„æ³¨è§£ï¼Œç”¨äºé™å®šæ³¨è§£çš„è¡Œä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span> æè¿°æ³¨è§£å°†æ³¨è§£çš„ä½ç½®ã€‚</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ElementType &#123;</span><br><span class="line">    TYPE, <span class="comment">//ç±»ï¼Œæ¥å£ï¼Œæ³¨è§£ï¼Œæšä¸¾</span></span><br><span class="line">    FIELD,<span class="comment">//å±æ€§</span></span><br><span class="line">    METHOD,<span class="comment">//æ–¹æ³•</span></span><br><span class="line">    PARAMETER,<span class="comment">//å‚æ•°</span></span><br><span class="line">    CONSTRUCTOR,<span class="comment">//æ„é€ æ–¹æ³•</span></span><br><span class="line">    LOCAL_VARIABLE,<span class="comment">//å±€éƒ¨å˜é‡</span></span><br><span class="line">    ANNOTATION_TYPE,<span class="comment">//æ³¨è§£</span></span><br><span class="line">    PACKAGE,<span class="comment">//åŒ…</span></span><br><span class="line">    TYPE_PARAMETER,<span class="comment">//Type parameter declaration</span></span><br><span class="line">    TYPE_USE<span class="comment">//Use of a type</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Retention</span> </span><br><span class="line">ä»¥ä¸‹ä¸‰ç§</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RetentionPolicy &#123;</span><br><span class="line">    SOURCE,</span><br><span class="line">    CLASS,</span><br><span class="line">    RUNTIME</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Documented</span> è¡¨ç¤ºå¯ä»¥è¢«javadocå·¥å…·æå–æˆæ–‡æ¡£</span><br><span class="line"><span class="meta">@Inherited</span> è¡¨ç¤ºç»§æ‰¿æ€§ï¼Œå¦‚æœæŸä¸ªä½¿ç”¨äº†è¯¥æ³¨è§£ä¿®é¥°çš„æ³¨è§£ï¼Œé‚£ä¹ˆå…¶å­ç±»ä¼šè‡ªåŠ¨å…·æœ‰è¯¥æ³¨è§£</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ³¨è§£åœ¨ç›¸åº”çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢çš„æ³¨è§£å¤„ç†å™¨ï¼Œæˆ–è€…åå°„å¤„ç†ï¼Œè·å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å¾—åˆ°çš„æ•°æ®ã€‚è¿™å°±æ˜¯æ³¨è§£çš„ä»»åŠ¡å•¦ã€‚</p><h3 id="è¿è¡Œå¤„ç†æ³¨è§£"><a href="#è¿è¡Œå¤„ç†æ³¨è§£" class="headerlink" title="è¿è¡Œå¤„ç†æ³¨è§£"></a>è¿è¡Œå¤„ç†æ³¨è§£</h3><p>é€šè¿‡åå°„è·å¾—Classå¯¹è±¡ï¼ŒMethodç­‰ç­‰ï¼Œä»è€Œé€šè¿‡getAnnotationç»§è€Œè·å¾—å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> learn2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationTest test = <span class="keyword">new</span> AnnotationTest();</span><br><span class="line">        test.test();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TestAnnotation</span>(msg = <span class="string">"test"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> someOne;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Class clazz = getClass();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field field = clazz.getField(<span class="string">"someOne"</span>);</span><br><span class="line">            String msg = field.getAnnotation(TestAnnotation.class).msg();</span><br><span class="line">            System.out.println(field.getAnnotation(TestAnnotation.class));</span><br><span class="line">            System.out.println(msg);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Target</span>(ElementType.FIELD)</span><br><span class="line">    <span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line">    <span class="meta">@interface</span> TestAnnotation&#123;</span><br><span class="line">        <span class="function">String <span class="title">msg</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¯‘å¤„ç†æ³¨è§£"><a href="#ç¼–è¯‘å¤„ç†æ³¨è§£" class="headerlink" title="ç¼–è¯‘å¤„ç†æ³¨è§£"></a>ç¼–è¯‘å¤„ç†æ³¨è§£</h3><p>ç¼–è¯‘æ—¶å¤„ç†æ³¨è§£ï¼Œç”Ÿæˆjavaæ–‡ä»¶</p><h3 id="å¤„ç†æ³¨è§£æ—¶çš„ç›¸å…³ç±»å’ŒAPI"><a href="#å¤„ç†æ³¨è§£æ—¶çš„ç›¸å…³ç±»å’ŒAPI" class="headerlink" title="å¤„ç†æ³¨è§£æ—¶çš„ç›¸å…³ç±»å’ŒAPI"></a>å¤„ç†æ³¨è§£æ—¶çš„ç›¸å…³ç±»å’ŒAPI</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//æ¥å£</span><br><span class="line">AnnotatedElement // è¢«æ³¨è§£çš„å…ƒç´ ï¼Œè¿™ä¸ªæ¥å£å£°æ˜çš„æ–¹æ³•åŒ…å«äº†ä¸€äº›è·å¾—æ³¨è§£æ³¨è§£å¯¹è±¡çš„æ–¹æ³•</span><br><span class="line">AnnotatedType //è¢«æ³¨è§£çš„ç±»å‹ï¼Œæœ‰ä¸€ä¸ªgetTypeçš„æ–¹æ³•//è¿™äº›æ¥å£éƒ½ä»1.8å¼€å§‹çš„ï¼Œæ„Ÿè§‰å’Œæ³›å‹ç›¸å…³</span><br><span class="line">AnnotatedArrayType //è¢«æ³¨è§£çš„æ•°ç»„ç±»å‹</span><br><span class="line">AnnotatedParameterizedType//è¢«æ³¨è§£çš„å‚æ•°åŒ–ç±»å‹ </span><br><span class="line">AnnotatedTypeVariable//è¢«æ³¨è§£çš„ç±»å‹å˜é‡</span><br><span class="line">AnnotatedWildcardType//è¢«æ³¨è§£çš„ç»Ÿé…ç¬¦ç±»å‹ è·å–ä¸Šç•Œå’Œä¸‹ç•Œçš„AnnotatedType</span><br><span class="line">//ç±»</span><br><span class="line">Filed</span><br><span class="line">Class</span><br><span class="line">Method</span><br><span class="line">Package</span><br><span class="line">Construcotr</span><br><span class="line">Paramter</span><br><span class="line">Executable</span><br><span class="line">AccessibleObject</span><br><span class="line"></span><br><span class="line">æ³¨è§£ä¸€ä¸ªæ™®é€šçš„intäº§ç”Ÿçš„AnnotatedTypeå¯¹è±¡æ˜¯sun.reflect.annotation.AnnotatedTypeFactory$AnnotatedTypeBaseImpl@1d44bcfa</span><br><span class="line">è€Œæ³¨è§£List&lt;String&gt; listç±»å‹äº§ç”Ÿçš„çš„AnnotatedTypeå¯¹è±¡æ˜¯sun.reflect.annotation.AnnotatedTypeFactory$AnnotatedParameterizedTypeImpl@1d44bcfa</span><br><span class="line">è€Œå¯¹int[] list äº§ç”Ÿçš„æ˜¯</span><br><span class="line">sun.reflect.annotation.AnnotatedTypeFactory$AnnotatedArrayTypeImpl@1d44bcfa</span><br><span class="line">ä¸ä¹‹å¯¹åº”çš„æ˜¯é‚£å‡ ä¸ªæ¥å£çš„å®ç°ç±»ï¼Œè™½ç„¶æˆ‘æ²¡ææ‡‚æœ‰å•¥ç”¨ã€‚ã€‚</span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒç”¨å¤„"><a href="#å…¶å®ƒç”¨å¤„" class="headerlink" title="å…¶å®ƒç”¨å¤„"></a>å…¶å®ƒç”¨å¤„</h3><p>ç”¨äºè®¾å®šå¸¸é‡</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java å®¹å™¨</title>
      <link href="/2019/06/30/Java-%E5%AE%B9%E5%99%A8/"/>
      <url>/2019/06/30/Java-%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="Java-å®¹å™¨"><a href="#Java-å®¹å™¨" class="headerlink" title="Java  å®¹å™¨"></a>Java  å®¹å™¨</h3><ul><li>List</li><li>Set</li><li>Map</li><li>Queue</li><li>Iterator</li><li>å·¥å…·ç±»</li><li>å¹¶å‘å®¹å™¨</li><li>androidä¸­çš„ç‰¹æ®Šé›†åˆ</li></ul><h4 id="ç›¸å…³æ¥å£"><a href="#ç›¸å…³æ¥å£" class="headerlink" title="ç›¸å…³æ¥å£"></a>ç›¸å…³æ¥å£</h4><ul><li><p>Iterable ä»£è¡¨å¯è¿­ä»£ï¼Œå®ç°çš„æ–¹æ³•éœ€è¦äº§å‡ºä¸€ä¸ªè¿­ä»£å™¨</p></li><li><p>Collection é™¤äº†Mapå¤–çš„ç¥–å…ˆé›†åˆæ¥å£</p></li><li><p>List</p></li><li><p>Set</p></li><li><p>Map</p><p>Set å’Œ Listéƒ½æ˜¯ä¸€è·¯ç»§æ‰¿Collectionä¸‹æ¥</p><p>Mapåˆ™æ˜¯å•ç‹¬çš„</p></li></ul><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>å®šä¹‰äº†ä»¥å¥—é€šè¿‡ç´¢å¼•è¿›è¡Œè·å–ï¼Œå’Œæ·»åŠ çš„é›†åˆ</p><ul><li>ArrayList     å†…éƒ¨æ˜¯ä¸€ä¸ªåŠ¨æ€æ‰©å®¹çš„æ•°ç»„å®ç°ã€‚</li><li>LinkedList   å†…éƒ¨æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨å®ç°</li><li>Vector å†…éƒ¨ä¹Ÿæ˜¯åŠ¨æ€æ‰©å®¹çš„æ•°ç»„å®ç°ï¼Œä¸è¿‡å¤§éƒ¨åˆ†æ–¹æ³•é€šè¿‡synchronizedè¿›è¡Œé”ä½æ–¹æ³•ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯æ•ˆç‡ä¸é«˜ã€‚</li><li>Stack Vectorçš„å­ç±»</li></ul><h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><p>å®šä¹‰äº†ä¸€ç»„ä¸å¯é‡å¤çš„é›†åˆï¼Œé€šè¿‡å“ˆå¸Œå€¼æ¥åˆ¤æ–­</p><ul><li>HashSet å†…éƒ¨æ˜¯é€šè¿‡ä¸€ä¸ªHashMapæ¥å®ç°ï¼Œç­‰åŒäºHashMapçš„é”®ï¼Œå€¼æ’ä¸ºåŒä¸€ä¸ªObject</li><li>TreeSet å†…éƒ¨æ˜¯é€šè¿‡ä¸€ä¸ªTreeMapæ¥å®ç°</li></ul><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><p>å®šä¹‰äº†é€šè¿‡é”®å€¼æ˜ å°„çš„é›†åˆ</p><ul><li>HashMap å†…éƒ¨é€šè¿‡ æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘è¿›è¡Œå®ç°çš„Map</li><li>TreeMap  å†…éƒ¨é€šè¿‡çº¢é»‘æ ‘è¿›è¡Œå®ç°ï¼Œä¿æŒå†…éƒ¨æ’åºé¡ºåº</li><li>HashTable å¤è€å®ç°ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä¸é«˜</li><li>Properties keyå’Œvalueéƒ½æ˜¯Stringç±»å‹</li></ul><h4 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h4><p>é˜Ÿåˆ—</p><h4 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h4><p>ç”Ÿæˆå™¨ï¼Œç”¨äºforeachå¾ªç¯</p><h4 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h4><ul><li>ArraysåŒ…å«äº†è®¸å¤šå¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œå¤åˆ¶ç­‰æ“ä½œçš„å·¥å…·ç±»</li><li>CollectionsåŒ…å«è®¸å¤šå¯¹é›†åˆè¿›è¡Œæ“ä½œ</li><li>ComparatorsåŒ…å«å¯¹æ¯”è¾ƒå™¨çš„å·¥å…·</li></ul><h4 id="å¹¶å‘å®¹å™¨"><a href="#å¹¶å‘å®¹å™¨" class="headerlink" title="å¹¶å‘å®¹å™¨"></a>å¹¶å‘å®¹å™¨</h4><p>ä»¥ä¸Šä¸­åªæœ‰Vectoerå’ŒHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å®ƒæ˜¯å°†æ•´ä¸ªé›†åˆéƒ½é”ä½äº†ï¼Œæ•ˆç‡ä¸é«˜ã€‚</p><ul><li>CopyOnWriteArryList</li><li>CopyOnWriteArraySet å†™æ—¶å¤åˆ¶ï¼Œåœ¨å†™å…¥çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªå‰¯æœ¬è¿›è¡Œå†™å…¥ï¼Œå½“è¿­ä»£å¤šäºä¿®æ”¹ï¼Œåº”è¯¥ä½¿ç”¨å†™æ—¶å¤åˆ¶å®¹å™¨</li><li>ConcurrentHashMap </li><li>ConcurrentSkipListSet </li><li>é˜»å¡é˜Ÿåˆ—</li></ul><p>ConcurrentMapå®¹å™¨:1.8ä»¥å‰é‡‡ç”¨é”åˆ†æ®µæŠ€æœ¯ï¼Œ1.8å¼€å§‹ä½¿ç”¨CASæ— é”æŠ€æœ¯ã€‚</p><h4 id="androidä¸­ç‰¹æ®Šå®¹å™¨"><a href="#androidä¸­ç‰¹æ®Šå®¹å™¨" class="headerlink" title="androidä¸­ç‰¹æ®Šå®¹å™¨"></a>androidä¸­ç‰¹æ®Šå®¹å™¨</h4><p>SparseArray ä½¿ç”¨ç¨€ç–æ•°ç»„å®ç°çš„ä¸€ä¸ªkeyä¸ºintï¼Œvalueä¸ºObjectçš„é›†åˆ</p><p>LongSparseArray keyä¸ºlong valueä¸ºobject</p><p>SparseLongArray keyä¸ºint valueä¸ºlong</p><p>SparseBooleanArray keyä¸ºint valueä¸ºboolean</p><p>SparseIntArray keyä¸ºint valueä¸ºint</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java åŸºç¡€çŸ¥è¯†æ¢³ç†</title>
      <link href="/2019/06/30/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/"/>
      <url>/2019/06/30/Java-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="Java-åŸºç¡€å†…å®¹"><a href="#Java-åŸºç¡€å†…å®¹" class="headerlink" title="Java  åŸºç¡€å†…å®¹"></a>Java  åŸºç¡€å†…å®¹</h3><ul><li>æ•°æ®ç±»å‹</li><li>è¿ç®—ç¬¦</li><li>æµç¨‹æ§åˆ¶</li><li>é¢å‘å¯¹è±¡</li><li>é‡è¦å…³é”®å­—</li><li>å¼‚å¸¸</li><li>ç¼–ç </li><li>Objectç±»</li></ul><h4 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h4><p>è®¡ç®—æœºä¸­æœ€å°çš„å•ä½æ˜¯bitï¼Œä¸€ä¸ªä½0/1è¡¨ç¤º</p><h5 id="åŸºç¡€æ•°æ®ç±»å‹"><a href="#åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="åŸºç¡€æ•°æ®ç±»å‹"></a>åŸºç¡€æ•°æ®ç±»å‹</h5><ul><li><p>byte  1å­—èŠ‚ </p></li><li><p>short 2å­—èŠ‚ </p></li><li><p>int  4å­—èŠ‚</p></li><li><p>long 8å­—èŠ‚</p></li><li><p>float 4å­—èŠ‚</p></li><li><p>double 8å­—èŠ‚</p></li><li><p>boolean 1å­—èŠ‚</p></li><li><p>char 2å­—èŠ‚ å¯ä»¥ä¸ºunicodeç¼–ç ï¼Œä½äºæ ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> a = <span class="string">'\u1233'</span>;<span class="comment">//unicodeç¼–ç è¡¨è¾¾</span></span><br></pre></td></tr></table></figure></li></ul><p>å¼•ç”¨æ•°æ®ç±»å‹ï¼šå¼•ç”¨ä½äºæ ˆï¼Œå¼•ç”¨çš„å¯¹è±¡ä½äºå †</p><p>é«˜ç²¾åº¦å‘ä½ç²¾åº¦å¯èƒ½ä¸¢å¤±ï¼Œè¡¨è¾¾å¼ä¸­é»˜è®¤è½¬æ¢ä¸ºå½“å‰è¡¨è¾¾å¼çš„æœ€å¤§ç²¾åº¦è¿›è¡Œè®¡ç®—</p><h5 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h5><ul><li>åŸºç¡€è¿ç®—ç¬¦</li><li>instanceof ç”¨äºåˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯æŸç±»å‹</li></ul><h4 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h4><ul><li><p>if else</p></li><li><p>if elseif </p></li><li><p>while</p></li><li><p>do while</p></li><li><p>for</p></li><li><p>foreach éœ€è¦å®¹å™¨å®ç°Iterableæ¥å£å’ŒIteratoræ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(SomeType obj: objList) &#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h4><h5 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h5><p>å…³é”®å­—extendsï¼Œç±»çš„ç»§æ‰¿å’Œæ¥å£çš„ç»§æ‰¿</p><h5 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h5><p>è®¿é—®æ§åˆ¶privateï¼Œdefaultï¼Œprotectedï¼Œpublic</p><h5 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h5><p>é€šè¿‡çˆ¶ç±»æˆ–è€…æ¥å£å¼•ç”¨è®¿é—®å®é™…å¯¹è±¡çš„æ–¹æ³•ï¼Œç§°ä¸ºåŠ¨æ€ç»‘å®šï¼Œå®åœ¨è¿è¡Œæ—¶æ‰èƒ½å†³å®šçš„ã€‚</p><h5 id="é‡è½½"><a href="#é‡è½½" class="headerlink" title="é‡è½½"></a>é‡è½½</h5><p>é™æ€ç»‘å®šï¼Œå³åŒåæ–¹æ³•å­˜åœ¨ä¸åŒçš„å‚æ•°åˆ—è¡¨ï¼ˆç±»å‹ï¼Œæ•°é‡ï¼‰</p><h5 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h5><p>æˆå‘˜å’Œæ–¹æ³•ä¿®é¥°ä¸ºpublic ï¼Œå®ç°çš„ç±»éœ€è¦å®ç°æ–¹æ³•ï¼Œä¸æ¥å£é—´å¯ä»¥ç»§æ‰¿ã€‚åªæœ‰å£°æ˜ï¼Œä½†æ˜¯æ–°ç‰ˆjdkå¯ä»¥å­˜åœ¨é»˜è®¤æ–¹æ³•ï¼Œä½¿ç”¨defaultå®šä¹‰</p><h5 id="å†…éƒ¨ç±»"><a href="#å†…éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»"></a>å†…éƒ¨ç±»</h5><p>åŒ¿åå†…éƒ¨ç±»ï¼Œé»˜è®¤æŒæœ‰å¤–éƒ¨ç±»thiså¼•ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åªæ˜¯å°†åŒ¿åå†…éƒ¨ç±»å¤åˆ¶ç»™äº†ä¸€ä¸ªå¼•ç”¨ï¼Œå…¶å®å†å‚æ•°ä¼ é€’ä¸­çš„å†…éƒ¨ç±»ï¼ŒåŒæ ·ä¹Ÿæ˜¯å°†åŒ¿åå†…éƒ¨ç±»å¯¹è±¡ä¼ é€’ç»™äº†ï¼Œä¸´æ—¶çš„å¼•ç”¨ã€‚</span></span><br><span class="line">   <span class="comment">//æ–¹æ³•å®ç°</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    B b = <span class="keyword">new</span> B()&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">b</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">b</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆå‘˜å†…éƒ¨ç±»ï¼Œé»˜è®¤æŒæœ‰å¤–éƒ¨ç±»thiså¼•ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        B b = a.new B();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™æ€å†…éƒ¨ç±»ï¼Œä¸ä¼šæŒæœ‰å¤–éƒ¨å¼•ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class A&#123;</span><br><span class="line"><span class="keyword">static</span> B&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mian</span><span class="params">()</span> </span>&#123;</span><br><span class="line">B b = <span class="keyword">new</span> A.B();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†…éƒ¨ç±»å¯ä»¥å’Œæˆå‘˜ä¸€æ ·è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ã€‚</p><p>åŒ¿åå†…éƒ¨ç±»å¯¹è±¡åœ¨è®¿é—®æ–¹æ³•å‚æ•°ï¼Œå‚æ•°éœ€è¦å®šä¹‰ä¸ºfinalï¼Œå› ä¸ºåœ¨æ–¹æ³•ä¸­ä¸€æ—¦ä¸€å¼€ï¼Œå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå°±ç»“æŸäº†ï¼Œä½†æ˜¯åŒ¿åå†…éƒ¨ç±»å¯¹è±¡è¿˜å¼•ç”¨ç€ï¼Œé€šè¿‡ä½¿ç”¨finalæ¥æ‹·è´ä¸€ä»½ä½¿ç”¨ï¼Œé—´æ¥çš„å»¶é•¿äº†ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±å¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚</p><h5 id="å¼•ç”¨ç±»å‹"><a href="#å¼•ç”¨ç±»å‹" class="headerlink" title="å¼•ç”¨ç±»å‹"></a>å¼•ç”¨ç±»å‹</h5><ul><li>å¼ºå¼•ç”¨ åªè¦æŒæœ‰å¼ºå¼•ç”¨ï¼ŒJVMå®å¯æŠ›å‡ºå†…å­˜æ³„æ¼ä¹Ÿä¸æ„¿æ„å»å›æ”¶</li><li>è½¯å¼•ç”¨ åœ¨æ²¡æœ‰å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹ä¸”å†…å­˜ä¸è¶³æƒ…å†µä¸‹ä¼šå»å›æ”¶å¯¹è±¡</li><li>å¼±å¼•ç”¨ åœ¨æ²¡æœ‰å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹å›å»å›æ”¶å¯¹è±¡</li><li>è™šå¼•ç”¨ å½¢åŒè™šè®¾ï¼Œå¸¸ç”¨äºjvmå†…éƒ¨è·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ å¥½, Hexo</title>
      <link href="/2019/06/29/%E4%BD%A0%E5%A5%BD-Hexo/"/>
      <url>/2019/06/29/%E4%BD%A0%E5%A5%BD-Hexo/</url>
      
        <content type="html"><![CDATA[<h3 id="ä½ å¥½ï¼ŒHexo"><a href="#ä½ å¥½ï¼ŒHexo" class="headerlink" title="ä½ å¥½ï¼ŒHexo"></a>ä½ å¥½ï¼ŒHexo</h3><h4 id="ç¼˜ç”±"><a href="#ç¼˜ç”±" class="headerlink" title="ç¼˜ç”±"></a>ç¼˜ç”±</h4><p>é¦–å…ˆç”¨hexoæ­å»ºåšå®¢è¿˜æ˜¯è›®çˆ½çš„ï¼ŒåŸºæœ¬åªéœ€è¦é…ç½®åŠ ä¸Šå†™mdæ–‡ä»¶å³å¯ï¼Œé¢œå€¼é«˜çš„æˆ‘éƒ½æƒ³å­¦å‰ç«¯äº†2333ã€‚æœ€è¿‘æˆ‘æ˜¯æƒ³ç€å‡†å¤‡æ‰¾æ–°å·¥ä½œäº†ï¼Œä½†æ˜¯å‘¢ï¼Œå¾—å¤ä¹ çŸ¥è¯†ï¼Œè€Œæˆ‘åŸºæœ¬ä¸Šåˆä¸æ€ä¹ˆå–œæ¬¢å½’çº³çŸ¥è¯†ï¼Œå³ä½¿æ˜¯å½’çº³ä¹Ÿåªç”¨å°è±¡ç¬”è®°åšåšé€Ÿè®°ï¼Œæ‰€ä»¥æˆ‘æ„Ÿè§‰è‡ªå·±å¾ˆè™šï¼Œå¤ªæµ®èºäº†ã€‚ä½†æ˜¯çœ‹åˆ«äººå¾—åšå®¢ï¼Œä»–ä»¬æ€ä¹ˆèƒ½å†™è¿™ä¹ˆå¤šå‘€ï¼äºæ˜¯æˆ‘è§‰å¾—æˆ‘å¾—è®¤çœŸå¯¹å¾…åšç¬”è®°è¿™ä»¶äº‹äº†ï¼Œå†™çš„åšå®¢ä¸èƒ½åƒä»¥å‰å†™é€Ÿè®°ä¼¼çš„ã€‚</p><p>æŠ›å¼€å…³äºå·¥ä½œå­¦ä¹ ä¸Šäº‹æƒ…ï¼Œå…¶å®ç”¨åšå®¢æ¥è®°å½•ç”Ÿæ´»ä¹Ÿå¾ˆå¿…è¦ã€‚</p><a id="more"></a><p>ç¬¬ä¸€ã€æˆ‘è¡¨è¾¾èƒ½åŠ›ä¸è¿‡å…³ï¼Œæœ‰æ—¶å€™åè„‘å­å¯ä»¥æƒ³å¾ˆå¤šè¯è¯­ï¼Œä½†æ˜¯è½å®åˆ°å£å¤´ç»¼åˆèµ·æ¥å°±ä¸æ˜¯ä¸€å›äº‹äº†ï¼Œæƒ³æ³•åƒå¥‡ç™¾æ€ªï¼Œè½¬ç¬å³é€ï¼Œç»¼åˆåˆ°å˜´å·´è¯´å‡ºæ¥çš„å°±æ›´å°‘äº†ã€‚ç©¶å…¶åŸå› æ˜¯æˆ‘çš„è¯­æ–‡æ°´å¹³é©¾é©­ä¸ä½è¿™äº›æ„è¯†ï¼Œå‘ƒå‘ƒï¼ˆæ¯”å¦‚ç°åœ¨2333ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¿—ç§°çš„çœ‹ä¹¦çœ‹å°‘äº†ï¼Œå†™ä¸œè¥¿å†™å°‘äº†ã€‚å¯¹äºæ–‡å­—æŒæ§èƒ½åŠ›ï¼Œæˆ‘æ„Ÿè§‰æ˜¯å…¶å®ƒå¾ˆå¤šæŠ€èƒ½çš„åŸºç¡€ï¼Œæ‰€ä»¥å’¯ï¼Œå¾—åšï¼</p><p>ç¬¬äºŒã€ è®°å¿†å¯¹æŠ—ï¼Œç°åœ¨æˆ‘é—­ä¸Šçœ¼ç›ï¼Œä¸€å‘¨å¹³å¹³æ·¡æ·¡ï¼Œç«Ÿç„¶å›å¿†ä¸åˆ°å¤ªå¤šäº‹æƒ…ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œèƒ½ç•™åœ¨æˆ‘è®°å¿†ä¸­ä¸œè¥¿æ›´æ˜¯å°‘ä¹‹åˆå°‘ï¼Œç”šè‡³æˆ‘å¾—æ‹¼å‘½å›å¿†æ‰èƒ½å›æƒ³åˆ°æ›¾ä»Šå¾—åŒå­¦ä»¥åŠç”Ÿæ´»å¾—æƒ…ã€‚å°½å¯èƒ½å¾—é€šè¿‡åšå®¢æ¥è®°å½•ç”Ÿæ´»çš„è½¨è¿¹ã€‚æˆ‘ä¸æƒ³è¿‡çš„è™šæ— ç¼¥ç¼ˆã€‚</p><p>ç¬¬ä¸‰ã€å†™åšå®¢ï¼Œæ˜¯ä¸€æ¬¡å’Œè‡ªå·±å¯¹è¯çš„æœºä¼šï¼Œè¯•é—®æœ‰å¤šä¹…æ²¡æœ‰é™ä¸‹å¿ƒæ¥å’Œè‡ªå·±å¯¹è¯äº†ï¼ˆå…¶å®å°±æ˜¯åçœ2333ï¼‰ã€‚</p><h4 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h4><ul><li>åšæŒå†™</li><li>è®¤çœŸæ€»ç»“å¹¶å†™å‡ºæŠ€æœ¯ç±»æ–‡ç«  ï¼ˆè™½ç„¶ç›®å‰å†™çš„ä¸œè¥¿æ˜¯çœŸçš„æ°´ï¼Œæˆ‘ä¼šæ”¹å–„çš„ï¼ï¼ï¼‰</li><li>æœ‰ä»€ä¹ˆæƒ³æ³•ä»¥åŠèƒ½è®°å½•ä¸€å®šè¦è®°å½•</li><li>å¾…å®Œå–„ã€‚ã€‚ã€‚</li></ul><p>æ˜æ˜åœ¨è·¯ä¸Šçš„æ—¶å€™è¿˜æƒ³äº†å¾…ä¼šè¦å†™å•¥çš„ï¼Œç»“æœå‘ƒå‘ƒï¼Œè¿™ä¸ªå­—æ•°å’Œæ°´å¹³è¿˜ä¸åˆ°ä¸€ç¯‡ä½œæ–‡ã€‚shitï¼Œçœ‹å§ï¼Œæœ‰å¤šé‡è¦äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç”Ÿæ´» </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/06/29/hello-world/"/>
      <url>/2019/06/29/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
